(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[79],{1137:function(e,t,i){"use strict";i.r(t),i.d(t,"LineOfSightLayerView3D",(function(){return le})),i.d(t,"default",(function(){return ue}));var n=i(2),r=i(4),a=i(6),o=i(7),s=i(0),c=i(3),l=i(1),u=(i(17),i(18),i(15),i(11)),b=i(578),d=i(8),h=i.n(d),O=i(16),v=(i(129),i(33)),y=i(90),j=i(60),f=i(195),p=i(23),g=i(198),_=i(5),m=i(10),C=i(48),w=i(42),k=i(80),A=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).elevationAlignedTargetLocation=null,r.inputPoints={isValid:!1,observer:Object(m.e)(),observerSurfaceNormal:null,target:Object(m.e)(),targetSurfaceNormal:null,observerAdjusted:Object(m.e)(),targetAdjusted:Object(m.e)()},r.computationResult={start:Object(m.e)(),end:Object(m.e)(),intersection:Object(m.e)(),isValid:!1,isTargetVisible:!1},r.result=null,r}return Object(r.a)(i,[{key:"updateComputationResults",value:function(){this.notifyChange("computationResult")}},{key:"updateInputPoints",value:function(){this.notifyChange("inputPoints")}},{key:"onElevationChange",value:function(){this.notifyChange("elevationAlignedTargetLocation")}}]),i}(v.a);Object(s.a)([Object(l.b)()],A.prototype,"target",void 0),Object(s.a)([Object(l.b)()],A.prototype,"elevationAlignedTargetLocation",void 0),Object(s.a)([Object(l.b)()],A.prototype,"inputPoints",void 0),Object(s.a)([Object(l.b)()],A.prototype,"computationResult",void 0),Object(s.a)([Object(l.b)()],A.prototype,"result",void 0),A=Object(s.a)([Object(u.a)("esri.views.3d.layers.analysis.LineOfSight.LineOfSightAnalysis")],A);var R=i(31),V=i(50),L=i(184),E=i(214),T=i(140),I=i(146),S=i(437),P=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(n.a)(this,i),t.call(this,e)}return Object(r.a)(i,[{key:"initialize",value:function(){this.intersector=new I.a(this.view.state.viewingMode),this.intersector.options.hud=!1,this.intersector.options.store=0}},{key:"getScreenPointIntersection",value:function(e){var t=Object(R.i)(e,V.c.get()),i=Object(E.c)(this.view.state.camera,t,M);return this._getRayIntersection(i)}},{key:"_getRayIntersection",value:function(e){if(Object(c.j)(e))return null;this.view.sceneIntersectionHelper.intersectToolIntersectorRay(e,this.intersector);var t=this.intersector.results.min,i=D;if(!t||!t.getIntersectionPoint(i))return null;var n=this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference),r=Object(m.e)();Object(_.m)(r,t.normal);var a=Object(_.j)(r,e.direction)>0?-1:1;Object(_.g)(r,r,a);var o=Object(S.a)(t,this.view);if(Object(c.k)(o)){var s,l=o.layer,u=o.sourceLayer;if(u)switch(u.type){case"scene":s=Object(L.g)(o,u.objectIdField);break;case"integrated-mesh":var b=t.target;s="".concat(b.metadata.nodeIndex,"/").concat(b.metadata.componentIndex);break;default:s=o.uid}else s=o.uid;return{type:"Graphic",id:"".concat(l.uid,"/").concat(s),ray:Object(k.b)(e),normal:r,point:n}}return"TerrainRenderer"===t.intersector?{type:"Terrain",id:t.target.metadata.tile.lij.slice(),ray:Object(k.b)(e),normal:r,point:n}:null}},{key:"_canUpdateFromIntersectionResult",value:function(e,t){if(Object(c.j)(e)||!t||e.type!==t.type)return!1;switch(e.type){case"Terrain":var i=e.id,n=t.id;return i[0]===n[0]&&i[1]===n[1]&&i[2]===n[2]||Object(T.j)(i,n);case"Graphic":case"I3S":return e.id===t.id}}},{key:"updateFromIntersectionResult",value:function(e){var t;if("Terrain"===e.type&&Object(c.k)(e.point)){var i=D,n=G,r=H;this.view.renderCoordsHelper.toRenderCoords(e.point,n),this.view.renderCoordsHelper.worldUpAtPosition(n,r);var a=this.view.basemapTerrain.elevationBounds,o=this.view.renderCoordsHelper.getAltitude(n),s=a?Math.abs(a.max-a.min)/Math.abs(o):100,l=o>0?1:-1;Object(_.t)(r,r),Object(_.g)(r,r,l*s),Object(_.h)(i,n,r),Object(k.e)(i,n,M),t=this._getRayIntersection(M)}else t=this._getRayIntersection(e.ray);return this._canUpdateFromIntersectionResult(t,e)?t.point:null}}]),i}(v.a);Object(s.a)([Object(l.b)()],P.prototype,"view",void 0),Object(s.a)([Object(l.b)()],P.prototype,"intersector",void 0),P=Object(s.a)([Object(u.a)("esri.views.3d.interactive.analysisTools.lineOfSight.LineOfSightRayIntersector")],P);var D=Object(m.e)(),G=Object(m.e)(),H=Object(m.e)(),M=Object(k.c)(),x=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).target=null,r.intersectedGraphic=null,r.intersectedLocation=null,r.elevationAlignedTargetLocation=null,r}return i}(v.a);Object(s.a)([Object(l.b)()],x.prototype,"target",void 0),Object(s.a)([Object(l.b)()],x.prototype,"intersectedGraphic",void 0),Object(s.a)([Object(l.b)()],x.prototype,"intersectedLocation",void 0),Object(s.a)([Object(l.b)()],x.prototype,"elevationAlignedTargetLocation",void 0),Object(s.a)([Object(l.b)()],x.prototype,"visible",void 0),x=Object(s.a)([Object(u.a)("esri.views.3d.layers.analysis.LineOfSight.LineOfSightResult")],x);var F=i(162),z=i(97),U=i(58),N=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._tasks=z.a,r._handles=new j.a,r._analysisHandles=new j.a,r}return Object(r.a)(i,[{key:"initialize",value:function(){var e,t=null==(e=this.view.resourceController)?void 0:e.scheduler;t&&(this._tasks=t.registerTask(z.b.LINE_OF_SIGHT_TOOL)),this._handles.add([this._connectObserver(),this._connectAnalyses(),this._connectTargets()]),this._intersector=new P({view:this.view})}},{key:"destroy",value:function(){this._handles.destroy(),this._analysisHandles.destroy(),this._analyses.removeAll()}},{key:"updating",get:function(){return this._tasks.updating}},{key:"priority",get:function(){return this._tasks.priority},set:function(e){this._tasks.priority=e}},{key:"_analyses",get:function(){return this.layerViewData.analyses}},{key:"_observerEngineLocation",get:function(){return this.layerViewData.observerEngineLocation},set:function(e){this.layerViewData.observerEngineLocation=e}},{key:"_screenPixelSize",get:function(){return this.view.state.camera.computeScreenPixelSizeAt(this._observerEngineLocation)}},{key:"getLineOfSightComputationDependencies",value:function(e){return{inputPoints:e.inputPoints}}},{key:"computeAnalysis",value:function(e){var t=e.analysis,i=t.inputPoints,n=t.computationResult,r=i.observerAdjusted,a=i.targetAdjusted,o=n.start,s=n.end;Object(_.m)(o,r),Object(_.m)(s,a),this._canComputeAnalysis(t)?this._computeAnalysisIntersection(e):this._interpolateAnalysisIntersection(e),t.updateComputationResults(),this.emit("result-changed",{target:e.analysis.target,result:t.result})}},{key:"_adjustStartEndPositions",value:function(e){var t=this._screenPixelSize,i=this.view,n=e.inputPoints,r=n.observer,a=n.observerSurfaceNormal,o=n.target,s=n.targetSurfaceNormal,l=n.observerAdjusted,u=n.targetAdjusted,b=J;Object(c.k)(a)?Object(_.m)(b,a):Object(_.l)(b,o,r);var d=t;Object(_.t)(b,b),Object(_.g)(b,b,Math.min(d,1)),Object(_.h)(l,r,b),Object(c.k)(s)?Object(_.m)(b,s):Object(_.l)(b,r,o);var h=i.state.camera.computeScreenPixelSizeAt(o);Object(_.t)(b,b),Object(_.g)(b,b,Math.min(h,1)),Object(_.h)(u,o,b)}},{key:"_computeAnalysisIntersection",value:function(e){var t=e.analysis,i=e.interpolationInfo,n=this.view,r=n.sceneIntersectionHelper,a=n.renderCoordsHelper;if(!Object(c.j)(r)){var o=this._intersector.intersector,s=t.computationResult,l=t.inputPoints,u=l.observer,b=l.target,d=s.start,h=s.end,O=Object(k.e)(d,h,Z);r.intersectToolIntersectorRay(O,o);var v=s.intersection,y=J,j=!!o.results.min&&o.results.min.getIntersectionPoint(v),f=!0;if(j){Object(_.m)(i.originalIntersection,v),Object(_.m)(i.originalObserver,d),Object(_.m)(i.originalTarget,h),a.fromRenderCoords(v,y,n.spatialReference);var p=1-Object(_.p)(h,b)/Object(_.p)(d,b);f=Object(_.p)(u,v)>=p*Object(_.p)(u,b)}var g=new U.a(y,n.spatialReference),m=t.result,C=t.target;Object(c.k)(m)?(m.target=C,m.intersectedGraphic=f?null:Object(S.a)(o.results.min,n),m.intersectedLocation=f?null:g,m.visible=!!j&&f):t.result=new x({target:C,elevationAlignedTargetLocation:t.elevationAlignedTargetLocation,intersectedGraphic:f?null:Object(S.a)(o.results.min,n),intersectedLocation:f?null:g,visible:!!j&&f}),s.isValid=l.isValid=!0,s.isTargetVisible=f}}},{key:"_interpolateAnalysisIntersection",value:function(e){var t=e.analysis,i=e.interpolationInfo,n=t.computationResult,r=t.inputPoints,a=n.start,o=n.end,s=n.intersection,c=i.originalIntersection,l=i.originalObserver,u=i.originalTarget;if(Object(_.m)(s,c),r.isValid){var b=J,d=Object(_.p)(l,c)/Object(_.p)(l,u);Object(_.C)(b,a,l),Object(_.g)(b,b,1-d),Object(_.h)(s,s,b),Object(_.C)(b,o,u),Object(_.g)(b,b,d),Object(_.h)(s,s,b),n.isValid=!0}else t.result=new x,n.isValid=!1,n.isTargetVisible=!1}},{key:"_canComputeAnalysis",value:function(e){var t=this.layerViewData.elevationAlignedObserver,i=this.view.frustum;if(Object(c.j)(t)||Object(c.j)(e.target)||Object(c.j)(i))return!1;var n=e.inputPoints,r=n.observerAdjusted,a=n.targetAdjusted,o=i.intersectsPoint(r),s=i.intersectsPoint(a);return o&&s}},{key:"_onObserverChange",value:function(e){if(Object(c.j)(e))return this.layer.targets.removeAll(),void(this.layerViewData.elevationAlignedObserver=null);this.layerViewData.elevationAlignedObserver=this._applyElevationAlignment(e,this.layer.intersection);var t=Object(m.e)();this.view.renderCoordsHelper.toRenderCoords(this.layerViewData.elevationAlignedObserver,t),this._observerEngineLocation=t,this.priority=z.b.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_applyElevationAlignment",value:function(e,t){if(e.hasZ&&(Object(c.j)(t)||"Graphic"===t.type))return e;var i=e.clone();return i.z=Object(c.u)(Object(F.b)(this.view.elevationProvider,i),0),i}},{key:"_onObserverChangeForAnalysis",value:function(e){e.inputPoints.isValid=!1}},{key:"_onObserverEngineForAnalysis",value:function(e,t,i){var n=e.inputPoints;if(Object(_.m)(n.observer,t),Object(c.k)(i)){var r=this._intersector.updateFromIntersectionResult(i);Object(c.k)(r)&&this.view.renderCoordsHelper.toRenderCoords(r,n.observer),n.observerSurfaceNormal=Object(m.c)(i.normal)}else n.observerSurfaceNormal=null;this._adjustStartEndPositions(e),e.updateInputPoints(),this.priority=z.b.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_onTargetLocationChange",value:function(e,t,i){var n=e.inputPoints;if(n.isValid=!1,Object(c.k)(t)){if(e.elevationAlignedTargetLocation=this._applyElevationAlignment(t,i),this.view.renderCoordsHelper.toRenderCoords(e.elevationAlignedTargetLocation,n.target),Object(c.k)(i)){var r=this._intersector.updateFromIntersectionResult(i);Object(c.k)(r)&&this.view.renderCoordsHelper.toRenderCoords(r,n.target),n.targetSurfaceNormal=Object(m.c)(i.normal)}else n.targetSurfaceNormal=null;this._adjustStartEndPositions(e),e.updateInputPoints()}this.priority=z.b.LINE_OF_SIGHT_TOOL_INTERACTIVE}},{key:"_connectAnalysisToTarget",value:function(e){var t=this;return Object(g.d)((function(){return{analysis:e,targetLocation:e.target.location,targetIntersection:e.target.intersection}}),(function(e){var i=e.analysis,n=e.targetLocation,r=e.targetIntersection;Object(c.k)(n)&&t._onTargetLocationChange(i,n,r)}))}},{key:"_connectAnalysisToObserver",value:function(e){var t=this;return Object(g.d)((function(){return{analysis:e,observer:t.layerViewData.elevationAlignedObserver}}),(function(e){var i=e.analysis;t._onObserverChangeForAnalysis(i)}))}},{key:"_connectAnalysisToObserverEngine",value:function(e){var t=this;return Object(g.d)((function(){return{analysis:e,observer:t._observerEngineLocation,observerIntersection:t.layer.intersection}}),(function(e){var i=e.analysis,n=e.observer,r=e.observerIntersection;t._onObserverEngineForAnalysis(i,n,r)}))}},{key:"_connectAnalysisToCamera",value:function(e){var t=this;return Object(g.b)((function(){return{camera:t.view.state.camera,isDirty:t._isCameraDirty}}),(function(t){var i=t.isDirty;e.inputPoints.isValid&&!i||e.updateInputPoints()}))}},{key:"_connectAnalysisToElevation",value:function(e){var t=this;return this.view.elevationProvider.on("elevation-change",(function(i){if(t._canComputeAnalysis(e)){var n=t.layer.observer;B(i.extent,i.spatialReference,n)&&t._onObserverChange(n);var r=e.target;Object(c.k)(r)&&B(i.extent,i.spatialReference,r.location)&&e.onElevationChange()}}))}},{key:"_connectAnalysisForCompute",value:function(e){var t=this,i=c.p,n={analysis:e,interpolationInfo:{originalIntersection:Object(m.e)(),originalObserver:Object(m.e)(),originalTarget:Object(m.e)()}};return Object(f.a)([Object(g.d)((function(){return t.getLineOfSightComputationDependencies(e)}),(function(){i=Object(c.a)(i),i=Object(p.i)(function(){var e=Object(O.a)(h.a.mark((function e(i){return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(p.m)(t._tasks.schedule((function(){return t.computeAnalysis(n)}),i));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),Object(f.b)((function(){return i=Object(c.a)(i)}))])}},{key:"_connectAnalysis",value:function(e){var t=this._analysisHandles;t.has(e)||t.add([this._connectAnalysisToTarget(e),this._connectAnalysisToObserver(e),this._connectAnalysisToObserverEngine(e),this._connectAnalysisToCamera(e),this._connectAnalysisToElevation(e),this._connectAnalysisForCompute(e)])}},{key:"_disconnectAnalysis",value:function(e){this._analysisHandles.remove(e)}},{key:"_onAnalysesCollectionChange",value:function(e){var t=this;e.added.forEach((function(e){return t._connectAnalysis(e)})),e.removed.forEach((function(e){return t._disconnectAnalysis(e)}))}},{key:"_onTargetsChange",value:function(e){var t=this;return this._analyses.removeAll(),e.items.length>0&&e.forEach((function(e){return t._addTarget(e)})),e.on("change",(function(e){return t._onTargetCollectionChange(e)}))}},{key:"_onTargetCollectionChange",value:function(e){var t=this;e.added.forEach((function(e){return t._addTarget(e)})),e.removed.forEach((function(e){return t._removeTarget(e)}))}},{key:"_onCursorTargetChange",value:function(e,t){Object(c.k)(t)&&this._removeTarget(t),Object(c.k)(e)&&this._addTarget(e)}},{key:"_addTarget",value:function(e){var t=this._analyses;t.some((function(t){return t.target===e}))||t.add(new A({target:e}))}},{key:"_removeTarget",value:function(e){var t=this._analyses,i=t.find((function(t){return t.target===e}));t.remove(i)}},{key:"_connectObserver",value:function(){var e=this;return Object(f.a)([Object(g.d)((function(){return e.layer.observer}),(function(t){return e._onObserverChange(t)}))])}},{key:"_connectAnalyses",value:function(){var e=this,t=null;return Object(f.a)([Object(g.d)((function(){return e._analyses}),(function(i){t=Object(c.s)(t),t=i.on("change",(function(t){return e._onAnalysesCollectionChange(t)})),i.forEach((function(t){return e._connectAnalysis(t)}))})),Object(f.b)((function(){return t=Object(c.s)(t)}))])}},{key:"_connectTargets",value:function(){var e=this,t=null;return Object(f.a)([Object(g.d)((function(){return e.layer.targets}),(function(i){t=Object(c.s)(t),t=e._onTargetsChange(i)})),Object(g.d)((function(){return e.layerViewData.cursorTarget}),(function(t,i){e._onCursorTargetChange(t,i)})),Object(f.b)((function(){t=Object(c.s)(t)}))])}},{key:"_isCameraDirty",get:function(){var e=this.layerViewData.elevationAlignedObserver,t=this.view,i=t.renderCoordsHelper;if(Object(c.j)(e)||Object(c.j)(i))return!1;var n=J;i.toRenderCoords(e,n);var r=t.state.camera.computeScreenPixelSizeAt(n);return Math.abs((r-this._screenPixelSize)/this._screenPixelSize)>W}}]),i}(y.a.EventedMixin(v.a));function B(e,t,i){return!Object(c.j)(i)&&(Object(C.o)(e,t,q,i.spatialReference),Object(w.i)(q,i))}Object(s.a)([Object(l.b)({constructOnly:!0})],N.prototype,"layer",void 0),Object(s.a)([Object(l.b)({constructOnly:!0})],N.prototype,"layerViewData",void 0),Object(s.a)([Object(l.b)({constructOnly:!0})],N.prototype,"view",void 0),Object(s.a)([Object(l.b)()],N.prototype,"updating",null),Object(s.a)([Object(l.b)()],N.prototype,"priority",null),Object(s.a)([Object(l.b)()],N.prototype,"_analyses",null),Object(s.a)([Object(l.b)()],N.prototype,"_observerEngineLocation",null),Object(s.a)([Object(l.b)()],N.prototype,"_screenPixelSize",null),Object(s.a)([Object(l.b)()],N.prototype,"_tasks",void 0),Object(s.a)([Object(l.b)()],N.prototype,"_isCameraDirty",null),N=Object(s.a)([Object(u.a)("esri.views.3d.layers.analysis.LineOfSight.LineOfSightController")],N);var W=.1,J=Object(m.e)(),Z=Object(k.c)(),q=Object(w.n)(),K=i(53),Q=i(51),X=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).innerWidth=2,r.outerWidth=8,r.visibleInnerColor=new Q.a([3,252,111,1]),r.visibleOuterColor=new Q.a([3,252,111,.15]),r.occludedInnerColor=new Q.a([252,3,69,1]),r.occludedOuterColor=new Q.a([252,3,69,.1]),r.undefinedInnerColor=new Q.a([255,255,255,1]),r.undefinedOuterColor=new Q.a([127,127,127,.2]),r}return i}(v.a);Object(s.a)([Object(l.b)({type:Number})],X.prototype,"innerWidth",void 0),Object(s.a)([Object(l.b)({type:Number})],X.prototype,"outerWidth",void 0),Object(s.a)([Object(l.b)({type:Q.a})],X.prototype,"visibleInnerColor",void 0),Object(s.a)([Object(l.b)({type:Q.a})],X.prototype,"visibleOuterColor",void 0),Object(s.a)([Object(l.b)({type:Q.a})],X.prototype,"occludedInnerColor",void 0),Object(s.a)([Object(l.b)({type:Q.a})],X.prototype,"occludedOuterColor",void 0),Object(s.a)([Object(l.b)({type:Q.a})],X.prototype,"undefinedInnerColor",void 0),Object(s.a)([Object(l.b)({type:Q.a})],X.prototype,"undefinedOuterColor",void 0),X=Object(s.a)([Object(u.a)("esri.views.3d.layers.analysis.LineOfSight.LineOfSightConfiguration")],X);var Y=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).analyses=new K.a,e.elevationAlignedObserver=null,e.configuration=new X,e.observerEngineLocation=Object(m.e)(),e.cursorTarget=null,e}return i}(v.a);Object(s.a)([Object(l.b)()],Y.prototype,"analyses",void 0),Object(s.a)([Object(l.b)()],Y.prototype,"elevationAlignedObserver",void 0),Object(s.a)([Object(l.b)({type:X})],Y.prototype,"configuration",void 0),Object(s.a)([Object(l.b)()],Y.prototype,"observerEngineLocation",void 0),Object(s.a)([Object(l.b)()],Y.prototype,"cursorTarget",void 0),Y=Object(s.a)([Object(u.a)("esri.views.3d.layers.analysis.LineOfSight.LineOfSightLayerViewData")],Y);var $=i(14),ee=i(21),te=i(32),ie=i(815),ne=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._handle=null,r._analysisHandles=new j.a,r}return Object(r.a)(i,[{key:"initialize",value:function(){this._handle=this._connectAnalyses()}},{key:"destroy",value:function(){this._handle=Object(c.s)(this._handle),this._analysisHandles=Object(c.e)(this._analysisHandles)}},{key:"visible",get:function(){return this.layerView.visible&&!this.layerView.suspended}},{key:"_analyses",get:function(){return this.layerView.layerViewData.analyses}},{key:"_configuration",get:function(){return this.layerView.layerViewData.configuration}},{key:"_opacity",get:function(){return this.layerView.fullOpacity}},{key:"createLineOfSightVisualization",value:function(){var e=this._configuration,t=this._opacity,i={view:this.view,attached:!0,width:e.outerWidth,innerWidth:e.innerWidth},n=Q.a.toUnitRGBA(e.visibleOuterColor);Object(ee.c)(n,n,t);var r=Q.a.toUnitRGBA(e.visibleInnerColor);Object(ee.c)(r,r,t);var a=Q.a.toUnitRGBA(e.occludedOuterColor);Object(ee.c)(a,a,t);var o=Q.a.toUnitRGBA(e.occludedInnerColor);Object(ee.c)(o,o,t);var s=Q.a.toUnitRGBA(e.undefinedOuterColor);Object(ee.c)(s,s,t);var c=Q.a.toUnitRGBA(e.undefinedInnerColor);return Object(ee.c)(c,c,t),{visibleLineVisualElement:new ie.a(Object($.a)(Object($.a)({},i),{},{color:n,innerColor:r})),occludedLineVisualElement:new ie.a(Object($.a)(Object($.a)({},i),{},{color:a,innerColor:o})),undefinedLineVisualElement:new ie.a(Object($.a)(Object($.a)({},i),{},{color:s,innerColor:c}))}}},{key:"destroyLineOfSightVisualization",value:function(e){e.visibleLineVisualElement=Object(c.e)(e.visibleLineVisualElement),e.occludedLineVisualElement=Object(c.e)(e.occludedLineVisualElement),e.undefinedLineVisualElement=Object(c.e)(e.undefinedLineVisualElement)}},{key:"updateLineOfSightVisualization",value:function(e,t){var i=this.visible,n=this._configuration,r=e.computationResult,a=e.inputPoints,o=r.start,s=r.end,c=r.intersection,l=r.isValid,u=r.isTargetVisible,b=a.observer,d=se;d[12]=b[0],d[13]=b[1],d[14]=b[2];var h=Object(_.l)(re,o,b),O=Object(_.l)(ae,s,b),v=Object(_.l)(oe,c,b),y=t.visibleLineVisualElement,j=t.occludedLineVisualElement,f=t.undefinedLineVisualElement;if(!i)return y.visible=!1,j.visible=!1,void(f.visible=!1);if(y.visible=!0,j.visible=!0,f.visible=!0,y.geometry=null,j.geometry=null,f.geometry=null,l)if(u){y.geometry=[[Object(m.f)(h),Object(m.f)(O)]],y.transform=d;var p=Q.a.toUnitRGBA(n.visibleOuterColor);y.color=Object(ee.c)(p,p,this._opacity)}else{y.geometry=[[Object(m.f)(h),Object(m.f)(v)]],y.transform=d;var g=Q.a.toUnitRGBA(n.occludedOuterColor);y.color=Object(ee.c)(g,g,this._opacity),j.geometry=[[Object(m.f)(v),Object(m.f)(O)]],j.transform=d}else f.geometry=[[Object(m.f)(h),Object(m.f)(O)]],f.transform=d}},{key:"updateVisualizationOpacity",value:function(e,t){var i=this._configuration,n=this._opacity,r=Q.a.toUnitRGBA(i.visibleOuterColor);Object(ee.c)(r,r,n);var a=Q.a.toUnitRGBA(i.visibleInnerColor);Object(ee.c)(a,a,n);var o=Q.a.toUnitRGBA(i.occludedOuterColor);Object(ee.c)(o,o,n);var s=Q.a.toUnitRGBA(i.occludedInnerColor);Object(ee.c)(s,s,n);var c=Q.a.toUnitRGBA(i.undefinedOuterColor);Object(ee.c)(c,c,n);var l=Q.a.toUnitRGBA(i.undefinedInnerColor);Object(ee.c)(l,l,n),t.visibleLineVisualElement.color=e.computationResult.isTargetVisible?r:o,t.visibleLineVisualElement.innerColor=a,t.occludedLineVisualElement.color=o,t.occludedLineVisualElement.innerColor=s,t.undefinedLineVisualElement.color=c,t.undefinedLineVisualElement.innerColor=l}},{key:"getLineOfSightVisualizationDependencies",value:function(e){var t=e.computationResult,i=this._configuration;return{computationResult:t,occludedOuterColor:i.occludedOuterColor,visibleOuterColor:i.visibleOuterColor,visible:this.visible}}},{key:"_connectAnalysis",value:function(e){var t=this,i=this._analysisHandles;if(!i.has(e)){var n=this.createLineOfSightVisualization();i.add([Object(g.d)((function(){return t.getLineOfSightVisualizationDependencies(e)}),(function(){return t.updateLineOfSightVisualization(e,n)})),Object(g.b)((function(){return t._opacity}),(function(){return t.updateVisualizationOpacity(e,n)})),Object(f.b)((function(){return t.destroyLineOfSightVisualization(n)}))],e)}}},{key:"_disconnectAnalysis",value:function(e){this._analysisHandles.remove(e)}},{key:"_connectAnalyses",value:function(){var e=this,t=null;return Object(f.a)([Object(g.d)((function(){return e._analyses}),(function(i){t=Object(c.s)(t),t=i.on("change",(function(t){return e._onAnalysesCollectionChange(t)})),e._onAnalysesCollectionChange({target:i,added:i.items,removed:[],moved:[]})})),Object(f.b)((function(){return t=Object(c.s)(t)}))])}},{key:"_onAnalysesCollectionChange",value:function(e){var t=this;e.added.forEach((function(e){return t._connectAnalysis(e)})),e.removed.forEach((function(e){return t._disconnectAnalysis(e)}))}}]),i}(v.a);Object(s.a)([Object(l.b)({constructOnly:!0})],ne.prototype,"layer",void 0),Object(s.a)([Object(l.b)({constructOnly:!0})],ne.prototype,"layerView",void 0),Object(s.a)([Object(l.b)({constructOnly:!0})],ne.prototype,"view",void 0),Object(s.a)([Object(l.b)({readOnly:!0})],ne.prototype,"visible",null),Object(s.a)([Object(l.b)()],ne.prototype,"_analyses",null),Object(s.a)([Object(l.b)()],ne.prototype,"_configuration",null),Object(s.a)([Object(l.b)()],ne.prototype,"_opacity",null),ne=Object(s.a)([Object(u.a)("esri.views.3d.layers.analysis.LineOfSight.LineOfSightView")],ne);var re=Object(m.e)(),ae=Object(m.e)(),oe=Object(m.e)(),se=Object(te.d)(),ce=i(577),le=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).type="line-of-sight-3d",e.layerViewData=new Y,e}return Object(r.a)(i,[{key:"initialize",value:function(){var e=this,t=this.view,i=this.layer;this._analysisController=new N({layer:i,layerViewData:this.layerViewData,view:t}),this._analysisView=new ne({layer:i,layerView:this,view:t}),this.handles.add([this._analysisController.on("result-changed",(function(t){t.target!==e.layerViewData.cursorTarget&&e.emit("result-changed",t)}))])}},{key:"destroy",value:function(){this._analysisController=Object(c.e)(this._analysisController),this._analysisView=Object(c.e)(this._analysisView)}},{key:"results",get:function(){return this.layerViewData.analyses.map((function(e){return e.result}))}},{key:"priority",get:function(){return this._analysisController.priority},set:function(e){this._analysisController.priority=e}},{key:"getResultForTarget",value:function(e){var t=this.layerViewData.analyses.find((function(t){return t.target===e})),i=Object(c.c)(t,(function(e){return e.result}));return Object(c.u)(i,null)}},{key:"isUpdating",value:function(){return Object(c.n)(this._analysisController,!1,(function(e){return e.updating}))}},{key:"testData",get:function(){return{view:this._analysisView,controller:this._analysisController}}}]),i}(Object(b.a)(ce.a));Object(s.a)([Object(l.b)({readOnly:!0})],le.prototype,"type",void 0),Object(s.a)([Object(l.b)()],le.prototype,"layer",void 0),Object(s.a)([Object(l.b)({readOnly:!0})],le.prototype,"results",null),Object(s.a)([Object(l.b)()],le.prototype,"priority",null),Object(s.a)([Object(l.b)()],le.prototype,"layerViewData",void 0),Object(s.a)([Object(l.b)()],le.prototype,"_analysisController",void 0),Object(s.a)([Object(l.b)()],le.prototype,"_analysisView",void 0);var ue=le=Object(s.a)([Object(u.a)("esri.views.3d.layers.LineOfSightLayerView3D")],le)},782:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var n=i(2),r=i(4),a=i(6),o=i(7),s=i(3),c=i(26),l=i(32),u=i(814),b=i(168),d=i(286),h=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e.view))._resources=null,r._transform=Object(l.d)(),r}return Object(r.a)(i,[{key:"object",get:function(){return Object(s.k)(this._resources)?this._resources.object:null}},{key:"transform",get:function(){return this._transform},set:function(e){Object(c.e)(this._transform,e),Object(s.k)(this._resources)&&(this._resources.object.transformation=this._transform)}},{key:"recreate",value:function(){this.attached&&this.createResources()}},{key:"recreateGeometry",value:function(){if(!Object(s.j)(this._resources)){var e=this._resources.object,t=this.view._stage;t.removeMany(e.geometries),e.removeAllGeometries(),this.createGeometries(e),this.visible||e.setVisible(this.visible),t.addMany(e.geometries)}}},{key:"createResources",value:function(){this.destroyResources();var e=this.view._stage;if(e){var t=new d.a({isPickable:!1,updatePolicy:1});e.add(t);var i=new b.a({castShadow:!1});i.transformation=this._transform,this.createExternalResources(),this.createGeometries(i),e.addMany(i.geometries),this.forEachExternalMaterial((function(t){return e.add(t)})),e.add(i),t.add(i),this.visible||i.setVisible(!1),this._resources={layer:t,object:i}}}},{key:"destroyResources",value:function(){var e=this.view._stage;!Object(s.j)(this._resources)&&e&&(e.remove(this._resources.object),e.remove(this._resources.layer),this.forEachExternalMaterial((function(t){e.remove(t),t.dispose()})),e.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}},{key:"updateVisibility",value:function(e){Object(s.j)(this._resources)||this._resources.object.setVisible(e)}}]),i}(u.a)},814:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n=i(2),r=i(4),a=function(){function e(t){var i=this;Object(n.a)(this,e),this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=t,this.view.watch("ready",(function(e){i._resourcesCreated&&(e?i._createResources():i._destroyResources())}))}return Object(r.a)(e,[{key:"applyProps",value:function(e){var t=!1;for(var i in e)i in this?"attached"===i?t=e[i]:this[i]=e[i]:console.error("Cannot set unknown property",i);this.attached=t}},{key:"destroy",value:function(){this.attached=!1}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&this.view._stage&&(this._attached=e,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources())}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.attached&&this.updateVisibility(e))}},{key:"_createResources",value:function(){this.createResources(),this._resourcesCreated=!0,this.visible||this.updateVisibility(!1)}},{key:"_destroyResources",value:function(){this.destroyResources(),this._resourcesCreated=!1}}]),e}()},815:function(e,t,i){"use strict";i.d(t,"a",(function(){return j}));var n=i(2),r=i(4),a=i(6),o=i(7),s=i(3),c=i(26),l=i(32),u=i(5),b=i(10),d=i(54),h=i(209),O=i(782),v=i(354),y=i(349),j=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e))._renderOccluded=4,r._width=1,r._color=Object(h.c)(1,0,1,1),r._innerWidth=1,r._innerColor=null,r._stipplePattern=null,r._stippleOffColor=null,r._stippleIntegerRepeats=!1,r._writeDepthEnabled=!0,r._falloff=0,r._polygonOffset=!1,r.applyProps(e),r}return Object(r.a)(i,[{key:"setGeometryFromRenderSpacePoint",value:function(e){var t=1e3,i=[];i.push([[e[0]-t,e[1]+0,e[2]+0],[e[0]+t,e[1]+0,e[2]+0]]),i.push([[e[0]-0,e[1]-t,e[2]+0],[e[0]+0,e[1]+t,e[2]+0]]),i.push([[e[0]-0,e[1]+0,e[2]-t],[e[0]+0,e[1]+0,e[2]+t]]),this.geometry=i}},{key:"setGeometryFromExtent",value:function(e){var t=this.view.spatialReference,i=Object(b.e)(),n=Object(b.e)(),r=100,a=[];Object(u.y)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),Object(u.y)(i,e[2],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),Object(u.y)(i,e[2],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),Object(u.y)(i,e[0],e[3],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),Object(u.y)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),Object(u.y)(i,e[0],e[1],r),this.view.renderCoordsHelper.toRenderCoords(i,t,n),a.push([n[0],n[1],n[2]]),this.geometry=[a]}},{key:"setGeometryFromFrustum",value:function(e){var t=[];e.lines.forEach((function(e){t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}},{key:"setGeometryFromBoundedPlane",value:function(e){var t=[],i=e.origin,n=e.basis1,r=e.basis2,a=.5,o=Object(b.e)(),s=Object(b.e)(),c=Object(b.e)(),l=Object(b.e)();o[0]=i[0]-n[0]*a-r[0]*a,o[1]=i[1]-n[1]*a-r[1]*a,o[2]=i[2]-n[2]*a-r[2]*a,s[0]=i[0]-n[0]*a+r[0]*a,s[1]=i[1]-n[1]*a+r[1]*a,s[2]=i[2]-n[2]*a+r[2]*a,c[0]=i[0]+n[0]*a+r[0]*a,c[1]=i[1]+n[1]*a+r[1]*a,c[2]=i[2]+n[2]*a+r[2]*a,l[0]=i[0]+n[0]*a-r[0]*a,l[1]=i[1]+n[1]*a-r[1]*a,l[2]=i[2]+n[2]*a-r[2]*a,t.push([o[0],o[1],o[2]]),t.push([s[0],s[1],s[2]]),t.push([c[0],c[1],c[2]]),t.push([l[0],l[1],l[2]]),t.push([o[0],o[1],o[2]]),this.geometry=[t]}},{key:"setGeometryFromSegment",value:function(e){var t=e.endRenderSpace;Object(c.i)(f),Object(c.t)(f,f,t),this.transform=f;var i=e.createRenderGeometry(t,this.view.renderCoordsHelper).points;this.geometry=[i]}},{key:"setGeometryFromSegments",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:b.b;Object(c.i)(f),Object(c.t)(f,f,i),this.transform=f,this.geometry=e.map((function(e){return e.createRenderGeometry(i,t.view.renderCoordsHelper).points}))}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){Object(d.g)(e,this._color)||(Object(d.c)(this._color,e),this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){Object(s.k)(e)?!Object(s.j)(this._innerColor)&&Object(d.g)(e,this._innerColor)||(this._innerColor=Object(d.c)(Object(h.b)(),e),this._updateMaterial()):Object(s.k)(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=Object(s.k)(e)!==Object(s.k)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){(Object(s.j)(e)||Object(s.j)(this._stippleOffColor)||!Object(d.g)(e,this._stippleOffColor))&&(this._stippleOffColor=Object(s.k)(e)?Object(h.a)(e):null,this._updateMaterial())}},{key:"stippleIntegerRepeats",get:function(){return this._stippleIntegerRepeats},set:function(e){this._stippleIntegerRepeats!==e&&(this._stippleIntegerRepeats=e,this._updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},set:function(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}},{key:"createExternalResources",value:function(){this._material=new y.a(this.materialParameters)}},{key:"destroyExternalResources",value:function(){this._material=null}},{key:"createGeometries",value:function(e){var t=this._createLineGeometries();if(0!==t.length)for(var i=0;i<t.length;++i){var n=Object(v.a)(t[i]);e.addGeometry(n,this._material)}}},{key:"forEachExternalMaterial",value:function(e){e(this._material)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,stippleIntegerRepeats:this._stippleIntegerRepeats,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}},{key:"_updateMaterial",value:function(){this.attached&&this._material.setParameterValues(this.materialParameters)}},{key:"_createLineGeometries",value:function(){var e=this.geometry;if(Object(s.j)(e)||0===e.length)return[];var t=[];return e.forEach((function(e){var i=e.length,n=new Float64Array(3*i);e.forEach((function(e,t){n[3*t+0]=e[0],n[3*t+1]=e[1],n[3*t+2]=e[2]}));var r={attributeData:{position:n},removeDuplicateStartEnd:0};t.push(r)})),t}}]),i}(O.a),f=Object(l.d)()}}]);
//# sourceMappingURL=79.bc1b530e.chunk.js.map