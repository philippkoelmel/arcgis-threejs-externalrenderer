{"version":3,"sources":["../node_modules/@arcgis/core/views/3d/layers/WMTSLayerView3D.js","../node_modules/@arcgis/core/views/layers/RefreshableLayerView.js"],"names":["p","i","getLogger","c","arguments","type","e","r","this","view","then","t","basemapTerrain","tilingSchemeLocked","s","tilingScheme","layer","activeLayer","tileMatrixSet","tileInfo","_getTileInfoSupportError","fullExtent","_getTileInfoCompatibilityError","_getCompatibleTileMatrixSet","tileMatrixSetId","id","_set","addResolvingPromise","when","_initialized","emit","_getTileInfoError","a","suspended","updatingHandles","add","refresh","error","notifyChange","canResume","tileMatrixSets","find","h","l","n","readOnly","prototype","d","o","handles","doRefresh","catch","declaredClass"],"mappings":"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","file":"static/js/108.85bbbfd8.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import t from\"../../../core/Error.js\";import i from\"../../../core/Logger.js\";import{whenTrueOnce as r}from\"../../../core/watchUtils.js\";import{property as s}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as o}from\"../../../core/accessorSupport/decorators/subclass.js\";import{LayerView3D as a}from\"./LayerView3D.js\";import{TiledLayerView3D as l}from\"./TiledLayerView3D.js\";import n from\"../../layers/LayerView.js\";import{RefreshableLayerView as h}from\"../../layers/RefreshableLayerView.js\";const p=i.getLogger(\"esri.views.3d.layers.WMTSLayerView3d\");let c=class extends(h(l(a(n)))){constructor(){super(...arguments),this.type=\"wmts-3d\"}get hasMixedImageFormats(){return!0}initialize(){const e=r(this.view,\"basemapTerrain.tilingSchemeDone\").then((()=>{const e=()=>new t(\"layerview:no-compatible-tiling-scheme\",\"None of the tiling schemes supported by the service are compatible with the scene.\");if(!this.view.basemapTerrain.tilingSchemeLocked)throw e();const i=this.view.basemapTerrain.tilingScheme,r=this.layer.activeLayer;let s;if(r&&r.tileMatrixSet){s=r.tileMatrixSet;const e=s.tileInfo,t=this._getTileInfoSupportError(e,s.fullExtent)||this._getTileInfoCompatibilityError(e,i);if(t)throw t}else{if(s=this._getCompatibleTileMatrixSet(),!s)throw e();r.tileMatrixSetId=s.id}this._set(\"tileInfo\",s.tileInfo),this._set(\"fullExtent\",s.fullExtent),this.layer.fullExtent=s.fullExtent}));this.addResolvingPromise(e),this.when((()=>this._initialized()))}refresh(){this.emit(\"data-changed\")}canResume(){if(!super.canResume())return!1;const e=this.layer.activeLayer.tileMatrixSet;return e&&!this._getTileInfoError(e.tileInfo,e.fullExtent)}async doRefresh(){this.suspended||this.emit(\"data-changed\")}_initialized(){this.updatingHandles.add(this,\"layer.activeLayer.styleId\",(()=>this.refresh())),this.updatingHandles.add(this,\"tileMatrixSet\",(()=>this.refresh())),this.updatingHandles.add(this.layer,\"activeLayer\",(e=>{let t=e.tileMatrixSet;if(t){const e=this._getTileInfoError(t.tileInfo,t.fullExtent);e&&(p.error(\"The selected tile matrix set is not compatible with the view\",e),t=null)}else t=this._getCompatibleTileMatrixSet(),t?e.tileMatrixSetId=t.id:p.error(\"The layer does not provide a tiling scheme that is compatible with the view\");this.notifyChange(\"suspended\"),this.canResume()&&this.refresh()}))}_getCompatibleTileMatrixSet(){return this.layer.activeLayer.tileMatrixSets.find((e=>{const t=e.tileInfo;return!this._getTileInfoError(t,e.fullExtent)}))}_getTileInfoError(e,t){return this._getTileInfoSupportError(e,t)||this._getTileInfoCompatibilityError(e,this.view.basemapTerrain.tilingScheme)}};e([s({readOnly:!0})],c.prototype,\"hasMixedImageFormats\",null),e([s()],c.prototype,\"fullExtent\",void 0),e([s()],c.prototype,\"layer\",void 0),e([s()],c.prototype,\"suspended\",void 0),e([s()],c.prototype,\"tileInfo\",void 0),c=e([o(\"esri.views.3d.layers.WMTSLayerView3D\")],c);var d=c;export{d as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/watchUtils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";const a=a=>{let c=class extends a{initialize(){this.handles.add(o(this,\"layer\",\"refresh\",(()=>{this.doRefresh().catch((r=>{s(r)||e.getLogger(this.declaredClass).error(r)}))})),\"RefreshableLayerView\")}};return r([t()],c.prototype,\"layer\",void 0),c=r([i(\"esri.layers.mixins.RefreshableLayerView\")],c),c};export{a as RefreshableLayerView,a as default};\n"],"sourceRoot":""}