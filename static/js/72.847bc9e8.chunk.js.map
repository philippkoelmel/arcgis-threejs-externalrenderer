{"version":3,"sources":["../node_modules/@arcgis/core/views/3d/layers/PointCloudWorkerHandle.js","../node_modules/@arcgis/core/views/3d/layers/i3s/LoDUtil.js","../node_modules/@arcgis/core/views/3d/layers/i3s/PagedNodeIndex.js","../node_modules/@arcgis/core/views/3d/layers/i3s/PointCloudRendererUtil.js","../node_modules/@arcgis/core/views/3d/layers/i3s/PointGraphic.js","../node_modules/@arcgis/core/views/3d/layers/i3s/PointHighlights.js","../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/PointRendererTechnique.js","../node_modules/@arcgis/core/views/3d/layers/i3s/PointRenderer.js","../node_modules/@arcgis/core/views/3d/layers/PointCloudLayerView3D.js","../node_modules/@arcgis/core/views/layers/support/popupUtils.js","../node_modules/@arcgis/core/views/3d/layers/support/PopupSceneLayerView.js","../node_modules/@arcgis/core/chunks/PointRenderer.glsl.js"],"names":["e","t","r","geometryBuffer","primaryAttributeData","buffer","push","modulationAttributeData","filterAttributesData","u","userAttributesData","n","l","o","h","indexOf","getParentId","d","remove","length","pop","load","g","s","this","_pages","pageSize","_nodeSR","_renderSR","nodes","renderObbs","parents","Uint32Array","c","getRenderObb","center","i","index","queue","masks","tempAabb","p","hasNodes","a","getNode","f","clippingBox","frustum","predicate","firstChild","childCount","hasPage","pageMiss","obb","obbs","renderer","type","toJSON","attributeStorageInfo","field","colorModulation","rendererJSON","isRGBRenderer","primaryAttribute","modulationAttribute","filters","map","filterJSON","attributeInfo","pointSizeAlgorithm","name","attributeValues","valueType","valuesPerElement","storageInfo","useElevation","encoding","toLowerCase","cloneProperties","pointCloudMetadata","constructOnly","prototype","context","highlights","Set","size","add","enableSet","removeSet","disableSet","delete","enabled","forEachNode","enableSetForNode","ids","get","id","forEach","addHighlight","disableSetForNode","removeHighlight","Map","nodeId","pointId","set","shader","configuration","build","output","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","drawScreenSize","rctx","depthTest","func","depthWrite","colorWrite","stencilWrite","sceneHasOcludees","stencilTest","m","arguments","count","k","positions","offset","stride","normalized","colors","T","_params","isGround","_bindParameters","inverseViewport","highlightDepthTexture","_highlights","j","canRender","layerUid","_useFixedSizes","_scaleFactor","_minSizePx","_useRealWorldSymbolSizes","_size","_sizePx","_slicePlaneEnabled","_clipBox","z","P","_techniqueConfig","L","tempMatrix4","tempVec3","_","hasHighlights","_context","_techniqueRep","shaderTechniqueRep","requestRender","x","v","camera","perScreenPixelRatio","near","_getSizeParams","y","S","q","node","point","dist","normal","A","C","B","b","forAll","splatSize","F","H","G","isLeaf","D","V","U","M","w","origin","E","coordinates","R","$","options","store","N","metadata","createGraphic","I","intersector","results","min","max","all","pass","vao","_initNode","selectTechnique","program","setUniform3fv","useProgram","bindPipelineState","setUniformMatrix4fv","projectionMatrix","setUniform2f","far","isHighlightPass","fullViewport","pixelRatio","drawFixedSize","fixedSize","fullHeight","sliceHelper","plane","screenMinSize","W","viewMatrix","bindVAO","_renderHighlightFragments","drawArrays","component","_requestRender","nodeAdded","filterInPlace","nodeRemoved","removeAll","clear","J","K","filter","Q","O","createVertex","rgb","drawScreenSpace","hasOccludees","releaseAndAcquire","_technique","Math","isInstanceOfNode","hasOwnProperty","ae","getLogger","le","he","maximumPointCount","_renderer","_rendererAdded","_renderedNodes","_nodeScales","_updateViewNeeded","_lodFactor","_maxLoggedBoxWarnings","_pageMultiplier","_nodeLoadEpoch","_indexQueue","_workQueue","Array","_idleQueue","_indexPagesLoading","_loadingNodes","_recalcWork","_layerIsVisible","_codedDomainPopulationPromise","_codedDomainPopulationAbortController","_totalWork","_index","_loadingInitNodePage","_nodeIdArray","layer","scaleFactor","useRealWorldSymbolSizes","pointsPerInch","outFields","fieldsIndex","from","view","clippingArea","renderSpatialReference","ee","elevationInfo","mode","spatialReference","unit","resourceController","_worker","schedule","addResolvingPromise","promise","_tmpPoint","_indexRequester","createStreamDataRequester","_dataRequester","_initRenderer","_initNodePages","memoryController","_memCache","getMemCache","uid","updatingHandles","_setUpdateViewNeeded","_elevationOffsetChanged","_rendererChanged","_reload","state","handles","basemapTerrain","on","_scaleUpdateHandler","events","when","scheduler","registerTask","ne","POINT_CLOUD_LAYER","registerIdleStateCallbacks","_idleBegin","_idleEnd","_clearNodeState","_updateLoading","cancelLoading","destroy","_destroyRenderer","abort","X","_createGraphic","_setPointsVisible","minSizePx","sqrt","sizePx","slicePlane","pointIdFilterMap","computeMapPointFromVec3d","_createGraphicAttributes","Y","pointIndexInNode","attributePointIndexInNode","epoch","geometry","attributes","sourceLayer","_encodeGraphicAttribute","values","_stage","addRenderPlugin","removeRenderPlugin","useFixedSizes","minScale","maxScale","extent","pe","has","scale","contentCamera","viewForward","sort","getRenderCenter","_updateQueues","_computeWork","notifyChange","_cancelNodeLoading","_cancelIndexLoading","abortController","cancelAll","_removeFromRenderer","suspended","_isRootNodeVisible","run","_updateWorkQueues","_processIndexQueue","_processWorkQueue","process","shift","_loadNodePage","then","addPage","_elevationOffset","done","_scheduleWorkEntry","_processWorkEntry","madeProgress","find","Promise","toString","resolve","loadNode","signal","_setupRendererData","_addToRenderer","catch","domain","queryCachedStatistics","ok","value","labels","isArray","codedValues","code","label","populateClassCodeCodedDomain","_splitGraphicsPerNode","_loadElevationAttributeFromGeometry","resourceId","_loadAndParseAttribute","_isValidPointGraphic","_loadAttribute","vertexCount","defaultGeometrySchema","_loadGeometry","isCollection","toArray","highlight","_graphicToPointDefinition","nodesPerPage","nodePerIndexBlock","renderCoordsHelper","_traverseVisible","createVisibilityTraverse","baseUrl","_requestNodePage","pointCount","lodThreshold","effectiveArea","inverseDensity","_getLodMemoryFactor","_computeNodesForMinimumDensity","_computePointCount","displayNodes","memoryFactor","_clippingBox","eye","se","_getScale","oe","_computeAveragePixelArea","getScale","te","loadNodeAsync","error","loadAdditionalUserAttributes","schema","rendererInfo","filterInfo","elevationOffset","inSR","outSR","invoke","_requestData","key","token","apiKey","request","query","removeNode","put","ue","addNode","halfSize","warn","setRenderObb","points","ce","reduce","getUsedMemory","displayedNumberOfFeatures","maximumNumberOfFeatures","totalNumberOfFeatures","core","visibleNodes","Z","re","readOnly","aliasOf","Boolean","ie","_e","popupTemplate","getRequiredFields","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","keyField","defaultPopupTemplateEnabled","defaultPopupTemplate","popupEnabled","_validateFetchPopupFeatures","reject","clientGraphics","associatedLayer","prepareFetchPopupFeatures","whenGraphicAttributes","concat","extensions","include","vertex","uniforms","varyings","fragment","Object","freeze","__proto__"],"mappings":"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","file":"static/js/72.847bc9e8.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as t}from\"../../../core/maybe.js\";import{WorkerHandle as r}from\"../../../core/workers/WorkerHandle.js\";class e extends r{constructor(t){super(\"PointCloudWorker\",\"transform\",t)}getTransferList(r){const e=[r.geometryBuffer];if(t(r.primaryAttributeData)&&r.primaryAttributeData.buffer&&e.push(r.primaryAttributeData.buffer),t(r.modulationAttributeData)&&r.modulationAttributeData.buffer&&e.push(r.modulationAttributeData.buffer),t(r.filterAttributesData))for(const u of r.filterAttributesData)t(u)&&u.buffer&&e.push(u.buffer);for(const t of r.userAttributesData)t.buffer&&e.push(t.buffer);return e}}export{e as PointCloudWorkerHandle};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{d as e}from\"../../../../chunks/vec3.js\";function t(e,t,g){for(let n=0;n<t.length;n++)r[n]=!1,o[n]=null;for(let r=0;r<e.length;r++)n[r]=!1,l[r]=null;for(let n=0;n<t.length;n++){const o=h(t[n],e,g);o>=0&&(r[n]=!0,null!=l[o]?l[o].push(t[n]):l[o]=[t[n]])}for(let l=0;l<e.length;l++){const r=h(e[l],t,g);r>=0&&(n[l]=!0,null!=o[r]?o[r].push(e[l]):o[r]=[e[l]])}const u=[];for(let r=0;r<e.length;r++)null!=l[r]||n[r]||u.push({load:[],remove:[e[r]]});for(let n=0;n<t.length;n++)null!=o[n]||r[n]||u.push({load:[t[n]],remove:[]});for(let n=0;n<t.length;n++)null!=o[n]&&(o[n].length>1||o[n][0]!==t[n])&&u.push({load:[t[n]],remove:o[n]});for(let n=0;n<e.length;n++)null!=l[n]&&(l[n].length>1||l[n][0]!==e[n])&&u.push({load:l[n],remove:[e[n]]});return u}const n=[!1],l=[null],r=[!1],o=[null];function h(e,t,n){let l=e;for(;l>0;){const e=t.indexOf(l);if(e>=0)return e;l=n.getParentId(l)}return t.indexOf(l)}function g(t,n,l){return t.sort(((t,r)=>{if(0===t.load.length&&0===r.load.length)return 0;if(0===t.load.length)return-1;if(0===r.load.length)return 1;if(0===t.remove.length&&0===r.remove.length){const o=l.getRenderCenter(t.load[0]),h=l.getRenderCenter(r.load[0]);return e(o,n)-e(h,n)}if(0===t.remove.length)return-1;if(0===r.remove.length)return 1;if(1===t.load.length&&1===r.load.length){const o=l.getRenderCenter(t.load[0]),h=l.getRenderCenter(r.load[0]);return e(o,n)-e(h,n)}if(1===t.load.length)return-1;if(1===r.load.length)return 1;{const o=l.getRenderCenter(t.remove[0]),h=l.getRenderCenter(r.remove[0]);return e(o,n)-e(h,n)}}))}function u(e,t,n){for(let l=0;l<e.length;++l){const r=e[l];r.load.length>t&&1===r.remove.length&&d(e,r,n)}}function d(e,t,n){const l=[t.remove[0]],r=[];for(;1===l.length;){const e=l.pop();r.length=0;for(let o=0;o<t.load.length;o++){let h=t.load[o],g=n.getParentId(h);for(;g!==e;)h=g,g=n.getParentId(h);let u=l.indexOf(h);u<0&&(u=l.length,l.push(h),r.push([])),r[u].push(t.load[o])}}t.load=l;for(let o=0;o<l.length;o++)r[o].length>1?e.push({remove:[l[o]],load:r[o]}):l[o]=r[o][0]}export{t as nodeDiff,g as sortFrontToBack,u as splitWorkEntries,d as splitWorkEntry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{create as e,contains as t,intersects as s}from\"../../../../geometry/support/aaBoundingBox.js\";import{transformObb as n}from\"./I3SUtil.js\";import{set as i,toAaBoundingBox as r,intersectPlane as o,ObbArray as p}from\"../../support/orientedBoundingBox.js\";class h{constructor(e,t,s){this._pages=[],this.pageSize=0,this._nodeSR=null,this._renderSR=null,this._nodeSR=e,this._renderSR=t,this.pageSize=s}addPage(e,t,s=0){for(;this._pages.length<e;)this._pages.push(null);const n=g(t,this._nodeSR,this._renderSR,s);this._pages[e]={nodes:t,renderObbs:n,parents:new Uint32Array(this.pageSize)},u(this._pages,this.pageSize)}hasPage(e){return!!this._pages[e]}getNode(e){const t=this.pageSize;return this._pages[l(e,t)].nodes[c(e,t)]}getRenderObb(e){const t=this.pageSize;return this._pages[l(e,t)].renderObbs[c(e,t)]}getRenderCenter(e){return this.getRenderObb(e).center}setRenderObb(e,t){const s=this.pageSize;i(t,this._pages[l(e,s)].renderObbs[c(e,s)])}getParentId(e){const t=this.pageSize;return this._pages[l(e,t)].parents[c(e,t)]}hasNodes(e,t){const s=l(e,this.pageSize),n=l(e+t-1,this.pageSize);for(let i=s;i<=n;i++)if(null==this._pages[i])return!1;return!0}forEachNodeId(e){for(let t=0;t<this._pages.length;t++){const s=this._pages[t];if(s)for(let n=0;n<s.nodes.length;n++)e(t*this.pageSize+n)}}createVisibilityTraverse(){const t={index:this,queue:[],masks:[],tempAabb:e()};return(e,s)=>a(t,e,s)}}function a(e,n,i){const p=e.index;if(!p.hasNodes(0,1))return;const h=e.queue;h.length=0,h.push(0);const a=e.masks;for(a.length=0,a.push(0);h.length>0;){const g=h.pop();let u=a.pop();const c=p.getNode(g),d=p.getRenderObb(g);let f=!0;if(null!=n.clippingBox){const i=1<<n.frustum.length;if(0==(u&i)){const o=r(d,e.tempAabb);t(n.clippingBox,o)?u|=i:s(n.clippingBox,o)||(f=!1)}}for(let e=0;e<n.frustum.length&&f;e++){const t=1<<e;if(0==(u&t)){const s=o(d,n.frustum[e]);s>0?f=!1:s<0&&(u|=t)}}if(i.predicate(g,c,f)){const e=c.firstChild,t=c.childCount;let s=!1;const n=l(e,p.pageSize),r=l(e+t-1,p.pageSize);for(let o=n;o<=r;o++)if(!p.hasPage(o)){i.pageMiss(g,o),s=!0;break}if(!s)for(let i=0;i<t;i++)h.push(e+i),a.push(u)}}}function g(e,t,s,i){const r=new p(e.length);for(let o=0;o<e.length;o++)n(e[o].obb,t,r.obbs[o],s,i);return r.obbs}function u(e,t){const s=[0];for(;s.length;){const n=s.pop(),i=e[l(n,t)].nodes[c(n,t)];for(let r=0;r<i.childCount;r++){const o=i.firstChild+r;null!=e[l(o,t)]&&(e[l(o,t)].parents[c(o,t)]=n,s.push(o))}}}function l(e,t){return e/t|0}function c(e,t){return e%t}export{h as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nfunction t(t){const e=t.renderer,n=e&&e.type,o=e&&t.renderer.toJSON()||null;let r=null,i=!1;\"point-cloud-unique-value\"===n||\"point-cloud-stretch\"===n||\"point-cloud-class-breaks\"===n?r=u(t.attributeStorageInfo,e.field):\"point-cloud-rgb\"===n?(r=l(t.attributeStorageInfo,e.field),i=null!=r):(r=l(t.attributeStorageInfo,\"RGB\"),i=null!=r);let a=null;return e&&e.colorModulation&&(a=u(t.attributeStorageInfo,e.colorModulation.field)),{rendererJSON:o,isRGBRenderer:i,primaryAttribute:r,modulationAttribute:a}}function e(t){const e=t.filters;return e?e.map((e=>({filterJSON:e.toJSON(),attributeInfo:u(t.attributeStorageInfo,e.field)}))):[]}function n(t){const e=t&&t.pointSizeAlgorithm;return e&&\"splat\"===e.type?e:null}function o(t){const e=t&&t.pointSizeAlgorithm;return e&&\"fixed-size\"===e.type?e:null}function r(t){const e=t&&t.pointSizeAlgorithm;return!(!e||!e.type)&&\"fixed-size\"===e.type}function l(t,e){for(const n of t)if(n.name===e&&null!=n.attributeValues&&\"UInt8\"===n.attributeValues.valueType&&3===n.attributeValues.valuesPerElement)return{name:e,storageInfo:n,useElevation:!1};return null}function u(t,e){for(const n of t)if(n.name===e){const t=\"embedded-elevation\"===n.encoding;return{name:e,storageInfo:t?null:n,useElevation:t}}return\"elevation\"===e.toLowerCase()?{name:e,storageInfo:null,useElevation:!0}:null}export{u as getAttributeInfo,e as getFilterInfo,o as getFixedSizeAlgorithm,t as getRendererInfo,n as getSplatSizeAlgorithm,r as rendererUsesFixedSizes};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../../../chunks/tslib.es6.js\";import o from\"../../../../Graphic.js\";import{property as e}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as s}from\"../../../../core/accessorSupport/decorators/subclass.js\";var t;let p=t=class extends o{constructor(r){super(r)}clone(){return new t(this.cloneProperties())}cloneProperties(){const{pointCloudMetadata:r}=this;return{...super.cloneProperties(),pointCloudMetadata:r}}};r([e({constructOnly:!0})],p.prototype,\"pointCloudMetadata\",void 0),p=t=r([s(\"esri.views.3d.layers.i3s.PointGraphic\")],p);export{p as PointGraphic};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{makeHandle as e}from\"../../../../core/handleUtils.js\";import{isSome as t}from\"../../../../core/maybe.js\";import{Object3DStateID as i}from\"../../webgl-engine/lib/Object3DStateID.js\";class h{constructor(e){this.context=e,this.highlights=new Set}get hasHighlights(){return this.highlights.size>0}destroy(){this.highlights=null}add(t){const i=new s(t);return this.highlights.add(i),this.enableSet(i),e((()=>this.removeSet(i)))}removeSet(e){this.disableSet(e),this.highlights.delete(e)}enableSet(e){e.enabled||(e.enabled=!0,this.context.forEachNode((t=>this.enableSetForNode(e,t))))}enableSetForNode(e,t){if(!e.enabled)return;const i=e.ids.get(t.id);i&&i.forEach((i=>this.context.addHighlight(t,i,e.id)))}disableSet(e){e.enabled&&(e.enabled=!1,this.context.forEachNode((t=>this.disableSetForNode(e,t))))}disableSetForNode(e,t){e.enabled||this.context.removeHighlight(t,e.id)}nodeAdded(e){this.highlights.forEach((t=>this.enableSetForNode(t,e)))}nodeRemoved(e){this.highlights.forEach((t=>this.disableSetForNode(t,e)))}removeAll(){this.highlights.forEach((e=>this.disableSet(e)))}}class s{constructor(e){this.id=new i(0),this.ids=new Map,this.enabled=!1;for(const i of e)t(i)&&this.add(i.nodeId,i.pointId)}add(e,t){const i=this.ids.get(e);i?i.add(t):this.ids.set(e,new Set([t]))}}export{h as PointHighlights};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{ReloadableShaderModule as r}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as t}from\"../core/shaderTechnique/ShaderTechnique.js\";import{parameter as i,ShaderTechniqueConfiguration as s}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as o}from\"../lib/DefaultVertexAttributeLocations.js\";import{Program as n}from\"../lib/Program.js\";import{stencilWriteMaskOn as l,stencilBaseAllZerosParams as c}from\"../lib/StencilUtils.js\";import{P as a}from\"../../../../chunks/PointRenderer.glsl.js\";import{makePipelineState as u,defaultDepthWriteParams as d,defaultColorWriteParams as p}from\"../../../webgl/renderState.js\";class h extends t{constructor(e,r,t){super(e,r,t)}initializeProgram(e){const r=h.shader.get(),t=this.configuration,i=r.build({output:t.output,slicePlaneEnabled:t.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:t.drawScreenSize});return new n(e.rctx,i,o)}initializePipeline(){return u({depthTest:{func:513},depthWrite:d,colorWrite:p,stencilWrite:this.configuration.sceneHasOcludees?l:null,stencilTest:this.configuration.sceneHasOcludees?c:null})}}h.shader=new r(a,(()=>import(\"./PointRenderer.glsl.js\")));class m extends s{constructor(){super(...arguments),this.output=0,this.slicePlaneEnabled=!1,this.drawScreenSize=!1,this.sceneHasOcludees=!1}}e([i({count:8})],m.prototype,\"output\",void 0),e([i()],m.prototype,\"slicePlaneEnabled\",void 0),e([i()],m.prototype,\"drawScreenSize\",void 0),e([i()],m.prototype,\"sceneHasOcludees\",void 0);export{h as PointRendererTechnique,m as PointRendererTechniqueConfiguration};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isNone as e,unwrap as i,disposeMaybe as t,isSome as s}from\"../../../../core/maybe.js\";import r from\"../../../../core/PooledArray.js\";import{i as n,t as o,m as a}from\"../../../../chunks/mat4.js\";import{c as h}from\"../../../../chunks/mat4f32.js\";import{I as l}from\"../../../../chunks/mat4f64.js\";import{f as c,l as d,a as u,o as m,d as p,p as g,s as f}from\"../../../../chunks/vec3.js\";import{c as _}from\"../../../../chunks/vec3f32.js\";import{c as x}from\"../../../../chunks/vec3f64.js\";import{s as S}from\"../../../../chunks/vec4.js\";import{create as z,POSITIVE_INFINITY as P,offset as b,contains as w,containsPoint as R,equals as y,set as q}from\"../../../../geometry/support/aaBoundingBox.js\";import{create as v}from\"../../../../geometry/support/plane.js\";import{fromPoints as M}from\"../../../../geometry/support/ray.js\";import{PointHighlights as j}from\"./PointHighlights.js\";import{minimumDistancePlane as F,maximumDistancePlane as H,intersectLine as V,toAaBoundingBox as U}from\"../../support/orientedBoundingBox.js\";import{bindSliceUniforms as A}from\"../../webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{bindOutputHighlight as C}from\"../../webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js\";import{Default3D as B}from\"../../webgl-engine/lib/DefaultVertexAttributeLocations.js\";import{IntersectorResult as E}from\"../../webgl-engine/lib/intersectorUtils.js\";import{PointRendererTechniqueConfiguration as L,PointRendererTechnique as I}from\"../../webgl-engine/shaders/PointRendererTechnique.js\";import N from\"../../../webgl/BufferObject.js\";import O from\"../../../webgl/VertexArrayObject.js\";const k={positions:[{name:\"position\",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:\"color\",count:3,type:5121,offset:0,stride:3,normalized:!0}]};class T{constructor(e){this._params=e,this.type=\"Point\",this.isGround=!1,this._bindParameters={inverseViewport:[0,0],highlightDepthTexture:null},this._highlights=new j({forEachNode:e=>this.forEachNode(e),addHighlight:(e,i,t)=>this.addHighlight(e,i,t),removeHighlight:(e,i)=>this.removeHighlight(e,i)}),this.canRender=!0,this.layerUid=\"\",this._useFixedSizes=!1,this._scaleFactor=1,this._minSizePx=0,this._useRealWorldSymbolSizes=!1,this._size=0,this._sizePx=0,this._slicePlaneEnabled=!1,this._clipBox=z(P),this._techniqueConfig=new L,this.tempMatrix4=h(),this.tempVec3=_(),this.nodes=new r}get needsHighlight(){return this._highlights.hasHighlights}initializeRenderContext(e){this._context=e,this._techniqueRep=this._context.shaderTechniqueRep,e.requestRender()}uninitializeRenderContext(){}intersect(e,i,t,s){const r=x(),n=x(),o=x(),a=x(),h=v(),f=e.camera.perScreenPixelRatio/2,_=e.camera.near,P=this._getSizeParams();c(n,s,t);const y=1/d(n);u(n,n,y),m(o,n),S(h,n[0],n[1],n[2],-p(n,t));class q{constructor(){this.node=null,this.pointId=null,this.point=null,this.dist=null,this.normal=null,this.layerUid=\"\"}}const j=new q,A=new q,C=[],B=z(),L=z(this._clipBox);b(L,-t[0],-t[1],-t[2],L),this.nodes.forAll((l=>{const d=l.splatSize*this._scaleFactor;let u=F(l.obb,h),m=H(l.obb,h);u-=G(d,u+_,P,f,l.isLeaf),m-=G(d,m+_,P,f,l.isLeaf);const x=m<0,S=null!=j.dist&&null!=A.dist&&j.dist<u*y&&A.dist>m*y;if(x||S)return;const z=D(d,m+_,P,f,l.isLeaf);if(!V(l.obb,t,n,z))return;const v=z*z;U(l.obb,B),b(B,-t[0],-t[1],-t[2],B);const M=!w(L,B);c(a,l.origin,t);const E=l.coordinates.length/3;for(let h=0;h<E;h++){if(r[0]=a[0]+l.coordinates[3*h],r[1]=a[1]+l.coordinates[3*h+1],r[2]=a[2]+l.coordinates[3*h+2],M&&!R(L,r))continue;const c=p(r,n),u=g(r)-c*c;if(u>v)continue;let m=c+_;const x=G(d,m,P,f,l.isLeaf);if(c-x<0)continue;m-=x;const S=D(d,m,P,f,l.isLeaf);if(u>S*S)continue;const z=(c-x)*y,b=e=>{e.point=$(l,h,e.point),e.dist=z,e.normal=o,e.node=l,e.pointId=h,e.layerUid=this.layerUid};if((null==j.dist||z<j.dist)&&(null==i||i(t,s,z))&&b(j),0!==e.options.store&&(null==A.dist||z>A.dist)&&(null==i||i(t,s,z))&&b(A),2===e.options.store&&(null==i||i(t,s,z))){const e=new q;b(e),C.push(e)}}}));const I=e=>{const{layerUid:i,node:t,pointId:s}=e;return{type:\"external\",point:e.point,metadata:{layerUid:i,createGraphic:()=>this._params.createGraphic(t,s,e.point)}}},N=(e,i)=>{const t=I(i),s=`${i.layerUid}/${i.node.id}/${i.pointId}`;e.set(t,s,i.dist,i.normal,l,void 0),e.intersector=\"PointRenderer\"};if(null!=j.dist){const i=e.results.min;(null==i.dist||j.dist<i.dist)&&N(i,j)}if(null!=A.dist&&0!==e.options.store){const i=e.results.max;(null==i.dist||A.dist>i.dist)&&N(i,A)}if(2===e.options.store){const i=M(t,s);for(const t of C){const s=new E(i);N(s,t),e.results.all.push(s)}}}render(e){if(0!==e.pass&&2!==e.pass&&5!==e.pass)return!1;const i=2===e.pass,t=e.rctx;this.nodes.forAll((i=>{null==i.vao&&this._initNode(e,i)}));const s=this._getSizeParams(),r=this.selectTechnique(e,s),h=r.program;if(null==h||0===this.nodes.length)return!0;const l=this._clipBox,c=!y(l,P,((e,i)=>e===i));c||(f(this.tempVec3,-1/0,-1/0,-1/0),h.setUniform3fv(\"uClipMin\",this.tempVec3),f(this.tempVec3,1/0,1/0,1/0),h.setUniform3fv(\"uClipMax\",this.tempVec3)),t.useProgram(h),r.bindPipelineState(t),h.setUniformMatrix4fv(\"uProjectionMatrix\",e.camera.projectionMatrix),i&&h.setUniform2f(\"nearFar\",e.camera.near,e.camera.far),e.isHighlightPass&&(this._bindParameters.inverseViewport[0]=1/e.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/e.camera.fullViewport[3],this._bindParameters.highlightDepthTexture=e.highlightDepthTexture,C(h,this._bindParameters));const d=e.camera.pixelRatio;s.drawFixedSize&&h.setUniform2f(\"uPointScale\",s.fixedSize*d,e.camera.fullHeight);const u=this._slicePlaneEnabled?e.sliceHelper&&e.sliceHelper.plane:null;return this.nodes.forAll((i=>{if(0===i.coordinates.length||e.isHighlightPass&&!i.highlights)return;if(h.setUniform2f(\"uScreenMinMaxSize\",s.screenMinSize*d,W(i.isLeaf)*d),!s.drawFixedSize){const t=i.splatSize*this._scaleFactor;h.setUniform2f(\"uPointScale\",t*d,e.camera.fullHeight/d)}const m=i.origin;c&&(f(this.tempVec3,l[0]-m[0],l[1]-m[1],l[2]-m[2]),h.setUniform3fv(\"uClipMin\",this.tempVec3),f(this.tempVec3,l[3]-m[0],l[4]-m[1],l[5]-m[2]),h.setUniform3fv(\"uClipMax\",this.tempVec3)),n(this.tempMatrix4),o(this.tempMatrix4,this.tempMatrix4,m),a(this.tempMatrix4,e.camera.viewMatrix,this.tempMatrix4),h.setUniformMatrix4fv(\"uModelViewMatrix\",this.tempMatrix4),A(h,r.configuration,u,m),t.bindVAO(i.vao),e.isHighlightPass?this._renderHighlightFragments(t,i):t.drawArrays(0,0,i.coordinates.length/3)})),!0}_renderHighlightFragments(t,s){const r=s.highlights;if(e(r))return;let n=i(r[0].component),o=n+1;for(let e=1;e<r.length;e++){const s=i(r[e].component);if(s!==o){const e=o-n;e>0&&t.drawArrays(0,n,e),n=s}o=s+1}const a=o-n;a>0&&t.drawArrays(0,n,a)}set useFixedSizes(e){this._useFixedSizes!==e&&(this._useFixedSizes=e,this._requestRender())}get useFixedSizes(){return this._useFixedSizes}set scaleFactor(e){this._scaleFactor!==e&&(this._scaleFactor=e,this._requestRender())}get scaleFactor(){return this._scaleFactor}set minSizePx(e){this._minSizePx!==e&&(this._minSizePx=e,this._requestRender())}get minSizePx(){return this._minSizePx}set useRealWorldSymbolSizes(e){this._useRealWorldSymbolSizes!==e&&(this._useRealWorldSymbolSizes=e,this._requestRender())}get useRealWorldSymbolSizes(){return this._useRealWorldSymbolSizes}set size(e){this._size!==e&&(this._size=e,this._requestRender())}get size(){return this._size}set sizePx(e){this._sizePx!==e&&(this._sizePx=e,this._requestRender())}get sizePx(){return this._sizePx}set clippingBox(e){q(this._clipBox,e||P)}get slicePlane(){return this._slicePlaneEnabled}set slicePlane(e){this._slicePlaneEnabled!==e&&(this._slicePlaneEnabled=e,this._requestRender())}get intersectionHandlerId(){return this.layerUid}addNode(e){this.nodes.push(e),this._highlights.nodeAdded(e),this._requestRender()}removeNode(e){let i=null;return this.nodes.filterInPlace((s=>s.id!==e||(i=s,s.vao=t(s.vao),this._highlights.nodeRemoved(s),!1))),this._requestRender(),i}forEachNode(e){this.nodes.forAll(e)}removeAll(){this.nodes.forAll((e=>e.vao=t(e.vao))),this._highlights.removeAll(),this.nodes.clear(),this._requestRender()}highlight(e){return this._highlights.add(e)}addHighlight(e,i,t){e.highlights=K(e.highlights,i,t),this._requestRender()}removeHighlight(e,i){e.highlights=Q(e.highlights,i),this._requestRender()}_initNode(e,i){const t=e.rctx;i.vao=new O(t,B,k,{positions:N.createVertex(t,35044,i.coordinates),colors:N.createVertex(t,35044,i.rgb)})}_requestRender(){this._context&&this._context.requestRender()}_getSizeParams(){const e=this._useFixedSizes,i=e&&!this._useRealWorldSymbolSizes;return{drawScreenSpace:i,drawFixedSize:e,fixedSize:i?this._sizePx:this._size,screenMinSize:e?0:this._minSizePx}}selectTechnique(e,i){return this._techniqueConfig.drawScreenSize=i.drawScreenSpace,this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled,this._techniqueConfig.sceneHasOcludees=e.hasOccludees,this._techniqueConfig.output=2===e.pass?1:5===e.pass?4:0,this._techniqueRep.releaseAndAcquire(I,this._techniqueConfig,this._technique)}}function W(e){return e?256:64}function D(e,i,t,s,r){if(t.drawScreenSpace)return t.fixedSize*i*s;const n=W(r)*i*s;return t.drawFixedSize?Math.min(t.fixedSize/2,n):t.screenMinSize>0?Math.min(Math.max(t.screenMinSize*i*s,e/2),n):Math.min(e/2,n)}function G(e,i,t,s,r){return t.drawScreenSpace?0:D(e,i,t,s,r)}function $(e,i,t){return null==t&&(t=x()),t[0]=e.origin[0]+e.coordinates[3*i],t[1]=e.origin[1]+e.coordinates[3*i+1],t[2]=e.origin[2]+e.coordinates[3*i+2],t}function J(e){return s(e.component)?e.component:-1}function K(i,t,s){e(i)&&(i=[]);const r={component:t,id:s};i.push(r);const n=J(r);let o=i.length-1;for(;o>0&&n<J(i[o-1]);)[i[o-1],i[o]]=[i[o],i[o-1]],--o;return i}function Q(i,t){if(e(i))return i;const s=i.filter((e=>e.id!==t));return 0===s.length?null:s}!function(e){function i(e){return e.hasOwnProperty(\"splatSize\")}e.isInstanceOfNode=i}(T||(T={}));export{T as PointRenderer};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{result as t,forEach as i}from\"../../../core/asyncUtils.js\";import r from\"../../../core/Collection.js\";import s from\"../../../core/Logger.js\";import{unwrapOr as o,isSome as n,isNone as a,mapSome as d}from\"../../../core/maybe.js\";import{createAbortController as l,eachAlways as h,isAbortError as u,eachAlwaysValues as p,throwIfAborted as c}from\"../../../core/promiseUtils.js\";import{pt2px as _}from\"../../../core/screenUtils.js\";import{estimateSize as m,isArrayBuffer as g}from\"../../../core/typedArrayUtil.js\";import{getMetersPerVerticalUnitForSR as f}from\"../../../core/unitUtils.js\";import{property as y}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as b}from\"../../../core/accessorSupport/decorators/subclass.js\";import{d as w}from\"../../../chunks/vec3.js\";import{a as N}from\"../../../chunks/vec3f32.js\";import{projectBoundingRect as x}from\"../../../geometry/projection.js\";import{create as P}from\"../../../geometry/support/aaBoundingBox.js\";import{containsPoint as v,create as C}from\"../../../geometry/support/aaBoundingRect.js\";import{create as S,fromNormalAndOffset as I}from\"../../../geometry/support/plane.js\";import{makeDehydratedPoint as A}from\"../../../layers/graphics/dehydratedFeatures.js\";import k from\"../../../layers/support/CodedValue.js\";import V from\"../../../layers/support/CodedValueDomain.js\";import\"../../../layers/support/Domain.js\";import\"../../../layers/support/InheritedDomain.js\";import\"../../../layers/support/RangeDomain.js\";import{unpackFieldNames as R}from\"../../../layers/support/fieldUtils.js\";import L from\"../../../layers/support/PromiseQueue.js\";import{getMetersPerUnit as j}from\"../../../symbols/support/unitConversionUtils.js\";import{LayerView3D as Q}from\"./LayerView3D.js\";import{PointCloudWorkerHandle as U}from\"./PointCloudWorkerHandle.js\";import{checkPointCloudLayerValid as D,checkPointCloudLayerCompatibleWithView as F}from\"./i3s/I3SUtil.js\";import{nodeDiff as z,sortFrontToBack as M,splitWorkEntries as W}from\"./i3s/LoDUtil.js\";import O from\"./i3s/PagedNodeIndex.js\";import{getSplatSizeAlgorithm as E,getFixedSizeAlgorithm as H,getRendererInfo as B,getFilterInfo as G,rendererUsesFixedSizes as q,getAttributeInfo as T}from\"./i3s/PointCloudRendererUtil.js\";import{getAttributeValues as $,readGeometry as J,elevationFromPositions as K}from\"./i3s/PointCloudWorkerUtil.js\";import{PointGraphic as Y}from\"./i3s/PointGraphic.js\";import{PointRenderer as X}from\"./i3s/PointRenderer.js\";import{PopupSceneLayerView as Z}from\"./support/PopupSceneLayerView.js\";import{projectToBoundingBox as ee}from\"../support/extentUtils.js\";import{minimumDistancePlane as te}from\"../support/orientedBoundingBox.js\";import{updatingProgress as ie}from\"../support/updatingProperties.js\";import re from\"../../layers/LayerView.js\";import{extractSafeScaleBounds as se,scaleBoundsPredicate as oe}from\"../../support/layerViewUtils.js\";import{TaskPriority as ne}from\"../../support/Scheduler.js\";const ae=s.getLogger(\"esri.views.3d.layers.PointCloudLayerView3D\"),de=8,le=S();let he=class extends(Z(Q(re))){constructor(){super(...arguments),this.type=\"point-cloud-3d\",this.maximumPointCount=4e6,this.slicePlaneEnabled=!1,this._renderer=null,this._rendererAdded=!1,this._renderedNodes=new Set,this._nodeScales=new Map,this._updateViewNeeded=!0,this._lodFactor=1,this._maxLoggedBoxWarnings=5,this._pageMultiplier=1,this._nodeLoadEpoch=0,this._indexQueue=[],this._workQueue=new Array,this._idleQueue=new L,this._indexPagesLoading=new Map,this._loadingNodes=new Map,this._recalcWork=!0,this._layerIsVisible=!1,this._codedDomainPopulationPromise=null,this._codedDomainPopulationAbortController=null,this._totalWork=0,this._index=null,this._loadingInitNodePage=!1,this._nodeIdArray=[]}get pointScale(){const e=E(this.layer&&this.layer.renderer),t=1;return e&&null!=e.scaleFactor?e.scaleFactor:t}get useRealWorldSymbolSizes(){const e=H(this.layer&&this.layer.renderer),t=!1;return e&&null!=e.useRealWorldSymbolSizes?e.useRealWorldSymbolSizes:t}get pointSize(){const e=H(this.layer&&this.layer.renderer),t=0;return e&&null!=e.size?e.size:t}get inverseDensity(){const e=96;return this.layer&&this.layer.renderer?1*e/this.layer.renderer.pointsPerInch:5}get availableFields(){const e=B(this.layer),t=new Set;e.primaryAttribute&&t.add(e.primaryAttribute.name),e.modulationAttribute&&t.add(e.primaryAttribute.name);const i=G(this.layer);if(i)for(const r of i)t.add(r.attributeInfo.name);if(this.layer.outFields)for(const r of R(this.layer.fieldsIndex,this.layer.outFields))t.add(r);return Array.from(t)}get _clippingBox(){if(!this.view||!this.view.clippingArea)return null;const e=P(),t=this.view.renderSpatialReference;return ee(this.view.clippingArea,e,t)?e:null}get _elevationOffset(){const e=this.layer&&this.layer.elevationInfo;if(e&&\"absolute-height\"===e.mode){const t=f(this.layer.spatialReference),i=j(e.unit);return o(e.offset,0)*i/t}return 0}initialize(){const e=this.view.resourceController;this._worker=new U((t=>e.schedule(t))),this.addResolvingPromise(this._worker.promise),this._tmpPoint=A(0,0,0,this.layer.spatialReference),D(this.layer),F(this.layer,this.view),this._indexRequester=e.createStreamDataRequester(2),this._dataRequester=e.createStreamDataRequester(3),this._initRenderer();const t=this._initNodePages(),i=this.view.resourceController.memoryController;this._memCache=i.getMemCache(this.layer.uid),this.updatingHandles.add(this,\"_clippingBox\",(()=>this._setUpdateViewNeeded()),2),this.updatingHandles.add(this,\"_elevationOffset\",(()=>this._elevationOffsetChanged()),2),this.updatingHandles.add(this.layer,\"renderer\",(()=>this._rendererChanged()),2),this.updatingHandles.add(this.layer,\"filters\",(()=>this._reload()),2),this.updatingHandles.add(this.layer,\"outFields\",(()=>this._reload()),2),this.updatingHandles.add(this.layer,\"scaleRangeId\",(()=>this._setUpdateViewNeeded())),this.updatingHandles.add(this,\"clippingArea\",(()=>this._setUpdateViewNeeded()),2),this.updatingHandles.add(this.view.state,\"contentCamera\",(()=>this._setUpdateViewNeeded())),this.handles.add([this.view.basemapTerrain.on(\"scale-change\",(e=>this._scaleUpdateHandler(e))),i.events.on(\"quality-changed\",(()=>this._setUpdateViewNeeded()))]),this.addResolvingPromise(t),this.when((()=>{this.handles.add([e.scheduler.registerTask(ne.POINT_CLOUD_LAYER,this),e.scheduler.registerIdleStateCallbacks((()=>this._idleBegin()),(()=>this._idleEnd())),this.updatingHandles.add(this,\"suspended\",(e=>{e?this._clearNodeState():this._setUpdateViewNeeded()}),2)])}),(()=>{this.updatingHandles.removeAll(),this.handles.removeAll()}))}_setUpdateViewNeeded(){this._updateViewNeeded=!0,this._updateLoading()}destroy(){this.cancelLoading(),this._worker&&(this._worker.destroy(),this._worker=null),this._destroyRenderer(),this._memCache.destroy(),this._memCache=null,this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null),this._codedDomainPopulationPromise=null}_initRenderer(){this._renderer=new X({createGraphic:(e,t,i)=>this._createGraphic(e,t,i)}),this._renderer.layerUid=this.layer.uid,this.updatingHandles.add(this,\"_clippingBox\",(e=>this._renderer.clippingBox=e),2),this.updatingHandles.add(this,\"suspended\",(e=>this._setPointsVisible(!e)),2),this.updatingHandles.add(this,\"pointScale\",(e=>this._renderer.scaleFactor=e),2),this._renderer.minSizePx=Math.sqrt(2),this.updatingHandles.add(this,\"useRealWorldSymbolSizes\",(e=>this._renderer.useRealWorldSymbolSizes=e),2),this.updatingHandles.add(this,\"pointSize\",(e=>{const t=_(e);this._renderer.size=e,this._renderer.sizePx=t}),2),this.updatingHandles.add(this,\"slicePlaneEnabled\",(e=>this._renderer.slicePlane=e),2),this.updatingHandles.add(this,\"inverseDensity\",(()=>this._setUpdateViewNeeded()),2),this.updatingHandles.add(this,\"maximumPointCount\",(()=>this._setUpdateViewNeeded()),2),this.updatingHandles.add(this.view,\"qualitySettings.sceneService.pointCloud.lodFactor\",(e=>{this._lodFactor=e,this._setUpdateViewNeeded()}),2)}_destroyRenderer(){this._renderer.removeAll(),this._setPointsVisible(!1)}_createGraphic(e,t,i){const r=n(e.pointIdFilterMap)?e.pointIdFilterMap[t]:t,s=this.view.computeMapPointFromVec3d(i),o=this._createGraphicAttributes(e,r);return new Y({pointCloudMetadata:{nodeId:e.id,pointIndexInNode:t,attributePointIndexInNode:r,epoch:this._nodeLoadEpoch},geometry:s,attributes:o,layer:this.layer,sourceLayer:this.layer})}_createGraphicAttributes(e,t){const i={};for(const r of e.attributes)this._encodeGraphicAttribute(r.attributeInfo,r.values,t,i);return i}_encodeGraphicAttribute(e,t,i,r){const s=e.storageInfo&&e.storageInfo.attributeValues,o=s?s.valuesPerElement:1;if(1===o)r[e.name]=t[i];else if(\"UInt8\"===s.valueType&&o<=4){let s=0;const n=i*o;for(let e=n;e<n+o;e++)s=(s<<8)+t[e];r[e.name]=s}else r[e.name]=void 0}_setPointsVisible(e){e&&!this._rendererAdded?(this.view._stage.addRenderPlugin([4],this._renderer),this._rendererAdded=!0):!e&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)}_rendererChanged(){this._renderer.useFixedSizes=q(this.layer.renderer),this._reload()}_reload(){this._clearNodeState(),this._memCache.clear(),this._setUpdateViewNeeded()}_elevationOffsetChanged(){this._clearNodeState(),this._memCache.clear(),this._initNodePages()}_scaleUpdateHandler(e){this.layer.minScale||this.layer.maxScale?x(e.extent,e.spatialReference,pe,this.layer.spatialReference)&&(this._nodeScales.forEach(((t,i)=>{if(!this._renderedNodes.has(i))return void this._nodeScales.delete(i);const r=this._index.getNode(i);v(pe,r.obb.center)&&this._nodeScales.set(i,e.scale)})),this._setUpdateViewNeeded()):this._nodeScales.clear()}displayNodes(e){this._workQueue=z([...this._renderedNodes],e,this._index),M(this._workQueue,this.view.state.contentCamera.viewForward,this._index),W(this._workQueue,de,this._index),this._updateQueues(),this._totalWork=this._computeWork(),this._updateLoading(),this._layerIsVisible=e.length>0||this._loadingInitNodePage,this.notifyChange(\"suspended\")}cancelLoading(){this._cancelNodeLoading(),this._cancelIndexLoading()}_cancelNodeLoading(){const e=new Array;this._loadingNodes.forEach((({abortController:t})=>e.push(t))),this._loadingNodes.clear();for(const t of e)t.abort();this._workQueue=[],this._idleQueue.cancelAll(),this._totalWork=this._computeWork(),this._updateLoading()}_updateQueues(){const e=new Set;this._workQueue.forEach((t=>t.load.forEach((t=>e.add(t)))));const t=new Array,i=new Map;this._loadingNodes.forEach(((r,s)=>{e.has(s)?i.set(s,r):t.push(r)})),this._loadingNodes=i;for(const{abortController:r}of t)r.abort();this._workQueue=this._workQueue.filter((e=>{for(const t of e.load)if(this._loadingNodes.has(t))return this._recalcWork=!0,!1;return!0})),this._totalWork=this._computeWork(),this._updateLoading()}_cancelIndexLoading(){this._indexQueue=[],this._indexPagesLoading.forEach((({abortController:e})=>e.abort())),this._indexPagesLoading.clear(),this._totalWork=this._computeWork(),this._updateLoading()}_clearNodeState(){this._nodeLoadEpoch++,this._renderedNodes.forEach((e=>this._removeFromRenderer(e))),this._cancelNodeLoading()}_idleBegin(){this._setUpdateViewNeeded()}_idleEnd(){this._setUpdateViewNeeded()}get running(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||this._indexQueue.length>0||this._workQueue.length>0||this._idleQueue.length>0}runTask(e){if(this.suspended){if(this._updateViewNeeded){this._updateViewNeeded=!1;const e=this._isRootNodeVisible();e!==this._layerIsVisible&&(this._layerIsVisible=e,this.notifyChange(\"suspended\")),this._updateLoading()}}else{for(e.run((()=>this._updateWorkQueues()));this._indexQueue.length>0&&e.run((()=>this._processIndexQueue())););for(this._processWorkQueue(e);this._idleQueue.length>0&&e.run((()=>this._idleQueue.process())););}}_processIndexQueue(){const e=this._indexQueue.shift(),t=this._loadNodePage(e);return this._indexPagesLoading.set(e,t),t.promise.then((t=>{this._index.addPage(e,t,this._elevationOffset),this._setUpdateViewNeeded()})).then((()=>{this._indexPagesLoading.delete(e)}),(()=>{this._indexPagesLoading.delete(e)})),!0}_processWorkQueue(e){for(;!e.done;){const t=this._scheduleWorkEntry();if(a(t))return;this._processWorkEntry(t),e.madeProgress()}}_scheduleWorkEntry(){let e=this._workQueue.length;for(;e--;){const e=this._workQueue.shift();if(!e.remove.find((e=>!this._renderedNodes.has(e))))return e;this._workQueue.push(e)}return null}_processWorkEntry(e){if(0!==e.load.length)Promise.all(e.load.map((e=>{const t=l(),i=this._memCache.pop(e.toString());return n(i)?this._loadingNodes.set(e,{abortController:t,promise:Promise.resolve(i)}):this._loadingNodes.has(e)||this._loadingNodes.set(e,{abortController:t,promise:this.loadNode(e,t.signal)}),this._loadingNodes.get(e).promise}))).then((t=>{for(let i=0;i<e.load.length;i++)if(t[i]){const r=this._setupRendererData(e.load[i],t[i]);this._addToRenderer(r)}for(const i of e.remove)this._removeFromRenderer(i)})).catch((()=>{})).then((()=>{for(const t of e.load)this._loadingNodes.delete(t);this._updateLoading(),this._recalcWork&&0===this._idleQueue.length&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())})),this._updateLoading();else for(const t of e.remove)this._removeFromRenderer(t)}async populateClassCodeCodedDomain(e,i){const r=\"CLASS_CODE\",s=this.layer.fieldsIndex.get(r);if(!s||s.domain)return;if(-1===e.indexOf(s.name))return;const o=await t(this.layer.queryCachedStatistics(r,{signal:i}));if(!1===o.ok)return;const n=o.value,a=n&&n.labels&&n.labels.labels;a&&Array.isArray(a)&&(s.domain=new V({name:\"CLASS_CODE\",codedValues:a.map((e=>new k({code:e.value,name:e.label})))}))}async prepareFetchPopupFeatures(e){return this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=l(),this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(e,this._codedDomainPopulationAbortController.signal).then((()=>{this._codedDomainPopulationAbortController=null}))),this._codedDomainPopulationPromise}async whenGraphicAttributes(e,t){const r=this._splitGraphicsPerNode(e),s=this.layer.attributeStorageInfo,o=t.map((e=>T(s,e))),n=async(e,t)=>{const r=this._index.getNode(t);await i(o,(async t=>{const i=t.useElevation?await this._loadElevationAttributeFromGeometry(r.resourceId):await this._loadAndParseAttribute(r,t);if(i)for(const r of e)if(this._isValidPointGraphic(r)){const e=r.pointCloudMetadata.attributePointIndexInNode;this._encodeGraphicAttribute(t,i,e,r.attributes)}}))},a=[];return r.forEach(((e,t)=>{a.push(n(e,t))})),await h(a),e}_isValidPointGraphic(e){return e instanceof Y&&e.pointCloudMetadata&&e.pointCloudMetadata.epoch===this._nodeLoadEpoch}_splitGraphicsPerNode(e){const t=new Map;for(const i of e){if(!this._isValidPointGraphic(i))continue;const e=i.pointCloudMetadata,r=t.get(e.nodeId);r?r.push(i):t.set(e.nodeId,[i])}return t}async _loadAndParseAttribute(e,t){const i=await this._loadAttribute(e.resourceId,t,null);return n(i)?$({attributeInfo:t,buffer:i},null,e.vertexCount):null}async _loadElevationAttributeFromGeometry(e){const t=this.layer.store.defaultGeometrySchema,i=J(t,await this._loadGeometry(e,null));return K(i,i.length/3)}highlight(e){if(!e)return{remove(){}};const t=r.isCollection(e)?e.toArray():Array.isArray(e)?e:[e];return this._renderer.highlight(t.map((e=>this._graphicToPointDefinition(e))))}_graphicToPointDefinition(e){if(!this._isValidPointGraphic(e))return null;const{nodeId:t,pointIndexInNode:i}=e.pointCloudMetadata;return null!=t&&null!=i?{nodeId:t,pointId:i}:null}_computeWork(){let e=0;for(const t of this._workQueue)e+=t.load.length+t.remove.length;return e+=this._loadingNodes.size,e+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize,e+=this._loadingInitNodePage?100:0,e+=this._updateViewNeeded?100:0,e}get updatingProgressValue(){if(this.suspended)return this._updateViewNeeded?0:1;const e=this._computeWork();return 1-Math.min(this._totalWork,e)/this._totalWork}_updateLoading(){this.notifyChange(\"updating\"),this.notifyChange(\"updatingProgressValue\")}canResume(){return super.canResume()&&this._layerIsVisible}isUpdating(){return this.suspended?this._updateViewNeeded:this._computeWork()>0}_initNodePages(){const e=this.layer.store.index,t=e.nodesPerPage||e.nodePerIndexBlock;return this._index=new O(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,t),this._cancelIndexLoading(),this._traverseVisible=this._index.createVisibilityTraverse(),this._loadingInitNodePage=!0,this._layerIsVisible=!0,this.notifyChange(\"suspended\"),this._updateLoading(),this._pageMultiplier=null!=e.nodesPerPage?1:e.nodePerIndexBlock,this._loadNodePage(0).promise.then((e=>{this._index.addPage(0,e,this._elevationOffset),this._loadingInitNodePage=!1,this._setUpdateViewNeeded()}))}_loadNodePage(e){const t=l(),i=`${this.baseUrl}/nodepages/${e*this._pageMultiplier}`;return{promise:this._requestNodePage(i,t.signal).then((t=>t.nodes.map(((t,i)=>({resourceId:null!=t.resourceId?t.resourceId:e*this._index.pageSize+i,obb:t.obb,firstChild:t.firstChild,childCount:t.childCount,vertexCount:null!=t.vertexCount?t.vertexCount:t.pointCount,lodThreshold:null!=t.lodThreshold?t.lodThreshold:t.effectiveArea}))))),abortController:t}}_updateWorkQueues(){if(!this._updateViewNeeded)return!1;let e=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const t=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();let i=this._computeNodesForMinimumDensity(e),r=this._computePointCount(i),s=Math.sqrt(r/(.75*t));for(;r>t;)e*=s,i=this._computeNodesForMinimumDensity(e),r=this._computePointCount(i),s=Math.sqrt(2);return this.displayNodes(i),this._updateViewNeeded=!1,this._updateLoading(),!0}_computePointCount(e){let t=0;for(let i=0;i<e.length;i++){const r=this._index.getNode(e[i]);r&&(t+=r.vertexCount)}return t}_getLodMemoryFactor(){return this.view.resourceController.memoryController.memoryFactor}_isRootNodeVisible(){let e=!1;return this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(t,i,r)=>(e=r,!1),pageMiss:()=>{}}),e}_computeNodesForMinimumDensity(e){const t=this.view.state.contentCamera,i=t.frustum,r=this._clippingBox,s=t.viewForward,o=w(s,t.eye),n=I(s,-o,le),a=t.perScreenPixelRatio/2,d=e*e,l=this._nodeIdArray;l.length=0;const{minScale:h,maxScale:u}=se(this.layer),p=0===h&&0===u?e=>l.push(e):e=>{const t=this._getScale(e);oe(t,h,u)&&l.push(e)};return this._traverseVisible({frustum:i,clippingBox:r},{predicate:(e,t,i)=>{if(!i)return!1;if(0===t.childCount)return p(e),!1;const r=this._index.getRenderObb(e);return!(this._computeAveragePixelArea(r,t.lodThreshold,t.vertexCount,n,a)<=d)||(p(e),!1)},pageMiss:(e,t)=>{p(e),this._indexQueue.indexOf(t)<0&&this._indexQueue.push(t)}}),l}_getScale(e){let t=this._nodeScales.get(e);if(null==t){const i=this._index.getNode(e).obb.center;this._tmpPoint.x=i[0],this._tmpPoint.y=i[1],this._tmpPoint.z=i[2],t=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(e,t)}return t}_computeAveragePixelArea(e,t,i,r,s){const o=1e-7,n=Math.max(o,te(e,r));return t/(n*n)/(4*s*s)/i}loadNode(e,t){try{return this.loadNodeAsync(e,t)}catch(i){throw u(i)||ae.error(i),i}}async loadAdditionalUserAttributes(e,t,i){const r=this.layer.outFields;if(!r)return[];const s=R(this.layer.fieldsIndex,r),o=new Set(e.map((e=>n(e)?e.name:null))),a=this.layer.attributeStorageInfo,l=[];for(const n of s){if(o.has(n))continue;const e=T(a,n);e&&l.push(t(e))}const h=await p(l);return c(i),d(h,(e=>e))}async loadNodeAsync(e,t){const i=this._index.getNode(e),r=B(this.layer),s=G(this.layer),o=i.resourceId,d=async e=>{if(a(e))return null;if(e.useElevation)return{attributeInfo:e,buffer:null};const i=await this._loadAttribute(o,e,t);return n(i)?{attributeInfo:e,buffer:i}:null};return this._idleQueue.push((async()=>{const i=this._loadGeometry(o,t),{primaryAttribute:n,modulationAttribute:a}=r,l=d(n),h=d(a),u=s.map((e=>e.attributeInfo)),p=u.map((e=>d(e))),_=this.loadAdditionalUserAttributes([n,a,...u],d,t),[m,g,f,y,b]=await Promise.all([i,l,h,Promise.all(p),_]);c(t);const w={geometryBuffer:m,primaryAttributeData:g,modulationAttributeData:f,filterAttributesData:y,userAttributesData:b,schema:this.layer.store.defaultGeometrySchema,rendererInfo:r,filterInfo:s,obb:this._index.getRenderObb(e),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};return this._worker.invoke(w,t)}),t)}async _loadGeometry(e,t){return this._requestData(`${this.baseUrl}/nodes/${e}/geometries/0`,t)}async _loadAttribute(e,t,i){if(a(t)||!t.storageInfo)return null;const r=t.storageInfo.key;return this._requestData(`${this.baseUrl}/nodes/${e}/attributes/${r}`,i)}_requestNodePage(e,t){const i={f:\"json\",token:this.layer.apiKey};return this._indexRequester.request(e,\"json\",{query:i,signal:t})}_requestData(e,t){return this._dataRequester.request(e,\"binary\",{query:{token:this.layer.apiKey},signal:t})}_removeFromRenderer(e){if(this._renderedNodes.has(e)){const t=this._renderer.removeNode(e);this._renderedNodes.delete(e),this._nodeScales.delete(e),this._memCache.put(t.id.toString(),t,ue(t))}}_addToRenderer(e){this._renderedNodes.has(e.id)||(this._renderedNodes.add(e.id),this._renderer.addNode(e))}_setupRendererData(e,t){const i=this._index.getNode(e),r=Math.sqrt(i.lodThreshold/i.vertexCount),s=this._index.getRenderObb(e);if(X.isInstanceOfNode(t))return t.splatSize=r,t.obb=s,t.origin=N(t.obb.center),t;const o=.01*Math.max(s.halfSize[0],s.halfSize[1],s.halfSize[2]);if(t.obb.halfSize[0]>s.halfSize[0]+o||t.obb.halfSize[1]>s.halfSize[1]+o||t.obb.halfSize[2]>s.halfSize[2]+o){if(this._maxLoggedBoxWarnings>0){const i=e=>`[${e.halfSize[0]}, ${e.halfSize[1]}, ${e.halfSize[2]}]`;ae.warn(`Node ${e} reported bounding box too small. got ${i(s)} but points cover ${i(t.obb)}`),0==--this._maxLoggedBoxWarnings&&ae.warn(\"  Too many bounding box errors, stopping reporting for this layer.\")}this._index.setRenderObb(e,t.obb)}return{id:e,coordinates:t.points,origin:N(s.center),rgb:t.rgb,attributes:t.attributes,pointIdFilterMap:t.pointIdFilterMap,highlights:null,splatSize:r,obb:s,isLeaf:0===i.childCount}}getUsedMemory(){let e=0;return this._renderer.forEachNode((t=>{e+=ce,e+=m(t.coordinates);for(const i of t.attributes){const t=i.values;g(t.buffer)&&(e+=m(t))}})),e}getUnloadedMemory(){const e=this._renderedNodes.size;if(e<4)return 0;const t=[...this._renderedNodes].reduce(((e,t)=>e+this._index.getNode(t).vertexCount));let i=this._loadingNodes.size;for(let r=0;r<this._workQueue.length;r++)i+=this._workQueue[r].load.length,i-=this._workQueue[r].remove.length;if(i<0)return 0;return i*t/e*((this.getUsedMemory()-e*ce)/t)+i*ce}ignoresMemoryFactor(){return!1}get performanceInfo(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce(((e,t)=>e+this._index.getNode(t).vertexCount),0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,\"Loading Nodes\":this._loadingNodes.size,\"Index Queue\":this._indexQueue.length,\"Work Queue\":this._workQueue.length,\"Idle Queue\":this._idleQueue.length}}get test(){return{index:this._index,visibleNodes:this._renderedNodes}}};function ue(e){return 5*e.coordinates.length+128}e([y()],he.prototype,\"layer\",void 0),e([y({readOnly:!0,aliasOf:\"layer.parsedUrl.path\"})],he.prototype,\"baseUrl\",void 0),e([y({readOnly:!0})],he.prototype,\"pointScale\",null),e([y({readOnly:!0})],he.prototype,\"useRealWorldSymbolSizes\",null),e([y({readOnly:!0})],he.prototype,\"pointSize\",null),e([y({readOnly:!0})],he.prototype,\"inverseDensity\",null),e([y()],he.prototype,\"maximumPointCount\",void 0),e([y({readOnly:!0})],he.prototype,\"availableFields\",null),e([y({readOnly:!0})],he.prototype,\"_clippingBox\",null),e([y({readOnly:!0})],he.prototype,\"_elevationOffset\",null),e([y({type:Boolean})],he.prototype,\"slicePlaneEnabled\",void 0),e([y()],he.prototype,\"updating\",void 0),e([y(ie)],he.prototype,\"updatingProgress\",void 0),e([y({readOnly:!0})],he.prototype,\"updatingProgressValue\",null),he=e([b(\"esri.views.3d.layers.PointCloudLayerView3D\")],he);const pe=C(),ce=160;var _e=he;export{_e as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l}from\"../../../layers/support/fieldUtils.js\";async function t(t,d=t.popupTemplate){if(!e(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes(\"*\"))return[\"*\"];const f=n?await p(t):[],r=l(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,t as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import r from\"../../../../core/Error.js\";import{isSome as s}from\"../../../../core/maybe.js\";import\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as t}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{unpackFieldNames as o,populateMissingFields as p}from\"../../../../layers/support/fieldUtils.js\";import{getFetchPopupTemplate as a,getRequiredFields as i}from\"../../../layers/support/popupUtils.js\";const c=c=>{let u=class extends c{_validateFetchPopupFeatures(e){const{layer:s}=this,{popupEnabled:t}=s;if(!t)return new r(\"scenelayerview3d:fetchPopupFeatures\",\"Popups are disabled\",{layer:s});return a(s,e)?void 0:new r(\"scenelayerview3d:fetchPopupFeatures\",\"Layer does not define a popup template\",{layer:s})}async prepareFetchPopupFeatures(e){}async fetchPopupFeatures(e,r){const t=this._validateFetchPopupFeatures(r);if(t)return Promise.reject(t);const c=s(r)?r.clientGraphics:null;if(!c||0===c.length)return Promise.resolve([]);const u=[],n=[],l=\"scene\"===this.layer.type&&s(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer,h=o(this.layer.fieldsIndex,await i(l,a(this.layer,r)));await this.prepareFetchPopupFeatures(h);const y=new Set;for(const s of c)p(h,s,y)?n.push(s):u.push(s);return 0===n.length?Promise.resolve(u):this.whenGraphicAttributes(n,[...y]).catch((()=>n)).then((e=>u.concat(e)))}};return u=e([t(\"esri.views.3d.layers.support.PopupSceneLayerView\")],u),u};export{c as PopupSceneLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{Slice as e}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{OutputHighlight as i}from\"../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl.js\";import{RgbaFloatEncoding as o}from\"../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl.js\";import{glsl as t}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as a}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function r(r){const n=new a,d=0===r.output,c=1===r.output,s=4===r.output;return n.extensions.add(\"GL_OES_standard_derivatives\"),n.include(e,r),n.attributes.add(\"position\",\"vec3\"),n.attributes.add(\"color\",\"vec3\"),n.vertex.uniforms.add(\"uModelViewMatrix\",\"mat4\").add(\"uProjectionMatrix\",\"mat4\").add(\"uScreenMinMaxSize\",\"vec2\").add(\"uPointScale\",\"vec2\").add(\"uClipMin\",\"vec3\").add(\"uClipMax\",\"vec3\"),c?(n.vertex.uniforms.add(\"nearFar\",\"vec2\"),n.varyings.add(\"depth\",\"float\")):4!==r.output&&n.varyings.add(\"vColor\",\"vec3\"),n.vertex.code.add(t`\n    void main(void) {\n      // Move clipped points outside of clipspace\n      if (position.x < uClipMin.x || position.y < uClipMin.y || position.z < uClipMin.z ||\n        position.x > uClipMax.x || position.y > uClipMax.y || position.z > uClipMax.z) {\n        gl_Position = vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize = 0.0;\n        return;\n      }\n\n      if (rejectBySlice(position)) {\n        gl_Position = vec4(0.0,0.0,0.0,2.0);\n        gl_PointSize = 0.0;\n        return;\n      }\n\n      // Position in camera space\n      vec4 camera = uModelViewMatrix * vec4(position, 1.0);\n\n      float pointSize = uPointScale.x;\n      vec4 position = uProjectionMatrix * camera;\n     ${r.drawScreenSize?t`\n      float clampedScreenSize = pointSize;`:t`\n      float pointRadius = 0.5 * pointSize;\n      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);\n      vec4 positionOffset = uProjectionMatrix * cameraOffset;\n      float radius = abs(positionOffset.y - position.y);\n      float viewHeight = uPointScale.y;\n      // screen diameter = (2 * r / w) * (h / 2)\n      float screenPointSize = (radius / position.w) * viewHeight;\n      float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\n      // Shift towards camera, to move rendered point out of terrain i.e. to\n      // the camera-facing end of the virtual point when considering it as a\n      // 3D sphere.\n      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\n      position = uProjectionMatrix * camera;`}\n\n     gl_PointSize = clampedScreenSize;\n     gl_Position = position;\n\n     ${c?t`depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);`:\"\"}\n     ${d?t`vColor = color;`:\"\"}\n    }\n  `),n.fragment.include(o,r),s&&n.include(i),n.fragment.code.add(t`\n    void main(void) {\n      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);\n      float r2 = dot(vOffset, vOffset);\n\n      if (r2 > 0.25) {\n        discard;\n      }\n      ${c?t`gl_FragColor = float2rgba(depth);`:\"\"}\n      ${s?t`outputHighlight();`:\"\"}\n      ${d?t`gl_FragColor = vec4(vColor, 1.0);`:\"\"}\n    }\n  `),n}var n=Object.freeze({__proto__:null,build:r});export{n as P,r as b};\n"],"sourceRoot":""}