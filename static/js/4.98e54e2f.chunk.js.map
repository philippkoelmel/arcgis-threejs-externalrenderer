{"version":3,"sources":["../node_modules/@arcgis/core/views/layers/support/FeatureFilter.js","../node_modules/@arcgis/core/views/support/floorFilterUtils.js","../node_modules/@arcgis/core/views/3d/layers/support/attributeUtils.js","../node_modules/@arcgis/core/views/3d/layers/graphics/QueryEngine.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFilterVisibility.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFrustumVisibility.js","../node_modules/@arcgis/core/views/3d/webgl-engine/lib/Object3DStateSet.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStateSet.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStates.js","../node_modules/@arcgis/core/views/3d/layers/graphics/ExtentSet.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DElevationAlignment.js"],"names":["d","m","i","esriSpatialRelIntersects","esriSpatialRelContains","esriSpatialRelCrosses","esriSpatialRelDisjoint","esriSpatialRelEnvelopeIntersects","esriSpatialRelIndexIntersects","esriSpatialRelOverlaps","esriSpatialRelTouches","esriSpatialRelWithin","esriSpatialRelRelation","u","esriSRUnit_Meter","esriSRUnit_Kilometer","esriSRUnit_Foot","esriSRUnit_StatuteMile","esriSRUnit_NauticalMile","esriSRUnit_USNauticalMile","h","e","where","geometry","spatialRelationship","hiddenIds","Set","distance","objectIds","units","timeExtent","enabled","t","this","_set","r","s","n","a","p","c","o","l","forEach","add","type","String","prototype","types","json","read","write","source","reader","target","writer","Array","from","Number","overridePolicy","readOnly","y","layer","floorInfo","floorField","view","floors","definitionExpression","length","filter","map","push","join","toLowerCase","get","name","_dataQueryEngineInstance","geometryType","outSpatialReference","spatialReference","toJSON","ensureDataQueryEngine","clear","destroy","dataQueryEngine","executeQueryForIdSet","_ensureQueryJSON","executeQueryForCount","executeQueryForExtent","count","extent","fromJSON","executeQueryForIds","executeQueryForLatestObservations","features","sourceLayer","executeQuery","defaultQueryJSON","timeInfo","objectIdField","queryGeometryType","fields","layerView","resourceController","scheduler","priority","graphics3d","graphicsCore","featureStore","hasZ","hasM","constructOnly","aliasOf","getLogger","_","_dirty","_querying","_handles","_queryResult","_layerView","_core","_objectIdField","_queryEngine","FILTER_VISIBILITY","registerTask","owner","_graphicsChanged","dirty","filterChanged","modifyGraphics3DGraphicVisibilities","clearVisibilityFlag","notifyChange","active","hasVisibilityFlag","setVisibilityFlag","recomputeFilter","graphics3DGraphics","size","clone","intersection","done","then","catch","warn","error","_getFeatureId","graphic","madeProgress","has","objectId","attributes","V","watchUpdatingTracking","C","suspendResumeExtentMode","dataExtent","suspendResumeExtent","scaleVisibility","suspended","outsideScaleRange","frustumVisibility","outsideOfView","updating","frustumVisibilityEnabled","f","scaleVisibilityEnabled","w","filterVisibilityEnabled","timeExtentVisibilityEnabled","elevationAlignmentEnabled","g","preferredUpdatePolicy","elevationFeatureExpressionEnabled","graphicSymbolSupported","filterVisibility","elevationAlignment","updateClippingExtent","layerMinMaxScaleChangeHandler","addPromise","elevationInfoChange","updateVisibilityInfo","updateLabelingInfo","setup","basemapTerrain","spatialIndex","queryGraphicUIDsInExtent","elevationProvider","b","labeler","addGraphicsOwner","deconflictor","deconfliction","labeling","objectStates","rendererChange","opacityChange","setupSuspendResumeExtent","_updateClippingExtent","startCreateGraphics","labelsEnabled","acquireSet","set","handle","setUid","uid","queryObjectIds","setObjectIds","highlight","toArray","isArray","E","fieldsIndex","setUids","S","clippingArea","setClippingExtent","recreateAllGraphics","remove","j","updateSuspendResumeExtent","watch","computedExtent","suspendResumeExtentChanged","extentToSuspendResumeRect","equals","x","extentPadding","setExtent","dependsOn","v","pause","resume","arguments","extentIntersectionDirty","_isVisibleBelowSurface","handles","extentIntersection","renderCoordsHelper","on","viewChange","state","FRUSTUM_VISIBILITY","elevationBoundsChange","viewingMode","isVisibleBelowSurface","updateIsVisibleBelowSurface","_setDirty","ground","navigationConstraint","opaque","radius","elevationBounds","min","max","Math","update","updateExtentIntersection","frustum","isVisibleInFrustum","items","objectStateId","object","renderGeometry","_removeObjectStateItem","splice","channel","removeHighlight","removeOcclude","removeRenderGeometryObjectState","stateType","objectStateSet","ids","paused","_graphicsCore","_stateSets","removeAll","releaseSet","indexOf","addObjectStateSet","removeObjectState","_addObjectStateSet","initializeSet","hasGraphic","_removeObjectStateSet","states","_extents","allocator","_tmpExtent","contains","removeContained","pushNew","mergeTight","pop","hasProgressed","sort","getItemAt","delete","some","filterInPlace","containsPoint","dirtyExtents","globalDirty","averageExtentUpdateSize","dirtyGraphicsSet","updateElevation","events","_elevationChanged","suspendedChange","ELEVATION_ALIGNMENT","running","empty","markAllGraphicsElevationDirty","run","merge","_updateDirtyGraphics","_updateDirtyExtents","setDirty","effectiveUpdatePolicy","keys","getGraphics3DGraphicById","alignWithElevation","emit","needsElevationUpdates","context","elevationInfo","mode","xmin","xmax","ymin","ymax"],"mappings":"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","file":"static/js/4.98e54e2f.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{geometryTypes as t}from\"../../../geometry.js\";import r from\"../../../TimeExtent.js\";import{JSONMap as i}from\"../../../core/jsonMap.js\";import{JSONSupport as s}from\"../../../core/JSONSupport.js\";import{clone as o}from\"../../../core/lang.js\";import{property as n}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import{writer as p}from\"../../../core/accessorSupport/decorators/writer.js\";import{fromJSON as l}from\"../../../geometry/support/jsonUtils.js\";import c from\"../../../rest/support/Query.js\";var d;const m=new i({esriSpatialRelIntersects:\"intersects\",esriSpatialRelContains:\"contains\",esriSpatialRelCrosses:\"crosses\",esriSpatialRelDisjoint:\"disjoint\",esriSpatialRelEnvelopeIntersects:\"envelope-intersects\",esriSpatialRelIndexIntersects:\"index-intersects\",esriSpatialRelOverlaps:\"overlaps\",esriSpatialRelTouches:\"touches\",esriSpatialRelWithin:\"within\",esriSpatialRelRelation:\"relation\"}),u=new i({esriSRUnit_Meter:\"meters\",esriSRUnit_Kilometer:\"kilometers\",esriSRUnit_Foot:\"feet\",esriSRUnit_StatuteMile:\"miles\",esriSRUnit_NauticalMile:\"nautical-miles\",esriSRUnit_USNauticalMile:\"us-nautical-miles\"});let h=d=class extends s{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship=\"intersects\",this.hiddenIds=new Set,this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null,this.enabled=!1}writeWhere(e,t){t.where=e||\"1=1\"}enable(){this._set(\"enabled\",!0)}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:a,distance:p}=this;return new c({geometry:o(r),objectIds:o(n),spatialRelationship:i,timeExtent:o(s),where:t,units:a,distance:p,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,hiddenIds:i,timeExtent:s,objectIds:n,units:a,distance:p}=this,l=new Set;return i.forEach((e=>l.add(e))),new d({geometry:o(t),hiddenIds:l,objectIds:o(n),spatialRelationship:r,timeExtent:o(s),where:e,units:a,distance:p})}};e([n({type:String})],h.prototype,\"where\",void 0),e([p(\"where\")],h.prototype,\"writeWhere\",null),e([n({types:t,json:{read:l,write:!0}})],h.prototype,\"geometry\",void 0),e([n({type:String,json:{read:{source:\"spatialRel\",reader:m.read},write:{target:\"spatialRel\",writer:m.write}}})],h.prototype,\"spatialRelationship\",void 0),e([n({json:{write:(e,t,r)=>t[r]=Array.from(e),read:e=>new Set(e)}})],h.prototype,\"hiddenIds\",void 0),e([n({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],h.prototype,\"distance\",void 0),e([n({type:[Number],json:{write:!0}})],h.prototype,\"objectIds\",void 0),e([n({type:String,json:{read:u.read,write:{writer:u.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],h.prototype,\"units\",void 0),e([n({type:r,json:{write:!0}})],h.prototype,\"timeExtent\",void 0),e([n({readOnly:!0})],h.prototype,\"enabled\",void 0),h=d=e([a(\"esri.views.layers.support.FeatureFilter\")],h);var y=h;export{y as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nfunction o(o){var n;const l=o.layer;if(\"floorInfo\"in l&&null!=(n=l.floorInfo)&&n.floorField&&\"floors\"in o.view){return r(o.view.floors,l.floorInfo.floorField)}return null}function n(o,n){var l;return\"floorInfo\"in n&&null!=(l=n.floorInfo)&&l.floorField?r(o,n.floorInfo.floorField):null}function l(o,n){const{definitionExpression:l}=n;return o?l?`(${l}) AND (${o})`:o:l}function r(o,n){if(null==o||!o.length)return null;const l=o.filter((o=>\"\"!==o)).map((o=>`'${o}'`));return l.push(\"''\"),`${n} IN (${l.join(\",\")}) OR ${n} IS NULL`}export{l as combineFloorsDefinitionExpression,o as getFloorFilterClause,n as getLayerFloorFilterClause};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nfunction n(n,t,e){if(!e||null==t)return null;if(!n)return r(t,e);const o=n.get(e);return o?t[o.name]:null}function r(n,r){const t=r.toLowerCase();for(const e in n)if(e.toLowerCase()===t)return n[e];return null}export{n as attributeLookup};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import r from\"../../../../core/Accessor.js\";import{isNone as t}from\"../../../../core/maybe.js\";import{property as s}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../../geometry/Extent.js\";import o from\"../../../../layers/graphics/data/QueryEngine.js\";import i from\"../../../../rest/support/FeatureSet.js\";import u from\"../../../../rest/support/Query.js\";import{featureGeometryTypeKebabDictionary as y}from\"../../../../geometry/support/typeUtils.js\";const c=o;let l=class extends r{constructor(e){super(e),this._dataQueryEngineInstance=null}get queryGeometryType(){switch(this.layer.geometryType){case\"multipoint\":case\"point\":case\"polygon\":case\"polyline\":return this.layer.geometryType;case\"mesh\":return\"polygon\";default:return}}get defaultQueryJSON(){return new u({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this.ensureDataQueryEngine()}destroy(){this.clear()}clear(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}async executeQueryForIdSet(e,r){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),r)}async executeQueryForCount(e,r){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),r)}async executeQueryForExtent(e,r){const{count:t,extent:s}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),r);return{count:t,extent:n.fromJSON(s)}}async executeQueryForIds(e,r){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),r)}async executeQueryForLatestObservations(e,r){const t=await this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),r),s=i.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}async executeQuery(e,r){const t=await this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),r),s=i.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}_ensureQueryJSON(e){return t(e)?this.defaultQueryJSON:(\"outSpatialReference\"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())}ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e=\"timeInfo\"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,r=this.layer.objectIdField,t=y.toJSON(this.queryGeometryType),s=this.layer.fields.map((e=>e.toJSON())),a=this.layerView.view.resourceController.scheduler,n=this.priority,o=this.spatialReference.toJSON(),i=this.layerView.graphics3d.graphicsCore.featureStore,{hasZ:u,hasM:l}=this.layerView;return this._dataQueryEngineInstance=new c({hasZ:u,hasM:l,geometryType:t,fields:s,timeInfo:e,spatialReference:o,objectIdField:r,featureStore:i,scheduler:a,priority:n}),this._dataQueryEngineInstance}};e([s({constructOnly:!0})],l.prototype,\"layerView\",void 0),e([s({constructOnly:!0})],l.prototype,\"priority\",void 0),e([s({readOnly:!0,aliasOf:\"layerView.view.spatialReference\"})],l.prototype,\"spatialReference\",void 0),e([s({readOnly:!0,aliasOf:\"layerView.layer\"})],l.prototype,\"layer\",void 0),e([s({readOnly:!0})],l.prototype,\"queryGeometryType\",null),e([s({readOnly:!0})],l.prototype,\"defaultQueryJSON\",null),l=e([a(\"esri.views.3d.layers.graphics.QueryEngine\")],l);var p=l;export{l as QueryEngine,p as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import i from\"../../../../core/Accessor.js\";import t from\"../../../../core/Handles.js\";import r from\"../../../../core/Logger.js\";import{isNone as s,isSome as h}from\"../../../../core/maybe.js\";import{isAbortError as l}from\"../../../../core/promiseUtils.js\";import{on as o}from\"../../../../core/watchUtils.js\";import{property as n}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import u from\"./QueryEngine.js\";import c from\"../../../layers/support/FeatureFilter.js\";import{getFloorFilterClause as y}from\"../../../support/floorFilterUtils.js\";import{TaskPriority as d}from\"../../../support/Scheduler.js\";const p=r.getLogger(\"esri.views.3d.layers.graphics.Graphics3DFilterVisibility\");let _=class extends i{constructor(...e){super(...e),this.filter=null,this._dirty=!1,this._querying=!1,this._handles=new t}get updating(){return this._dirty||this._querying||null!=this._queryResult}setup(e,i){this._layerView=e,this._core=i,this._objectIdField=e.layer.objectIdField,this._queryEngine=new u({layerView:this._layerView,priority:d.FILTER_VISIBILITY});const t=this._layerView.view.resourceController.scheduler;this._handles.add(t.registerTask(d.FILTER_VISIBILITY,this)),this._handles.add(o(i.owner,\"loadedGraphics\",\"after-changes\",(e=>this._graphicsChanged(e)),(()=>this.dirty=!0))),this.filterChanged()}destroy(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null}clear(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((e=>e.clearVisibilityFlag(2))),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange(\"updating\")}_graphicsChanged(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)}updateVisibility(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)}filterChanged(){const e=this.recomputeFilter();e!==this.filter&&(this.filter=e,this.dirty=!0)}get active(){return this.filter&&this._core.graphics3DGraphics.size>0}recomputeFilter(){const e=\"filter\"in this._layerView?this._layerView.filter:null,i=\"timeExtent\"in this._layerView?this._layerView.timeExtent:null,t=y(this._layerView);if(s(i)&&s(t))return e;const r=h(e)?e.clone():new c;if(h(i)&&(r.timeExtent=h(r.timeExtent)?r.timeExtent.intersection(i):i),h(t)){const e=null==r.where||\"\"===r.where;r.where=e?t:`(${r.where}) AND (${t})`}return r}get running(){return this._dirty&&!this._querying||null!=this._queryResult}runTask(e){this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then((e=>{this._queryResult=e,this._querying=!1})).catch((e=>{l(e)||(p.warn(\"FeatureFilter query failed: \"+e,{error:e}),this._queryResult=new Set,this._core.graphics3DGraphics.forEach((e=>this._queryResult.add(this._getFeatureId(e.graphic)))),this._querying=!1)})),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((i=>{if(e.done)return!1;const t=this._queryResult.has(this._getFeatureId(i.graphic));return!!i.setVisibilityFlag(2,t,0)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null)),this.notifyChange(\"updating\")):this.clear()}_getFeatureId(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId}set dirty(e){this._dirty!==e&&(this._dirty=e,this.notifyChange(\"updating\"))}};e([n({readOnly:!0})],_.prototype,\"updating\",null),_=e([a(\"esri.views.3d.layers.graphics.Graphics3DFilterVisibility\")],_);export{_ as Graphics3DFilterVisibility};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../Graphic.js\";import i from\"../../../../core/Accessor.js\";import{neverReached as s}from\"../../../../core/compilerUtils.js\";import r from\"../../../../core/Handles.js\";import{logOnError as n}from\"../../../../core/promiseUtils.js\";import{init as a}from\"../../../../core/watchUtils.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{diff as p}from\"../../../../core/accessorSupport/diffUtils.js\";import{canProject as h,project as d}from\"../../../../geometry/support/webMercatorUtils.js\";import c from\"../../../../rest/support/Query.js\";import{SUSPEND_RESUME_EXTENT_OPTIMISM as u}from\"./constants.js\";import{Graphics3DCore as g}from\"./Graphics3DCore.js\";import m from\"./Graphics3DElevationAlignment.js\";import{Graphics3DFilterVisibility as y}from\"./Graphics3DFilterVisibility.js\";import f from\"./Graphics3DFrustumVisibility.js\";import{Graphics3DObjectStates as b}from\"./Graphics3DObjectStates.js\";import w from\"./Graphics3DScaleVisibility.js\";import{enlargeExtent as x}from\"./graphicUtils.js\";import{attributeLookup as E}from\"../support/attributeUtils.js\";import{WatchUpdatingTracking as C}from\"../../../support/WatchUpdatingTracking.js\";let V=class extends i{constructor(t){super(t),this._handles=new r,this.watchUpdatingTracking=new C,this.suspendResumeExtentMode=\"computed\",this.dataExtent=null,this.suspendResumeExtent=null}get suspended(){var t;return null==(t=this.scaleVisibility)?void 0:t.suspended}get suspendInfo(){var t,e;const i={};return null!=(t=this.scaleVisibility)&&t.suspended&&(i.outsideScaleRange=!0),null!=(e=this.frustumVisibility)&&e.suspended&&(i.outsideOfView=!0),i}get updating(){var t,e,i;return!!(null!=(t=this.graphicsCore)&&t.updating||null!=(e=this.frustumVisibility)&&e.updating||null!=(i=this.watchUpdatingTracking)&&i.updating)}normalizeCtorArgs(t){const e=t.frustumVisibilityEnabled?new f:null,i=t.scaleVisibilityEnabled?new w:null,s=(t.filterVisibilityEnabled||t.timeExtentVisibilityEnabled)&&\"multipatch\"!==t.layer.geometryType?new y:null,r=t.elevationAlignmentEnabled?new m:null,n=new g({owner:t.owner,layer:t.layer,preferredUpdatePolicy:t.preferredUpdatePolicy,elevationFeatureExpressionEnabled:t.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:t.owner.hasZ,hasM:t.owner.hasM}),{updateClippingExtent:a,suspendResumeExtentMode:o,dataExtent:l}=t;return{graphicsCore:n,frustumVisibility:e,scaleVisibility:i,filterVisibility:s,elevationAlignment:r,updateClippingExtent:a,suspendResumeExtentMode:o,dataExtent:l}}initialize(){this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,\"scaleRangeId\",(()=>this.scaleVisibility.layerMinMaxScaleChangeHandler())),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,\"filter\",(()=>this.filterVisibility.filterChanged())),this.watchUpdatingTracking.add(this.owner,\"timeExtent\",(()=>this.filterVisibility.filterChanged()))),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,\"elevationInfo\",((t,e)=>{p(t,e)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())})),this.watchUpdatingTracking.add(this.layer,\"labelsVisible\",(()=>this.graphicsCore.updateVisibilityInfo())),this.watchUpdatingTracking.add(this.layer,\"labelingInfo\",((t,e)=>{p(t,e)&&this.graphicsCore.updateLabelingInfo()}))}async setup(){this.frustumVisibility&&this.frustumVisibility.setup(this.owner);const t=this.owner,e=this.owner.view.basemapTerrain,i=(t,e,i)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(t,e,i);if(this.scaleVisibility&&this.scaleVisibility.setup(t,this.layer,i,this.graphicsCore,e),this.filterVisibility&&(\"filter\"in t||\"timeExtent\"in t)&&this.filterVisibility.setup(t,this.graphicsCore),this.elevationAlignment){const e=t.view.elevationProvider;this.elevationAlignment.setup(t,i,this.graphicsCore,e)}this._set(\"objectStates\",new b(this.graphicsCore)),this._set(\"labeling\",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set(\"deconfliction\",t.view.deconflictor.addGraphicsOwner(this.graphicsCore)),await n(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates})),this.watchUpdatingTracking.add(this.layer,\"renderer\",(t=>this.watchUpdatingTracking.addPromise(this.graphicsCore.rendererChange(t)))),this.watchUpdatingTracking.add(t,\"fullOpacity\",(()=>this.graphicsCore.opacityChange())),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(t.view,\"clippingArea\",(()=>this._updateClippingExtent())),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled&&await n(this.graphicsCore.updateLabelingInfo())}destroy(){this._handles&&(this._handles.destroy(),this._handles=null);const t=[\"watchUpdatingTracking\",\"frustumVisibility\",\"scaleVisibility\",\"filterVisibility\",\"elevationAlignment\",\"objectStates\",\"graphicsCore\"];for(const e of t){const t=this[e];t&&(t.destroy(),this._set(e,null))}this._set(\"layer\",null),this._set(\"owner\",null)}maskOccludee(t){const{set:e,handle:i}=this.objectStates.acquireSet(1,null);return this.objectStates.setUid(e,t.uid),i}highlight(t,i){if(t instanceof c){const{set:e,handle:s}=this.objectStates.acquireSet(0,i);return this.owner.queryObjectIds(t).then((t=>this.objectStates.setObjectIds(e,t))),s}if(\"number\"==typeof t||\"string\"==typeof t)return this.highlight([t],i);if(t instanceof e)return this.highlight([t],i);if(\"toArray\"in t&&(t=t.toArray()),Array.isArray(t)&&t.length>0){if(t[0]instanceof e){const e=t;if(null==E(this.layer.fieldsIndex,e[0].attributes,i)){const t=e.map((t=>t.uid)),{set:i,handle:s}=this.objectStates.acquireSet(0,null);return this.objectStates.setUids(i,t),s}t=e.map((t=>E(this.layer.fieldsIndex,t.attributes,i)))}if(\"number\"==typeof t[0]||\"string\"==typeof t[0]){const e=t,{set:s,handle:r}=this.objectStates.acquireSet(0,i);return this.objectStates.setObjectIds(s,e),r}}return S}_updateClippingExtent(){const t=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(t,this.owner.view.spatialReference)&&(this.updateClippingExtent(t)||this.graphicsCore.recreateAllGraphics())}setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(a(this,\"suspendResumeExtentMode\",(()=>{switch(this._handles.remove(j),this.suspendResumeExtentMode){case\"computed\":this._handles.add([a(this.graphicsCore,\"computedExtent\",(t=>this.updateSuspendResumeExtent(t))),this.graphicsCore.watch(\"extentPadding\",(()=>this.updateSuspendResumeExtent(this.graphicsCore.computedExtent)))],j);break;case\"data\":this._handles.add([a(this,\"dataExtent\",(t=>this.updateSuspendResumeExtent(t))),this.graphicsCore.watch(\"extentPadding\",(()=>this.updateSuspendResumeExtent(this.dataExtent)))],j);break;default:s(this.suspendResumeExtentMode)}})))}updateSuspendResumeExtent(t){t?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(t,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)}extentToSuspendResumeRect(t,e){const i=this.owner.view.spatialReference;if(!t.spatialReference.equals(i)){if(!h(t,i))return;t=d(t,i)}return x(t,e,u,this.graphicsCore.extentPadding)}suspendResumeExtentChanged(t){this.frustumVisibility&&this.frustumVisibility.setExtent(t),this.scaleVisibility&&this.scaleVisibility.setExtent(t)}};t([o({aliasOf:\"graphicsCore.layer\"})],V.prototype,\"layer\",void 0),t([o({aliasOf:\"graphicsCore.owner\"})],V.prototype,\"owner\",void 0),t([o({constructOnly:!0})],V.prototype,\"updateClippingExtent\",void 0),t([o({constructOnly:!0})],V.prototype,\"graphicsCore\",void 0),t([o({constructOnly:!0})],V.prototype,\"scaleVisibility\",void 0),t([o({constructOnly:!0})],V.prototype,\"filterVisibility\",void 0),t([o({constructOnly:!0})],V.prototype,\"elevationAlignment\",void 0),t([o({constructOnly:!0})],V.prototype,\"frustumVisibility\",void 0),t([o({readOnly:!0})],V.prototype,\"deconfliction\",void 0),t([o({readOnly:!0})],V.prototype,\"labeling\",void 0),t([o({readOnly:!0})],V.prototype,\"objectStates\",void 0),t([o({readOnly:!0})],V.prototype,\"watchUpdatingTracking\",void 0),t([o()],V.prototype,\"suspendResumeExtentMode\",void 0),t([o()],V.prototype,\"dataExtent\",void 0),t([o({readOnly:!0})],V.prototype,\"suspended\",null),t([o({readOnly:!0})],V.prototype,\"suspendInfo\",null),t([o({readOnly:!0,dependsOn:[\"graphicsCore.updating\",\"frustumVisibility.updating\",\"watchUpdatingTracking.updating\"]})],V.prototype,\"updating\",null),V=t([l(\"esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView\")],V);var v=V;const j=\"suspendResumeExtentMode\",S={remove(){},pause(){},resume(){}};export{v as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import s from\"../../../../core/Handles.js\";import{init as i}from\"../../../../core/watchUtils.js\";import{property as r}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{getReferenceEllipsoid as o}from\"../../../../geometry/projectionEllipsoid.js\";import{FrustumExtentIntersection as a}from\"../../support/FrustumExtentIntersection.js\";import{TaskPriority as l}from\"../../../support/Scheduler.js\";const h=1.2;let u=class extends t{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new s,this.layerView=null,this.updating=!0}setup(e){this.layerView=e,this.extentIntersection=new a({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,s=t.basemapTerrain,r=t.resourceController.scheduler;this.handles.add([t.on(\"resize\",(()=>this.viewChange())),t.state.watch(\"camera\",(()=>this.viewChange()),!0),r.registerTask(l.FRUSTUM_VISIBILITY,this),s.on(\"elevation-bounds-change\",(()=>this.elevationBoundsChange()))]),\"local\"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([i(s,[\"opacity\",\"wireframe\"],(()=>this.updateIsVisibleBelowSurface())),i(t,\"map.ground.navigationConstraint.type\",(()=>this.updateIsVisibleBelowSurface()))])}destroy(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set(\"updating\",!0)}setExtent(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}viewChange(){this._setDirty()}elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}updateIsVisibleBelowSurface(){const e=this.layerView.view,t=e.basemapTerrain,s=\"local\"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&\"none\"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=s||!t.opaque||i}updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const e=this.layerView.view;let t;if(this._isVisibleBelowSurface)t=-.3*o(e.spatialReference).radius;else{const{min:s,max:i}=e.basemapTerrain.elevationBounds;t=s-Math.max(1,(i-s)*(h-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}get running(){return this.updating}runTask(){if(this._set(\"updating\",!1),!this.extent)return void this._set(\"suspended\",!1);this.updateExtentIntersection();const e=this.layerView.view.frustum,t=o(this.layerView.view.spatialReference).radius;this._set(\"suspended\",!this.extentIntersection.isVisibleInFrustum(e,t))}};e([r({readOnly:!0})],u.prototype,\"suspended\",void 0),e([r({readOnly:!0})],u.prototype,\"updating\",void 0),u=e([n(\"esri.views.3d.layers.graphics.Graphics3DFrustumVisibility\")],u);var p=u;export{p as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nclass e{constructor(){this.items=[]}addObject(e,t){this.items.push({type:0,objectStateId:t,object:e})}addRenderGeometry(e,t,s){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:s})}addExternal(e,t){this.items.push({type:2,objectStateId:t,remove:e})}remove(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];s.objectStateId===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeObject(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];0===s.type&&s.object===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeRenderGeometry(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];1===s.type&&s.renderGeometry===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeAll(){this.items.forEach((e=>{this._removeObjectStateItem(e)})),this.items=[]}_removeObjectStateItem(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}}}export{e as Object3DStateSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{Object3DStateSet as t}from\"../../webgl-engine/lib/Object3DStateSet.js\";class e{constructor(e,i){this.stateType=e,this.objectIdField=i,this.objectStateSet=new t,this.ids=new Set,this.paused=!1}hasGraphic(t){if(this.objectIdField){const e=t.graphic.attributes[this.objectIdField];return this.ids.has(e)}return this.ids.has(t.graphic.uid)}}export{e as Graphics3DObjectStateSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{makeHandle as t}from\"../../../../core/handleUtils.js\";import{Graphics3DObjectStateSet as e}from\"./Graphics3DObjectStateSet.js\";class s{constructor(t){this._graphicsCore=t,this._stateSets=new Array}destroy(){this._stateSets&&this._stateSets.forEach((t=>t.objectStateSet.removeAll())),this._stateSets=null}acquireSet(s,a){const i=new e(s,a);this._stateSets.push(i);const h=t((()=>this.releaseSet(i)));return{set:i,handle:h}}releaseSet(t){t.objectStateSet.removeAll();const e=this._stateSets?this._stateSets.indexOf(t):-1;-1!==e&&this._stateSets.splice(e,1)}_addObjectStateSet(t,e){t.addObjectStateSet(e.stateType,e.objectStateSet)}_removeObjectStateSet(t,e){t.removeObjectState(e.objectStateSet)}setUid(t,e){t.ids.add(e);const s=this._graphicsCore.graphics3DGraphics.get(e);s&&this._addObjectStateSet(s,t)}setUids(t,e){e.forEach((e=>this.setUid(t,e)))}setObjectIds(t,e){e.forEach((e=>t.ids.add(e))),this.initializeSet(t)}addGraphic(t){this._stateSets.forEach((e=>{!e.paused&&e.hasGraphic(t)&&this._addObjectStateSet(t,e)}))}removeGraphic(t){this._stateSets.forEach((e=>{e.hasGraphic(t)&&this._removeObjectStateSet(t,e)}))}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach((t=>t.objectStateSet.removeAll()))}initializeSet(t){const e=this._graphicsCore.graphics3DGraphics;t.objectIdField?e.forEach((e=>{e&&t.hasGraphic(e)&&this._addObjectStateSet(e,t)})):t.ids.forEach((s=>{const a=e.get(s);a&&this._addObjectStateSet(a,t)}))}get test(){return{states:this._stateSets}}}export{s as Graphics3DObjectStates};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport t from\"../../../../core/PooledArray.js\";import{create as e,copy as r,area as s,expand as n,contains as o,containsPoint as i}from\"../../../../geometry/support/aaBoundingRect.js\";import{noBudget as h}from\"../../../support/Scheduler.js\";const a=.05;class c{constructor(){this._extents=new t({allocator:t=>t||e()}),this._tmpExtent=e(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(t){this.contains(t)||(this.removeContained(t),r(this._extents.pushNew(),t),this._dirty=!0)}pop(){return this._dirty&&this.mergeTight(),this._extents.pop()}merge(t){return this.mergeTight(t),t.hasProgressed}mergeTight(t=h){const e=this._extents,o=new Set;let i=0;for(;i!==e.length;){e.sort(((t,e)=>t[0]-e[0])),i=e.length,o.clear();for(let i=0;i<e.length;++i){if(t.done)return;const h=e.getItemAt(i);for(let t=i+1;t<e.length;++t){const r=e.getItemAt(t);if(r[0]>=h[2])break;o.add(r)}o.forEach((i=>{if(h===i)return;if(i[2]<=h[0])return void o.delete(i);const c=s(h),g=s(i),m=this._tmpExtent;n(h,i,m);const d=c+g;(s(m)-d)/d<a&&(r(h,m),o.delete(i),e.remove(i),t.madeProgress())})),o.add(h)}}this._dirty=!1}contains(t){return this._extents.some((e=>o(e,t)))}removeContained(t){this._extents.filterInPlace((e=>!o(t,e)))}get test(){const t=this;return{containsPoint:e=>t._extents.some((t=>i(t,e)))}}}export{c as ExtentSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import i from\"../../../../core/Evented.js\";import s from\"../../../../core/Handles.js\";import{isSome as r}from\"../../../../core/maybe.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{ExtentSet as h}from\"./ExtentSet.js\";import{TaskPriority as o}from\"../../../support/Scheduler.js\";let p=class extends t{constructor(){super(...arguments),this.dirtyExtents=new h,this.globalDirty=!1,this.averageExtentUpdateSize=0,this.dirtyGraphicsSet=new Set,this.handles=new s,this.updateElevation=!1,this.layerView=null,this.graphicsCore=null,this.events=new i}setup(e,t,i,s){this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=i,this.elevationProvider=s;const r=this.layerView.view.resourceController.scheduler;this.handles.add([s.on(\"elevation-change\",(e=>this._elevationChanged(e))),this.layerView.watch(\"suspended\",(()=>this.suspendedChange())),r.registerTask(o.ELEVATION_ALIGNMENT,this)])}destroy(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}clear(){this.dirtyGraphicsSet.clear(),this.notifyChange(\"updating\")}suspendedChange(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange(\"updating\"))}elevationInfoChange(){this.globalDirty=!0,this.notifyChange(\"updating\")}get updating(){return this.running}get running(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}get updatingRemaining(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}runTask(e){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((()=>this.dirtyExtents.merge(e)));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange(\"updating\")}_updateDirtyGraphics(e){const t=this.layerView.view.renderCoordsHelper,i=0===this.graphicsCore.effectiveUpdatePolicy;for(const s of this.dirtyGraphicsSet.keys()){const a=this.graphicsCore.getGraphics3DGraphicById(s);if(this.dirtyGraphicsSet.delete(s),r(a)&&(a.alignWithElevation(this.elevationProvider,t,i),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this.dirtyExtents.empty&&!e.done;){const t=this.dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit(\"invalidate-elevation\",{extent:t,spatialReference:i});const s=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,i,(e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);r(t)&&t.needsElevationUpdates()&&this.dirtyGraphicsSet.add(e)})),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-s)+.9*this.averageExtentUpdateSize,e.madeProgress()}}markAllGraphicsElevationDirty(){this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach(((e,t)=>this.dirtyGraphicsSet.add(t)))}_elevationChanged(e){if(\"scene\"===e.context&&(!this.graphicsCore.layer.elevationInfo||\"relative-to-scene\"!==this.graphicsCore.layer.elevationInfo.mode))return;const{extent:t,spatialReference:i}=e;if(this.layerView.suspended){if(!this.updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this.updateElevation=!0)}this.events.emit(\"invalidate-elevation\",{extent:t,spatialReference:i})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange(\"updating\")}};e([a({readOnly:!0})],p.prototype,\"updating\",null),e([a({readOnly:!0})],p.prototype,\"updatingRemaining\",null),p=e([n(\"esri.views.3d.layers.graphics.Graphics3DElevationAlignment\")],p);var d=p;export{d as default};\n"],"sourceRoot":""}