(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[4],{1e3:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var n=i(2),r=i(3),a=i(215),s=function(){function e(){Object(n.a)(this,e),this.items=[]}return Object(r.a)(e,[{key:"addObject",value:function(e,t){this.items.push({type:0,objectStateId:t,object:e})}},{key:"addRenderGeometry",value:function(e,t,i){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:i})}},{key:"addExternal",value:function(e,t){this.items.push({type:2,objectStateId:t,remove:e})}},{key:"remove",value:function(e){for(var t=this.items.length-1;t>=0;--t){var i=this.items[t];i.objectStateId===e&&(this._removeObjectStateItem(i),this.items.splice(t,1))}}},{key:"removeObject",value:function(e){for(var t=this.items.length-1;t>=0;--t){var i=this.items[t];0===i.type&&i.object===e&&(this._removeObjectStateItem(i),this.items.splice(t,1))}}},{key:"removeRenderGeometry",value:function(e){for(var t=this.items.length-1;t>=0;--t){var i=this.items[t];1===i.type&&i.renderGeometry===e&&(this._removeObjectStateItem(i),this.items.splice(t,1))}}},{key:"removeAll",value:function(){var e=this;this.items.forEach((function(t){e._removeObjectStateItem(t)})),this.items=[]}},{key:"_removeObjectStateItem",value:function(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}}}]),e}(),u=function(){function e(t,i){Object(n.a)(this,e),this.stateType=t,this.objectIdField=i,this.objectStateSet=new s,this.ids=new Set,this.paused=!1}return Object(r.a)(e,[{key:"hasGraphic",value:function(e){if(this.objectIdField){var t=e.graphic.attributes[this.objectIdField];return this.ids.has(t)}return this.ids.has(e.graphic.uid)}}]),e}(),c=function(){function e(t){Object(n.a)(this,e),this._graphicsCore=t,this._stateSets=new Array}return Object(r.a)(e,[{key:"destroy",value:function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()})),this._stateSets=null}},{key:"acquireSet",value:function(e,t){var i=this,n=new u(e,t);this._stateSets.push(n);var r=Object(a.b)((function(){return i.releaseSet(n)}));return{set:n,handle:r}}},{key:"releaseSet",value:function(e){e.objectStateSet.removeAll();var t=this._stateSets?this._stateSets.indexOf(e):-1;-1!==t&&this._stateSets.splice(t,1)}},{key:"_addObjectStateSet",value:function(e,t){e.addObjectStateSet(t.stateType,t.objectStateSet)}},{key:"_removeObjectStateSet",value:function(e,t){e.removeObjectState(t.objectStateSet)}},{key:"setUid",value:function(e,t){e.ids.add(t);var i=this._graphicsCore.graphics3DGraphics.get(t);i&&this._addObjectStateSet(i,e)}},{key:"setUids",value:function(e,t){var i=this;t.forEach((function(t){return i.setUid(e,t)}))}},{key:"setObjectIds",value:function(e,t){t.forEach((function(t){return e.ids.add(t)})),this.initializeSet(e)}},{key:"addGraphic",value:function(e){var t=this;this._stateSets.forEach((function(i){!i.paused&&i.hasGraphic(e)&&t._addObjectStateSet(e,i)}))}},{key:"removeGraphic",value:function(e){var t=this;this._stateSets.forEach((function(i){i.hasGraphic(e)&&t._removeObjectStateSet(e,i)}))}},{key:"allGraphicsDeleted",value:function(){this._stateSets&&this._stateSets.forEach((function(e){return e.objectStateSet.removeAll()}))}},{key:"initializeSet",value:function(e){var t=this,i=this._graphicsCore.graphics3DGraphics;e.objectIdField?i.forEach((function(i){i&&e.hasGraphic(i)&&t._addObjectStateSet(i,e)})):e.ids.forEach((function(n){var r=i.get(n);r&&t._addObjectStateSet(r,e)}))}},{key:"test",get:function(){return{states:this._stateSets}}}]),e}()},1003:function(e,t,i){"use strict";i.d(t,"a",(function(){return O}));var n=i(11),r=i(2),a=i(3),s=i(6),u=i(7),c=i(0),o=i(34),l=i(94),h=i(61),d=i(4),p=i(1),y=(i(17),i(18),i(16),i(12)),f=i(73),b=i(43),v=i(103),g=function(){function e(){Object(r.a)(this,e),this._extents=new f.a({allocator:function(e){return e||Object(b.l)()}}),this._tmpExtent=Object(b.l)(),this._dirty=!1}return Object(a.a)(e,[{key:"empty",get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"clear",value:function(){this._extents.clear()}},{key:"add",value:function(e){this.contains(e)||(this.removeContained(e),Object(b.k)(this._extents.pushNew(),e),this._dirty=!0)}},{key:"pop",value:function(){return this._dirty&&this.mergeTight(),this._extents.pop()}},{key:"merge",value:function(e){return this.mergeTight(e),e.hasProgressed}},{key:"mergeTight",value:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v.d,i=this._extents,n=new Set,r=0;r!==i.length;){i.sort((function(e,t){return e[0]-t[0]})),r=i.length,n.clear();for(var a=function(r){if(t.done)return{v:void 0};for(var a=i.getItemAt(r),s=r+1;s<i.length;++s){var u=i.getItemAt(s);if(u[0]>=a[2])break;n.add(u)}n.forEach((function(r){if(a!==r)if(r[2]<=a[0])n.delete(r);else{var s=Object(b.d)(a),u=Object(b.d)(r),c=e._tmpExtent;Object(b.p)(a,r,c);var o=s+u;(Object(b.d)(c)-o)/o<.05&&(Object(b.k)(a,c),n.delete(r),i.remove(r),t.madeProgress())}})),n.add(a)},s=0;s<i.length;++s){var u=a(s);if("object"===typeof u)return u.v}}this._dirty=!1}},{key:"contains",value:function(e){return this._extents.some((function(t){return Object(b.g)(t,e)}))}},{key:"removeContained",value:function(e){this._extents.filterInPlace((function(t){return!Object(b.g)(e,t)}))}},{key:"test",get:function(){var e=this;return{containsPoint:function(t){return e._extents.some((function(e){return Object(b.h)(e,t)}))}}}}]),e}(),j=function(e){Object(s.a)(i,e);var t=Object(u.a)(i);function i(){var e;return Object(r.a)(this,i),(e=t.apply(this,arguments)).dirtyExtents=new g,e.globalDirty=!1,e.averageExtentUpdateSize=0,e.dirtyGraphicsSet=new Set,e.handles=new h.a,e.updateElevation=!1,e.layerView=null,e.graphicsCore=null,e.events=new l.a,e}return Object(a.a)(i,[{key:"setup",value:function(e,t,i,n){var r=this;this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=i,this.elevationProvider=n;var a=this.layerView.view.resourceController.scheduler;this.handles.add([n.on("elevation-change",(function(e){return r._elevationChanged(e)})),this.layerView.watch("suspended",(function(){return r.suspendedChange()})),a.registerTask(v.b.ELEVATION_ALIGNMENT,this)])}},{key:"destroy",value:function(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}},{key:"clear",value:function(){this.dirtyGraphicsSet.clear(),this.notifyChange("updating")}},{key:"suspendedChange",value:function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))}},{key:"elevationInfoChange",value:function(){this.globalDirty=!0,this.notifyChange("updating")}},{key:"updating",get:function(){return this.running}},{key:"running",get:function(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}},{key:"updatingRemaining",get:function(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}},{key:"runTask",value:function(e){var t=this;for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((function(){return t.dirtyExtents.merge(e)}));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange("updating")}},{key:"_updateDirtyGraphics",value:function(e){var t,i=this.layerView.view.renderCoordsHelper,r=0===this.graphicsCore.effectiveUpdatePolicy,a=Object(n.a)(this.dirtyGraphicsSet.keys());try{for(a.s();!(t=a.n()).done;){var s=t.value,u=this.graphicsCore.getGraphics3DGraphicById(s);if(this.dirtyGraphicsSet.delete(s),Object(d.k)(u)&&(u.alignWithElevation(this.elevationProvider,i,r),e.madeProgress()),e.done)return}}catch(c){a.e(c)}finally{a.f()}}},{key:"_updateDirtyExtents",value:function(e){for(var t=this;!this.dirtyExtents.empty&&!e.done;){var i=this.dirtyExtents.pop(),n=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:i,spatialReference:n});var r=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(i,n,(function(e){var i=t.graphicsCore.getGraphics3DGraphicById(e);Object(d.k)(i)&&i.needsElevationUpdates()&&t.dirtyGraphicsSet.add(e)})),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-r)+.9*this.averageExtentUpdateSize,e.madeProgress()}}},{key:"markAllGraphicsElevationDirty",value:function(){var e=this;this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach((function(t,i){return e.dirtyGraphicsSet.add(i)}))}},{key:"_elevationChanged",value:function(e){if("scene"!==e.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var t=e.extent,i=e.spatialReference;if(this.layerView.suspended){if(!this.updateElevation){var n=this.graphicsCore.computedExtent;n&&t[2]>n.xmin&&t[0]<n.xmax&&t[3]>n.ymin&&t[1]<n.ymax&&(this.updateElevation=!0)}this.events.emit("invalidate-elevation",{extent:t,spatialReference:i})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange("updating")}}}]),i}(o.a);Object(c.a)([Object(p.b)({readOnly:!0})],j.prototype,"updating",null),Object(c.a)([Object(p.b)({readOnly:!0})],j.prototype,"updatingRemaining",null);var O=j=Object(c.a)([Object(y.a)("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],j)},808:function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));var n,r=i(14),a=i(2),s=i(3),u=i(6),c=i(7),o=i(0),l=i(140),h=i(193),d=i(60),p=i(30),y=i(27),f=i(1),b=(i(18),i(17),i(16),i(12)),v=i(45),g=i(108),j=i(171),O=new d.a({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),m=new d.a({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),w=n=function(e){Object(u.a)(i,e);var t=Object(c.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).where=null,n.geometry=null,n.spatialRelationship="intersects",n.hiddenIds=new Set,n.distance=void 0,n.objectIds=null,n.units=null,n.timeExtent=null,n.enabled=!1,n}return Object(s.a)(i,[{key:"writeWhere",value:function(e,t){t.where=e||"1=1"}},{key:"enable",value:function(){this._set("enabled",!0)}},{key:"createQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.where,i=this.geometry,n=this.spatialRelationship,a=this.timeExtent,s=this.objectIds,u=this.units,c=this.distance;return new j.a(Object(r.a)({geometry:Object(y.a)(i),objectIds:Object(y.a)(s),spatialRelationship:n,timeExtent:Object(y.a)(a),where:t,units:u,distance:c},e))}},{key:"clone",value:function(){var e=this.where,t=this.geometry,i=this.spatialRelationship,r=this.hiddenIds,a=this.timeExtent,s=this.objectIds,u=this.units,c=this.distance,o=new Set;return r.forEach((function(e){return o.add(e)})),new n({geometry:Object(y.a)(t),hiddenIds:o,objectIds:Object(y.a)(s),spatialRelationship:i,timeExtent:Object(y.a)(a),where:e,units:u,distance:c})}}]),i}(p.a);Object(o.a)([Object(f.b)({type:String})],w.prototype,"where",void 0),Object(o.a)([Object(v.a)("where")],w.prototype,"writeWhere",null),Object(o.a)([Object(f.b)({types:l.a,json:{read:g.a,write:!0}})],w.prototype,"geometry",void 0),Object(o.a)([Object(f.b)({type:String,json:{read:{source:"spatialRel",reader:O.read},write:{target:"spatialRel",writer:O.write}}})],w.prototype,"spatialRelationship",void 0),Object(o.a)([Object(f.b)({json:{write:function(e,t,i){return t[i]=Array.from(e)},read:function(e){return new Set(e)}}})],w.prototype,"hiddenIds",void 0),Object(o.a)([Object(f.b)({type:Number,json:{write:{overridePolicy:function(e){return{enabled:e>0}}}}})],w.prototype,"distance",void 0),Object(o.a)([Object(f.b)({type:[Number],json:{write:!0}})],w.prototype,"objectIds",void 0),Object(o.a)([Object(f.b)({type:String,json:{read:m.read,write:{writer:m.write,overridePolicy:function(e){return{enabled:e&&this.distance>0}}}}})],w.prototype,"units",void 0),Object(o.a)([Object(f.b)({type:h.a,json:{write:!0}})],w.prototype,"timeExtent",void 0),Object(o.a)([Object(f.b)({readOnly:!0})],w.prototype,"enabled",void 0);var S=w=n=Object(o.a)([Object(b.a)("esri.views.layers.support.FeatureFilter")],w)},809:function(e,t,i){"use strict";function n(e){var t,i=e.layer;return"floorInfo"in i&&null!=(t=i.floorInfo)&&t.floorField&&"floors"in e.view?s(e.view.floors,i.floorInfo.floorField):null}function r(e,t){var i;return"floorInfo"in t&&null!=(i=t.floorInfo)&&i.floorField?s(e,t.floorInfo.floorField):null}function a(e,t){var i=t.definitionExpression;return e?i?"(".concat(i,") AND (").concat(e,")"):e:i}function s(e,t){if(null==e||!e.length)return null;var i=e.filter((function(e){return""!==e})).map((function(e){return"'".concat(e,"'")}));return i.push("''"),"".concat(t," IN (").concat(i.join(","),") OR ").concat(t," IS NULL")}i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return r}))},842:function(e,t,i){"use strict";function n(e,t,i){if(!i||null==t)return null;if(!e)return function(e,t){var i=t.toLowerCase();for(var n in e)if(n.toLowerCase()===i)return e[n];return null}(t,i);var n=e.get(i);return n?t[n.name]:null}i.d(t,"a",(function(){return n}))},851:function(e,t,i){"use strict";i.d(t,"a",(function(){return w}));var n=i(8),r=i.n(n),a=i(15),s=i(2),u=i(3),c=i(6),o=i(7),l=i(0),h=(i(140),i(34)),d=i(4),p=i(1),y=(i(17),i(18),i(16),i(12)),f=i(72),b=i(846),v=i(243),g=i(171),j=i(271),O=b.a,m=function(e){Object(c.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(s.a)(this,i),(n=t.call(this,e))._dataQueryEngineInstance=null,n}return Object(u.a)(i,[{key:"queryGeometryType",get:function(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon";default:return}}},{key:"defaultQueryJSON",get:function(){return new g.a({outSpatialReference:this.spatialReference}).toJSON()}},{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}},{key:"destroy",value:function(){this.clear()}},{key:"clear",value:function(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}},{key:"executeQueryForIdSet",value:function(){var e=Object(a.a)(r.a.mark((function e(t,i){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(t),i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQueryForCount",value:function(){var e=Object(a.a)(r.a.mark((function e(t,i){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(t),i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQueryForExtent",value:function(){var e=Object(a.a)(r.a.mark((function e(t,i){var n,a,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(t),i);case 2:return n=e.sent,a=n.count,s=n.extent,e.abrupt("return",{count:a,extent:f.a.fromJSON(s)});case 6:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQueryForIds",value:function(){var e=Object(a.a)(r.a.mark((function e(t,i){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(t),i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQueryForLatestObservations",value:function(){var e=Object(a.a)(r.a.mark((function e(t,i){var n,a,s=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(t),i);case 2:return n=e.sent,a=v.default.fromJSON(n),e.abrupt("return",(a.features.forEach((function(e){e.layer=s.layer,e.sourceLayer=s.layer})),a));case 5:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"executeQuery",value:function(){var e=Object(a.a)(r.a.mark((function e(t,i){var n,a,s=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(t),i);case 2:return n=e.sent,a=v.default.fromJSON(n),e.abrupt("return",(a.features.forEach((function(e){e.layer=s.layer,e.sourceLayer=s.layer})),a));case 5:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_ensureQueryJSON",value:function(e){return Object(d.j)(e)?this.defaultQueryJSON:("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())}},{key:"ensureDataQueryEngine",value:function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var e="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,t=this.layer.objectIdField,i=j.a.toJSON(this.queryGeometryType),n=this.layer.fields.map((function(e){return e.toJSON()})),r=this.layerView.view.resourceController.scheduler,a=this.priority,s=this.spatialReference.toJSON(),u=this.layerView.graphics3d.graphicsCore.featureStore,c=this.layerView,o=c.hasZ,l=c.hasM;return this._dataQueryEngineInstance=new O({hasZ:o,hasM:l,geometryType:i,fields:n,timeInfo:e,spatialReference:s,objectIdField:t,featureStore:u,scheduler:r,priority:a}),this._dataQueryEngineInstance}}]),i}(h.a);Object(l.a)([Object(p.b)({constructOnly:!0})],m.prototype,"layerView",void 0),Object(l.a)([Object(p.b)({constructOnly:!0})],m.prototype,"priority",void 0),Object(l.a)([Object(p.b)({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],m.prototype,"spatialReference",void 0),Object(l.a)([Object(p.b)({readOnly:!0,aliasOf:"layerView.layer"})],m.prototype,"layer",void 0),Object(l.a)([Object(p.b)({readOnly:!0})],m.prototype,"queryGeometryType",null),Object(l.a)([Object(p.b)({readOnly:!0})],m.prototype,"defaultQueryJSON",null);var w=m=Object(l.a)([Object(y.a)("esri.views.3d.layers.graphics.QueryEngine")],m)},861:function(e,t,i){"use strict";i.d(t,"a",(function(){return N}));var n=i(8),r=i.n(n),a=i(15),s=i(2),u=i(3),c=i(6),o=i(7),l=i(0),h=i(146),d=i(34),p=i(156),y=i(61),f=i(25),b=i(36),v=i(1),g=(i(17),i(18),i(16)),j=i(12),O=i(636),m=i(77),w=i(171),S=i(521),x=i(904),_=i(1003),k=i(4),E=i(851),I=i(808),C=i(809),V=i(103),R=g.a.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility"),G=function(e){Object(c.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(s.a)(this,i);for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).filter=null,e._dirty=!1,e._querying=!1,e._handles=new y.a,e}return Object(u.a)(i,[{key:"updating",get:function(){return this._dirty||this._querying||null!=this._queryResult}},{key:"setup",value:function(e,t){var i=this;this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,this._queryEngine=new E.a({layerView:this._layerView,priority:V.b.FILTER_VISIBILITY});var n=this._layerView.view.resourceController.scheduler;this._handles.add(n.registerTask(V.b.FILTER_VISIBILITY,this)),this._handles.add(Object(b.b)(t.owner,"loadedGraphics","after-changes",(function(e){return i._graphicsChanged(e)}),(function(){return i.dirty=!0}))),this.filterChanged()}},{key:"destroy",value:function(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null}},{key:"clear",value:function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((function(e){return e.clearVisibilityFlag(2)})),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange("updating")}},{key:"_graphicsChanged",value:function(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)}},{key:"updateVisibility",value:function(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)}},{key:"filterChanged",value:function(){var e=this.recomputeFilter();e!==this.filter&&(this.filter=e,this.dirty=!0)}},{key:"active",get:function(){return this.filter&&this._core.graphics3DGraphics.size>0}},{key:"recomputeFilter",value:function(){var e="filter"in this._layerView?this._layerView.filter:null,t="timeExtent"in this._layerView?this._layerView.timeExtent:null,i=Object(C.b)(this._layerView);if(Object(k.j)(t)&&Object(k.j)(i))return e;var n=Object(k.k)(e)?e.clone():new I.a;if(Object(k.k)(t)&&(n.timeExtent=Object(k.k)(n.timeExtent)?n.timeExtent.intersection(t):t),Object(k.k)(i)){var r=null==n.where||""===n.where;n.where=r?i:"(".concat(n.where,") AND (").concat(i,")")}return n}},{key:"running",get:function(){return this._dirty&&!this._querying||null!=this._queryResult}},{key:"runTask",value:function(e){var t=this;this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then((function(e){t._queryResult=e,t._querying=!1})).catch((function(e){Object(f.n)(e)||(R.warn("FeatureFilter query failed: "+e,{error:e}),t._queryResult=new Set,t._core.graphics3DGraphics.forEach((function(e){return t._queryResult.add(t._getFeatureId(e.graphic))})),t._querying=!1)})),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((function(i){if(e.done)return!1;var n=t._queryResult.has(t._getFeatureId(i.graphic));return!!i.setVisibilityFlag(2,n,0)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()}},{key:"_getFeatureId",value:function(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId}},{key:"dirty",set:function(e){this._dirty!==e&&(this._dirty=e,this.notifyChange("updating"))}}]),i}(d.a);Object(l.a)([Object(v.b)({readOnly:!0})],G.prototype,"updating",null),G=Object(l.a)([Object(j.a)("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],G);var D=i(968),T=i(1e3),F=i(881),U=i(114),Q=i(842),q=i(270),A=function(e){Object(c.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(s.a)(this,i),(n=t.call(this,e))._handles=new y.a,n.watchUpdatingTracking=new q.a,n.suspendResumeExtentMode="computed",n.dataExtent=null,n.suspendResumeExtent=null,n}return Object(u.a)(i,[{key:"suspended",get:function(){var e;return null==(e=this.scaleVisibility)?void 0:e.suspended}},{key:"suspendInfo",get:function(){var e,t,i={};return null!=(e=this.scaleVisibility)&&e.suspended&&(i.outsideScaleRange=!0),null!=(t=this.frustumVisibility)&&t.suspended&&(i.outsideOfView=!0),i}},{key:"updating",get:function(){var e,t,i;return!!(null!=(e=this.graphicsCore)&&e.updating||null!=(t=this.frustumVisibility)&&t.updating||null!=(i=this.watchUpdatingTracking)&&i.updating)}},{key:"normalizeCtorArgs",value:function(e){var t=e.frustumVisibilityEnabled?new D.a:null,i=e.scaleVisibilityEnabled?new F.a:null,n=(e.filterVisibilityEnabled||e.timeExtentVisibilityEnabled)&&"multipatch"!==e.layer.geometryType?new G:null,r=e.elevationAlignmentEnabled?new _.a:null;return{graphicsCore:new x.a({owner:e.owner,layer:e.layer,preferredUpdatePolicy:e.preferredUpdatePolicy,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:e.owner.hasZ,hasM:e.owner.hasM}),frustumVisibility:t,scaleVisibility:i,filterVisibility:n,elevationAlignment:r,updateClippingExtent:e.updateClippingExtent,suspendResumeExtentMode:e.suspendResumeExtentMode,dataExtent:e.dataExtent}}},{key:"initialize",value:function(){var e=this;this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",(function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",(function(){return e.filterVisibility.filterChanged()})),this.watchUpdatingTracking.add(this.owner,"timeExtent",(function(){return e.filterVisibility.filterChanged()}))),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",(function(t,i){Object(O.a)(t,i)&&e.watchUpdatingTracking.addPromise(e.graphicsCore.elevationInfoChange())})),this.watchUpdatingTracking.add(this.layer,"labelsVisible",(function(){return e.graphicsCore.updateVisibilityInfo()})),this.watchUpdatingTracking.add(this.layer,"labelingInfo",(function(t,i){Object(O.a)(t,i)&&e.graphicsCore.updateLabelingInfo()}))}},{key:"setup",value:function(){var e=Object(a.a)(r.a.mark((function e(){var t,i,n,a,s=this;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),t=this.owner,i=this.owner.view.basemapTerrain,n=function(e,t,i){return s.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,i)},this.scaleVisibility&&this.scaleVisibility.setup(t,this.layer,n,this.graphicsCore,i),this.filterVisibility&&("filter"in t||"timeExtent"in t)&&this.filterVisibility.setup(t,this.graphicsCore),this.elevationAlignment&&(a=t.view.elevationProvider,this.elevationAlignment.setup(t,n,this.graphicsCore,a)),this._set("objectStates",new T.a(this.graphicsCore)),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",t.view.deconflictor.addGraphicsOwner(this.graphicsCore)),e.next=8,Object(f.r)(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}));case 8:if(this.watchUpdatingTracking.add(this.layer,"renderer",(function(e){return s.watchUpdatingTracking.addPromise(s.graphicsCore.rendererChange(e))})),this.watchUpdatingTracking.add(t,"fullOpacity",(function(){return s.graphicsCore.opacityChange()})),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(t.view,"clippingArea",(function(){return s._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),e.t0=this.graphicsCore.labelsEnabled,!e.t0){e.next=17;break}return e.next=17,Object(f.r)(this.graphicsCore.updateLabelingInfo());case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var e=0,t=["watchUpdatingTracking","frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","objectStates","graphicsCore"];e<t.length;e++){var i=t[e],n=this[i];n&&(n.destroy(),this._set(i,null))}this._set("layer",null),this._set("owner",null)}},{key:"maskOccludee",value:function(e){var t=this.objectStates.acquireSet(1,null),i=t.set,n=t.handle;return this.objectStates.setUid(i,e.uid),n}},{key:"highlight",value:function(e,t){var i=this;if(e instanceof w.a){var n=this.objectStates.acquireSet(0,t),r=n.set,a=n.handle;return this.owner.queryObjectIds(e).then((function(e){return i.objectStates.setObjectIds(r,e)})),a}if("number"==typeof e||"string"==typeof e)return this.highlight([e],t);if(e instanceof h.a)return this.highlight([e],t);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof h.a){var s=e;if(null==Object(Q.a)(this.layer.fieldsIndex,s[0].attributes,t)){var u=s.map((function(e){return e.uid})),c=this.objectStates.acquireSet(0,null),o=c.set,l=c.handle;return this.objectStates.setUids(o,u),l}e=s.map((function(e){return Object(Q.a)(i.layer.fieldsIndex,e.attributes,t)}))}if("number"==typeof e[0]||"string"==typeof e[0]){var d=e,p=this.objectStates.acquireSet(0,t),y=p.set,f=p.handle;return this.objectStates.setObjectIds(y,d),f}}return P}},{key:"_updateClippingExtent",value:function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())}},{key:"setupSuspendResumeExtent",value:function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(Object(b.a)(this,"suspendResumeExtentMode",(function(){switch(e._handles.remove(M),e.suspendResumeExtentMode){case"computed":e._handles.add([Object(b.a)(e.graphicsCore,"computedExtent",(function(t){return e.updateSuspendResumeExtent(t)})),e.graphicsCore.watch("extentPadding",(function(){return e.updateSuspendResumeExtent(e.graphicsCore.computedExtent)}))],M);break;case"data":e._handles.add([Object(b.a)(e,"dataExtent",(function(t){return e.updateSuspendResumeExtent(t)})),e.graphicsCore.watch("extentPadding",(function(){return e.updateSuspendResumeExtent(e.dataExtent)}))],M);break;default:Object(p.a)(e.suspendResumeExtentMode)}})))}},{key:"updateSuspendResumeExtent",value:function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)}},{key:"extentToSuspendResumeRect",value:function(e,t){var i=this.owner.view.spatialReference;if(!e.spatialReference.equals(i)){if(!Object(m.a)(e,i))return;e=Object(m.d)(e,i)}return Object(U.e)(e,t,S.a,this.graphicsCore.extentPadding)}},{key:"suspendResumeExtentChanged",value:function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)}}]),i}(d.a);Object(l.a)([Object(v.b)({aliasOf:"graphicsCore.layer"})],A.prototype,"layer",void 0),Object(l.a)([Object(v.b)({aliasOf:"graphicsCore.owner"})],A.prototype,"owner",void 0),Object(l.a)([Object(v.b)({constructOnly:!0})],A.prototype,"updateClippingExtent",void 0),Object(l.a)([Object(v.b)({constructOnly:!0})],A.prototype,"graphicsCore",void 0),Object(l.a)([Object(v.b)({constructOnly:!0})],A.prototype,"scaleVisibility",void 0),Object(l.a)([Object(v.b)({constructOnly:!0})],A.prototype,"filterVisibility",void 0),Object(l.a)([Object(v.b)({constructOnly:!0})],A.prototype,"elevationAlignment",void 0),Object(l.a)([Object(v.b)({constructOnly:!0})],A.prototype,"frustumVisibility",void 0),Object(l.a)([Object(v.b)({readOnly:!0})],A.prototype,"deconfliction",void 0),Object(l.a)([Object(v.b)({readOnly:!0})],A.prototype,"labeling",void 0),Object(l.a)([Object(v.b)({readOnly:!0})],A.prototype,"objectStates",void 0),Object(l.a)([Object(v.b)({readOnly:!0})],A.prototype,"watchUpdatingTracking",void 0),Object(l.a)([Object(v.b)()],A.prototype,"suspendResumeExtentMode",void 0),Object(l.a)([Object(v.b)()],A.prototype,"dataExtent",void 0),Object(l.a)([Object(v.b)({readOnly:!0})],A.prototype,"suspended",null),Object(l.a)([Object(v.b)({readOnly:!0})],A.prototype,"suspendInfo",null),Object(l.a)([Object(v.b)({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"]})],A.prototype,"updating",null);var N=A=Object(l.a)([Object(j.a)("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],A),M="suspendResumeExtentMode",P={remove:function(){},pause:function(){},resume:function(){}}},968:function(e,t,i){"use strict";i.d(t,"a",(function(){return v}));var n=i(2),r=i(3),a=i(6),s=i(7),u=i(0),c=i(34),o=i(61),l=i(36),h=i(1),d=(i(17),i(18),i(16),i(12)),p=i(70),y=i(687),f=i(103),b=function(e){Object(a.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(n.a)(this,i),(e=t.apply(this,arguments)).suspended=!1,e.extent=null,e.extentIntersectionDirty=!0,e._isVisibleBelowSurface=!1,e.handles=new o.a,e.layerView=null,e.updating=!0,e}return Object(r.a)(i,[{key:"setup",value:function(e){var t=this;this.layerView=e,this.extentIntersection=new y.a({renderCoordsHelper:e.view.renderCoordsHelper});var i=e.view,n=i.basemapTerrain,r=i.resourceController.scheduler;this.handles.add([i.on("resize",(function(){return t.viewChange()})),i.state.watch("camera",(function(){return t.viewChange()}),!0),r.registerTask(f.b.FRUSTUM_VISIBILITY,this),n.on("elevation-bounds-change",(function(){return t.elevationBoundsChange()}))]),"local"===i.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([Object(l.a)(n,["opacity","wireframe"],(function(){return t.updateIsVisibleBelowSurface()})),Object(l.a)(i,"map.ground.navigationConstraint.type",(function(){return t.updateIsVisibleBelowSurface()}))])}},{key:"destroy",value:function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}},{key:"_setDirty",value:function(){this.updating||this._set("updating",!0)}},{key:"setExtent",value:function(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}},{key:"viewChange",value:function(){this._setDirty()}},{key:"elevationBoundsChange",value:function(){this._setDirty(),this.extentIntersectionDirty=!0}},{key:"isVisibleBelowSurface",set:function(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}},{key:"updateIsVisibleBelowSurface",value:function(){var e=this.layerView.view,t=e.basemapTerrain,i="local"===e.viewingMode,n=e.map.ground&&e.map.ground.navigationConstraint&&"none"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=i||!t.opaque||n}},{key:"updateExtentIntersection",value:function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=-.3*Object(p.e)(t.spatialReference).radius;else{var i=t.basemapTerrain.elevationBounds,n=i.min,r=i.max;e=n-Math.max(1,(r-n)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}}},{key:"running",get:function(){return this.updating}},{key:"runTask",value:function(){if(this._set("updating",!1),this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum,t=Object(p.e)(this.layerView.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e,t))}else this._set("suspended",!1)}}]),i}(c.a);Object(u.a)([Object(h.b)({readOnly:!0})],b.prototype,"suspended",void 0),Object(u.a)([Object(h.b)({readOnly:!0})],b.prototype,"updating",void 0);var v=b=Object(u.a)([Object(d.a)("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],b)}}]);
//# sourceMappingURL=4.bde2b13b.chunk.js.map