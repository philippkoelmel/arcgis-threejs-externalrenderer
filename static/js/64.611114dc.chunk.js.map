{"version":3,"sources":["../node_modules/@arcgis/core/views/3d/layers/MapImageLayerView3D.js","../node_modules/@arcgis/core/views/layers/MapImageLayerView.js","../node_modules/@arcgis/core/views/layers/support/popupUtils.js","../node_modules/@arcgis/core/views/support/floorFilterUtils.js","../node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","../node_modules/@arcgis/core/layers/support/sublayerUtils.js","../node_modules/@arcgis/core/views/support/drapedUtils.js","../node_modules/@arcgis/core/layers/support/ExportImageParameters.js"],"names":["i","arguments","type","this","updatingHandles","add","addPromise","refreshDebounced","e","r","o","view","timeExtent","c","y","exportImageParameters","layer","destroy","commitProperty","_get","s","a","Promise","reject","p","get","l","minScale","maxScale","visible","sublayers","forEach","popupEnabled","u","defaultPopupTemplateEnabled","t","unshift","sublayer","popupTemplate","toArray","reverse","map","all","load","catch","createQuery","event","m","renderer","createFetchPopupFeaturesQueryGeometry","geometry","n","outFields","_loadArcadeModules","arcadeUtils","hasGeometryOperations","maxAllowableOffset","width","queryFeatures","features","reduce","value","filter","isEmpty","prototype","readOnly","d","getRequiredFields","fieldsIndex","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","f","push","has","indexOf","keyField","defaultPopupTemplate","floorInfo","floorField","floors","definitionExpression","length","join","xoffset","Math","max","abs","yoffset","stops","size","maxSize","minSize","floor","pointerType","visualVariables","symbol","uniqueValueInfos","classBreakInfos","flatten","some","originIdOf","source","mapLayerId","id","gdbVersion","slice","layerDefinition","resolution","overlayPixelSizeInMapUnits","basemapSpatialReference","equals","spatialReference","x","xmin","min","ymin","xmax","ymax","labelingInfo","labelsVisible","opacity","scale","hasDynamicLayers","visibleSublayers","toExportImageJSON","JSON","stringify","serviceSublayers","_set","handles","remove","allSublayers","on","notifyChange","propertyName","dpi","format","imageFormat","transparent","imageTransparency","dynamicLayers","layers","layerDefs","Number"],"mappings":"6WAImeA,EAAC,kDAAqB,aAAa,kCAAC,eAASC,YAAgBC,KAAK,eAA/B,EAAlC,8CAAgF,WAAY,WAACC,KAAKC,gBAAgBC,IAAIF,KAAK,sBAAsB,kBAAI,EAAKC,gBAAgBE,WAAW,EAAKC,yBAA1L,mDAAgN,SAAsCC,EAAEC,GAAG,OAAOC,YAAEF,EAAEC,EAAEN,KAAKQ,QAA7Q,6BAAmR,WAAkB,MAAM,CAACC,WAAWT,KAAKS,gBAA5T,GCAyX,SAAAC,GAAI,IAAIC,EAAC,gKAAiB,WAAaX,KAAKY,sBAAsB,IAAIf,IAAE,CAACgB,MAAMb,KAAKa,UAA3E,qBAAmF,WAAUb,KAAKY,sBAAsBE,UAAUd,KAAKY,sBAAsB,OAA7J,8BAAkK,WAAyB,IAAIP,EAAE,OAAO,OAAOA,EAAEL,KAAKY,wBAAwBP,EAAEU,eAAe,WAAWf,KAAKe,eAAe,eAAef,KAAKgB,KAAK,uBAAuB,GAAG,IAAjV,uEAAmV,WAAyBX,EAAEY,GAA3B,IAAAC,EAAA,0BAAAA,EAAA,yDAA0CA,EAAGlB,KAATa,MAAkBR,EAAtD,yCAA+Dc,QAAQC,OAAO,IAAId,IAAE,uCAAuC,gCAAgC,CAACO,MAAMK,MAAlK,cAA6KG,EAAErB,KAAKsB,IAAI,cAAczB,EAAE,GAAG0B,EAA3M,+BAAAL,EAAA,MAA6M,WAAMb,GAAN,mBAAAa,EAAA,sDAAgBZ,EAAE,IAAID,EAAEmB,UAAUH,GAAGhB,EAAEmB,SAASjB,EAAE,IAAIF,EAAEoB,UAAUJ,GAAGhB,EAAEoB,SAAYpB,EAAEqB,SAASpB,GAAGC,IAAKF,EAAEsB,UAAUtB,EAAEsB,UAAUC,QAAQL,GAAWlB,EAAEwB,eAAoBvB,EAAEwB,YAAEzB,EAAD,YAAC,eAAMY,GAAP,IAASc,6BAA4B,KAAKC,YAAE1B,IAAIT,EAAEoC,QAAQ,CAACC,SAAS7B,EAAE8B,cAAc7B,MAA9P,2CAA7M,sDAAidI,EAAEQ,EAAES,UAAUS,UAAUC,UAAUC,IAAIf,GAAvf,SAAggBJ,QAAQoB,IAAI7B,GAA5gB,cAAqhBC,EAAEd,EAAEyC,IAAF,uCAAO,sBAAApB,EAAA,iBAAAA,EAAA,6DAAgBZ,EAAhB,EAAO4B,SAAyB3B,EAAhC,EAAkB4B,cAAlB,SAA4C7B,EAAEkC,OAAOC,OAAO,eAA5D,cAA2EvB,EAAEZ,EAAEoC,cAAcrB,EAAEW,YAAEf,GAAGA,EAAE0B,MAAM,KAAK9C,EAAE+C,YAAE,CAACC,SAASvC,EAAEuC,SAASF,MAAMtB,IAAIE,EAAE,EAAKuB,sCAAsCzC,EAAER,GAAGqB,EAAE6B,SAASxB,EAAjN,SAAqOyB,YAAE1C,EAAEC,GAAzO,cAAmNW,EAAE+B,UAArN,iBAA0P,EAAKC,mBAAmB3C,GAAlR,eAAkPuB,EAAlP,SAAwRA,EAAEqB,YAAYC,sBAAsB7C,KAAKW,EAAEmC,mBAAmB9B,EAAE+B,MAAMzD,GAA9V,UAA8WS,EAAEiD,cAAcrC,GAA9X,wCAAkYsC,UAAlY,4CAAP,uDAAvhB,SAAy7BjD,YAAEI,GAA37B,uCAA+7B8C,QAAQ,SAACpD,EAAEC,GAAH,OAAOA,EAAEoD,MAAF,sBAAYrD,GAAZ,YAAiBC,EAAEoD,QAAOrD,IAAG,IAAIsD,QAAQ,SAAAtD,GAAC,OAAE,MAAMA,MAAhgC,iDAAnV,gFAAu1C,WAAY,IAAIA,EAAE,QAAQ,oEAAoB,OAAOA,EAAEL,KAAKS,cAAcJ,EAAEuD,WAAn6C,gCAA46C,SAAmBvD,GAAG,GAAGA,EAAEiB,IAAI,0BAA0B,OAAOC,kBAA5+C,GAAeb,GAAm+C,OAAOL,YAAE,CAACY,eAAKN,EAAEkD,UAAU,6BAAwB,GAAQxD,YAAE,CAACY,YAAE,CAAC6C,UAAS,KAAMnD,EAAEkD,UAAU,qBAAqB,MAAMxD,YAAE,CAACY,eAAKN,EAAEkD,UAAU,aAAQ,GAAQxD,YAAE,CAACY,eAAKN,EAAEkD,UAAU,iBAAY,GAAQxD,YAAE,CAACY,YAAEI,MAAIV,EAAEkD,UAAU,kBAAa,GAAQlD,EAAEN,YAAE,CAACa,YAAE,wCAAwCP,GDAjoEqB,CAAEf,MAAoXC,EAA3DrB,EAAEQ,YAAE,CAACC,YAAE,6CAA6CT,I,kKEAvsBmC,E,8EAAf,WAAiBA,GAAjB,YAAAd,EAAA,6BAAAA,EAAA,yDAAmB6C,EAAnB,+BAAqB/B,EAAEG,cAAmB9B,YAAE0D,GAA5C,yCAAqD,IAArD,uBAAsEA,EAAEC,kBAAkBhC,EAAEiC,aAA5F,UAA8DpE,EAA9D,OAA8HmD,EAAGe,EAAvBG,oBAAwCjD,EAAiDe,EAA/DmC,cAA4BjD,EAAmCc,EAA/CoC,YAA4B7D,EAAmByB,EAAjCqC,cAA8BvC,EAAGE,EAAjBsC,eAAsBzE,EAAE0E,SAAS,KAAnN,0CAA8N,CAAC,MAA/N,YAA4OvB,EAA5O,kCAAoP3B,YAAEW,GAAtP,iDAAyP,GAAzP,eAA0OwC,EAA1O,KAA4PlE,EAAEiB,YAAES,EAAEiC,YAAH,sBAAmBpE,GAAnB,YAAwB2E,KAAvR,mBAAkStD,GAAGZ,EAAEmE,KAAKvD,GAAGZ,GAAGW,GAAGe,EAAEiC,YAAYS,IAAIzD,KAAK,IAAIX,EAAEqE,QAAQ1D,IAAIX,EAAEmE,KAAKxD,GAAGX,GAAGC,GAAGyB,EAAEiC,YAAYS,IAAInE,KAAK,IAAID,EAAEqE,QAAQpE,IAAID,EAAEmE,KAAKlE,GAAGuB,GAAGA,EAAEF,SAAS,SAAAvB,GAAI,IAAegB,EAAGhB,EAAZuE,SAActE,GAAGe,GAAGW,EAAEiC,YAAYS,IAAIrD,KAAK,IAAIf,EAAEqE,QAAQtD,IAAIf,EAAEmE,KAAKpD,MAAMf,IAAngB,4C,wBAAqgB,SAASyD,EAAE1C,EAAEE,GAAG,OAAOF,EAAEc,cAAcd,EAAEc,cAAc9B,YAAEkB,IAAIA,EAAEQ,6BAA6B1B,YAAEgB,EAAEwD,sBAAsBxD,EAAEwD,qBAAqB,O,iCCA9xB,SAAStE,EAAEA,GAAG,IAAIyC,EAAQzB,EAAEhB,EAAEM,MAAM,MAAG,cAAcU,GAAG,OAAOyB,EAAEzB,EAAEuD,YAAY9B,EAAE+B,YAAY,WAAWxE,EAAEC,KAAaF,EAAEC,EAAEC,KAAKwE,OAAOzD,EAAEuD,UAAUC,YAAmB,KAAK,SAAS/B,EAAEzC,EAAEyC,GAAG,IAAIzB,EAAE,MAAM,cAAcyB,GAAG,OAAOzB,EAAEyB,EAAE8B,YAAYvD,EAAEwD,WAAWzE,EAAEC,EAAEyC,EAAE8B,UAAUC,YAAY,KAAK,SAASxD,EAAEhB,EAAEyC,GAAG,IAA2BzB,EAAGyB,EAAxBiC,qBAA0B,OAAO1E,EAAEgB,EAAC,WAAKA,EAAL,kBAAgBhB,EAAhB,KAAqBA,EAAEgB,EAAE,SAASjB,EAAEC,EAAEyC,GAAG,GAAG,MAAMzC,IAAIA,EAAE2E,OAAO,OAAO,KAAK,IAAM3D,EAAEhB,EAAEoD,QAAQ,SAAApD,GAAC,MAAE,KAAKA,KAAI+B,KAAK,SAAA/B,GAAC,iBAAMA,EAAN,QAAa,OAAOgB,EAAEkD,KAAK,MAAP,UAAgBzB,EAAhB,gBAAyBzB,EAAE4D,KAAK,KAAhC,gBAA4CnC,EAA5C,YAJ1d,uG,iCCIA,SAAShB,EAAEA,EAAE3B,GAAG,OAAOA,EAAE,YAAYA,GAAGA,EAAE+E,QAAQC,KAAKC,IAAItD,EAAEqD,KAAKE,IAAIlF,EAAE+E,UAAU,YAAY/E,GAAGA,EAAEmF,QAAQH,KAAKC,IAAItD,EAAEqD,KAAKE,IAAIlF,EAAEmF,SAAS,IAAIxD,EAAEA,EAAoH,SAASgB,EAAEhB,EAAEgB,GAAG,MAAM,iBAAiBhB,EAAEA,EAAEA,GAAGA,EAAEyD,OAAOzD,EAAEyD,MAAMP,OAAjL,SAAWlD,GAAe,IAAZ,IAAI3B,EAAE,EAAE2C,EAAE,EAAU1C,EAAE,EAAEA,EAAE0B,EAAEkD,OAAO5E,IAAI,CAAC,IAAMW,EAAEe,EAAE1B,GAAGoF,KAAK,iBAAiBzE,IAAIZ,GAAGY,EAAE+B,KAAK,OAAO3C,EAAE2C,EAAwE3C,CAAE2B,EAAEyD,OAAOzC,EAAE,SAAS1C,EAAE0B,EAAE3B,GAAG,IAAIA,EAAE,OAAO2B,EAAE,IAAM1B,EAAED,EAAEsD,QAAQ,SAAA3B,GAAC,MAAE,SAASA,EAAEjC,QAAOuC,KAAK,SAAAjC,GAAI,IAAcC,EAAaD,EAArBsF,QAAkB1E,EAAGZ,EAAXuF,QAAa,OAAO5C,EAAE1C,EAAE0B,GAAGgB,EAAE/B,EAAEe,IAAI,KAASf,EAAE,EAAQV,EAAED,EAAE4E,OAAO,GAAG,IAAI3E,EAAE,OAAOyB,EAAE,IAAI,IAAIgB,EAAE,EAAEA,EAAEzC,EAAEyC,IAAI/B,GAAGX,EAAE0C,GAAG,IAAMwB,EAAEa,KAAKQ,MAAM5E,EAAEV,GAAG,OAAO8E,KAAKC,IAAId,EAAExC,GAAG,SAASf,EAAEZ,GAAG,IAAM2C,EAAE3C,GAAGA,EAAEwC,SAAS5B,EAAE,WAAWZ,GAAGA,EAAEsC,OAAOtC,EAAEsC,MAAMmD,aAAa,EAAE,EAAE,IAAI9C,EAAE,OAAO/B,EAAE,IAAMV,EAAE,oBAAoByC,EAAE1C,EAAEW,EAAE+B,EAAE+C,iBAAiB9E,EAAE,GAAG,WAAW+B,EAAEjD,KAAK,OAAOiC,EAAEzB,EAAEyC,EAAEgD,QAAQ,GAAG,iBAAiBhD,EAAEjD,KAAK,CAAC,IAAIM,EAAEE,EAAE,OAAOyC,EAAEiD,iBAAiBrE,SAAS,SAAAoB,GAAI3C,EAAE2B,EAAE3B,EAAE2C,EAAEgD,WAAW3F,EAAE,GAAG,iBAAiB2C,EAAEjD,KAAK,CAAC,IAAIM,EAAEE,EAAE,OAAOyC,EAAEkD,gBAAgBtE,SAAS,SAAAoB,GAAI3C,EAAE2B,EAAE3B,EAAE2C,EAAEgD,WAAW3F,EAAE,OAAO2C,EAAEjD,KAAKQ,EAJr+B,mC,mJCIA,SAASF,EAAEA,EAAE2C,EAAEnD,GAAkD,OAAvCmD,EAAEmD,SAAS,qBAAExE,aAAmBuD,SAAc7E,EAAE6E,WAAwB7E,EAAE+F,MAAM,SAAA/F,GAAC,OAAEA,EAAEgG,WAAW,YAAYxG,GAAGQ,EAAEgG,WAAW,YAAYxG,GAAGQ,EAAEgG,WAAW,YAAYxG,GAAGQ,EAAEgG,WAAW,gBAAgBxG,GAAGQ,EAAEgG,WAAW,WAAWxG,GAAGQ,EAAEgG,WAAW,iBAAiBxG,GAAGQ,EAAEgG,WAAW,UAAUxG,OAAMS,EAAED,EAAE2C,IAAG,SAASA,EAAE3C,EAAE2C,EAAEnD,GAAG,QAAQQ,EAAE+F,MAAM,SAAA/F,GAAI,IAAM2C,EAAE3C,EAAEiG,OAAO,SAAStD,GAAG,cAAcA,EAAEjD,MAAMiD,EAAEuD,aAAalG,EAAEmG,MAAMxD,EAAEyD,YAAYzD,EAAEyD,aAAa5G,EAAE4G,cAAcpG,EAAEgG,WAAW,YAAY,GAAGhG,EAAEgG,WAAW,gBAAgB,GAAGhG,EAAEgG,WAAW,WAAW,GAAGhG,EAAEgG,WAAW,iBAAiB,OAAO/F,EAAED,EAAE2C,GAAG,SAAS1C,EAAED,EAAE2C,GAAG,IAAI3C,IAAIA,EAAE6E,OAAO,OAAM,EAAG,IAAM5E,EAAE0C,EAAE0D,QAAQrE,UAAU8D,SAAS,gBAAY9F,EAAZ,EAAEsB,UAAF,OAAiBtB,GAAGA,EAAE+B,UAAUC,aAAYC,KAAK,SAAAjC,GAAC,OAAEA,EAAEmG,MAAKpE,UAAU,GAAG/B,EAAE6E,OAAO5E,EAAE4E,OAAO,OAAM,EAAG,IAAnK,EAAuKrF,EAAE,EAAQU,EAAED,EAAE4E,OAArL,cAA8M7E,GAA9M,IAA4L,2BAAoB,CAAC,IAAD,IAAP2B,EAAO,QAAVwE,GAAgB3G,EAAEU,GAAGD,EAAET,KAAKmC,GAAGnC,IAAI,GAAGA,GAAGU,EAAE,OAAM,GAAvP,8BAA0P,OAAM,EAAG,SAASV,EAAEQ,GAAG,QAAQA,GAAGA,EAAE+F,MAAM,SAAA/F,GAAC,OAAE,MAAMA,EAAEmB,UAAUnB,EAAEsG,iBAAiB,MAAMtG,EAAEsG,gBAAgBnF,c,iCCJp9B,6EAI+Q,SAASN,EAAEc,EAAEgB,EAAE9B,GAAU,IAAKD,EAAbV,EAAQ,uDAAN,IAAIV,IAAS,GAAG,OAAOqB,EAAEnB,KAAKkB,EAAE+B,EAAE9B,EAAE0F,gBAAgB,GAAG,OAAO1F,EAAEnB,KAAK,CAAC,IAAMF,EAAEqB,EAAE2F,2BAA2B7E,GAAGzB,EAAEW,EAAE4F,wBAAwB7F,EAAEZ,YAAEE,KAAKA,EAAEwG,OAAO7F,EAAE8F,kBAAkB1G,YAAEC,GAAGD,YAAEY,EAAE8F,kBAAkBhE,EAAEnD,EAAQ,IAAA+C,EAAEZ,EAAEiF,EAAEhG,EAAEI,EAAEW,EAAErB,EAAEM,EAAEP,EAAEsB,EAAEiF,EAAEhG,EAAEM,EAAES,EAAErB,EAAEM,EAAoBuD,EAAGtD,EAApB8F,iBAAsB,OAAOzG,EAAE2G,KAAK7B,KAAK8B,IAAIvE,EAAElC,GAAGH,EAAE6G,KAAK/B,KAAK8B,IAAI9F,EAAEE,GAAGhB,EAAE8G,KAAKhC,KAAKC,IAAI1C,EAAElC,GAAGH,EAAE+G,KAAKjC,KAAKC,IAAIjE,EAAEE,GAAGhB,EAAEyG,iBAAiBxC,EAAEjE,EAAkG,IAAIV,K,wMCAlE+C,EAAE,CAAClB,QAAQ,mBAAmBuD,qBAAqB,YAAYsC,aAAa,mBAAmBC,cAAc,mBAAmBC,QAAQ,mBAAmBjG,SAAS,mBAAmBC,SAAS,mBAAmBoB,SAAS,mBAAmByD,OAAO,oBAAwB5F,EAAC,kDAAqB,SAAAA,EAAYL,GAAE,kCAAC,cAAMA,IAAQ2E,OAAO,KAAK,EAAK0C,MAAM,EAAtC,EAAnC,2CAA2E,WAAU1H,KAAKa,MAAM,OAAhG,yBAAqG,WAAmB,WAAC,IAAIb,KAAK2H,iBAAiB,OAAO,KAAK,IAAMtH,EAAEL,KAAK4H,iBAAiBtF,KAAK,SAAAjC,GAAI,IAAMC,EAAE0C,YAAE,EAAKgC,OAAO3E,GAAG,OAAOA,EAAEwH,kBAAkBvH,MAAM,OAAOD,EAAE6E,OAAO4C,KAAKC,UAAU1H,GAAG,OAAlS,4BAAuS,WAAuB,OAAOL,KAAKa,OAAOU,YAAEvB,KAAK4H,iBAAiB5H,KAAKa,MAAMmH,iBAAiBhI,KAAKa,SAA1Y,iBAAiZ,SAAUR,GAAE,WAACL,KAAKgB,KAAK,WAAWX,IAAIL,KAAKiI,KAAK,QAAQ5H,GAAGL,KAAKkI,QAAQC,OAAO,SAAS9H,GAAGL,KAAKkI,QAAQhI,IAAI,CAACG,EAAE+H,aAAaC,GAAG,UAAU,kBAAI,EAAKC,aAAa,uBAAsBjI,EAAEgI,GAAG,mBAAmB,SAAAhI,GAAC,OAAE,EAAKiI,aAAa1F,EAAEvC,EAAEkI,mBAAkB,YAAzoB,kBAAmpB,WAAa,IAAMlI,EAAEL,KAAK4H,iBAAiB,OAAOvH,EAAEA,EAAE6E,OAAO,QAAQ7E,EAAEiC,KAAK,SAAAjC,GAAC,OAAEA,EAAEmG,MAAKrB,KAAK,KAAK,UAAU,OAA7vB,qBAAkwB,WAAe,IAAK9E,EAAL,OAAaC,IAAI,OAAOD,EAAEL,KAAKgF,UAAU3E,EAAE6E,QAAQjE,EAAEjB,KAAK4H,iBAAiBjE,QAAQ,SAAAtD,GAAC,OAAE,MAAMA,EAAE4E,sBAAsB3E,GAAG,MAAMD,EAAEyE,aAAY,OAAO7D,EAAEiE,OAAO4C,KAAKC,UAAU9G,EAAEwC,QAAQ,SAACpD,EAAEC,GAAK,IAAMW,EAAE+B,YAAE,EAAKgC,OAAO1E,GAAGT,EAAEmC,YAAEf,GAAGN,YAAEM,EAAEX,GAAGA,EAAE2E,qBAAqB,OAAO5E,EAAEC,EAAEkG,IAAI3G,EAAEQ,IAAI,KAAK,OAAriC,mBAA0iC,WAAcL,KAAKe,eAAe,UAAUf,KAAKe,eAAe,aAAaf,KAAKe,eAAe,iBAAiBf,KAAKe,eAAe,cAAc,IAAMV,EAAEL,KAAKa,MAAM,OAAOR,IAAIA,EAAEU,eAAe,OAAOV,EAAEU,eAAe,eAAeV,EAAEU,eAAe,qBAAqBV,EAAEU,eAAe,gBAAgBf,KAAKgB,KAAK,YAAY,GAAG,IAAp3C,4BAAs3C,WAAsB,WAAOX,EAAE,GAAG,IAAIL,KAAKa,MAAM,OAAOR,EAAE,IAAMC,EAAEN,KAAKa,MAAMc,UAAoLrB,GAAGA,EAAEsB,SAA7K,SAAFX,EAAEX,GAAI,IAAM0B,EAAE,EAAK0F,MAAM7H,EAAE,IAAImC,EAAEzB,EAAE,IAAID,EAAEkB,UAAUQ,GAAG1B,EAAEkB,SAASN,EAAE,IAAIZ,EAAEmB,UAAUO,GAAG1B,EAAEmB,SAASnB,EAAEoB,UAAU7B,GAAGU,GAAGW,KAAKZ,EAAEqB,UAAUrB,EAAEqB,UAAUC,QAAQX,GAAGZ,EAAE4B,QAAQ3B,OAAqB,IAAM0B,EAAEhC,KAAKgB,KAAK,oBAAoB,OAAOgB,GAAGA,EAAEkD,SAAS7E,EAAE6E,QAAQlD,EAAEoE,MAAM,SAAC9F,EAAEW,GAAH,OAAOZ,EAAEY,KAAKX,KAAID,EAAE2B,IAAxuD,oBAA0uD,WAAS,IAAM3B,EAAEL,KAAKa,MAAUP,EAAE,CAACkI,IAAInI,EAAEmI,IAAIC,OAAOpI,EAAEqI,YAAYC,YAAYtI,EAAEuI,kBAAkBnC,WAAWpG,EAAEoG,YAAY,MAAM,OAAOzG,KAAK2H,kBAAkB3H,KAAK6I,cAAcvI,EAAEuI,cAAc7I,KAAK6I,cAAcvI,EAAC,2BAAKA,GAAL,IAAOwI,OAAO9I,KAAK8I,OAAOC,UAAU/I,KAAK+I,YAAWzI,MAAp/D,GAAeW,YAAEX,MAAu+DD,YAAE,CAACR,YAAE,CAACiE,UAAS,KAAMpD,EAAEmD,UAAU,gBAAgB,MAAMxD,YAAE,CAACR,eAAKa,EAAEmD,UAAU,cAAS,GAAQxD,YAAE,CAACR,YAAE,CAACiE,UAAS,KAAMpD,EAAEmD,UAAU,mBAAmB,MAAMxD,YAAE,CAACR,eAAKa,EAAEmD,UAAU,QAAQ,MAAMxD,YAAE,CAACR,YAAE,CAACiE,UAAS,KAAMpD,EAAEmD,UAAU,SAAS,MAAMxD,YAAE,CAACR,YAAE,CAACiE,UAAS,KAAMpD,EAAEmD,UAAU,YAAY,MAAMxD,YAAE,CAACR,YAAE,CAACE,KAAKiJ,UAAUtI,EAAEmD,UAAU,aAAQ,GAAQxD,YAAE,CAACR,YAAEqB,MAAIR,EAAEmD,UAAU,kBAAa,GAAQxD,YAAE,CAACR,YAAE,CAACiE,UAAS,KAAMpD,EAAEmD,UAAU,UAAU,MAAMxD,YAAE,CAACR,YAAE,CAACiE,UAAS,KAAMpD,EAAEmD,UAAU,mBAAmB,MAAMnD,EAAEL,YAAE,CAACE,YAAE,6CAA6CG","file":"static/js/64.611114dc.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"./DynamicLayerView3D.js\";import{MapImageLayerView as t}from\"../../layers/MapImageLayerView.js\";import{createQueryGeometry as o}from\"../../support/drapedUtils.js\";let i=class extends(t(s)){constructor(){super(...arguments),this.type=\"map-image-3d\"}initialize(){this.updatingHandles.add(this,\"exportImageVersion\",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}createFetchPopupFeaturesQueryGeometry(e,r){return o(e,r,this.view)}getFetchOptions(){return{timeExtent:this.timeExtent}}};i=e([r(\"esri.views.3d.layers.MapImageLayerView3D\")],i);var a=i;export{a as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{eachAlways as o}from\"../../core/promiseUtils.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as a}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as p}from\"../../layers/support/commonProperties.js\";import{ExportImageParameters as i}from\"../../layers/support/ExportImageParameters.js\";import{calculateTolerance as m}from\"../../renderers/support/clickToleranceUtils.js\";import{loadArcade as l}from\"../../support/arcadeOnDemand.js\";import{getRequiredFields as n,getFetchPopupTemplate as u}from\"./support/popupUtils.js\";const c=c=>{let y=class extends c{initialize(){this.exportImageParameters=new i({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get exportImageVersion(){var e;return null==(e=this.exportImageParameters)||e.commitProperty(\"version\"),this.commitProperty(\"timeExtent\"),(this._get(\"exportImageVersion\")||0)+1}async fetchPopupFeatures(e,s){const{layer:a}=this;if(!e)return Promise.reject(new r(\"mapimagelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:a}));const p=this.get(\"view.scale\"),i=[],l=async e=>{const r=0===e.minScale||p<=e.minScale,o=0===e.maxScale||p>=e.maxScale;if(e.visible&&r&&o)if(e.sublayers)e.sublayers.forEach(l);else if(e.popupEnabled){const r=u(e,{...s,defaultPopupTemplateEnabled:!1});t(r)&&i.unshift({sublayer:e,popupTemplate:r})}},c=a.sublayers.toArray().reverse().map(l);await Promise.all(c);const y=i.map((async({sublayer:r,popupTemplate:o})=>{await r.load().catch((()=>{}));const a=r.createQuery(),p=t(s)?s.event:null,i=m({renderer:r.renderer,event:p}),l=this.createFetchPopupFeaturesQueryGeometry(e,i);a.geometry=l,a.outFields=await n(r,o);const u=await this._loadArcadeModules(o);u&&u.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=l.width/i);return(await r.queryFeatures(a)).features}));return(await o(y)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\"))return l()}};return e([s()],y.prototype,\"exportImageParameters\",void 0),e([s({readOnly:!0})],y.prototype,\"exportImageVersion\",null),e([s()],y.prototype,\"layer\",void 0),e([s()],y.prototype,\"suspended\",void 0),e([s(p)],y.prototype,\"timeExtent\",void 0),y=e([a(\"esri.views.layers.MapImageLayerView\")],y),y};export{c as MapImageLayerView,c as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l}from\"../../../layers/support/fieldUtils.js\";async function t(t,d=t.popupTemplate){if(!e(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes(\"*\"))return[\"*\"];const f=n?await p(t):[],r=l(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,t as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nfunction o(o){var n;const l=o.layer;if(\"floorInfo\"in l&&null!=(n=l.floorInfo)&&n.floorField&&\"floors\"in o.view){return r(o.view.floors,l.floorInfo.floorField)}return null}function n(o,n){var l;return\"floorInfo\"in n&&null!=(l=n.floorInfo)&&l.floorField?r(o,n.floorInfo.floorField):null}function l(o,n){const{definitionExpression:l}=n;return o?l?`(${l}) AND (${o})`:o:l}function r(o,n){if(null==o||!o.length)return null;const l=o.filter((o=>\"\"!==o)).map((o=>`'${o}'`));return l.push(\"''\"),`${n} IN (${l.join(\",\")}) OR ${n} IS NULL`}export{l as combineFloorsDefinitionExpression,o as getFloorFilterClause,n as getLayerFloorFilterClause};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}function n(t,n){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?e(t.stops):n}function r(t,e){if(!e)return t;const r=e.filter((t=>\"size\"===t.type)).map((e=>{const{maxSize:r,minSize:s}=e;return(n(r,t)+n(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let n=0;n<o;n++)s+=r[n];const f=Math.floor(s/o);return Math.max(f,t)}function s(e){const n=e&&e.renderer,s=\"touch\"===(e&&e.event&&e.event.pointerType)?9:6;if(!n)return s;const o=\"visualVariables\"in n?r(s,n.visualVariables):s;if(\"simple\"===n.type)return t(o,n.symbol);if(\"unique-value\"===n.type){let e=o;return n.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===n.type){let e=o;return n.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return n.type,o}export{s as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nfunction e(e,n,i){const o=n.flatten((({sublayers:e})=>e)).length;if(o!==e.length)return!0;return!!e.some((e=>e.originIdOf(\"minScale\")>i||e.originIdOf(\"maxScale\")>i||e.originIdOf(\"renderer\")>i||e.originIdOf(\"labelingInfo\")>i||e.originIdOf(\"opacity\")>i||e.originIdOf(\"labelsVisible\")>i||e.originIdOf(\"source\")>i))||!r(e,n)}function n(e,n,i){return!!e.some((e=>{const n=e.source;return!(!n||\"map-layer\"===n.type&&n.mapLayerId===e.id&&(!n.gdbVersion||n.gdbVersion===i.gdbVersion))||e.originIdOf(\"renderer\")>2||e.originIdOf(\"labelingInfo\")>2||e.originIdOf(\"opacity\")>2||e.originIdOf(\"labelsVisible\")>2}))||!r(e,n)}function r(e,n){if(!e||!e.length)return!0;const r=n.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).map((e=>e.id)).toArray();if(e.length>r.length)return!1;let i=0;const o=r.length;for(const{id:t}of e){for(;i<o&&r[i]!==t;)i++;if(i>=o)return!1}return!0}function i(e){return!!e&&e.some((e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale))}export{n as isExportDynamic,i as isSublayerOverhaul,e as shouldWriteSublayerStructure};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport\"../../geometry.js\";import{isSome as e,isNone as t}from\"../../core/maybe.js\";import{getMetersPerUnitForSR as r}from\"../../core/unitUtils.js\";import{calculateTolerance as n}from\"../../renderers/support/clickToleranceUtils.js\";import i from\"../../geometry/Extent.js\";function a(t,n,a,o=new i){let s;if(\"2d\"===a.type)s=n*a.resolution;else if(\"3d\"===a.type){const i=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?r(o)/r(a.spatialReference):n*i}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,i){const o=i.toMap(e);if(t(o))return!1;return a(o,n(),i,s).intersects(r)}const s=new i;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Accessor.js\";import{HandleOwnerMixin as s}from\"../../core/HandleOwner.js\";import{isSome as t}from\"../../core/maybe.js\";import{property as i}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as o}from\"../../core/accessorSupport/decorators/subclass.js\";import{combinedViewLayerTimeExtentProperty as a}from\"./commonProperties.js\";import{isExportDynamic as l}from\"./sublayerUtils.js\";import{getLayerFloorFilterClause as n,combineFloorsDefinitionExpression as y}from\"../../views/support/floorFilterUtils.js\";const m={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let c=class extends(s(r)){constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>{const r=n(this.floors,e);return e.toExportImageJSON(r)}));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&l(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(m[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){var e;const r=!(null==(e=this.floors)||!e.length),s=this.visibleSublayers.filter((e=>null!=e.definitionExpression||r&&null!=e.floorInfo));return s.length?JSON.stringify(s.reduce(((e,r)=>{const s=n(this.floors,r),i=t(s)?y(s,r):r.definitionExpression;return e[r.id]=i,e}),{})):null}get version(){this.commitProperty(\"layers\"),this.commitProperty(\"layerDefs\"),this.commitProperty(\"dynamicLayers\"),this.commitProperty(\"timeExtent\");const e=this.layer;return e&&(e.commitProperty(\"dpi\"),e.commitProperty(\"imageFormat\"),e.commitProperty(\"imageTransparency\"),e.commitProperty(\"gdbVersion\")),(this._get(\"version\")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const r=this.layer.sublayers,s=r=>{const t=this.scale,i=0===t,o=0===r.minScale||t<=r.minScale,a=0===r.maxScale||t>=r.maxScale;r.visible&&(i||o&&a)&&(r.sublayers?r.sublayers.forEach(s):e.unshift(r))};r&&r.forEach(s);const t=this._get(\"visibleSublayers\");return!t||t.length!==e.length||t.some(((r,s)=>e[s]!==r))?e:t}toJSON(){const e=this.layer;let r={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?r.dynamicLayers=this.dynamicLayers:r={...r,layers:this.layers,layerDefs:this.layerDefs},r}};e([i({readOnly:!0})],c.prototype,\"dynamicLayers\",null),e([i()],c.prototype,\"floors\",void 0),e([i({readOnly:!0})],c.prototype,\"hasDynamicLayers\",null),e([i()],c.prototype,\"layer\",null),e([i({readOnly:!0})],c.prototype,\"layers\",null),e([i({readOnly:!0})],c.prototype,\"layerDefs\",null),e([i({type:Number})],c.prototype,\"scale\",void 0),e([i(a)],c.prototype,\"timeExtent\",void 0),e([i({readOnly:!0})],c.prototype,\"version\",null),e([i({readOnly:!0})],c.prototype,\"visibleSublayers\",null),c=e([o(\"esri.layers.mixins.ExportImageParameters\")],c);export{c as ExportImageParameters};\n"],"sourceRoot":""}