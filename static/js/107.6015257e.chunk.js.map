{"version":3,"sources":["../node_modules/@arcgis/core/views/3d/layers/ImageryLayerView3D.js","../node_modules/@arcgis/core/views/layers/ImageryLayerView.js","../node_modules/@arcgis/core/views/layers/support/popupUtils.js"],"names":["m","arguments","type","redrawDebounced","a","e","redraw","t","_redrawImage","this","handles","add","i","view","basemapTerrain","initializeMaximumDataResolution","layer","on","updatingHandles","addPromise","refreshDebounced","spatialReference","fullExtent","equals","maximumDataResolution","x","pixelSizeX","y","pixelSizeY","timeExtent","imageElement","image","document","createElement","pixelData","HTMLCanvasElement","Promise","reject","r","getContext","applyRenderer","signal","s","o","applyFilter","pixelBlock","width","height","createImageData","data","set","getAsRGBA","putImageData","u","popupEnabled","n","popupTemplate","getRequiredFields","c","geometry","outFields","outSpatialReference","l","resolution","p","layerOptions","returnTopmostRaster","showNoDataRecords","h","w","d","returnDomainValues","pixelSize","queryVisibleRasters","then","isEmpty","prototype","fieldsIndex","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","f","push","has","indexOf","forEach","keyField","defaultPopupTemplateEnabled","defaultPopupTemplate"],"mappings":"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","file":"static/js/107.6015257e.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{isNone as t}from\"../../../core/maybe.js\";import{debounce as a}from\"../../../core/promiseUtils.js\";import{whenOnce as i}from\"../../../core/watchUtils.js\";import\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/Logger.js\";import{subclass as r}from\"../../../core/accessorSupport/decorators/subclass.js\";import s from\"./DynamicLayerView3D.js\";import{ImageryLayerView as o}from\"../../layers/ImageryLayerView.js\";let m=class extends(o(s)){constructor(){super(...arguments),this.type=\"imagery-3d\",this.redrawDebounced=a((async e=>{this.redraw(((e,t)=>this._redrawImage(e,t)),e)}),2e3)}initialize(){this.handles.add([i(this.view.basemapTerrain,\"ready\",(()=>this.initializeMaximumDataResolution())),this.layer.on(\"redraw\",(()=>this.redrawDebounced()))]),this.updatingHandles.add(this.layer,\"exportImageServiceParameters.version\",(()=>{this.updatingHandles.addPromise(this.refreshDebounced())})),this.updatingHandles.add(this,\"timeExtent\",(()=>this.updatingHandles.addPromise(this.refreshDebounced())))}initializeMaximumDataResolution(){const e=this.view.basemapTerrain.spatialReference,t=this.layer.fullExtent;t&&e.equals(t.spatialReference)&&(this.maximumDataResolution={x:this.layer.pixelSizeX,y:this.layer.pixelSizeY})}getFetchOptions(){return{timeExtent:this.timeExtent}}async processResult(e,t,a){t.imageElement?e.image=t.imageElement:(e.image=document.createElement(\"canvas\"),e.pixelData=t.pixelData,await this._redrawImage(e,a))}async _redrawImage(e,a){if(!(e.image instanceof HTMLCanvasElement)||t(e.pixelData))return Promise.reject();const i=e.image,r=i.getContext(\"2d\"),s=await this.layer.applyRenderer(e.pixelData,{signal:a}),o=this.layer.applyFilter(s).pixelBlock;if(t(o))return Promise.reject();i.width=o.width,i.height=o.height;const m=r.createImageData(o.width,o.height);m.data.set(o.getAsRGBA()),r.putImageData(m,0,0)}};m=e([r(\"esri.views.3d.layers.ImageryLayerView3D\")],m);var n=m;export{n as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import r from\"../../core/Error.js\";import{isSome as t}from\"../../core/maybe.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import\"../../core/Logger.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import p from\"../../geometry/Point.js\";import{combinedViewLayerTimeExtentProperty as i}from\"../../layers/support/commonProperties.js\";import a from\"../../rest/support/Query.js\";import{getFetchPopupTemplate as n}from\"./support/popupUtils.js\";const u=u=>{let m=class extends u{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,o){const{layer:s}=this;if(!e)throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:s});const{popupEnabled:i}=s,u=n(s,o);if(!i||!t(u))throw new r(\"imagerylayerview:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:i,popupTemplate:u});const m=await u.getRequiredFields(),c=new a;c.timeExtent=this.timeExtent,c.geometry=e,c.outFields=m,c.outSpatialReference=e.spatialReference;const l=this.view.resolution,y=\"2d\"===this.view.type?new p(l,l,this.view.spatialReference):new p(.5*l,.5*l,this.view.spatialReference),{returnTopmostRaster:h,showNoDataRecords:w}=u.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},d={returnDomainValues:!0,returnTopmostRaster:h,pixelSize:y,showNoDataRecords:w,signal:t(o)?o.signal:null};return s.queryVisibleRasters(c,d).then((e=>e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}};return e([o()],m.prototype,\"layer\",void 0),e([o()],m.prototype,\"suspended\",void 0),e([o(i)],m.prototype,\"timeExtent\",void 0),e([o()],m.prototype,\"view\",void 0),m=e([s(\"esri.views.layers.ImageryLayerView\")],m),m};export{u as ImageryLayerView,u as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l}from\"../../../layers/support/fieldUtils.js\";async function t(t,d=t.popupTemplate){if(!e(d))return[];const i=await d.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:n}=d,{objectIdField:s,typeIdField:a,globalIdField:o,relationships:u}=t;if(i.includes(\"*\"))return[\"*\"];const f=n?await p(t):[],r=l(t.fieldsIndex,[...i,...f]);return a&&r.push(a),r&&s&&t.fieldsIndex.has(s)&&-1===r.indexOf(s)&&r.push(s),r&&o&&t.fieldsIndex.has(o)&&-1===r.indexOf(o)&&r.push(o),u&&u.forEach((e=>{const{keyField:p}=e;r&&p&&t.fieldsIndex.has(p)&&-1===r.indexOf(p)&&r.push(p)})),r}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,t as getRequiredFields};\n"],"sourceRoot":""}