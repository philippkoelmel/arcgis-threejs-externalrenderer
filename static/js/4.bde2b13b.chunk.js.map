{"version":3,"sources":["../node_modules/@arcgis/core/views/3d/webgl-engine/lib/Object3DStateSet.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStateSet.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DObjectStates.js","../node_modules/@arcgis/core/views/3d/layers/graphics/ExtentSet.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DElevationAlignment.js","../node_modules/@arcgis/core/views/layers/support/FeatureFilter.js","../node_modules/@arcgis/core/views/support/floorFilterUtils.js","../node_modules/@arcgis/core/views/3d/layers/support/attributeUtils.js","../node_modules/@arcgis/core/views/3d/layers/graphics/QueryEngine.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFilterVisibility.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView.js","../node_modules/@arcgis/core/views/3d/layers/graphics/Graphics3DFrustumVisibility.js"],"names":["e","this","items","t","push","type","objectStateId","object","s","renderGeometry","owner","remove","length","_removeObjectStateItem","splice","forEach","channel","removeHighlight","removeOcclude","removeRenderGeometryObjectState","i","stateType","objectIdField","objectStateSet","ids","Set","paused","graphic","attributes","has","uid","_graphicsCore","_stateSets","Array","removeAll","a","h","releaseSet","set","handle","indexOf","addObjectStateSet","removeObjectState","add","graphics3DGraphics","get","_addObjectStateSet","setUid","initializeSet","hasGraphic","_removeObjectStateSet","states","c","_extents","allocator","_tmpExtent","_dirty","clear","contains","removeContained","r","pushNew","mergeTight","pop","hasProgressed","o","sort","done","getItemAt","delete","g","m","n","d","madeProgress","some","filterInPlace","containsPoint","p","arguments","dirtyExtents","globalDirty","averageExtentUpdateSize","dirtyGraphicsSet","handles","updateElevation","layerView","graphicsCore","events","queryGraphicUIDsInExtent","elevationProvider","view","resourceController","scheduler","on","_elevationChanged","watch","suspendedChange","registerTask","ELEVATION_ALIGNMENT","destroy","notifyChange","suspended","running","size","empty","markAllGraphicsElevationDirty","run","merge","_updateDirtyGraphics","_updateDirtyExtents","deconflictor","setDirty","renderCoordsHelper","effectiveUpdatePolicy","keys","getGraphics3DGraphicById","alignWithElevation","spatialReference","emit","extent","needsElevationUpdates","context","layer","elevationInfo","mode","computedExtent","xmin","xmax","ymin","ymax","readOnly","prototype","esriSpatialRelIntersects","esriSpatialRelContains","esriSpatialRelCrosses","esriSpatialRelDisjoint","esriSpatialRelEnvelopeIntersects","esriSpatialRelIndexIntersects","esriSpatialRelOverlaps","esriSpatialRelTouches","esriSpatialRelWithin","esriSpatialRelRelation","u","esriSRUnit_Meter","esriSRUnit_Kilometer","esriSRUnit_Foot","esriSRUnit_StatuteMile","esriSRUnit_NauticalMile","esriSRUnit_USNauticalMile","where","geometry","spatialRelationship","hiddenIds","distance","objectIds","units","timeExtent","enabled","_set","l","String","types","json","read","write","source","reader","target","writer","from","Number","overridePolicy","y","floorInfo","floorField","floors","definitionExpression","filter","map","join","toLowerCase","name","_dataQueryEngineInstance","geometryType","outSpatialReference","toJSON","ensureDataQueryEngine","dataQueryEngine","executeQueryForIdSet","_ensureQueryJSON","executeQueryForCount","executeQueryForExtent","count","fromJSON","executeQueryForIds","executeQueryForLatestObservations","features","sourceLayer","executeQuery","defaultQueryJSON","timeInfo","queryGeometryType","fields","priority","graphics3d","featureStore","hasZ","hasM","constructOnly","aliasOf","getLogger","_","_querying","_handles","_queryResult","_layerView","_core","_objectIdField","_queryEngine","FILTER_VISIBILITY","_graphicsChanged","dirty","filterChanged","modifyGraphics3DGraphicVisibilities","clearVisibilityFlag","active","hasVisibilityFlag","setVisibilityFlag","recomputeFilter","clone","intersection","then","catch","warn","error","_getFeatureId","objectId","V","watchUpdatingTracking","C","suspendResumeExtentMode","dataExtent","suspendResumeExtent","scaleVisibility","outsideScaleRange","frustumVisibility","outsideOfView","updating","frustumVisibilityEnabled","f","scaleVisibilityEnabled","w","filterVisibilityEnabled","timeExtentVisibilityEnabled","elevationAlignmentEnabled","preferredUpdatePolicy","elevationFeatureExpressionEnabled","graphicSymbolSupported","filterVisibility","elevationAlignment","updateClippingExtent","layerMinMaxScaleChangeHandler","addPromise","elevationInfoChange","updateVisibilityInfo","updateLabelingInfo","setup","basemapTerrain","spatialIndex","b","labeler","addGraphicsOwner","deconfliction","labeling","objectStates","rendererChange","opacityChange","setupSuspendResumeExtent","_updateClippingExtent","startCreateGraphics","labelsEnabled","acquireSet","queryObjectIds","setObjectIds","highlight","toArray","isArray","E","fieldsIndex","setUids","S","clippingArea","setClippingExtent","recreateAllGraphics","j","updateSuspendResumeExtent","suspendResumeExtentChanged","extentToSuspendResumeRect","equals","x","extentPadding","setExtent","dependsOn","v","pause","resume","extentIntersectionDirty","_isVisibleBelowSurface","extentIntersection","viewChange","state","FRUSTUM_VISIBILITY","elevationBoundsChange","viewingMode","isVisibleBelowSurface","updateIsVisibleBelowSurface","_setDirty","ground","navigationConstraint","opaque","radius","elevationBounds","min","max","Math","update","updateExtentIntersection","frustum","isVisibleInFrustum"],"mappings":"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","file":"static/js/4.bde2b13b.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nclass e{constructor(){this.items=[]}addObject(e,t){this.items.push({type:0,objectStateId:t,object:e})}addRenderGeometry(e,t,s){this.items.push({type:1,objectStateId:t,renderGeometry:e,owner:s})}addExternal(e,t){this.items.push({type:2,objectStateId:t,remove:e})}remove(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];s.objectStateId===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeObject(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];0===s.type&&s.object===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeRenderGeometry(e){for(let t=this.items.length-1;t>=0;--t){const s=this.items[t];1===s.type&&s.renderGeometry===e&&(this._removeObjectStateItem(s),this.items.splice(t,1))}}removeAll(){this.items.forEach((e=>{this._removeObjectStateItem(e)})),this.items=[]}_removeObjectStateItem(e){switch(e.type){case 0:0===e.objectStateId.channel?e.object.removeHighlight(e.objectStateId):1===e.objectStateId.channel&&e.object.removeOcclude(e.objectStateId);break;case 1:e.owner.removeRenderGeometryObjectState(e.renderGeometry,e.objectStateId);break;case 2:e.remove(e.objectStateId)}}}export{e as Object3DStateSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{Object3DStateSet as t}from\"../../webgl-engine/lib/Object3DStateSet.js\";class e{constructor(e,i){this.stateType=e,this.objectIdField=i,this.objectStateSet=new t,this.ids=new Set,this.paused=!1}hasGraphic(t){if(this.objectIdField){const e=t.graphic.attributes[this.objectIdField];return this.ids.has(e)}return this.ids.has(t.graphic.uid)}}export{e as Graphics3DObjectStateSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{makeHandle as t}from\"../../../../core/handleUtils.js\";import{Graphics3DObjectStateSet as e}from\"./Graphics3DObjectStateSet.js\";class s{constructor(t){this._graphicsCore=t,this._stateSets=new Array}destroy(){this._stateSets&&this._stateSets.forEach((t=>t.objectStateSet.removeAll())),this._stateSets=null}acquireSet(s,a){const i=new e(s,a);this._stateSets.push(i);const h=t((()=>this.releaseSet(i)));return{set:i,handle:h}}releaseSet(t){t.objectStateSet.removeAll();const e=this._stateSets?this._stateSets.indexOf(t):-1;-1!==e&&this._stateSets.splice(e,1)}_addObjectStateSet(t,e){t.addObjectStateSet(e.stateType,e.objectStateSet)}_removeObjectStateSet(t,e){t.removeObjectState(e.objectStateSet)}setUid(t,e){t.ids.add(e);const s=this._graphicsCore.graphics3DGraphics.get(e);s&&this._addObjectStateSet(s,t)}setUids(t,e){e.forEach((e=>this.setUid(t,e)))}setObjectIds(t,e){e.forEach((e=>t.ids.add(e))),this.initializeSet(t)}addGraphic(t){this._stateSets.forEach((e=>{!e.paused&&e.hasGraphic(t)&&this._addObjectStateSet(t,e)}))}removeGraphic(t){this._stateSets.forEach((e=>{e.hasGraphic(t)&&this._removeObjectStateSet(t,e)}))}allGraphicsDeleted(){this._stateSets&&this._stateSets.forEach((t=>t.objectStateSet.removeAll()))}initializeSet(t){const e=this._graphicsCore.graphics3DGraphics;t.objectIdField?e.forEach((e=>{e&&t.hasGraphic(e)&&this._addObjectStateSet(e,t)})):t.ids.forEach((s=>{const a=e.get(s);a&&this._addObjectStateSet(a,t)}))}get test(){return{states:this._stateSets}}}export{s as Graphics3DObjectStates};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport t from\"../../../../core/PooledArray.js\";import{create as e,copy as r,area as s,expand as n,contains as o,containsPoint as i}from\"../../../../geometry/support/aaBoundingRect.js\";import{noBudget as h}from\"../../../support/Scheduler.js\";const a=.05;class c{constructor(){this._extents=new t({allocator:t=>t||e()}),this._tmpExtent=e(),this._dirty=!1}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(t){this.contains(t)||(this.removeContained(t),r(this._extents.pushNew(),t),this._dirty=!0)}pop(){return this._dirty&&this.mergeTight(),this._extents.pop()}merge(t){return this.mergeTight(t),t.hasProgressed}mergeTight(t=h){const e=this._extents,o=new Set;let i=0;for(;i!==e.length;){e.sort(((t,e)=>t[0]-e[0])),i=e.length,o.clear();for(let i=0;i<e.length;++i){if(t.done)return;const h=e.getItemAt(i);for(let t=i+1;t<e.length;++t){const r=e.getItemAt(t);if(r[0]>=h[2])break;o.add(r)}o.forEach((i=>{if(h===i)return;if(i[2]<=h[0])return void o.delete(i);const c=s(h),g=s(i),m=this._tmpExtent;n(h,i,m);const d=c+g;(s(m)-d)/d<a&&(r(h,m),o.delete(i),e.remove(i),t.madeProgress())})),o.add(h)}}this._dirty=!1}contains(t){return this._extents.some((e=>o(e,t)))}removeContained(t){this._extents.filterInPlace((e=>!o(t,e)))}get test(){const t=this;return{containsPoint:e=>t._extents.some((t=>i(t,e)))}}}export{c as ExtentSet};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import i from\"../../../../core/Evented.js\";import s from\"../../../../core/Handles.js\";import{isSome as r}from\"../../../../core/maybe.js\";import{property as a}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{ExtentSet as h}from\"./ExtentSet.js\";import{TaskPriority as o}from\"../../../support/Scheduler.js\";let p=class extends t{constructor(){super(...arguments),this.dirtyExtents=new h,this.globalDirty=!1,this.averageExtentUpdateSize=0,this.dirtyGraphicsSet=new Set,this.handles=new s,this.updateElevation=!1,this.layerView=null,this.graphicsCore=null,this.events=new i}setup(e,t,i,s){this.layerView=e,this.queryGraphicUIDsInExtent=t,this.graphicsCore=i,this.elevationProvider=s;const r=this.layerView.view.resourceController.scheduler;this.handles.add([s.on(\"elevation-change\",(e=>this._elevationChanged(e))),this.layerView.watch(\"suspended\",(()=>this.suspendedChange())),r.registerTask(o.ELEVATION_ALIGNMENT,this)])}destroy(){this.dirtyGraphicsSet.clear(),this.handles.destroy(),this.handles=null,this.layerView=null,this.graphicsCore=null,this.queryGraphicUIDsInExtent=null}clear(){this.dirtyGraphicsSet.clear(),this.notifyChange(\"updating\")}suspendedChange(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange(\"updating\"))}elevationInfoChange(){this.globalDirty=!0,this.notifyChange(\"updating\")}get updating(){return this.running}get running(){return this.dirtyGraphicsSet.size>0||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}get updatingRemaining(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}runTask(e){for(this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,e.madeProgress()),e.run((()=>this.dirtyExtents.merge(e)));this.running&&!e.done;)this._updateDirtyGraphics(e),this._updateDirtyExtents(e);this.layerView.view.deconflictor.setDirty(),this.notifyChange(\"updating\")}_updateDirtyGraphics(e){const t=this.layerView.view.renderCoordsHelper,i=0===this.graphicsCore.effectiveUpdatePolicy;for(const s of this.dirtyGraphicsSet.keys()){const a=this.graphicsCore.getGraphics3DGraphicById(s);if(this.dirtyGraphicsSet.delete(s),r(a)&&(a.alignWithElevation(this.elevationProvider,t,i),e.madeProgress()),e.done)return}}_updateDirtyExtents(e){for(;!this.dirtyExtents.empty&&!e.done;){const t=this.dirtyExtents.pop(),i=this.elevationProvider.spatialReference;this.events.emit(\"invalidate-elevation\",{extent:t,spatialReference:i});const s=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(t,i,(e=>{const t=this.graphicsCore.getGraphics3DGraphicById(e);r(t)&&t.needsElevationUpdates()&&this.dirtyGraphicsSet.add(e)})),this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-s)+.9*this.averageExtentUpdateSize,e.madeProgress()}}markAllGraphicsElevationDirty(){this.dirtyExtents.clear(),this.dirtyGraphicsSet.clear(),this.graphicsCore.graphics3DGraphics.forEach(((e,t)=>this.dirtyGraphicsSet.add(t)))}_elevationChanged(e){if(\"scene\"===e.context&&(!this.graphicsCore.layer.elevationInfo||\"relative-to-scene\"!==this.graphicsCore.layer.elevationInfo.mode))return;const{extent:t,spatialReference:i}=e;if(this.layerView.suspended){if(!this.updateElevation){const e=this.graphicsCore.computedExtent;e&&t[2]>e.xmin&&t[0]<e.xmax&&t[3]>e.ymin&&t[1]<e.ymax&&(this.updateElevation=!0)}this.events.emit(\"invalidate-elevation\",{extent:t,spatialReference:i})}else t[0]===-1/0?this.globalDirty=!0:this.dirtyExtents.add(t),this.notifyChange(\"updating\")}};e([a({readOnly:!0})],p.prototype,\"updating\",null),e([a({readOnly:!0})],p.prototype,\"updatingRemaining\",null),p=e([n(\"esri.views.3d.layers.graphics.Graphics3DElevationAlignment\")],p);var d=p;export{d as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{geometryTypes as t}from\"../../../geometry.js\";import r from\"../../../TimeExtent.js\";import{JSONMap as i}from\"../../../core/jsonMap.js\";import{JSONSupport as s}from\"../../../core/JSONSupport.js\";import{clone as o}from\"../../../core/lang.js\";import{property as n}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/accessorSupport/ensureType.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import{subclass as a}from\"../../../core/accessorSupport/decorators/subclass.js\";import{writer as p}from\"../../../core/accessorSupport/decorators/writer.js\";import{fromJSON as l}from\"../../../geometry/support/jsonUtils.js\";import c from\"../../../rest/support/Query.js\";var d;const m=new i({esriSpatialRelIntersects:\"intersects\",esriSpatialRelContains:\"contains\",esriSpatialRelCrosses:\"crosses\",esriSpatialRelDisjoint:\"disjoint\",esriSpatialRelEnvelopeIntersects:\"envelope-intersects\",esriSpatialRelIndexIntersects:\"index-intersects\",esriSpatialRelOverlaps:\"overlaps\",esriSpatialRelTouches:\"touches\",esriSpatialRelWithin:\"within\",esriSpatialRelRelation:\"relation\"}),u=new i({esriSRUnit_Meter:\"meters\",esriSRUnit_Kilometer:\"kilometers\",esriSRUnit_Foot:\"feet\",esriSRUnit_StatuteMile:\"miles\",esriSRUnit_NauticalMile:\"nautical-miles\",esriSRUnit_USNauticalMile:\"us-nautical-miles\"});let h=d=class extends s{constructor(e){super(e),this.where=null,this.geometry=null,this.spatialRelationship=\"intersects\",this.hiddenIds=new Set,this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null,this.enabled=!1}writeWhere(e,t){t.where=e||\"1=1\"}enable(){this._set(\"enabled\",!0)}createQuery(e={}){const{where:t,geometry:r,spatialRelationship:i,timeExtent:s,objectIds:n,units:a,distance:p}=this;return new c({geometry:o(r),objectIds:o(n),spatialRelationship:i,timeExtent:o(s),where:t,units:a,distance:p,...e})}clone(){const{where:e,geometry:t,spatialRelationship:r,hiddenIds:i,timeExtent:s,objectIds:n,units:a,distance:p}=this,l=new Set;return i.forEach((e=>l.add(e))),new d({geometry:o(t),hiddenIds:l,objectIds:o(n),spatialRelationship:r,timeExtent:o(s),where:e,units:a,distance:p})}};e([n({type:String})],h.prototype,\"where\",void 0),e([p(\"where\")],h.prototype,\"writeWhere\",null),e([n({types:t,json:{read:l,write:!0}})],h.prototype,\"geometry\",void 0),e([n({type:String,json:{read:{source:\"spatialRel\",reader:m.read},write:{target:\"spatialRel\",writer:m.write}}})],h.prototype,\"spatialRelationship\",void 0),e([n({json:{write:(e,t,r)=>t[r]=Array.from(e),read:e=>new Set(e)}})],h.prototype,\"hiddenIds\",void 0),e([n({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],h.prototype,\"distance\",void 0),e([n({type:[Number],json:{write:!0}})],h.prototype,\"objectIds\",void 0),e([n({type:String,json:{read:u.read,write:{writer:u.write,overridePolicy(e){return{enabled:e&&this.distance>0}}}}})],h.prototype,\"units\",void 0),e([n({type:r,json:{write:!0}})],h.prototype,\"timeExtent\",void 0),e([n({readOnly:!0})],h.prototype,\"enabled\",void 0),h=d=e([a(\"esri.views.layers.support.FeatureFilter\")],h);var y=h;export{y as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nfunction o(o){var n;const l=o.layer;if(\"floorInfo\"in l&&null!=(n=l.floorInfo)&&n.floorField&&\"floors\"in o.view){return r(o.view.floors,l.floorInfo.floorField)}return null}function n(o,n){var l;return\"floorInfo\"in n&&null!=(l=n.floorInfo)&&l.floorField?r(o,n.floorInfo.floorField):null}function l(o,n){const{definitionExpression:l}=n;return o?l?`(${l}) AND (${o})`:o:l}function r(o,n){if(null==o||!o.length)return null;const l=o.filter((o=>\"\"!==o)).map((o=>`'${o}'`));return l.push(\"''\"),`${n} IN (${l.join(\",\")}) OR ${n} IS NULL`}export{l as combineFloorsDefinitionExpression,o as getFloorFilterClause,n as getLayerFloorFilterClause};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nfunction n(n,t,e){if(!e||null==t)return null;if(!n)return r(t,e);const o=n.get(e);return o?t[o.name]:null}function r(n,r){const t=r.toLowerCase();for(const e in n)if(e.toLowerCase()===t)return n[e];return null}export{n as attributeLookup};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../geometry.js\";import r from\"../../../../core/Accessor.js\";import{isNone as t}from\"../../../../core/maybe.js\";import{property as s}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import n from\"../../../../geometry/Extent.js\";import o from\"../../../../layers/graphics/data/QueryEngine.js\";import i from\"../../../../rest/support/FeatureSet.js\";import u from\"../../../../rest/support/Query.js\";import{featureGeometryTypeKebabDictionary as y}from\"../../../../geometry/support/typeUtils.js\";const c=o;let l=class extends r{constructor(e){super(e),this._dataQueryEngineInstance=null}get queryGeometryType(){switch(this.layer.geometryType){case\"multipoint\":case\"point\":case\"polygon\":case\"polyline\":return this.layer.geometryType;case\"mesh\":return\"polygon\";default:return}}get defaultQueryJSON(){return new u({outSpatialReference:this.spatialReference}).toJSON()}get dataQueryEngine(){return this.ensureDataQueryEngine()}destroy(){this.clear()}clear(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)}async executeQueryForIdSet(e,r){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),r)}async executeQueryForCount(e,r){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),r)}async executeQueryForExtent(e,r){const{count:t,extent:s}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),r);return{count:t,extent:n.fromJSON(s)}}async executeQueryForIds(e,r){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),r)}async executeQueryForLatestObservations(e,r){const t=await this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(e),r),s=i.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}async executeQuery(e,r){const t=await this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),r),s=i.fromJSON(t);return s.features.forEach((e=>{e.layer=this.layer,e.sourceLayer=this.layer})),s}_ensureQueryJSON(e){return t(e)?this.defaultQueryJSON:(\"outSpatialReference\"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())}ensureDataQueryEngine(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const e=\"timeInfo\"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,r=this.layer.objectIdField,t=y.toJSON(this.queryGeometryType),s=this.layer.fields.map((e=>e.toJSON())),a=this.layerView.view.resourceController.scheduler,n=this.priority,o=this.spatialReference.toJSON(),i=this.layerView.graphics3d.graphicsCore.featureStore,{hasZ:u,hasM:l}=this.layerView;return this._dataQueryEngineInstance=new c({hasZ:u,hasM:l,geometryType:t,fields:s,timeInfo:e,spatialReference:o,objectIdField:r,featureStore:i,scheduler:a,priority:n}),this._dataQueryEngineInstance}};e([s({constructOnly:!0})],l.prototype,\"layerView\",void 0),e([s({constructOnly:!0})],l.prototype,\"priority\",void 0),e([s({readOnly:!0,aliasOf:\"layerView.view.spatialReference\"})],l.prototype,\"spatialReference\",void 0),e([s({readOnly:!0,aliasOf:\"layerView.layer\"})],l.prototype,\"layer\",void 0),e([s({readOnly:!0})],l.prototype,\"queryGeometryType\",null),e([s({readOnly:!0})],l.prototype,\"defaultQueryJSON\",null),l=e([a(\"esri.views.3d.layers.graphics.QueryEngine\")],l);var p=l;export{l as QueryEngine,p as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import i from\"../../../../core/Accessor.js\";import t from\"../../../../core/Handles.js\";import r from\"../../../../core/Logger.js\";import{isNone as s,isSome as h}from\"../../../../core/maybe.js\";import{isAbortError as l}from\"../../../../core/promiseUtils.js\";import{on as o}from\"../../../../core/watchUtils.js\";import{property as n}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{subclass as a}from\"../../../../core/accessorSupport/decorators/subclass.js\";import u from\"./QueryEngine.js\";import c from\"../../../layers/support/FeatureFilter.js\";import{getFloorFilterClause as y}from\"../../../support/floorFilterUtils.js\";import{TaskPriority as d}from\"../../../support/Scheduler.js\";const p=r.getLogger(\"esri.views.3d.layers.graphics.Graphics3DFilterVisibility\");let _=class extends i{constructor(...e){super(...e),this.filter=null,this._dirty=!1,this._querying=!1,this._handles=new t}get updating(){return this._dirty||this._querying||null!=this._queryResult}setup(e,i){this._layerView=e,this._core=i,this._objectIdField=e.layer.objectIdField,this._queryEngine=new u({layerView:this._layerView,priority:d.FILTER_VISIBILITY});const t=this._layerView.view.resourceController.scheduler;this._handles.add(t.registerTask(d.FILTER_VISIBILITY,this)),this._handles.add(o(i.owner,\"loadedGraphics\",\"after-changes\",(e=>this._graphicsChanged(e)),(()=>this.dirty=!0))),this.filterChanged()}destroy(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null}clear(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities((e=>e.clearVisibilityFlag(2))),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange(\"updating\")}_graphicsChanged(e){this._queryEngine&&0==(1&e.type)||(this.dirty=!0)}updateVisibility(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)}filterChanged(){const e=this.recomputeFilter();e!==this.filter&&(this.filter=e,this.dirty=!0)}get active(){return this.filter&&this._core.graphics3DGraphics.size>0}recomputeFilter(){const e=\"filter\"in this._layerView?this._layerView.filter:null,i=\"timeExtent\"in this._layerView?this._layerView.timeExtent:null,t=y(this._layerView);if(s(i)&&s(t))return e;const r=h(e)?e.clone():new c;if(h(i)&&(r.timeExtent=h(r.timeExtent)?r.timeExtent.intersection(i):i),h(t)){const e=null==r.where||\"\"===r.where;r.where=e?t:`(${r.where}) AND (${t})`}return r}get running(){return this._dirty&&!this._querying||null!=this._queryResult}runTask(e){this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then((e=>{this._queryResult=e,this._querying=!1})).catch((e=>{l(e)||(p.warn(\"FeatureFilter query failed: \"+e,{error:e}),this._queryResult=new Set,this._core.graphics3DGraphics.forEach((e=>this._queryResult.add(this._getFeatureId(e.graphic)))),this._querying=!1)})),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities((i=>{if(e.done)return!1;const t=this._queryResult.has(this._getFeatureId(i.graphic));return!!i.setVisibilityFlag(2,t,0)&&(e.madeProgress(),!0)})),e.done||(this._queryResult=null)),this.notifyChange(\"updating\")):this.clear()}_getFeatureId(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId}set dirty(e){this._dirty!==e&&(this._dirty=e,this.notifyChange(\"updating\"))}};e([n({readOnly:!0})],_.prototype,\"updating\",null),_=e([a(\"esri.views.3d.layers.graphics.Graphics3DFilterVisibility\")],_);export{_ as Graphics3DFilterVisibility};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as t}from\"../../../../chunks/tslib.es6.js\";import e from\"../../../../Graphic.js\";import i from\"../../../../core/Accessor.js\";import{neverReached as s}from\"../../../../core/compilerUtils.js\";import r from\"../../../../core/Handles.js\";import{logOnError as n}from\"../../../../core/promiseUtils.js\";import{init as a}from\"../../../../core/watchUtils.js\";import{property as o}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as l}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{diff as p}from\"../../../../core/accessorSupport/diffUtils.js\";import{canProject as h,project as d}from\"../../../../geometry/support/webMercatorUtils.js\";import c from\"../../../../rest/support/Query.js\";import{SUSPEND_RESUME_EXTENT_OPTIMISM as u}from\"./constants.js\";import{Graphics3DCore as g}from\"./Graphics3DCore.js\";import m from\"./Graphics3DElevationAlignment.js\";import{Graphics3DFilterVisibility as y}from\"./Graphics3DFilterVisibility.js\";import f from\"./Graphics3DFrustumVisibility.js\";import{Graphics3DObjectStates as b}from\"./Graphics3DObjectStates.js\";import w from\"./Graphics3DScaleVisibility.js\";import{enlargeExtent as x}from\"./graphicUtils.js\";import{attributeLookup as E}from\"../support/attributeUtils.js\";import{WatchUpdatingTracking as C}from\"../../../support/WatchUpdatingTracking.js\";let V=class extends i{constructor(t){super(t),this._handles=new r,this.watchUpdatingTracking=new C,this.suspendResumeExtentMode=\"computed\",this.dataExtent=null,this.suspendResumeExtent=null}get suspended(){var t;return null==(t=this.scaleVisibility)?void 0:t.suspended}get suspendInfo(){var t,e;const i={};return null!=(t=this.scaleVisibility)&&t.suspended&&(i.outsideScaleRange=!0),null!=(e=this.frustumVisibility)&&e.suspended&&(i.outsideOfView=!0),i}get updating(){var t,e,i;return!!(null!=(t=this.graphicsCore)&&t.updating||null!=(e=this.frustumVisibility)&&e.updating||null!=(i=this.watchUpdatingTracking)&&i.updating)}normalizeCtorArgs(t){const e=t.frustumVisibilityEnabled?new f:null,i=t.scaleVisibilityEnabled?new w:null,s=(t.filterVisibilityEnabled||t.timeExtentVisibilityEnabled)&&\"multipatch\"!==t.layer.geometryType?new y:null,r=t.elevationAlignmentEnabled?new m:null,n=new g({owner:t.owner,layer:t.layer,preferredUpdatePolicy:t.preferredUpdatePolicy,elevationFeatureExpressionEnabled:t.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:t.owner.hasZ,hasM:t.owner.hasM}),{updateClippingExtent:a,suspendResumeExtentMode:o,dataExtent:l}=t;return{graphicsCore:n,frustumVisibility:e,scaleVisibility:i,filterVisibility:s,elevationAlignment:r,updateClippingExtent:a,suspendResumeExtentMode:o,dataExtent:l}}initialize(){this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,\"scaleRangeId\",(()=>this.scaleVisibility.layerMinMaxScaleChangeHandler())),this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,\"filter\",(()=>this.filterVisibility.filterChanged())),this.watchUpdatingTracking.add(this.owner,\"timeExtent\",(()=>this.filterVisibility.filterChanged()))),this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,\"elevationInfo\",((t,e)=>{p(t,e)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())})),this.watchUpdatingTracking.add(this.layer,\"labelsVisible\",(()=>this.graphicsCore.updateVisibilityInfo())),this.watchUpdatingTracking.add(this.layer,\"labelingInfo\",((t,e)=>{p(t,e)&&this.graphicsCore.updateLabelingInfo()}))}async setup(){this.frustumVisibility&&this.frustumVisibility.setup(this.owner);const t=this.owner,e=this.owner.view.basemapTerrain,i=(t,e,i)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(t,e,i);if(this.scaleVisibility&&this.scaleVisibility.setup(t,this.layer,i,this.graphicsCore,e),this.filterVisibility&&(\"filter\"in t||\"timeExtent\"in t)&&this.filterVisibility.setup(t,this.graphicsCore),this.elevationAlignment){const e=t.view.elevationProvider;this.elevationAlignment.setup(t,i,this.graphicsCore,e)}this._set(\"objectStates\",new b(this.graphicsCore)),this._set(\"labeling\",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set(\"deconfliction\",t.view.deconflictor.addGraphicsOwner(this.graphicsCore)),await n(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates})),this.watchUpdatingTracking.add(this.layer,\"renderer\",(t=>this.watchUpdatingTracking.addPromise(this.graphicsCore.rendererChange(t)))),this.watchUpdatingTracking.add(t,\"fullOpacity\",(()=>this.graphicsCore.opacityChange())),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this.watchUpdatingTracking.add(t.view,\"clippingArea\",(()=>this._updateClippingExtent())),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled&&await n(this.graphicsCore.updateLabelingInfo())}destroy(){this._handles&&(this._handles.destroy(),this._handles=null);const t=[\"watchUpdatingTracking\",\"frustumVisibility\",\"scaleVisibility\",\"filterVisibility\",\"elevationAlignment\",\"objectStates\",\"graphicsCore\"];for(const e of t){const t=this[e];t&&(t.destroy(),this._set(e,null))}this._set(\"layer\",null),this._set(\"owner\",null)}maskOccludee(t){const{set:e,handle:i}=this.objectStates.acquireSet(1,null);return this.objectStates.setUid(e,t.uid),i}highlight(t,i){if(t instanceof c){const{set:e,handle:s}=this.objectStates.acquireSet(0,i);return this.owner.queryObjectIds(t).then((t=>this.objectStates.setObjectIds(e,t))),s}if(\"number\"==typeof t||\"string\"==typeof t)return this.highlight([t],i);if(t instanceof e)return this.highlight([t],i);if(\"toArray\"in t&&(t=t.toArray()),Array.isArray(t)&&t.length>0){if(t[0]instanceof e){const e=t;if(null==E(this.layer.fieldsIndex,e[0].attributes,i)){const t=e.map((t=>t.uid)),{set:i,handle:s}=this.objectStates.acquireSet(0,null);return this.objectStates.setUids(i,t),s}t=e.map((t=>E(this.layer.fieldsIndex,t.attributes,i)))}if(\"number\"==typeof t[0]||\"string\"==typeof t[0]){const e=t,{set:s,handle:r}=this.objectStates.acquireSet(0,i);return this.objectStates.setObjectIds(s,e),r}}return S}_updateClippingExtent(){const t=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(t,this.owner.view.spatialReference)&&(this.updateClippingExtent(t)||this.graphicsCore.recreateAllGraphics())}setupSuspendResumeExtent(){(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(a(this,\"suspendResumeExtentMode\",(()=>{switch(this._handles.remove(j),this.suspendResumeExtentMode){case\"computed\":this._handles.add([a(this.graphicsCore,\"computedExtent\",(t=>this.updateSuspendResumeExtent(t))),this.graphicsCore.watch(\"extentPadding\",(()=>this.updateSuspendResumeExtent(this.graphicsCore.computedExtent)))],j);break;case\"data\":this._handles.add([a(this,\"dataExtent\",(t=>this.updateSuspendResumeExtent(t))),this.graphicsCore.watch(\"extentPadding\",(()=>this.updateSuspendResumeExtent(this.dataExtent)))],j);break;default:s(this.suspendResumeExtentMode)}})))}updateSuspendResumeExtent(t){t?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(t,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)}extentToSuspendResumeRect(t,e){const i=this.owner.view.spatialReference;if(!t.spatialReference.equals(i)){if(!h(t,i))return;t=d(t,i)}return x(t,e,u,this.graphicsCore.extentPadding)}suspendResumeExtentChanged(t){this.frustumVisibility&&this.frustumVisibility.setExtent(t),this.scaleVisibility&&this.scaleVisibility.setExtent(t)}};t([o({aliasOf:\"graphicsCore.layer\"})],V.prototype,\"layer\",void 0),t([o({aliasOf:\"graphicsCore.owner\"})],V.prototype,\"owner\",void 0),t([o({constructOnly:!0})],V.prototype,\"updateClippingExtent\",void 0),t([o({constructOnly:!0})],V.prototype,\"graphicsCore\",void 0),t([o({constructOnly:!0})],V.prototype,\"scaleVisibility\",void 0),t([o({constructOnly:!0})],V.prototype,\"filterVisibility\",void 0),t([o({constructOnly:!0})],V.prototype,\"elevationAlignment\",void 0),t([o({constructOnly:!0})],V.prototype,\"frustumVisibility\",void 0),t([o({readOnly:!0})],V.prototype,\"deconfliction\",void 0),t([o({readOnly:!0})],V.prototype,\"labeling\",void 0),t([o({readOnly:!0})],V.prototype,\"objectStates\",void 0),t([o({readOnly:!0})],V.prototype,\"watchUpdatingTracking\",void 0),t([o()],V.prototype,\"suspendResumeExtentMode\",void 0),t([o()],V.prototype,\"dataExtent\",void 0),t([o({readOnly:!0})],V.prototype,\"suspended\",null),t([o({readOnly:!0})],V.prototype,\"suspendInfo\",null),t([o({readOnly:!0,dependsOn:[\"graphicsCore.updating\",\"frustumVisibility.updating\",\"watchUpdatingTracking.updating\"]})],V.prototype,\"updating\",null),V=t([l(\"esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView\")],V);var v=V;const j=\"suspendResumeExtentMode\",S={remove(){},pause(){},resume(){}};export{v as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import t from\"../../../../core/Accessor.js\";import s from\"../../../../core/Handles.js\";import{init as i}from\"../../../../core/watchUtils.js\";import{property as r}from\"../../../../core/accessorSupport/decorators/property.js\";import\"../../../../core/has.js\";import\"../../../../core/accessorSupport/ensureType.js\";import\"../../../../core/Logger.js\";import{subclass as n}from\"../../../../core/accessorSupport/decorators/subclass.js\";import{getReferenceEllipsoid as o}from\"../../../../geometry/projectionEllipsoid.js\";import{FrustumExtentIntersection as a}from\"../../support/FrustumExtentIntersection.js\";import{TaskPriority as l}from\"../../../support/Scheduler.js\";const h=1.2;let u=class extends t{constructor(){super(...arguments),this.suspended=!1,this.extent=null,this.extentIntersectionDirty=!0,this._isVisibleBelowSurface=!1,this.handles=new s,this.layerView=null,this.updating=!0}setup(e){this.layerView=e,this.extentIntersection=new a({renderCoordsHelper:e.view.renderCoordsHelper});const t=e.view,s=t.basemapTerrain,r=t.resourceController.scheduler;this.handles.add([t.on(\"resize\",(()=>this.viewChange())),t.state.watch(\"camera\",(()=>this.viewChange()),!0),r.registerTask(l.FRUSTUM_VISIBILITY,this),s.on(\"elevation-bounds-change\",(()=>this.elevationBoundsChange()))]),\"local\"===t.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([i(s,[\"opacity\",\"wireframe\"],(()=>this.updateIsVisibleBelowSurface())),i(t,\"map.ground.navigationConstraint.type\",(()=>this.updateIsVisibleBelowSurface()))])}destroy(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)}_setDirty(){this.updating||this._set(\"updating\",!0)}setExtent(e){this.extent=e,this.extentIntersectionDirty=!0,this._setDirty()}viewChange(){this._setDirty()}elevationBoundsChange(){this._setDirty(),this.extentIntersectionDirty=!0}set isVisibleBelowSurface(e){this._isVisibleBelowSurface=e,this._setDirty(),this.extentIntersectionDirty=!0}updateIsVisibleBelowSurface(){const e=this.layerView.view,t=e.basemapTerrain,s=\"local\"===e.viewingMode,i=e.map.ground&&e.map.ground.navigationConstraint&&\"none\"===e.map.ground.navigationConstraint.type;this.isVisibleBelowSurface=s||!t.opaque||i}updateExtentIntersection(){if(!this.extentIntersectionDirty)return;this.extentIntersectionDirty=!1;const e=this.layerView.view;let t;if(this._isVisibleBelowSurface)t=-.3*o(e.spatialReference).radius;else{const{min:s,max:i}=e.basemapTerrain.elevationBounds;t=s-Math.max(1,(i-s)*(h-1))}this.extentIntersection.update(this.extent,e.spatialReference,t)}get running(){return this.updating}runTask(){if(this._set(\"updating\",!1),!this.extent)return void this._set(\"suspended\",!1);this.updateExtentIntersection();const e=this.layerView.view.frustum,t=o(this.layerView.view.spatialReference).radius;this._set(\"suspended\",!this.extentIntersection.isVisibleInFrustum(e,t))}};e([r({readOnly:!0})],u.prototype,\"suspended\",void 0),e([r({readOnly:!0})],u.prototype,\"updating\",void 0),u=e([n(\"esri.views.3d.layers.graphics.Graphics3DFrustumVisibility\")],u);var p=u;export{p as default};\n"],"sourceRoot":""}