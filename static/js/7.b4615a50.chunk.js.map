{"version":3,"sources":["../node_modules/@arcgis/core/views/3d/webgl-engine/shaders/ImageMaterialTechnique.js","../node_modules/@arcgis/core/views/3d/webgl-engine/materials/ImageMaterial.js","../node_modules/@arcgis/core/views/layers/RefreshableLayerView.js","../node_modules/@arcgis/core/views/3d/layers/support/projectExtentUtils.js","../node_modules/@arcgis/core/chunks/ImageMaterial.glsl.js","../node_modules/@arcgis/core/views/3d/layers/support/overlayImageUtils.js","../node_modules/@arcgis/core/views/3d/layers/DynamicLayerView3D.js"],"names":["E","e","t","shader","get","r","this","configuration","i","build","output","slicePlaneEnabled","sliceHighlightDisabled","sliceEnabledForVertexPrograms","OITEnabled","transparencyPassType","multipassTerrainEnabled","cullAboveGround","m","rctx","p","program","camera","projectionMatrix","setUniform1f","opacity","setUniform2fv","nearFar","inverseViewport","s","rebindTextures","P","blending","transparent","w","c","culling","v","cullFace","depthTest","func","u","depthWrite","writeDepth","j","d","colorWrite","S","stencilWrite","sceneHasOcludees","b","stencilTest","f","g","polygonOffset","h","enableOffset","_occludeePipelineState","setPipelineState","pipeline","o","a","y","T","O","arguments","l","n","count","prototype","supportsEdges","techniqueConfig","params","relativeElevation","material","updateParameters","_material","updateTexture","textureId","_technique","_techniqueRep","releaseAndAcquire","getTechniqueConfig","_output","hasOccludees","setParameterValues","_updateOccludeeState","bindTextures","bindTextureScale","bindPass","getPipelineState","initTextureTransparent","handles","add","doRefresh","catch","getLogger","declaredClass","error","view","spatialReference","layer","fullExtent","Promise","resolve","equals","clone","state","isLocal","portalItem","then","destroyed","include","linearDepth","vertex","uniforms","attributes","varyings","code","fragment","float","Object","freeze","__proto__","createSquareGeometry","Math","min","max","Float64Array","Float32Array","Uint32Array","x","M","length","size","data","exclusive","H","drapeSourceType","updatePolicy","fullExtentInLocalViewSpatialReference","maximumDataResolution","_images","Array","_extents","_overlays","updateWhenStationary","refreshDebounced","addResolvingPromise","C","_set","updatingHandles","_suspendedChangeHandler","resourceController","scheduler","registerIdleStateCallbacks","_isScaleRangeActive","notifyChange","_isScaleRangeLayer","clear","_spatialReference","forEach","index","_updateImageExtent","_clippedExtent","extent","V","width","height","round","resolution","pixelRatio","imageMaxWidth","imageMaxHeight","floor","_imageSizeEquals","imageSize","_","suspended","_fetch","_clearImage","push","minScale","maxScale","scale","some","loadingPromise","HTMLImageElement","HTMLCanvasElement","image","contains","_createStageObjects","L","TESTS_DISABLE_UPDATE_THRESHOLDS","abs","texture","renderGeometry","loadingAbortController","pixelData","renderExtent","abort","signal","_waitFetchReady","requestAsImageElement","getFetchOptions","fetchImage","warnOnce","processResult","R","basemapTerrain","overlayManager","renderer","removeGeometries","_stage","remove","preMultiplyAlpha","wrap","I","A","G","id","D","origin","renderLocalOrigin","addGeometries","viewingMode","ready","readOnly","U"],"mappings":"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","file":"static/js/7.b4615a50.chunk.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import{bindSliceUniformsWithOrigin as t}from\"../core/shaderLibrary/Slice.glsl.js\";import{bindMultipassTerrainTexture as r}from\"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{bindProjectionMatrix as i,bindView as s}from\"../core/shaderLibrary/util/View.glsl.js\";import{ReloadableShaderModule as a}from\"../core/shaderTechnique/ReloadableShaderModule.js\";import{ShaderTechnique as o}from\"../core/shaderTechnique/ShaderTechnique.js\";import{parameter as n,ShaderTechniqueConfiguration as l}from\"../core/shaderTechnique/ShaderTechniqueConfiguration.js\";import{Default3D as p}from\"../lib/DefaultVertexAttributeLocations.js\";import{OITBlending as c,OITDepthTest as u,OITDepthWrite as d,getOITPolygonOffset as h}from\"../lib/OrderIndependentTransparency.js\";import{Program as m}from\"../lib/Program.js\";import{stencilWriteMaskOn as b,stencilToolMaskBaseParams as f,stencilBaseAllZerosParams as g}from\"../lib/StencilUtils.js\";import{I as y}from\"../../../../chunks/ImageMaterial.glsl.js\";import{simpleBlendingParams as T,makePipelineState as P,cullingParams as v,defaultDepthWriteParams as j,defaultColorWriteParams as S}from\"../../../webgl/renderState.js\";class E extends o{initializeProgram(e){const t=E.shader.get(),r=this.configuration,i=t.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new m(e.rctx,i,p)}bindPass(e,t){i(this.program,t.camera.projectionMatrix),this.program.setUniform1f(\"opacity\",e.opacity),t.multipassTerrainEnabled&&(this.program.setUniform2fv(\"cameraNearFar\",t.camera.nearFar),this.program.setUniform2fv(\"inverseViewport\",t.inverseViewport),r(this.program,t))}bindDraw(e){s(this.program,e),t(this.program,this.configuration,e),this.program.rebindTextures()}setPipelineState(e,t){const r=this.configuration,i=3===e,s=2===e;return P({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?w:c(e),culling:v(r.cullFace),depthTest:{func:u(e)},depthWrite:i?r.writeDepth&&j:d(e),colorWrite:S,stencilWrite:r.sceneHasOcludees?b:null,stencilTest:r.sceneHasOcludees?t?f:g:null,polygonOffset:i||s?null:h(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}E.shader=new a(y,(()=>import(\"./ImageMaterial.glsl.js\")));const w=T(1,771);class O extends l{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!1}}e([n({count:8})],O.prototype,\"output\",void 0),e([n({count:3})],O.prototype,\"cullFace\",void 0),e([n()],O.prototype,\"slicePlaneEnabled\",void 0),e([n()],O.prototype,\"transparent\",void 0),e([n()],O.prototype,\"enableOffset\",void 0),e([n()],O.prototype,\"writeDepth\",void 0),e([n()],O.prototype,\"sceneHasOcludees\",void 0),e([n({count:4})],O.prototype,\"transparencyPassType\",void 0),e([n()],O.prototype,\"multipassTerrainEnabled\",void 0),e([n()],O.prototype,\"cullAboveGround\",void 0);export{E as ImageMaterialTechnique,O as ImageMaterialTechniqueConfiguration};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport e from\"../lib/GLMaterialTexture.js\";import{Material as t,materialParametersDefaults as i}from\"../lib/Material.js\";import{OITPolygonOffsetLimit as s}from\"../lib/OrderIndependentTransparency.js\";import{DefaultBufferWriter as a,PositionUVLayout as r}from\"./internal/DefaultBufferWriter.js\";import{intersectTriangleGeometry as n}from\"./internal/MaterialUtil.js\";import{ImageMaterialTechniqueConfiguration as u,ImageMaterialTechnique as h}from\"../shaders/ImageMaterialTechnique.js\";class c extends t{constructor(e){super(e,p),this.supportsEdges=!0,this.techniqueConfig=new u}getTechniqueConfig(e,t){return this.techniqueConfig.output=e,this.techniqueConfig.cullFace=this.params.cullFace,this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled,this.techniqueConfig.transparent=this.params.transparent,this.techniqueConfig.writeDepth=this.params.writeDepth,this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees,this.techniqueConfig.transparencyPassType=t?t.transparencyPassType:3,this.techniqueConfig.enableOffset=!t||t.camera.relativeElevation<s,this.techniqueConfig.multipassTerrainEnabled=!!t&&t.multipassTerrainEnabled,this.techniqueConfig.cullAboveGround=!!t&&t.cullAboveGround,this.techniqueConfig}intersect(e,t,i,s,a,r,u){n(e,t,s,a,r,void 0,u)}getGLMaterial(e){return 0===e.output||7===e.output||4===e.output?new l(e):void 0}createBufferWriter(){return new a(r)}}class l extends e{constructor(e){super({...e,...e.material.params}),this.updateParameters()}updateParameters(e){const t=this._material.params;this.updateTexture(t.textureId),this._technique=this._techniqueRep.releaseAndAcquire(h,this._material.getTechniqueConfig(this._output,e),this._technique)}beginSlot(e){if(23===e)return!0;if(4===this._output)return 3===e;return e===(this._technique.configuration.transparent?this._technique.configuration.writeDepth?5:8:3)}_updateOccludeeState(e){e.hasOccludees!==this._material.params.sceneHasOcludees&&(this._material.setParameterValues({sceneHasOcludees:e.hasOccludees}),this.updateParameters(e))}ensureParameters(e){0!==this._output&&7!==this._output||this._updateOccludeeState(e),this.updateParameters(e)}bind(e){this.bindTextures(this._technique.program),this.bindTextureScale(this._technique.program),this._technique.bindPass(this._material.params,e)}getPipelineState(e,t){return this._technique.getPipelineState(t)}}const p={transparent:!1,writeDepth:!0,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,opacity:1,textureId:null,initTextureTransparent:!0,...i};export{c as ImageMaterial};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as r}from\"../../chunks/tslib.es6.js\";import e from\"../../core/Logger.js\";import{isAbortError as s}from\"../../core/promiseUtils.js\";import{on as o}from\"../../core/watchUtils.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import\"../../core/has.js\";import\"../../core/accessorSupport/ensureType.js\";import{subclass as i}from\"../../core/accessorSupport/decorators/subclass.js\";const a=a=>{let c=class extends a{initialize(){this.handles.add(o(this,\"layer\",\"refresh\",(()=>{this.doRefresh().catch((r=>{s(r)||e.getLogger(this.declaredClass).error(r)}))})),\"RefreshableLayerView\")}};return r([t()],c.prototype,\"layer\",void 0),c=r([i(\"esri.layers.mixins.RefreshableLayerView\")],c),c};export{a as RefreshableLayerView,a as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../../core/maybe.js\";import{project as r}from\"../../../../geometry/support/webMercatorUtils.js\";import{projectGeometry as o}from\"../../../../portal/support/geometryServiceUtils.js\";function t(t){const l=t.view.spatialReference,s=t.layer.fullExtent,i=s&&s.spatialReference;if(!i)return Promise.resolve(null);if(i.equals(l))return Promise.resolve(s.clone());const n=r(s,l);return e(n)?Promise.resolve(n):t.view.state.isLocal?o(s,l,t.layer.portalItem).then((e=>!t.destroyed&&e?e:void 0)).catch((()=>null)):Promise.resolve(null)}export{t as toViewIfLocal};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{Slice as e}from\"../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl.js\";import{Transform as r}from\"../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl.js\";import{ReadLinearDepth as a}from\"../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl.js\";import{multipassTerrainTest as o}from\"../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl.js\";import{defaultMaskAlphaCutoff as i}from\"../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl.js\";import{ColorConversion as d}from\"../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl.js\";import{glsl as t}from\"../views/3d/webgl-engine/core/shaderModules/interfaces.js\";import{ShaderBuilder as l}from\"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder.js\";function s(s){const n=new l;return n.include(r,{linearDepth:!1}),n.vertex.uniforms.add(\"proj\",\"mat4\").add(\"view\",\"mat4\"),n.attributes.add(\"position\",\"vec3\"),n.attributes.add(\"uv0\",\"vec2\"),n.varyings.add(\"vpos\",\"vec3\"),s.multipassTerrainEnabled&&n.varyings.add(\"depth\",\"float\"),n.vertex.uniforms.add(\"textureCoordinateScaleFactor\",\"vec2\"),n.vertex.code.add(t`\n    void main(void) {\n      vpos = position;\n      ${s.multipassTerrainEnabled?\"depth = (view * vec4(vpos, 1.0)).z;\":\"\"}\n      vTexCoord = uv0 * textureCoordinateScaleFactor;\n      gl_Position = transformPosition(proj, view, vpos);\n    }\n  `),n.include(e,s),s.multipassTerrainEnabled&&(n.fragment.include(a),n.include(o,s)),n.fragment.uniforms.add(\"tex\",\"sampler2D\"),n.fragment.uniforms.add(\"opacity\",\"float\"),n.varyings.add(\"vTexCoord\",\"vec2\"),7===s.output?n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n\n      float alpha = texture2D(tex, vTexCoord).a * opacity;\n      if (alpha  < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = vec4(alpha);\n    }\n    `):(n.fragment.include(d),n.fragment.code.add(t`\n    void main() {\n      discardBySlice(vpos);\n      ${s.multipassTerrainEnabled?\"terrainDepthTest(gl_FragCoord, depth);\":\"\"}\n      gl_FragColor = texture2D(tex, vTexCoord) * opacity;\n\n      if (gl_FragColor.a < ${t.float(i)}) {\n        discard;\n      }\n\n      gl_FragColor = highlightSlice(gl_FragColor, vpos);\n      ${s.OITEnabled?\"gl_FragColor = premultiplyAlpha(gl_FragColor);\":\"\"}\n    }\n    `)),n}var n=Object.freeze({__proto__:null,build:s});export{n as I,s as b};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{width as t,height as e,intersects as n}from\"../../../../geometry/support/aaBoundingRect.js\";import{Geometry as i}from\"../../webgl-engine/lib/Geometry.js\";import r from\"../../webgl-engine/lib/GeometryUtil.js\";function o(n,i,r){const o=t(n)/e(n),a={width:r,height:r};return o>1.0001?a.height=r/o:o<.9999&&(a.width=r*o),a.width=Math.round(a.width/(t(n)/t(i))),a.height=Math.round(a.height/(e(n)/e(i))),a}function a(t){return r.createSquareGeometry([[t[0],t[1],-1],[t[2],t[1],-1],[t[2],t[3],-1],[t[0],t[3],-1]])}function h(t,e){if(!n(t,e))return a(e);const r=[t[1]-e[1],Math.min(t[3],e[3])-Math.max(t[1],e[1]),e[3]-t[3],123456],o=[t[0]-e[0],Math.min(t[2],e[2])-Math.max(t[0],e[0]),e[2]-t[2],123456],h=e[2]-e[0],u=e[3]-e[1],l=o[0]>0&&o[2]>0?3:2,m=r[0]>0&&r[2]>0?3:2,c=(m+1)*(l+1),g=new Float64Array(3*c),w=new Float32Array(2*c),d=new Uint32Array(6*(m*l-1));let f=0,p=0,y=0,x=0,M=0;for(let n=0;n<4;n++){const t=r[n];if(t<=0)continue;let i=0;for(let r=0;r<4;r++){const t=o[r];t<=0||(g[p++]=e[0]+i,g[p++]=e[1]+f,g[p++]=-1,w[y++]=i/h,w[y++]=f/u,r<3&&n<3&&(1!==r||1!==n)&&(d[M++]=x,d[M++]=x+1,d[M++]=x+l+1,d[M++]=x+1,d[M++]=x+l+2,d[M++]=x+l+1),x++,i+=t)}f+=t}const v=new Uint32Array(d.length);return new i([[\"position\",{size:3,data:g,exclusive:!0}],[\"normal\",{size:3,data:s,exclusive:!0}],[\"uv0\",{size:2,data:w,exclusive:!0}]],[[\"position\",d],[\"normal\",v],[\"uv0\",d]])}const s=[0,0,1];export{o as computeImageExportSize,a as createGeometryForExtent,h as createOuterImageGeometry};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.21/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import{forEach as t,result as i}from\"../../../core/asyncUtils.js\";import r from\"../../../core/Logger.js\";import{isNone as a,isSome as s}from\"../../../core/maybe.js\";import{debounce as n,isAbortError as o,eachAlways as l,createAbortController as h,onAbort as m,isAborted as d,createAbortError as c,always as g,throwIfAborted as u}from\"../../../core/promiseUtils.js\";import{whenOnce as p}from\"../../../core/watchUtils.js\";import{property as y}from\"../../../core/accessorSupport/decorators/property.js\";import\"../../../core/has.js\";import\"../../../core/accessorSupport/ensureType.js\";import{subclass as f}from\"../../../core/accessorSupport/decorators/subclass.js\";import x from\"../../../geometry/Extent.js\";import{equals as w,create as _,width as v,height as b,copy as R,intersection as S}from\"../../../geometry/support/aaBoundingRect.js\";import{LayerView3D as E}from\"./LayerView3D.js\";import{computeImageExportSize as j,createGeometryForExtent as I,createOuterImageGeometry as A}from\"./support/overlayImageUtils.js\";import{toViewIfLocal as C}from\"./support/projectExtentUtils.js\";import L from\"../support/debugFlags.js\";import{RenderGeometry as D}from\"../webgl-engine/lib/RenderGeometry.js\";import{Texture as M}from\"../webgl-engine/lib/Texture.js\";import{ImageMaterial as G}from\"../webgl-engine/materials/ImageMaterial.js\";import T from\"../../layers/LayerView.js\";import{RefreshableLayerView as P}from\"../../layers/RefreshableLayerView.js\";const H=r.getLogger(\"esri.views.3d.layers.DynamicLayerView3D\");let O=class extends(P(E(T))){constructor(){super(...arguments),this.drapeSourceType=0,this.updatePolicy=1,this.fullExtentInLocalViewSpatialReference=null,this.maximumDataResolution=null,this._images=new Array,this._extents=new Array,this._overlays=new Array,this.updateWhenStationary=!0,this.refreshDebounced=n((async e=>{await this.doRefresh(e).catch((e=>{o(e)||r.getLogger(this.declaredClass).error(e)}))}),2e3)}initialize(){this.addResolvingPromise(C(this).then((e=>this._set(\"fullExtentInLocalViewSpatialReference\",e)))),this.updatingHandles.add(this,\"suspended\",(()=>this._suspendedChangeHandler())),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks((()=>{this._isScaleRangeActive()&&this.notifyChange(\"suspended\")}),(()=>{}))),this._isScaleRangeLayer()&&this.updatingHandles.add(this.layer,\"scaleRangeId\",(()=>this.notifyChange(\"suspended\")))}destroy(){this.clear()}setDrapingExtent(e,t){this._spatialReference=t,e.forEach((e=>{this._overlays[e.index]=e,this._updateImageExtent(e)}))}_updateImageExtent(e){const t=this._clippedExtent(e.extent,V);if(a(t))return;const i=j(e.extent,t,e.resolution);let r=e.pixelRatio*this.view.pixelRatio;if(\"imageMaxWidth\"in this.layer||\"imageMaxHeight\"in this.layer){const e=this.layer.imageMaxWidth,t=this.layer.imageMaxHeight;if(i.width>e){const t=e/i.width;i.height=Math.floor(i.height*t),i.width=e,r*=t}if(i.height>t){const e=t/i.height;i.width=Math.floor(i.width*e),i.height=t,r*=e}}const s=this._extents[e.index];s&&w(s.extent,t)&&this._imageSizeEquals(t,s.imageSize,i)||(this._extents[e.index]={extent:_(t),imageSize:i,pixelRatio:r},this.suspended||this._fetch(e.index).catch((e=>{o(e)||H.error(e)})))}clear(){for(let e=0;e<this._images.length;e++)this._clearImage(e)}async doRefresh(e){if(this.suspended)return;const t=[];for(let i=0;i<this._extents.length;i++)this._extents[i]&&t.push(this._fetch(i,e));await l(t)}canResume(){if(!super.canResume())return!1;if(this._isScaleRangeLayer()){const{minScale:e,maxScale:t}=this.layer;if(e>0||t>0){const i=this.view.scale;if(i<t||e>0&&i>e)return!1}}return!0}isUpdating(){return this._images.some((e=>!!e.loadingPromise))}async processResult(e,t,i){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)}findExtentInfoAt(e){for(const t of this._extents){const i=t.extent;if(new x(i[0],i[1],i[2],i[3],this._spatialReference).contains(e))return t}return null}getFetchOptions(){}async redraw(e,i){await t(this._images,(async(t,r)=>{t&&(await e(t,i),await this._createStageObjects(r,t.image))}))}_imageSizeEquals(e,t,i){if(!this.maximumDataResolution||L.TESTS_DISABLE_UPDATE_THRESHOLDS)return!1;const r=v(e)/this.maximumDataResolution.x,a=b(e)/this.maximumDataResolution.y,s=r/t.width,n=a/t.height,o=r/i.width,l=a/i.height,h=Math.abs(s-o),m=Math.abs(n-l);return h<=1.5&&m<=1.5}async _fetch(e,t){if(this.suspended)return;const i=this._extents[e],r=i.extent;this._images[e]||(this._images[e]={texture:null,material:null,renderGeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:_(r)});const a=this._images[e];a.loadingAbortController&&(a.loadingAbortController.abort(),a.loadingAbortController=null);const s=new x(r[0],r[1],r[2],r[3],this._spatialReference);if(0===s.width||0===s.height)return void this._clearImage(e);const n=h();a.loadingAbortController=n,m(t,(()=>n.abort()));const l=n.signal,u=this._waitFetchReady(l).then((()=>{const t={requestAsImageElement:!0,pixelRatio:this._overlays[e].pixelRatio,...this.getFetchOptions(),signal:l},{height:r,width:a}=i.imageSize;return this.layer.fetchImage(s,a,r,t)})).then((e=>{if(d(l))throw H.warnOnce(\"A call to fetchImage resolved even though the request was aborted. fetchImage should not resolve if options.signal.aborted is true.\"),c();return this.processResult(a,e)})).then((()=>R(a.renderExtent,r)));a.loadingPromise=u,g(u,(()=>{u===a.loadingPromise&&(a.loadingPromise=null,a.loadingAbortController=null)})),this.notifyChange(\"updating\"),await u.then((async()=>{await this._createStageObjects(e,a.image),this.notifyChange(\"updating\")})).catch((e=>{throw e&&!o(e)&&H.error(e),this.notifyChange(\"updating\"),e}))}_clearImage(e){const t=this._images[e];if(t){s(t.renderGeometry)&&(this.view.basemapTerrain.overlayManager.renderer.removeGeometries([t.renderGeometry],this,2),t.renderGeometry=null);const e=this.view._stage;e.remove(t.texture),t.texture=null,e.remove(t.material),t.material=null,t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null}}async _createStageObjects(e,t){const r=this.view._stage,n=this._images[e],o=this.view.basemapTerrain.overlayManager.renderer,l=()=>{r.remove(n.texture),n.texture=null,s(n.renderGeometry)&&(o.removeGeometries([n.renderGeometry],this,2),n.renderGeometry=null)};if(t){const s=new M(t,{width:t.width,height:t.height,preMultiplyAlpha:!0,wrap:{s:33071,t:33071}});let h;if(await i(this._images[0===e?1:0].loadingPromise),0===e)h=I(n.renderExtent);else{const e=this._images[0].renderExtent;if(!e)return void l();h=A(e,n.renderExtent)}l(),r.add(s),n.texture=s,a(n.material)?(n.material=new G({transparent:!0,textureId:s.id}),r.add(n.material)):n.material.setParameterValues({textureId:s.id}),n.renderGeometry=new D(h,n.material),n.renderGeometry.origin=this._overlays[e].renderLocalOrigin,o.addGeometries([n.renderGeometry],this,2)}else l(),r.remove(n.material),n.material=null}_isScaleRangeLayer(){return\"minScale\"in this.layer&&\"maxScale\"in this.layer}_isScaleRangeActive(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)}_clippedExtent(e,t){if(\"local\"!==this.view.viewingMode)return R(t,e);const i=this.view.basemapTerrain;return i.ready?S(e,i.extent,t):R(t,e)}_suspendedChangeHandler(){this.suspended?this.clear():this.refreshDebounced()}async _waitFetchReady(e){await p(this.view,\"stationary\",e),u(e)}};e([y()],O.prototype,\"layer\",void 0),e([y()],O.prototype,\"suspended\",void 0),e([y({readOnly:!0})],O.prototype,\"fullExtentInLocalViewSpatialReference\",void 0),e([y()],O.prototype,\"updating\",void 0),O=e([f(\"esri.views.3d.layers.DynamicLayerView3D\")],O);const V=_();var U=O;export{U as default};\n"],"sourceRoot":""}