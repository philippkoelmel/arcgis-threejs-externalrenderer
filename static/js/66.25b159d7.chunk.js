(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[66],{1130:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return tn}));var n=r(13),i=r(8),a=r.n(i),s=r(16),o=r(2),c=r(4),u=r(6),l=r(7),h=r(0),f=r(22),v=r(17),d=r(15),y=r(3),p=r(23),m=r(1),_=(r(18),r(11)),b=r(583),g=r(55),x=r(20),O=r(33),j=r(30),k=r(855);var w=new Set,M=[],S=new Map,T=[0,0],I=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e))._keyToItem=new Map,n.concurrency=6,n.strategy="scale-first",n.tileInfoView=null,n}return Object(c.a)(r,[{key:"initialize",value:function(){var e=this,t=this.concurrency,r=this.process;this._queue=new k.a({concurrency:t,process:function(t,n){var i=e._keyToItem.get(t);return r(i,{signal:n})},peeker:function(e){return e.values().next().value}})}},{key:"destroy",value:function(){this.clear(),this._queue.destroy(),this._queue=null}},{key:"length",get:function(){return this._queue?this._queue.length:0}},{key:"onGoingCount",get:function(){return this._keyToItem.size}},{key:"updating",get:function(){return this.length>0||this.onGoingCount>0}},{key:"abort",value:function(e){var t="string"==typeof e?e:e.id;this._queue.abort(t)}},{key:"clear",value:function(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}},{key:"has",value:function(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}},{key:"isOngoing",value:function(e){var t="string"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}},{key:"pause",value:function(){this._queue.pause()}},{key:"push",value:function(e,t){var r=this,n=e.key.id+"-"+t;if(this.has(n))return this.get(n);var i=this._queue.push(n),a=function(){r._keyToItem.delete(n),r.notifyChange("updating")};return this._keyToItem.set(n,e),i.then(a,a),this.notifyChange("updating"),i}},{key:"reset",value:function(){this._queue.reset(),this.notifyChange("updating")}},{key:"resume",value:function(){this._queue.resume()}},{key:"_peekByScaleFirst",value:function(e){var t=this;if(!this.state)return e.values().next().value;var r=this.tileInfoView,n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;e.forEach((function(e){var r=t._keyToItem.get(e),a=t.tileInfoView.getTileScale(r.key);S.has(a)||(S.set(a,[]),n=Math.max(a,n),i=Math.min(a,i)),S.get(a).push(r.key),w.add(a)}));var a=this.state.scale;S.has(a)||(function(e,t){e.length=0,t.forEach((function(t){return e.push(t)}))}(M,w),M.sort(),a=M.reduce((function(e,t){return Math.abs(t-a)<Math.abs(e-a)?t:e}),M[0])),a=Math.min(a,n),a=Math.max(a,i);var s=S.get(a),o=r.getClosestInfoForScale(a),c=o.getColumnForX(this.state.center[0]),u=o.getRowForY(this.state.center[1]);return s.sort((function(e,t){var r=o.denormalizeCol(e.col,e.world),n=o.denormalizeCol(t.col,t.world);return Math.sqrt((c-r)*(c-r)+(u-e.row)*(u-e.row))-Math.sqrt((c-n)*(c-n)+(u-t.row)*(u-t.row))})),w.clear(),S.clear(),s[0].id}},{key:"_peekByCenterFirst",value:function(e){var t=this;if(!this.state)return e.values().next().value;var r=this.tileInfoView,n=this.state.center,i=Number.POSITIVE_INFINITY,a=null;return e.forEach((function(e){var s=t._keyToItem.get(e);r.getTileCoords(T,s.key);var o=Object(j.d)(T,n);o<i&&(i=o,a=s.key)})),a.id}}]),r}(O.a);Object(h.a)([Object(m.b)({constructOnly:!0})],I.prototype,"concurrency",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],I.prototype,"process",void 0),Object(h.a)([Object(m.b)()],I.prototype,"state",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],I.prototype,"strategy",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],I.prototype,"tileInfoView",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],I.prototype,"updating",null);I=Object(h.a)([Object(_.a)("esri.views.2d.tiling.PagedTileQueue")],I),r(996);var L=r(586);var z=new Set,C=[],P=new Map,V=[0,0],E=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this,e))._keyToItem=new Map,n.concurrency=6,n.strategy="scale-first",n.tileInfoView=null,n}return Object(c.a)(r,[{key:"initialize",value:function(){var e=this,t=this.concurrency,r=this.process,n=this.strategy;this._queue=new k.a({concurrency:t,process:function(t,n){var i=e._keyToItem.get(t);return r(i,{signal:n})},peeker:"scale-first"===n?function(t){return e._peekByScaleFirst(t)}:function(t){return e._peekByCenterFirst(t)}})}},{key:"destroy",value:function(){this.clear(),this._queue.destroy(),this._queue=null}},{key:"length",get:function(){return this._queue?this._queue.length:0}},{key:"onGoingCount",get:function(){return this._keyToItem.size}},{key:"updating",get:function(){return this.length>0||this.onGoingCount>0}},{key:"abort",value:function(e){var t="string"==typeof e?e:e.id;this._queue.abort(t)}},{key:"clear",value:function(){this._queue.clear(),this._keyToItem.clear(),this.notifyChange("updating")}},{key:"has",value:function(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}},{key:"isOngoing",value:function(e){var t="string"==typeof e?e:e.id;return this.has(t)&&this._queue.isOngoing(t)}},{key:"pause",value:function(){this._queue.pause()}},{key:"push",value:function(e){var t=this,r=e.key.id;if(this._queue.has(r))return this._queue.get(r);var n=this._queue.push(r),i=function(){t._keyToItem.delete(r),t.notifyChange("updating")};return this._keyToItem.set(r,e),n.then(i,i),this.notifyChange("updating"),n}},{key:"reset",value:function(){this._queue.reset()}},{key:"resume",value:function(){this._queue.resume()}},{key:"_peekByScaleFirst",value:function(e){var t=this;if(!this.state)return e.values().next().value;var r=this.tileInfoView,n=Number.NEGATIVE_INFINITY,i=Number.POSITIVE_INFINITY;e.forEach((function(e){var r=t._keyToItem.get(e),a=t.tileInfoView.getTileScale(r.key);P.has(a)||(P.set(a,[]),n=Math.max(a,n),i=Math.min(a,i)),P.get(a).push(r.key),z.add(a)}));var a=this.state.scale;P.has(a)||(function(e,t){e.length=0,t.forEach((function(t){return e.push(t)}))}(C,z),C.sort(),a=C.reduce((function(e,t){return Math.abs(t-a)<Math.abs(e-a)?t:e}),C[0])),a=Math.min(a,n),a=Math.max(a,i);var s=P.get(a),o=r.getClosestInfoForScale(a),c=o.getColumnForX(this.state.center[0]),u=o.getRowForY(this.state.center[1]);return s.sort((function(e,t){var r=o.denormalizeCol(e.col,e.world),n=o.denormalizeCol(t.col,t.world);return Math.sqrt((c-r)*(c-r)+(u-e.row)*(u-e.row))-Math.sqrt((c-n)*(c-n)+(u-t.row)*(u-t.row))})),z.clear(),P.clear(),s[0].id}},{key:"_peekByCenterFirst",value:function(e){var t=this;if(!this.state)return e.values().next().value;var r=this.tileInfoView,n=this.state.center,i=Number.POSITIVE_INFINITY,a=null;return e.forEach((function(e){var s=t._keyToItem.get(e);r.getTileCoords(V,s.key);var o=Object(j.d)(V,n);o<i&&(i=o,a=s.key)})),a.id}}]),r}(O.a);Object(h.a)([Object(m.b)({constructOnly:!0})],E.prototype,"concurrency",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],E.prototype,"process",void 0),Object(h.a)([Object(m.b)()],E.prototype,"state",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],E.prototype,"strategy",void 0),Object(h.a)([Object(m.b)({constructOnly:!0})],E.prototype,"tileInfoView",void 0),Object(h.a)([Object(m.b)({readOnly:!0})],E.prototype,"updating",null);E=Object(h.a)([Object(_.a)("esri.views.2d.tiling.TileQueue")],E),r(42);r(895),new L.a(0,0,0,0),new Map;var R=r(739),A=r(741),F=r(762),W=new Map;W.set(A.c.MARKER,{multiplier:1,indicesPerRecord:6,verticesPerRecord:4}),W.set(A.c.LINE,{multiplier:1,indicesPerRecord:24,verticesPerRecord:8}),W.set(A.c.FILL,{multiplier:1,indicesPerRecord:10,verticesPerRecord:10}),W.set(A.c.TEXT,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4}),W.set(A.c.LABEL,{multiplier:8,indicesPerRecord:6,verticesPerRecord:4});var B=function(){function e(t,r){Object(o.a)(this,e),this._pos=0;var n=r?this._roundToNearest(r,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(n),this._buffer=new t(this._array),this._ctor=t,this._i16View=new Int16Array(this._array)}return Object(c.a)(e,[{key:"length",get:function(){return this._pos}},{key:"_roundToNearest",value:function(e,t){var r=Math.round(e);return r+(t-r%t)}},{key:"_ensureSize",value:function(e){if(this._pos+e>=this._buffer.length){var t=this._roundToNearest(1.5*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),r=new ArrayBuffer(t),n=new this._ctor(r);n.set(this._buffer,0),this._array=r,this._buffer=n,this._i16View=new Int16Array(this._array)}}},{key:"ensureSize",value:function(e){this._ensureSize(e)}},{key:"writeF32",value:function(e){this._ensureSize(1);var t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}},{key:"push",value:function(e){this._ensureSize(1);var t=this._pos;return this._buffer[this._pos++]=e,t}},{key:"writeFixed",value:function(e){this._buffer[this._pos++]=e}},{key:"setValue",value:function(e,t){this._buffer[e]=t}},{key:"i1616Add",value:function(e,t,r){this._i16View[2*e]+=t,this._i16View[2*e+1]+=r}},{key:"getValue",value:function(e){return this._buffer[e]}},{key:"incr",value:function(e){if(this._buffer.length<e)throw new Error("Increment index overflows the target buffer");this._buffer[e]++}},{key:"decr",value:function(e){this._buffer[e]--}},{key:"writeRegion",value:function(e){this._ensureSize(e.length);var t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}},{key:"writeManyFrom",value:function(e,t,r){this._ensureSize(r-t);for(var n=t;n!==r;n++)this.writeFixed(e._buffer[n])}},{key:"buffer",value:function(){var e=this._array.slice(0,4*this._pos);return this.destroy(),e}},{key:"toArray",value:function(){for(var e=this._array,t=[],r=0;r<e.byteLength/4;r++)t.push(e[r]);return t}},{key:"seek",value:function(e){this._pos=e}},{key:"destroy",value:function(){this._array=null,this._buffer=null}}]),e}(),D=function(){function e(t,r,n){Object(o.a)(this,e),this._start={index:0,vertex:0};var i=function(e,t,r){var n=W.get(e),i=n.indicesPerRecord,a=n.multiplier,s=n.verticesPerRecord;return{recordBytes:r*R.d*Uint32Array.BYTES_PER_ELEMENT,indexBytes:a*i*r*Uint32Array.BYTES_PER_ELEMENT,vertexBytes:a*s*r*t}}(t,r,n),a=r/4;this.geometryType=t,this._records=new B(Int32Array,i.recordBytes),this._indices=new B(Uint32Array,i.indexBytes),this._vertices=new B(Uint32Array,i.vertexBytes),this._metrics=new B(Float32Array,0),this._strideInt=a}return Object(c.a)(e,[{key:"serialize",value:function(e){var t=this._records.buffer(),r=this._indices.buffer(),n=this._vertices.buffer(),i=this._metrics.length?this._metrics.buffer():null,a=4*this._strideInt;return e.push(t,r,n),{stride:a,records:t,indices:r,vertices:n,metrics:i}}},{key:"strideInt",get:function(){return this._strideInt}},{key:"recordCount",get:function(){return this._records.length/R.d}},{key:"vertexCount",get:function(){return this._vertices.length/this._strideInt}},{key:"indexCount",get:function(){return this._indices.length}},{key:"indexWriter",get:function(){return this._indices}},{key:"vertexWriter",get:function(){return this._vertices}},{key:"metricWriter",get:function(){return this._metrics}},{key:"vertexEnsureSize",value:function(e){this._vertices.ensureSize(e)}},{key:"indexEnsureSize",value:function(e){this._indices.ensureSize(e)}},{key:"recordStart",value:function(){this._start.index=this._indices.length,this._start.vertex=this._vertices.length}},{key:"recordEnd",value:function(e,t,r,n,i,a,s,o){this._records.push(e),this._records.push(t),this._records.push(r),this._records.push(n),this._records.push(i),this._records.push(a),this._records.push(s),this._records.writeF32(o)}},{key:"writeIndex",value:function(e){this._indices.push(e)}},{key:"writeVertex",value:function(e){this._vertices.push(e)}},{key:"writeVertexF32",value:function(e){this._vertices.writeF32(e)}},{key:"copyLastFrom",value:function(e,t,r){for(var n=e._records.length-R.d,i=e._records.getValue(n),a=e._records.getValue(n+1),s=e._records.getValue(n+2),o=e._records.getValue(n+4),c=e._records.getValue(n+6),u=e._records.getValue(n+7),l=this._vertices.length,h=(e._start.vertex-this._vertices.length)/this._strideInt,f=this._indices.length,v=this.vertexCount,d=e._start.index;d!==e._indices.length;d++){var y=e._indices.getValue(d);this._indices.push(y-h)}for(var p=e._start.vertex;p!==e._vertices.length;p++){var m=e._vertices.getValue(p);this._vertices.push(m)}for(var _=l;_<=this._vertices.length;_+=this._strideInt)this._vertices.i1616Add(_,t,r);this._records.push(i),this._records.push(a),this._records.push(s),this._records.push(f),this._records.push(o),this._records.push(v),this._records.push(c),this._records.push(u)}}]),e}(),K=r(872),G=r(935),N=128;function Z(e){switch(e){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case N:return 1}}function U(e){switch(e){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case N:return 1}}var X,q,Y,H=function(){function e(t,r,n,i,a){Object(o.a)(this,e),this._hasDotDensity=!1,this._hasAggregate=!1,this.hasRecords=!1,this._data={self:new Map,neighbors:new Array},this._current={geometryType:0,writer:null,overlaps:0,start:0,insertAfter:0,sortKey:0,id:0,materialKey:0,indexStart:0,vertStart:0,isDotDensity:!1,bufferingEnabled:!1,metricBoxLenPointer:0},this.hint=r,this.tileKey=t,this._hasDotDensity=n,this._hasAggregate=i,this._pixelBufferEnabled=a}return Object(c.a)(e,[{key:"hasAggregates",get:function(){return this._hasAggregate}},{key:"hasPixelBufferEnabled",get:function(){return this._pixelBufferEnabled}},{key:"serialize",value:function(e){var t=this,r=[];return r.push(this._serializeTileVertexData(this.tileKey,this.tileKey,this._data.self)),this._data.neighbors.forEach((function(n,i){var a=1<<i,s=Z(a),o=U(a),c=Object(G.a)(new L.a(t.tileKey),s,o,e),u=t._serializeTileVertexData(t.tileKey,c.id,n.vertexData);u.message.bufferIds=n.displayIds,r.push(u)})),r}},{key:"_serializeTileVertexData",value:function(e,t,r){var n,i,a,s,o,c,u=new Array;return{message:{tileKeyOrigin:e,tileKey:t,data:(n={},Object(x.a)(n,A.c.MARKER,null==(i=r.get(A.c.MARKER))?void 0:i.serialize(u)),Object(x.a)(n,A.c.FILL,null==(a=r.get(A.c.FILL))?void 0:a.serialize(u)),Object(x.a)(n,A.c.LINE,null==(s=r.get(A.c.LINE))?void 0:s.serialize(u)),Object(x.a)(n,A.c.TEXT,null==(o=r.get(A.c.TEXT))?void 0:o.serialize(u)),Object(x.a)(n,A.c.LABEL,null==(c=r.get(A.c.LABEL))?void 0:c.serialize(u)),n)},transferList:u}}},{key:"featureStart",value:function(e,t){this._current.insertAfter=e,this._current.sortKey=t}},{key:"featureEnd",value:function(){}},{key:"recordStart",value:function(e,t,r,n,i){this._current.writer=this._getVertexWriter(r,n),this._current.overlaps=0,this._current.indexStart=this._current.writer.indexCount,this._current.vertStart=this._current.writer.vertexCount,this._current.bufferingEnabled=i,this._current.id=e,this._current.materialKey=t,this._current.geometryType=r,this._current.isDotDensity=!1,this._current.writer.recordStart()}},{key:"recordCount",value:function(){return this._current.writer.recordCount}},{key:"vertexCount",value:function(){return this._current.writer.vertexCount}},{key:"indexCount",value:function(){return this._current.writer.indexCount}},{key:"vertexEnsureSize",value:function(e){this._current.writer.vertexEnsureSize(e)}},{key:"indexEnsureSize",value:function(e){this._current.writer.indexEnsureSize(e)}},{key:"vertexBounds",value:function(e,t,r,n){this._current.bufferingEnabled&&this._addOverlap(e,t,r,n)}},{key:"vertexWrite",value:function(e){this._current.writer.writeVertex(e)}},{key:"vertexWriteF32",value:function(e){this._current.writer.writeVertexF32(e)}},{key:"vertexEnd",value:function(){}},{key:"vertexWriter",value:function(){return this._current.writer.vertexWriter}},{key:"indexWrite",value:function(e){this._current.writer.writeIndex(e)}},{key:"indexWriter",value:function(){return this._current.writer.indexWriter}},{key:"metricWriter",value:function(){return this._current.writer.metricWriter}},{key:"metricStart",value:function(e,t,r,n,i,a,s,o){this._current.writer=this._getVertexWriter(A.c.LABEL,!1);var c=this._current.writer.metricWriter;c.push(Object(K.b)(e)),c.push(t),c.push(r),c.push(n),c.push(i),c.push(a),c.push(s),c.push(o),c.push(255),this._current.metricBoxLenPointer=c.push(0)}},{key:"metricEnd",value:function(){var e=this._current.writer.metricWriter;0===e.getValue(this._current.metricBoxLenPointer)&&e.seek(e.length-10)}},{key:"metricBoxWrite",value:function(e,t,r,n){var i=this._current.writer.metricWriter;i.incr(this._current.metricBoxLenPointer),i.push(0),i.push(0),i.push(e),i.push(t),i.push(r),i.push(n)}},{key:"recordEnd",value:function(){var e=this._current.indexStart,t=this._current.writer.indexCount;if(e===t)return!1;this.hasRecords=!0;var r=t-e,n=this._current.vertStart,i=this._current.writer.vertexCount-n;if(this._current.writer.recordEnd(this._current.id,this._current.materialKey,this._current.insertAfter,e,r,n,i,this._current.sortKey),!this._pixelBufferEnabled||this._hasAggregate||0===this._current.overlaps||this._current.geometryType===A.c.LABEL)return!0;for(var a=this._current.writer,s=0;s<8;s++){var o=1<<s;if(this._current.overlaps&o){this._data.neighbors[s]||(this._data.neighbors[s]={vertexData:new Map,displayIds:new Set});var c=this._data.neighbors[s],u=this._current.geometryType;if(!c.vertexData.has(u)){var l=Object(F.e)(u,this._current.isDotDensity).geometry,h=new D(u,l,R.j);c.vertexData.set(u,h)}var f=c.vertexData.get(this._current.geometryType),v=512*-Z(o)*8,d=512*-U(o)*8;f.copyLastFrom(a,v,d),c.displayIds.add(this._current.id)}}return!0}},{key:"_addOverlap",value:function(e,t,r,n){var i=255^((e<0+r?148:e>=R.v-r?41:189)|(t<0+n?224:t>=R.v-n?7:231));this._current.overlaps|=i}},{key:"_getVertexWriter",value:function(e,t){if(!this._data.self.has(e)){var r=this._data.self,n=Object(F.e)(e,this._hasDotDensity).geometry;r.set(e,new D(e,n,this.hint.records))}return this._data.self.get(e)}}]),e}(),J=r(858),Q=r(34),$=r(21),ee=r(31);function te(e){switch(e){case"left":return X.Left;case"right":return X.Right;case"center":case"justify":return X.Center}}function re(e){switch(e){case"top":return q.Top;case"middle":return q.Center;case"baseline":return q.Baseline;case"bottom":return q.Bottom}}function ne(e){switch(e){case"left":return X.Left;case"right":return X.Right;case"center":case"justify":return X.Center}}(Y=X||(X={}))[Y.Left=-1]="Left",Y[Y.Center=0]="Center",Y[Y.Right=1]="Right",function(e){e[e.Top=1]="Top",e[e.Center=0]="Center",e[e.Bottom=-1]="Bottom",e[e.Baseline=2]="Baseline"}(q||(q={}));var ie=r(758),ae=r(744),se=r(745),oe=r(862),ce=100;function ue(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function le(e,t){return Math.sqrt(e*e+t*t)}function he(e){var t=le(e[0],e[1]);e[0]/=t,e[1]/=t}function fe(e,t){return le(e[0]-t[0],e[1]-t[1])}function ve(e){return"function"==typeof e}function de(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;return 1/Math.max(e,1)}function ye(e,t){return[!!e.minScale&&t.scaleToZoom(e.minScale)||0,!!e.maxScale&&t.scaleToZoom(e.maxScale)||ce]}function pe(e,t){return e[t+1]}function me(e){return e.length-1}function _e(e){for(var t=0,r=0;r<me(e);r++)t+=be(e,r);return t}function be(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=pe(e,t),i=Object(Q.a)(n,2),a=i[0],s=i[1];return Math.sqrt(a*a+s*s)*r}var ge=function(){function e(t,r,n,i,a){Object(o.a)(this,e),this._segments=t,this._index=r,this._distance=n,this._xStart=i,this._yStart=a,this._done=!1}return Object(c.a)(e,[{key:"clone",value:function(){return new e(this._segments,this._index,this._distance,this.xStart,this.yStart)}},{key:"equals",value:function(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}},{key:"leq",value:function(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}},{key:"geq",value:function(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}},{key:"_segment",get:function(){return this._segments[this._index+1]}},{key:"angle",get:function(){var e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length),r=Math.acos(t);return e>0&&(r=2*Math.PI-r),r}},{key:"xStart",get:function(){return this._xStart}},{key:"yStart",get:function(){return this._yStart}},{key:"x",get:function(){return this.xStart+this.distance*this.dx}},{key:"y",get:function(){return this.yStart+this.distance*this.dy}},{key:"dx",get:function(){return this._segment[0]}},{key:"dy",get:function(){return this._segment[1]}},{key:"xMidpoint",get:function(){return this.xStart+.5*this.dx}},{key:"yMidpoint",get:function(){return this.yStart+.5*this.dy}},{key:"xEnd",get:function(){return this.xStart+this.dx}},{key:"yEnd",get:function(){return this.yStart+this.dy}},{key:"length",get:function(){var e=this.dx,t=this.dy;return Math.sqrt(e*e+t*t)}},{key:"remainingLength",get:function(){return this.length*(1-this._distance)}},{key:"backwardLength",get:function(){return this.length*this._distance}},{key:"distance",get:function(){return this._distance}},{key:"done",get:function(){return this._done}},{key:"hasPrev",value:function(){return this._index-1>=0}},{key:"hasNext",value:function(){return this._index+1<me(this._segments)}},{key:"next",value:function(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}},{key:"prev",value:function(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}},{key:"_seekBackwards",value:function(e,t){var r=this.backwardLength;if(e<=r)return this._distance=(r-e)/this.length,this;for(var n=this.backwardLength;this.prev();){if(n+this.length>e)return this._seekBackwards(e-n);n+=this.length}return this._distance=0,t?this:null}},{key:"seek",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;for(var r=this.remainingLength;this.next();){if(r+this.length>e)return this.seek(e-r,t);r+=this.length}return this._distance=1,t?this:null}}],[{key:"create",value:function(t){return new e(t,0,0,t[0][0],t[0][1])}}]),e}();function xe(e,t,r){var n=_e(e),i=ge.create(e),a=n/2,s=(n-t)/2,o=Math.floor(s/t),c=a-o*t;i.seek(c);for(var u=-o;u<=o;u++)i.x<512&&i.x>=0&&i.y<512&&i.y>=0&&r(i.clone(),u,a+u*t,n),i.seek(t)}function Oe(e,t){var r=1e-6;if(!(t<=0)){var n=e.length;if(!(n<3)){var i=[],a=0;i.push(0);for(var s=1;s<n;s++)a+=fe(e[s],e[s-1]),i.push(a);t=Math.min(t,.2*a);var o=[];o.push(e[0][0]),o.push(e[0][1]);var c=e[n-1][0],u=e[n-1][1],l=ue([0,0],e[0],e[1]);he(l),e[0][0]+=t*l[0],e[0][1]+=t*l[1],ue(l,e[n-1],e[n-2]),he(l),e[n-1][0]+=t*l[0],e[n-1][1]+=t*l[1];for(var h=1;h<n;h++)i[h]+=t;i[n-1]+=t;for(var f=.5*t,v=1;v<n-1;v++){for(var d=0,y=0,p=0,m=v-1;m>=0&&!(i[m+1]<i[v]-f);m--){var _=f+i[m+1]-i[v],b=i[m+1]-i[m],g=i[v]-i[m]<f?1:_/b;if(Math.abs(g)<r)break;var x=g*g,O=g*_-.5*x*b,j=g*b/t,k=e[m+1],w=e[m][0]-k[0],M=e[m][1]-k[1];d+=j/O*(k[0]*g*_+.5*x*(_*w-b*k[0])-x*g*b*w/3),y+=j/O*(k[1]*g*_+.5*x*(_*M-b*k[1])-x*g*b*M/3),p+=j}for(var S=v+1;S<n&&!(i[S-1]>i[v]+f);S++){var T=f-i[S-1]+i[v],I=i[S]-i[S-1],L=i[S]-i[v]<f?1:T/I;if(Math.abs(L)<r)break;var z=L*L,C=L*T-.5*z*I,P=L*I/t,V=e[S-1],E=e[S][0]-V[0],R=e[S][1]-V[1];d+=P/C*(V[0]*L*T+.5*z*(T*E-I*V[0])-z*L*I*E/3),y+=P/C*(V[1]*L*T+.5*z*(T*R-I*V[1])-z*L*I*R/3),p+=P}o.push(d/p),o.push(y/p)}o.push(c),o.push(u);for(var A=0,F=0;A<n;A++)e[A][0]=o[F++],e[A][1]=o[F++]}}}var je=r(417),ke=r(755),we=r(936),Me=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"getPlacement",value:function(e,t,r){var n=Object(we.b)(t);if(!n)return null;var i=Object(ke.c)(e);return n.execute(i,t,r)}}]),e}(),Se=r(179),Te=r(597),Ie=r(248),Le=r(810),ze=function(){function e(t,r,n,i){Object(o.a)(this,e),this.center=Object(Ie.b)(t,r),this.centerT=Object(Ie.a)(),this.halfWidth=n/2,this.halfHeight=i/2,this.width=n,this.height=i}return Object(c.a)(e,[{key:"x",get:function(){return this.center[0]},set:function(e){this.center[0]=e}},{key:"y",get:function(){return this.center[1]},set:function(e){this.center[1]=e}},{key:"blX",get:function(){return this.center[0]+this.halfWidth}},{key:"blY",get:function(){return this.center[1]+this.halfHeight}},{key:"trX",get:function(){return this.center[0]-this.halfWidth}},{key:"trY",get:function(){return this.center[1]-this.halfHeight}},{key:"xmin",get:function(){return this.x-this.halfWidth}},{key:"xmax",get:function(){return this.x+this.halfWidth}},{key:"ymin",get:function(){return this.y-this.halfHeight}},{key:"ymax",get:function(){return this.y+this.halfHeight}},{key:"clone",value:function(){return new e(this.x,this.y,this.width,this.height)}},{key:"serialize",value:function(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}},{key:"findCollisionDelta",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,r=Math.abs(e.centerT[0]-this.centerT[0]),n=Math.abs(e.centerT[1]-this.centerT[1]),i=(e.halfWidth+this.halfWidth+t)/r,a=(e.halfHeight+this.halfHeight+t)/n,s=Math.min(i,a);return Object($.n)(s)}},{key:"extend",value:function(e){var t=Math.min(this.xmin,e.xmin),r=Math.min(this.ymin,e.ymin),n=Math.max(this.xmax,e.xmax)-t,i=Math.max(this.ymax,e.ymax)-r,a=t+n/2,s=r+i/2;this.width=n,this.height=i,this.halfWidth=n/2,this.halfHeight=i/2,this.x=a,this.y=s}}],[{key:"deserialize",value:function(t){return new e(t.readF32(),t.readF32(),t.readInt32(),t.readInt32())}}]),e}(),Ce=Math.PI/180,Pe=function(){function e(t,r,n,i){Object(o.a)(this,e),this._rotationT=Object(Te.a)(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;var a=n.rect,s=new Float32Array(8);t*=i,r*=i;var c=n.code?a.width*i:n.metrics.width,u=n.code?a.height*i:n.metrics.height;s[0]=t,s[1]=r,s[2]=t+c,s[3]=r,s[4]=t,s[5]=r+u,s[6]=t+c,s[7]=r+u,this._data=s,this._setTextureCoords(a),this._scale=i,this._mosaic=n,this.x=t,this.y=r,this.maxOffset=Math.max(t+c,r+u)}return Object(c.a)(e,[{key:"width",get:function(){return this._mosaic.metrics.width*this._scale}},{key:"mosaic",get:function(){return this._mosaic}},{key:"angle",get:function(){return this._angle},set:function(e){this._angle=e,Object(Se.d)(this._rotationT),Object(Se.f)(this._rotationT,this._rotationT,-e),this._setOffsets(this._data)}},{key:"xTopLeft",get:function(){return this._data[0]}},{key:"yTopLeft",get:function(){return this._data[1]}},{key:"xBottomRight",get:function(){return this._data[6]}},{key:"yBottomRight",get:function(){return this._data[7]}},{key:"texcoords",get:function(){return this._texcoords}},{key:"textureBinding",get:function(){return this._mosaic.textureBinding}},{key:"offsets",get:function(){return this._offsets||this._setOffsets(this._data),this._offsets}},{key:"char",get:function(){return String.fromCharCode(this._mosaic.code)}},{key:"code",get:function(){return this._mosaic.code}},{key:"bounds",get:function(){if(!this._bounds){var e=this._mosaic.metrics,t=e.height,r=e.width*this._scale,n=Math.abs(t)*this._scale,i=new Float32Array(8);i[0]=this.x,i[1]=this.y,i[2]=this.x+r,i[3]=this.y,i[4]=this.x,i[5]=this.y+n,i[6]=this.x+r,i[7]=this.y+n;var a=Object(Se.e)(Object(Te.a)(),this._rotationT,this._T);Object(Te.b)(i,i,a);for(var s=1/0,o=1/0,c=0,u=0,l=0;l<4;l++){var h=i[2*l],f=i[2*l+1];s=Math.min(s,h),o=Math.min(o,f),c=Math.max(c,h),u=Math.max(u,f)}var v=c-s,d=u-o,y=s+v/2,p=o+d/2;this._bounds=new ze(y,p,v,d)}return this._bounds}},{key:"setTransform",value:function(e){this._T=e,this._offsets=null}},{key:"_setOffsets",value:function(e){this._offsets||(this._offsets={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0});var t=this._offsets,r=new Float32Array(8),n=Object(Se.e)(Object(Te.a)(),this._rotationT,this._T);Object(Te.b)(r,e,n),t.upperLeft=Object(ae.a)(8*r[0],8*r[1]),t.upperRight=Object(ae.a)(8*r[2],8*r[3]),t.lowerLeft=Object(ae.a)(8*r[4],8*r[5]),t.lowerRight=Object(ae.a)(8*r[6],8*r[7])}},{key:"_setTextureCoords",value:function(e){var t=e.x,r=e.y,n=e.width,i=e.height;this._texcoords={upperLeft:Object(ae.a)(t,r),upperRight:Object(ae.a)(t+n,r),lowerLeft:Object(ae.a)(t,r+i),lowerRight:Object(ae.a)(t+n,r+i)}}}]),e}(),Ve=function(e,t){return{code:0,page:0,sdf:!0,rect:new Le.a(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}}},Ee=function(){function e(t,r,i){Object(o.a)(this,e),this._rotation=0,this._decorate(t,r,i),this.glyphs=t,this.bounds=this._createBounds(t),this.isMultiline=r.length>1,this._hasRotation=0!==i.angle,this._T=this._createGlyphTransform(this.bounds,i);var a,s=Object(n.a)(t);try{for(s.s();!(a=s.n()).done;){a.value.setTransform(this._T)}}catch(c){s.e(c)}finally{s.f()}}return Object(c.a)(e,[{key:"setRotation",value:function(e){if(0!==e||0!==this._rotation){this._rotation=e;var t=this._T,r=Object(Se.b)(Object(Te.a)(),e);Object(Se.e)(t,r,t);var i,a=Object(n.a)(this.glyphs);try{for(a.s();!(i=a.n()).done;){i.value.setTransform(this._T)}}catch(s){a.e(s)}finally{a.f()}}}},{key:"_decorate",value:function(e,t,r){if(r.decoration&&"none"!==r.decoration&&e.length){var i,a=r.scale,s="underline"===r.decoration?30:20,o=e[0].textureBinding,c=Object(n.a)(t);try{for(c.s();!(i=c.n()).done;){var u=i.value,l=u.startX*a,h=u.startY*a,f=(u.width+u.glyphWidthEnd)*a;e.push(new Pe(l,h+s*a,Ve(f,o),1))}}catch(v){c.e(v)}finally{c.f()}}}},{key:"boundsT",get:function(){var e=this.bounds,t=Object(j.s)(Object(Ie.a)(),e.x,e.y);if(Object(j.t)(t,t,this._T),this._hasRotation){var r=Math.max(e.width,e.height);return new ze(t[0],t[1],r,r)}return new ze(t[0],t[1],e.width,e.height)}},{key:"_createBounds",value:function(e){var t,r=1/0,i=1/0,a=0,s=0,o=Object(n.a)(e);try{for(o.s();!(t=o.n()).done;){var c=t.value;r=Math.min(r,c.xTopLeft),i=Math.min(i,c.yTopLeft),a=Math.max(a,c.xTopLeft+c.width),s=Math.max(s,c.yBottomRight)}}catch(h){o.e(h)}finally{o.f()}var u=a-r,l=s-i;return new ze(r+u/2,i+l/2,u,l)}},{key:"_createGlyphTransform",value:function(e,t){var r=Ce*t.angle,n=Object(Te.a)(),i=Object(Ie.a)();return Object(Se.h)(n,n,Object(j.s)(i,t.xOffset,-t.yOffset)),t.isCIM?Object(Se.f)(n,n,r):(Object(Se.h)(n,n,Object(j.s)(i,e.x,e.y)),Object(Se.f)(n,n,r),Object(Se.h)(n,n,Object(j.s)(i,-e.x,-e.y))),n}}]),e}(),Re=function e(t,r,n,i,a,s){Object(o.a)(this,e),this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(r,n)),this.end=Math.max(0,Math.max(r,n)),this.end<t.length&&(this.glyphWidthEnd=t[this.end].metrics.width),this.width=i,this.yMin=a,this.yMax=s},Ae=function(e){return 10===e},Fe=function(e){return 32===e};function We(e,t,r){for(var n=r.scale,i=new Array,a=function(e,t,r){for(var n=new Array,i=1/r.scale,a=r.maxLineWidth*i,s=t?e.length-1:0,o=t?-1:e.length,c=t?-1:1,u=s,l=0,h=0,f=u,v=f,d=0,y=1/0,p=0;u!==o;){var m=e[u],_=m.code,b=m.metrics,g=Math.abs(b.top);if(Ae(_)||Fe(_)||(y=Math.min(y,g),p=Math.max(p,g+b.height)),Ae(_))u!==s&&(n.push(new Re(e,f,u-c,l,y,p)),y=1/0,p=0),l=0,f=u+c,v=u+c,h=0;else if(Fe(_))v=u+c,h=0,d=b.advance,l+=b.advance;else if(l>a){if(v!==f){var x=v-2*c;l-=d,n.push(new Re(e,f,x,l-h,y,p)),y=1/0,p=0,f=v,l=h}else n.push(new Re(e,f,u-c,l,y,p)),y=1/0,p=0,f=u,v=u,l=0;l+=b.advance,h+=b.advance}else l+=b.advance,h+=b.advance;u+=c}var O=new Re(e,f,u-c,l,y,p);return O.start>=0&&O.end<e.length&&n.push(O),n}(e,t,r),s=function(e,t){for(var r=0,n=0;n<e.length;n++){var i=e[n].width;r=Math.max(i,r)}var a="underline"===t.decoration?4:0,s=e[0].yMin;return{x:0,y:s,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+a-s,width:r}}(a,r),o=r.vAlign,c=r.hAlign,u=o===q.Baseline?1:0,l=u?0:o-1,h=(1-u)*-s.y+l*(s.height/2)+-26*(u?1:0),f=0;f<a.length;f++){var v=a[f],d=v.start,y=v.end,p=-1*(c+1)*(v.width/2)-3,m=f*r.lineHeight+h-3;a[f].startX=p,a[f].startY=m;for(var _=d;_<=y;_++){var b=e[_];if(!Ae(b.code)){var g=new Pe(p+b.metrics.left,m-b.metrics.top,b,n);p+=b.metrics.advance,i.push(g)}}}return new Ee(i,a,r)}var Be=function(e){return function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(o.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i)))._isCIM=!1,e._vertexBoundsScale=1,e.geometryType=A.c.TEXT,e._aux=Object(ae.b)(0,0,e._referenceSize,e._bitset),e}return Object(c.a)(r,[{key:"bindTextInfo",value:function(e,t){var r=this;e&&e.length?this._shapingInfo=Object(y.b)(e,(function(e){return We(e,t,{scale:r._scale,angle:r._angle,xOffset:r._xOffset,yOffset:r._yOffset,hAlign:r._xAlignD,vAlign:r._yAlignD,maxLineWidth:Math.max(32,Math.min(r._lineWidth,512)),lineHeight:R.f*Math.max(.25,Math.min(r._lineHeight,4)),decoration:r._decoration,isCIM:r._isCIM})})):this._shapingInfo=null}},{key:"_write",value:function(e,t,r){var n=t.getDisplayId();this._writeGeometry(e,t,n,r)}},{key:"_writeGeometry",value:function(e,t,r,n){var i=this,a=this._shapingInfo;if(!Object(y.j)(a)){if(Object(y.k)(this._textPlacement)){var s=null!=n?n:t.readLegacyGeometryForDisplay();return this._writePlacedText(e,r,s,a)}var o=n?Object(je.m)(Object(je.d)(n),2):"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(!Object(y.j)(o)){if(o.isPoint){var c=Object(Q.a)(o.coords,2),u=c[0],l=c[1];return this._writeGlyphs(e,r,{x:u,y:l},a)}o.forEachVertex((function(t,n){return i._writeGlyphs(e,r,{x:t,y:n},a)}))}}}},{key:"_writePlacedText",value:function(e,t,r,n){var i=Object(y.t)(this._textPlacement),a=Me.getPlacement(r,i,Object(ee.g)(1));if(a)for(var s=a.next();null!=s;){var o=s.getAngle();n.setRotation(o);var c=s.tx,u=s.ty;c<0||c>=512||u<0||u>=512||(this._writeGlyphs(e,t,{x:c,y:u},n),n.setRotation(-o)),s=a.next()}}},{key:"_writeGlyphs",value:function(e,t,r,i){var a,s=se.e.load(this._materialKey),o=Object(ae.a)(Math.round(8*r.x),Math.round(8*r.y)),c=this._vertexBoundsScale,u=i.bounds,l=2*Math.max(u.width,u.height),h=Object(n.a)(i.glyphs);try{for(h.s();!(a=h.n()).done;){var f=a.value;s.textureBinding=f.textureBinding,e.recordStart(t,s.data,this.geometryType,!1,!0),e.vertexBounds(r.x+u.x+this._xOffset,r.y+u.y-this._yOffset,l*c,l*c),this._writeVertices(e,t,o,f),e.recordEnd()}}catch(v){h.e(v)}finally{h.f()}}},{key:"_writeGlyph",value:function(e,t,r,n,i){var a=se.e.load(this._materialKey),s=Object(ae.a)(Math.round(8*r),Math.round(8*n));a.textureBinding=i.textureBinding,e.recordStart(t,a.data,this.geometryType,!1,!0);var o=i.bounds,c=this._vertexBoundsScale;e.vertexBounds(r+o.x*c,n+o.y*c,o.width*c,o.height*c),this._writeVertices(e,t,s,i),e.recordEnd()}},{key:"_writeVertices",value:function(e,t,r,n){var i=e.vertexCount();this._writeVertexCommon(e,t,r,n),e.vertexWrite(n.offsets.upperLeft),e.vertexWrite(n.texcoords.upperLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,n),e.vertexWrite(n.offsets.upperRight),e.vertexWrite(n.texcoords.upperRight),e.vertexEnd(),this._writeVertexCommon(e,t,r,n),e.vertexWrite(n.offsets.lowerLeft),e.vertexWrite(n.texcoords.lowerLeft),e.vertexEnd(),this._writeVertexCommon(e,t,r,n),e.vertexWrite(n.offsets.lowerRight),e.vertexWrite(n.texcoords.lowerRight),e.vertexEnd(),e.indexWrite(i+0),e.indexWrite(i+1),e.indexWrite(i+2),e.indexWrite(i+1),e.indexWrite(i+3),e.indexWrite(i+2)}},{key:"_writeVertexCommon",value:function(e,t,r,n){var i=this._color,a=this._haloColor,s=Object(ae.b)(0,0,this._referenceSize,this._bitset),o=Object(ae.b)(0,0,this._size,this._haloSize);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(i),e.vertexWrite(a),e.vertexWrite(o),e.vertexWrite(s),e.vertexWrite(this._minMaxZoom)}}]),r}(e)},De=r(964),Ke=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"executeEffects",value:function(e,t){var r,i=Object(ke.c)(t),a=new De.a(i),s=Object(n.a)(e);try{for(s.s();!(r=s.n()).done;){var o=r.value,c=Object(we.a)(o);c&&(a=c.execute(a,o,1.3333333333333333))}}catch(u){s.e(u)}finally{s.f()}return a}},{key:"next",value:function(e){var t=e.next();return Object(ke.d)(t),t}}]),e}(),Ge=function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"bindFeature",value:function(e,t,r){}},{key:"write",value:function(e,t,r){if(Object(y.j)(this._effects))return this._write(e,t);for(var n=Ke.executeEffects(this._effects,t.readLegacyGeometryForDisplay()),i=Ke.next(n);i;)this._write(e,t,i),i=Ke.next(n)}},{key:"_write",value:function(e,t,r){}}]),e}(),Ne=new(r(1012).a);function Ze(e){return Ne.hasBidiChar(e)?(t="rtl"===Ne.checkContextual(e)?"IDNNN":"ICNNN",[Ne.bidiTransform(e,t,"VLYSN"),!0]):[e,!1];var t}var Ue=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e,n,i,a,s,c,u,l,h,f,v,d,y,p,m,_,b){var g,x=arguments.length>17&&void 0!==arguments[17]&&arguments[17],O=arguments.length>18?arguments[18]:void 0,j=arguments.length>19?arguments[19]:void 0;Object(o.a)(this,r),(g=t.call(this))._xOffset=Object(ee.g)(d),g._yOffset=Object(ee.g)(y),g._decoration=h||"none",g._color=a,g._haloColor=s,g._haloSize=Math.min(Math.floor(5*Object(ee.g)(Object(ee.j)(i))),127),g._size=Math.min(Math.round(Object(ee.g)(n)),127);var k=Math.min(Math.round(Object(ee.g)(n)),127);g._referenceSize=Math.round(Math.sqrt(256*k)),g._scale=g._size/24,g._angle=v,g._justify=ne(c||"center"),g._xAlignD=te(c||"center"),g._yAlignD=re(u||"baseline"),g._baseline="baseline"===(u||"baseline"),g._bitset=(1===l?1:0)|(f?1:0)<<1;var w=se.e.load(e);return w.sdf=!0,g._materialKey=w.data,g._lineWidth=Object(ee.g)(p)||512,g._lineHeight=m||1,g._textPlacement=_,g._effects=b,g._isCIM=x,g._minMaxZoom=Object(ae.a)(Math.round(O*R.h),Math.round(j*R.h)),g}return Object(c.a)(r,null,[{key:"fromText",value:function(e,t){var n=new r(e.materialKey,e.font.size,e.haloSize||0,e.color&&Object(ie.d)(e.color)||0,e.haloColor&&Object(ie.d)(e.haloColor)||0,e.horizontalAlignment,e.verticalAlignment,0,e.font.decoration,!1,e.angle||0,e.xoffset,e.yoffset,e.lineWidth,e.lineHeight,null,null,!1,0,ce),i=Ze(e.text),a=Object(Q.a)(i,2)[1];return n.bindTextInfo(t,a),n._vertexBoundsScale=e.maxVVSize?e.maxVVSize/e.font.size:1,n}},{key:"fromCIMText",value:function(e,t,n){var i=e.scaleFactor||1,a=e.size*e.sizeRatio*i,s=ye(e.scaleInfo,n),o=Object(Q.a)(s,2),c=o[0],u=o[1],l=new r(e.materialKey,a,e.outlineSize*e.sizeRatio,Object(ie.c)(e.color),Object(ie.c)(e.outlineColor),e.horizontalAlignment,e.verticalAlignment,e.alignment,e.decoration,e.colorLocked,e.angle,e.offsetX*e.sizeRatio*i,e.offsetY*e.sizeRatio*i,512,1,e.markerPlacement,e.effects,!0,c,u),h=Ze(e.text),f=Object(Q.a)(h,2)[1];return l.bindTextInfo(t,f),l._vertexBoundsScale=e.maxVVSize?e.maxVVSize/a:1,l}}]),r}(Be(Ge)),Xe=d.a.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate");var qe=function(e){var t=new Map;return function(r){return t.has(r)||t.set(r,e(r)),t.get(r)}}((function(e){var t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t})),Ye=function(e){return Math.floor(127*e+127)},He=function(e){return Math.floor(10*e)},Je=function(e){return Math.round(e*(254/360))},Qe=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e,n,i,a){var s;Object(o.a)(this,r),(s=t.call(this,e,i.font.size,i.haloSize||0,i.color&&Object(ie.d)(i.color)||0,i.haloColor&&Object(ie.d)(i.haloColor)||0,i.horizontalAlignment,i.verticalAlignment,Object(oe.a)(n.labelPlacement)?1:0,i.font.decoration,!1,i.angle||0,i.xoffset,i.yoffset,i.lineWidth,i.lineHeight,null,null,null,null,null))._outLineLabelAngle=0,s._refPlacementPadding=0,s._refPlacementDirX=0,s._refPlacementDirY=0,s._refOffsetX=0,s._refOffsetY=0,s._zoomLevel=0,s.geometryType=A.c.LABEL;var c=function(e,t){var r=!!e.minScale&&t.scaleToZoom(e.minScale)||0;return Object($.f)(r,0,25.5)}(n,a),u=function(e,t){var r=!!e.maxScale&&t.scaleToZoom(e.maxScale)||255;return Object($.f)(r,0,25.5)}(n,a),l=function(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return[X.Right,q.Bottom];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return[X.Center,q.Bottom];case"above-right":case"esriServerPointLabelPlacementAboveRight":return[X.Left,q.Bottom];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return[X.Right,q.Center];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":return[X.Center,q.Center];case"center-right":case"esriServerPointLabelPlacementCenterRight":return[X.Left,q.Center];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return[X.Right,q.Top];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return[X.Center,q.Top];case"below-right":case"esriServerPointLabelPlacementBelowRight":return[X.Left,q.Top];case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return[X.Center,q.Baseline];default:return console.debug("Found invalid placement type ".concat(e)),[X.Center,q.Center]}}(n.labelPlacement),h=Object(Q.a)(l,2),f=h[0],v=h[1];s._xAlignD=f,s._yAlignD=v,s._minZoom=c,s._maxZoom=u,s._refPlacementPadding=Object(ee.g)(i.haloSize)+R.t;var d=se.b.load(e);return d.sdf=!0,s._materialKey=d.data,s}return Object(c.a)(r,[{key:"_shapedBox",get:function(){return Object(y.t)(this._shapingInfo).bounds}},{key:"setZoomLevel",value:function(e){this._zoomLevel=e}},{key:"bindReferenceTemplate",value:function(e){var t=function(e){switch(e){case X.Right:return-1;case X.Center:return 0;case X.Left:return 1;default:return console.debug("Found invalid horizontal alignment ".concat(e)),0}}(this._xAlignD),r=function(e){switch(e){case q.Top:return 1;case q.Center:return 0;case q.Bottom:case q.Baseline:return-1;default:return console.debug("Found invalid vertical alignment ".concat(e)),0}}(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,Object(y.j)(e))this._refSymbolAndPlacementOffset=Object(ae.b)(0,0,Ye(t),Ye(r));else{if("circle"===e.boundsType&&(t||r)){var n=Math.sqrt(t*t+r*r);t/=n,r/=n}var i=Math.max(e.height,e.width),a=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=Object(ae.b)(a,i,Ye(t),Ye(r)),this._referenceSize=i,this._refPlacementDirX=t,this._refPlacementDirY=r,this._refOffsetX=e.xOffset,this._refOffsetY=e.yOffset}}},{key:"_write",value:function(e,t){if(!Object(y.j)(this._shapingInfo)){var r=this._shapingInfo,n=t.getDisplayId(),i="esriGeometryPolygon"===t.geometryType?t.readLegacyCentroid():t.readLegacyGeometry();if(i)switch(this.current={out:e,inId:n,inShaping:r,zoomLevel:this._zoomLevel},t.geometryType){case"esriGeometryPolyline":this._placeLineLabels(i);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(i);break;default:!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mapview-labeling";Xe.error(new f.a(t,e))}("mapview-labeling","Geometry of type ".concat(t.geometryType," is not supported"))}}}},{key:"_isVisible",value:function(e,t){var r=He(this.current.zoomLevel);return He(e)<=r&&r<=He(t)}},{key:"_placePointLabels",value:function(e){var t=this.current,r=t.out,n=t.inId,i=t.inShaping;this._writeGlyphs(r,n,e,i)}},{key:"_placeLineLabels",value:function(e){var t,r=function(e,t){for(var r=t,n=0;n<e.length;n++){var i=e[n],a=[];a.push(i[0]);for(var s=1;s<i.length;s++){var o=Object(Q.a)(a[s-1],2),c=o[0],u=o[1];c+=i[s][0],u+=i[s][1],a.push([c,u])}Oe(a,r);var l=[];l.push(a[0]);for(var h=1;h<a.length;h++){var f=Object(Q.a)(a[h-1],2),v=f[0],d=f[1],y=Object(Q.a)(a[h],2),p=y[0],m=y[1],_=Math.round(p-v),b=Math.round(m-d);l.push([_,b])}e[n]=l,i=l}return e}(e.paths,this.current.inShaping.bounds.width),i=this._placeSubdivGlyphs.bind(this),a=(this._shapedBox.width+128)/2,s=Object(n.a)(r);try{for(s.s();!(t=s.n()).done;){xe(t.value,a,i)}}catch(o){s.e(o)}finally{s.f()}}},{key:"_placeSubdivGlyphs",value:function(e,t,r,n){var i=qe(t),a=this._shapedBox.width/2,s=Math.min(r,n-r),o=Object($.n)(s/(8+a/2)),c=0===t?o:Math.min(i,o),u=Math.max(this._minZoom,this.current.zoomLevel+1-c),l=this.current.zoomLevel-u,h=this._shapedBox.width/2*Math.pow(2,l);this.current.inShaping.isMultiline?0===t&&this._placeStraight(e,u):this._placeCurved(e,u,h)}},{key:"_placeStraight",value:function(e,t){var r=this.current,n=r.out,i=r.inId,a=r.inShaping;this._writeGlyphs(n,i,e,a,t)}},{key:"_placeCurved",value:function(e,t,r){var n=this.current,i=n.out,a=n.inId;i.metricStart(a,t,e.x,e.y,0,0,0,0);var s=e.clone(),o=e.angle*(180/Math.PI)%360,c=(e.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=Je(o),this._placeFirst(s,t,1),this._placeBack(e,s,t,r,1),this._placeForward(e,s,t,r,1),this._outLineLabelAngle=Je(c),this._placeFirst(s,t,0),this._placeBack(e,s,t,r,0),this._placeForward(e,s,t,r,0),i.metricEnd()}},{key:"_placeBack",value:function(e,t,r,n,i){for(var a=e.clone(),s=e.backwardLength+0;a.prev()&&!(s>=n);)this._placeOnSegment(a,t,s,r,-1,i),s+=a.length+0}},{key:"_placeForward",value:function(e,t,r,n,i){for(var a=e.clone(),s=e.remainingLength+0;a.next()&&!(s>=n);)this._placeOnSegment(a,t,s,r,1,i),s+=a.length+0}},{key:"_placeFirst",value:function(e,t,r){var i,a=e,s=this.current.inShaping,o=s.glyphs,c=this.current.zoomLevel,u=this.current,l=u.out,h=u.inId,f=Object(n.a)(o);try{for(f.s();!(i=f.n()).done;){var v=i.value,d=v.x>s.bounds.x?r:1-r,y=d*e.remainingLength+(1-d)*e.backwardLength,p=Math.abs(v.x+v.width/2-s.bounds.x),m=Math.max(0,c+Object($.n)(p/(y+0))),_=Math.max(t,m);if(v.maxZoom=25,v.angle=e.angle+(1-r)*Math.PI,v.minZoom=_,this._writeGlyph(l,h,a.x,a.y,v),r&&this._isVisible(v.minZoom,v.maxZoom)){var b=v.bounds;l.metricBoxWrite(b.center[0],b.center[1],b.width,b.height)}}}catch(g){f.e(g)}finally{f.f()}}},{key:"_placeOnSegment",value:function(e,t,r,i,a,s){var o,c=this.current.inShaping.glyphs,u=this.current,l=u.out,h=u.inId,f=this.current.inShaping,v=this.current.zoomLevel,d=e.dx/e.length,y=e.dy/e.length,p={x:e.x+r*-a*d,y:e.y+r*-a*y},m=Object(n.a)(c);try{for(m.s();!(o=m.n()).done;){var _=o.value,b=_.x>f.bounds.x?s:1-s;if(b&&1===a||!b&&-1===a){var g=Math.abs(_.x+_.width/2-f.bounds.x),x=Math.max(0,v+Object($.n)(g/r)-.1),O=Math.max(i,v+Object($.n)(g/(r+e.length+0)));if(0!==x&&(_.angle=e.angle+(1-s)*Math.PI,_.minZoom=O,_.maxZoom=x,this._writeGlyph(l,h,p.x,p.y,_),s&&this._isVisible(_.minZoom,_.maxZoom))){var j=_.bounds,k=e.x-t.x,w=e.y-t.y;l.metricBoxWrite(j.center[0]+k,j.center[1]+w,j.width,j.height)}}}}catch(M){m.e(M)}finally{m.f()}}},{key:"_writeGlyphs",value:function(e,t,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this._minZoom;if(!(r.x<0||r.x>=512||r.y<0||r.y>=512)){var s,o=r.x+this._refOffsetX,c=r.y-this._refOffsetY,u=Object(n.a)(i.glyphs);try{for(u.s();!(s=u.n()).done;){var l=s.value;l.minZoom=a,l.maxZoom=this._maxZoom,this._writeGlyph(e,t,o,c,l)}}catch(d){u.e(d)}finally{u.f()}var h=this._refPlacementDirX,f=this._refPlacementDirY,v=i.boundsT;e.metricStart(t,a,o,c,h,f,this._referenceSize,this._materialKey),e.metricBoxWrite(v.center[0],v.center[1],v.width,v.height),e.metricEnd()}}},{key:"_writeVertexCommon",value:function(e,t,r,n){var i=this._color,a=this._haloColor,s=Object(ae.b)(0,0,this._size,this._haloSize),o=Math.max(n.minZoom,this._minZoom),c=Math.min(n.maxZoom,this._maxZoom),u=Object(ae.b)(He(o),He(c),this._outLineLabelAngle,0);e.vertexWrite(r),e.vertexWrite(t),e.vertexWrite(i),e.vertexWrite(a),e.vertexWrite(s),e.vertexWrite(this._refSymbolAndPlacementOffset),e.vertexWrite(u)}}],[{key:"fromLabelClass",value:function(e,t){if("esriServerLinePlacementCenterAlong"===e.labelPlacement){var n=e.symbol;n.xoffset=0,n.yoffset=0,n.angle=0,n.font.decoration="none"}return new r(e.materialKey,e,e.symbol,t)}}]),r}(Ue),$e=3.14159265359/180,et=function(e){return function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(o.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).angle=0,e.xOffset=0,e.yOffset=0,e.width=0,e.height=0,e.boundsType="square",e._anchorX=0,e._anchorY=0,e._computedWidth=0,e._computedHeight=0,e._vertexBoundsScaleX=1,e._vertexBoundsScaleY=1,e._offsets={xUpperLeft:0,yUpperLeft:0,xUpperRight:0,yUpperRight:0,xBottomLeft:0,yBottomLeft:0,xBottomRight:0,yBottomRight:0},e.geometryType=A.c.MARKER,e}return Object(c.a)(r,[{key:"_write",value:function(e,t,r){var n=t.getDisplayId();e.recordStart(n,this._materialKey,this.geometryType,!1,!0),this._writeGeometry(e,t,n,r),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,n){var i=this;if(Object(y.k)(this._markerPlacement))return this._writePlacedMarkers(e,t,n);var a=n?Object(je.m)(Object(je.d)(n),2):"esriGeometryPolygon"===t.geometryType?t.readCentroid():t.readGeometryForDisplay();if(!Object(y.j)(a)){if(a.isPoint){var s=Object(Q.a)(a.coords,2),o=s[0],c=s[1];if(!e.hasAggregates&&e.hasPixelBufferEnabled&&(o<-1||o>=513||c<-1||c>=513))return;return this._writeVertices(e,r,this._getPos(o,c),o,c)}a.forEachVertex((function(t,n){return i._writeVertices(e,r,i._getPos(t,n),t,n)}))}}},{key:"_writePlacedMarkers",value:function(e,t,r){var n=null!=r?r:t.readLegacyGeometryForDisplay(),i=Me.getPlacement(n,Object(y.t)(this._markerPlacement),Object(ee.g)(1));if(i)for(var a=t.getDisplayId(),s=Object(Ie.a)(),o=Object(Te.a)(),c=i.next();null!=c;){var u=c,l=u.tx,h=u.ty;l>=-128&&l<=640&&h>=-128&&h<=640&&(this._applyTransformation(o,s,c.getAngle()/$e),this._writeVertices(e,a,this._getPos(l,h),l,h)),c=i.next()}}},{key:"_writeVertices",value:function(e,t,r,n,i){var a=e.vertexCount();e.vertexBounds(n+this.xOffset,i-this.yOffset,this._computedWidth*this._vertexBoundsScaleX,this._computedHeight*this._vertexBoundsScaleY),e.vertexWrite(r),e.vertexWrite(this._offsetUpperLeft),e.vertexWrite(this._texUpperLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetUpperRight),e.vertexWrite(this._texUpperRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomLeft),e.vertexWrite(this._texBottomLeft),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.vertexWrite(r),e.vertexWrite(this._offsetBottomRight),e.vertexWrite(this._texBottomRight),e.vertexWrite(this._bitestAndDistRatio),e.vertexWrite(t),e.vertexWrite(this._fillColor),e.vertexWrite(this._outlineColor),e.vertexWrite(this._sizeOutlineWidth),e.vertexWrite(this._minMaxZoom),e.vertexEnd(),e.indexWrite(a+0),e.indexWrite(a+1),e.indexWrite(a+2),e.indexWrite(a+1),e.indexWrite(a+3),e.indexWrite(a+2)}},{key:"_applyTransformation",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(Se.d)(e),Object(Se.h)(e,e,Object(Ie.b)(this.xOffset,-this.yOffset)),this.angle+r!==0&&Object(Se.f)(e,e,$e*(this.angle+r));var n=this._computedWidth,i=this._computedHeight,a=(this._anchorX-.5)*n,s=(this._anchorY-.5)*i;Object(j.s)(t,a,s),Object(j.t)(t,t,e),this._offsetUpperLeft=Object(ae.a)(16*t[0],16*t[1]),this._offsets.xUpperLeft=t[0],this._offsets.yUpperLeft=t[1],Object(j.s)(t,a+n,s),Object(j.t)(t,t,e),this._offsetUpperRight=Object(ae.a)(16*t[0],16*t[1]),this._offsets.xUpperRight=t[0],this._offsets.yUpperRight=t[1],Object(j.s)(t,a,s+i),Object(j.t)(t,t,e),this._offsetBottomLeft=Object(ae.a)(16*t[0],16*t[1]),this._offsets.xBottomLeft=t[0],this._offsets.yBottomLeft=t[1],Object(j.s)(t,a+n,s+i),Object(j.t)(t,t,e),this._offsetBottomRight=Object(ae.a)(16*t[0],16*t[1]),this._offsets.xBottomRight=t[0],this._offsets.yBottomRight=t[1]}},{key:"_getPos",value:function(e,t){return Object(ae.a)(Math.round(8*e),Math.round(8*t))}}]),r}(e)},tt=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e,n,i,a,s,c,u,l,h,f,v,d,y,p,m,_,b,g,x,O,j,k,w){var M;Object(o.a)(this,r),(M=t.call(this)).angle=a,M.height=u,M.width=c,M.xOffset=n*x,M.yOffset=i*x,M._markerPlacement=O,M._effects=j,M._anchorX=.5-(.5+_)*m.width/m.width,M._anchorY=.5-(.5+b)*m.height/m.height,M._minMaxZoom=Object(ae.a)(Math.round(k*R.h),Math.round(w*R.h));var S=(1===p?1:0)|(v?1:0)<<1|(y?1:0)<<2|(d?1:0)<<3,T=m&&m.sdf,I=se.d.load(e);I.sdf=T,I.pattern=!0,I.textureBinding=m.textureBinding,M._materialKey=I.data,M._fillColor=s,M._outlineColor=h,M._sizeOutlineWidth=Object(ae.b)(Math.round(Math.min(Math.sqrt(128*c),255)),Math.round(Math.min(Math.sqrt(128*u),255)),Math.round(Math.min(Math.sqrt(128*f),255)),Math.round(Math.min(Math.sqrt(128*l),255)));var L=m.rect.x+R.l,z=m.rect.y+R.l,C=L+m.width,P=z+m.height;M._offsets.xUpperLeft=L,M._offsets.yUpperLeft=z,M._offsets.xUpperRight=C,M._offsets.yUpperRight=z,M._offsets.xBottomLeft=L,M._offsets.yBottomLeft=P,M._offsets.xBottomRight=C,M._offsets.yBottomRight=P,M._texUpperLeft=Object(ae.a)(L,z),M._texUpperRight=Object(ae.a)(C,z),M._texBottomLeft=Object(ae.a)(L,P),M._texBottomRight=Object(ae.a)(C,P),c*=g,u*=g,c*=x,u*=x;var V=Math.round(64*g);M._bitestAndDistRatio=Object(ae.a)(S,V),M._computedWidth=c,M._computedHeight=u;var E=Object(Ie.a)(),A=Object(Te.a)();return M._applyTransformation(A,E),M}return Object(c.a)(r,null,[{key:"fromCIMMarker",value:function(e,t,n){var i=t&&t.width||1,a=t&&t.height||1,s=e.size,o=i/a*e.scaleX,c=e.scaleSymbolsProportionally&&e.frameHeight?s/e.frameHeight:1,u=Object(ie.c)(e.color),l=Object(ie.c)(e.outlineColor),h=Object(ee.g)(s),f=h*o,v=Object(ee.g)(e.offsetX||0),d=Object(ee.g)(e.offsetY||0),p=Object(ee.g)(e.outlineWidth||0)*c,m=e.alignment||0,_=Object(ee.g)(e.referenceSize),b=ye(e.scaleInfo,n),g=Object(Q.a)(b,2),x=g[0],O=g[1],j=e.rotation||0;e.rotateClockwise||(j=-j);var k=0,w=0,M=e.anchorPoint;M&&(e.isAbsoluteAnchorPoint?s&&(k=-M.x/(s*o),w=M.y/s):(k=M.x,w=M.y));var S=new r(e.materialKey,v,d,j,u,f,h,_,l,p,e.colorLocked,e.scaleSymbolsProportionally,!1,m,t,k,w,e.sizeRatio,Object(y.u)(e.scaleFactor,1),e.markerPlacement,e.effects,x,O);return S._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/f:1,S._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/h:1,S}},{key:"fromPictureMarker",value:function(e,t){var n=Math.round(Object(ee.g)(e.width)),i=Math.round(Object(ee.g)(e.height)),a=R.k,s=Math.round(Object(ee.g)(e.xoffset||0)),o=Math.round(Object(ee.g)(e.yoffset||0)),c=new r(e.materialKey,s,o,e.angle,a,n,i,i,0,0,!1,!1,!1,0,t,0,0,1,1,null,null,0,ce);return c._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.width:1,c._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.height:1,c}},{key:"fromSimpleMarker",value:function(e,t){var n=Object(ie.d)(e.color),i=Math.round(Object(ee.g)(e.size)),a=i,s=Math.round(Object(ee.g)(e.xoffset||0)),o=Math.round(Object(ee.g)(e.yoffset||0)),c=e.style,u=e.outline,l=0|(u&&u.color&&Object(ie.d)(u.color)),h=0|(u&&u.width&&Math.round(Object(ee.g)(u.width))),f=new r(e.materialKey,s,o,e.angle,n,i,a,a,l,h,!1,!1,"esriSMSCross"===c||"esriSMSX"===c,0,t,0,0,126/64,1,null,null,0,ce);return f.boundsType="esriSMSCircle"===c?"circle":"square",f._vertexBoundsScaleX=e.maxVVSize?e.maxVVSize/e.size:1,f._vertexBoundsScaleY=e.maxVVSize?e.maxVVSize/e.size:1,f}},{key:"fromLineSymbolMarker",value:function(e,t){var n,i=Object(ie.d)(e.color),a=Math.round(Object(ee.g)(6*e.lineWidth)),s=a,o="cross"===e.style||"x"===e.style;switch(e.placement){case"begin-end":n="Both";break;case"begin":n="JustBegin";break;case"end":n="JustEnd";break;default:n="None"}var c={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:n,offsetAlongLine:0},u=new r(e.materialKey,0,0,0,i,a,s,s/6,i,o?Math.round(Object(ee.g)(e.lineWidth)):0,!1,!1,o,1,t,0,0,126/64,1,c,null,0,ce);return u.boundsType="circle"===e.style?"circle":"square",u}}]),r}(et(Ge)),rt=r(14),nt=r(614),it=r(250),at=r(832),st=(r(289),r(223)),ot=r(962);function ct(e,t,r,n,i,a,s){Ct=0;var o,c,u,l,h,f=(n-r)*a,v=i&&i.length,d=v?(i[0]-r)*a:f,y=ut(t,r,n,0,d,a,!0);if(y&&y.next!==y.prev){if(v&&(y=function(e,t,r,n,i,a){for(var s=new Array,o=0,c=n.length;o<c;o++){var u=ut(e,t,r,n[o]*a,o<c-1?n[o+1]*a:r*a,a,!1);u===u.next&&(u.steiner=!0),s.push(pt(u))}s.sort(wt);for(var l=0,h=s;l<h.length;l++){mt(h[l],i),i=lt(i,i.next)}return i}(t,r,n,i,y,a)),f>80*a){o=u=t[0+r*a],c=l=t[1+r*a];for(var p=a;p<d;p+=a){var m=t[p+r*a],_=t[p+1+r*a];o=Math.min(o,m),c=Math.min(c,_),u=Math.max(u,m),l=Math.max(l,_)}h=0!==(h=Math.max(u-o,l-c))?1/h:0}ht(y,e,a,o,c,h,s,0)}}function ut(e,t,r,n,i,a,s){var o;if(s===function(e,t,r,n,i,a){for(var s=0,o=n,c=i-a;o<i;o+=a)s+=(e[c+t*a]-e[o+t*a])*(e[o+1+t*a]+e[c+1+t*a]),c=o;return s}(e,t,0,n,i,a)>0)for(var c=n;c<i;c+=a)o=dt(c+t*a,e[c+t*a],e[c+1+t*a],o);else for(var u=i-a;u>=n;u-=a)o=dt(u+t*a,e[u+t*a],e[u+1+t*a],o);return o&&kt(o,o.next)&&(yt(o),o=o.next),o}function lt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;if(!e)return e;var r,n=e;do{if(r=!1,n.steiner||!kt(n,n.next)&&0!==bt(n.prev,n,n.next))n=n.next;else{if(yt(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function ht(e,t,r,n,i,a,s,o){if(e){!o&&a&&(e=_t(e,n,i,a));for(var c=e;e.prev!==e.next;){var u=e.prev,l=e.next;if(a?vt(e,n,i,a):ft(e))t.push(u.index/r+s),t.push(e.index/r+s),t.push(l.index/r+s),yt(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?ht(e=Mt(e,t,r,s),t,r,n,i,a,s,2):2===o&&St(e,t,r,n,i,a,s):ht(lt(e),t,r,n,i,a,s,1);break}}}}function ft(e){var t=e.prev,r=e,n=e.next;if(bt(t,r,n)>=0)return!1;for(var i=e.next.next,a=i,s=0;i!==e.prev&&(0===s||i!==a);){if(s++,xt(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&bt(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function vt(e,t,r,n){var i=e.prev,a=e,s=e.next;if(bt(i,a,s)>=0)return!1;for(var o=i.x<a.x?i.x<s.x?i.x:s.x:a.x<s.x?a.x:s.x,c=i.y<a.y?i.y<s.y?i.y:s.y:a.y<s.y?a.y:s.y,u=i.x>a.x?i.x>s.x?i.x:s.x:a.x>s.x?a.x:s.x,l=i.y>a.y?i.y>s.y?i.y:s.y:a.y>s.y?a.y:s.y,h=jt(o,c,t,r,n),f=jt(u,l,t,r,n),v=e.prevZ,d=e.nextZ;v&&v.z>=h&&d&&d.z<=f;){if(v!==e.prev&&v!==e.next&&xt(i.x,i.y,a.x,a.y,s.x,s.y,v.x,v.y)&&bt(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,d!==e.prev&&d!==e.next&&xt(i.x,i.y,a.x,a.y,s.x,s.y,d.x,d.y)&&bt(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;v&&v.z>=h;){if(v!==e.prev&&v!==e.next&&xt(i.x,i.y,a.x,a.y,s.x,s.y,v.x,v.y)&&bt(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;d&&d.z<=f;){if(d!==e.prev&&d!==e.next&&xt(i.x,i.y,a.x,a.y,s.x,s.y,d.x,d.y)&&bt(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function dt(e,t,r,n){var i=Lt.create(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function yt(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function pt(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function mt(e,t){if(t=function(e,t){var r,n=t,i=e.x,a=e.y,s=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var o=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(o<=i&&o>s){if(s=o,o===i){if(a===n.y)return n;if(a===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r.prev;var c,u=r,l=r.x,h=r.y,f=1/0;for(n=r.next;n!==u;)i>=n.x&&n.x>=l&&i!==n.x&&xt(a<h?i:s,a,l,h,a<h?s:i,a,n.x,n.y)&&(((c=Math.abs(a-n.y)/(i-n.x))<f||c===f&&n.x>r.x)&&Ot(n,e)&&(r=n,f=c)),n=n.next;return r}(e,t)){var r=It(t,e);lt(r,r.next)}}function _t(e,t,r,n){for(var i;i!==e;i=i.next){if(null===(i=i||e).z&&(i.z=jt(i.x,i.y,t,r,n)),i.prev.next!==i||i.next.prev!==i)return i.prev.next=i,i.next.prev=i,_t(e,t,r,n);i.prevZ=i.prev,i.nextZ=i.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){for(var t,r=1;;){var n=void 0,i=e;e=null,t=null;for(var a=0;i;){a++,n=i;for(var s=0;s<r&&n;s++)n=n.nextZ;for(var o=r;s>0||o>0&&n;){var c=void 0;0===s?(c=n,n=n.nextZ,o--):0!==o&&n?i.z<=n.z?(c=i,i=i.nextZ,s--):(c=n,n=n.nextZ,o--):(c=i,i=i.nextZ,s--),t?t.nextZ=c:e=c,c.prevZ=t,t=c}i=n}if(t.nextZ=null,r*=2,a<2)return e}}(e)}function bt(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function gt(e,t,r,n){return!!(kt(e,t)&&kt(r,n)||kt(e,n)&&kt(r,t))||bt(e,t,r)>0!=bt(e,t,n)>0&&bt(r,n,e)>0!=bt(r,n,t)>0}function xt(e,t,r,n,i,a,s,o){return(i-s)*(t-o)-(e-s)*(a-o)>=0&&(e-s)*(n-o)-(r-s)*(t-o)>=0&&(r-s)*(a-o)-(i-s)*(n-o)>=0}function Ot(e,t){return bt(e.prev,e,e.next)<0?bt(e,t,e.next)>=0&&bt(e,e.prev,t)>=0:bt(e,t,e.prev)<0||bt(e,e.next,t)<0}function jt(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function kt(e,t){return e.x===t.x&&e.y===t.y}function wt(e,t){return e.x-t.x}function Mt(e,t,r,n){var i=e;do{var a=i.prev,s=i.next.next;!kt(a,s)&&gt(a,i,i.next,s)&&Ot(a,s)&&Ot(s,a)&&(t.push(a.index/r+n),t.push(i.index/r+n),t.push(s.index/r+n),yt(i),yt(i.next),i=e=s),i=i.next}while(i!==e);return i}function St(e,t,r,n,i,a,s){var o=e;do{for(var c=o.next.next;c!==o.prev;){if(o.index!==c.index&&Tt(o,c)){var u=It(o,c);return o=lt(o,o.next),u=lt(u,u.next),ht(o,t,r,n,i,a,s,0),void ht(u,t,r,n,i,a,s,0)}c=c.next}o=o.next}while(o!==e)}function Tt(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){var r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&gt(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&Ot(e,t)&&Ot(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)}function It(e,t){var r=Lt.create(e.index,e.x,e.y),n=Lt.create(t.index,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}for(var Lt=function(){function e(){Object(o.a)(this,e),this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return Object(c.a)(e,null,[{key:"create",value:function(t,r,n){var i=Ct<zt.length?zt[Ct++]:new e;return i.index=t,i.x=r,i.y=n,i.prev=null,i.next=null,i.z=null,i.prevZ=null,i.nextZ=null,i.steiner=!1,i}}]),e}(),zt=new Array,Ct=0,Pt=0;Pt<8096;Pt++)zt.push(new Lt);var Vt=new ot.b(0,0,0,1,0),Et=new ot.b(0,0,0,1,0);function Rt(e,t,r){for(var n=0,i=1;i<r;i++){var a=e[2*(t+i-1)],s=e[2*(t+i-1)+1];n+=(e[2*(t+i)]-a)*(e[2*(t+i)+1]+s)}return n}function At(e,t,r,n,i){for(var a=0,s=r;s<n;s+=3){var o=2*(e.getValue(s)-i),c=2*(e.getValue(s+1)-i),u=2*(e.getValue(s+2)-i);a+=Math.abs((t[o]-t[u])*(t[c+1]-t[o+1])-(t[o]-t[c])*(t[u+1]-t[o+1]))}return a}Vt.setExtent(R.v),Et.setExtent(R.v);var Ft=function(e){return function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(o.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).forceLibtess=!1,e.geometryType=A.c.FILL,e}return Object(c.a)(r,[{key:"_write",value:function(e,t,r){var n="esriGeometryPoint"===t.geometryType,i=se.a.load(this._materialKey);e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,i.dotDensity,n),this._writeGeometry(e,t,i,r,n),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,n,i){var a=this._getGeometry(t,n,i);if(!Object(y.j)(a)){var s=e.indexCount();if(a.maxLength>100||this.forceLibtess||!function(e,t){var r=t.coords,n=t.lengths,i=t.hasIndeterminateRingOrder,a=e.indexWriter(),s=e.vertexCount();if(i)return!1;for(var o=a.length,c=0,u=0;u<n.length;){for(var l=u,h=n[u],f=Rt(r,c,h),v=[];++l<n.length;){var d=n[l],y=Rt(r,c+h,d);if(!(y>0))break;f+=y,v.push(c+h),h+=d}var p=a.length;ct(a,r,c,c+h,v,2,s);var m=At(a,r,p,a.length,s),_=Math.abs(f);if(Math.abs((m-_)/Math.max(1e-7,_))>1e-5)return a.seek(o),!1;u=l,c+=h}return!0}(e,a)){var o=function(e,t){var r=e.indexWriter(),n=e.vertexCount(),i=t.coords,a=t.lengths,s=Object(J.b)(i,a),o=s.buffer,c=s.vertexCount;r.ensureSize(c);for(var u=0;u<c;u++)r.push(u+n);return o}(e,a);s!==e.indexCount()&&this._writeVertices(e,t,o,[o.length/2],r)}else!(s===e.indexCount())&&this._writeVertices(e,t,a.coords,a.lengths,r)}}},{key:"_writeVertices",value:function(e,t,r,i,a){var s=t.getDisplayId(),o=0,c=i.reduce((function(e,t){return e+t})),u=a.dotDensity?4:10;e.vertexEnsureSize(u*c);var l,h=Object(n.a)(i);try{for(h.s();!(l=h.n()).done;){for(var f=l.value,v=f+o,d=o;d<v;d++){var y=r[2*d],p=r[2*d+1],m=Object(ae.a)(1*y,1*p);e.vertexBounds(y,p,0,0),e.vertexWrite(m),e.vertexWrite(s),a.dotDensity?e.vertexWriteF32(1/Math.abs(t.readGeometryArea())):(e.vertexWrite(this.fillColor),e.vertexWrite(this.tl),e.vertexWrite(this.br),e.vertexWrite(this.aux1),e.vertexWrite(this.aux2),e.vertexWrite(this.aux3),e.vertexWrite(this._minMaxZoom))}o+=f}}catch(_){h.e(_)}finally{h.f()}}},{key:"_getGeometry",value:function(e,t,r){var i=t?Object(je.m)(Object(je.d)(t),2):e.readGeometryForDisplay();return i?function(e,t){if(Object(y.j)(e))return null;if(!function(e,t,r){for(var n=0,i=0;i<e.lengths.length;i++){for(var a=e.lengths[i],s=0;s<a;s++){var o=e.coords[2*(s+n)],c=e.coords[2*(s+n)+1];if(o<t||o>r||c<t||c>r)return!0}n+=a}return!1}(e,-128,R.v+128))return e;Vt.setPixelMargin(t),Vt.reset(3);for(var r=0,i=0;i<e.lengths.length;i++){var a=e.lengths[i],s=e.coords[2*(0+r)],o=e.coords[2*(0+r)+1];Vt.moveTo(s,o);for(var c=1;c<a;c++)s=e.coords[2*(c+r)],o=e.coords[2*(c+r)+1],Vt.lineTo(s,o);Vt.close(),r+=a}var u=Vt.result(!1);if(!u)return null;var l,h=[],f=[],v=Object(n.a)(u);try{for(v.s();!(l=v.n()).done;){var d,p=l.value,m=0,_=Object(n.a)(p);try{for(_.s();!(d=_.n()).done;){var b=d.value;f.push(b.x),f.push(b.y),m++}}catch(g){_.e(g)}finally{_.f()}h.push(m)}}catch(g){v.e(g)}finally{v.f()}return new st.a(h,f)}(i,r?256:8):null}}]),r}(e)},Wt=r(901),Bt=d.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate"),Dt=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(o.a)(this,r),(n=t.call(this))._ongoingMaterialRequestMap=new Map,n._materialCache=new Map,n._dynamicPropertyMap=new Map,n._cimLayer=e,n}return Object(c.a)(r,[{key:"analyze",value:function(e,t,r,n){var i=this,a=t.readLegacyFeature(),s=this._materialCache,o=this._cimLayer.materialHash;if(!o)return Bt.error("A Dynamic mesh template must have a material hash value or function!"),Promise.reject(null);var c="function"==typeof o?o(a,r,n):o;if(s.has(c)){var u=s.get(c);return Promise.resolve(u)}if(this._ongoingMaterialRequestMap.has(c))return this._ongoingMaterialRequestMap.get(c);var l=Object(Wt.a)(this._cimLayer.cim,this._cimLayer.materialOverrides);l.mosaicHash=c;var h=e.getMosaicItem(l).then((function(e){return i._ongoingMaterialRequestMap.delete(c),s.set(c,e),e})).catch((function(e){return i._ongoingMaterialRequestMap.delete(c),Bt.error(".analyze()",e.message),null}));return this._ongoingMaterialRequestMap.set(c,h),h}}]),r}(Ge);function Kt(e,t){if(e&&"name"in e){var r=e;return t&&t.error(new f.a(r.name,r.message,r.details)),!1}return!0}var Gt=128,Nt=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e,n,i){var a,s;if(Object(o.a)(this,r),(a=t.call(this,e))._minMaxZoom=Object(ae.a)(Math.round(n*R.h),Math.round(i*R.h)),ve(e.color)){a._dynamicPropertyMap.set("fillColor",(function(t,r,n){var i=e.color(t,r,n);return i&&Object(ie.c)(i)||0}))}else{var c=e.color;a.fillColor=c&&Object(ie.c)(c)||0}var u=0;ve(e.height)||(u=e.height||0);var l="CIMMarkerPlacementInsidePolygon"===(null==(s=e.cim.placement)?void 0:s.type)&&e.cim.placement.shiftOddRows?2:1;a._dynamicPropertyMap.set("_height",(function(t,r,n){return ve(e.height)?e.height(t,r,n)*l:u*l}));var h=0;ve(e.offsetX)||(h=Object(ee.g)(e.offsetX||0)+Gt)>255&&(h=255);a._dynamicPropertyMap.set("_offsetX",(function(t,r,n){if(ve(e.offsetX)){var i=Object(ee.g)(e.offsetX(t,r,n))+Gt;return i>255&&(i=255),i}return h}));var f=1;ve(e.scaleX)||(f=e.scaleX||1);a._dynamicPropertyMap.set("_scaleX",(function(t,r,n){return ve(e.scaleX)?e.scaleX(t,r,n):f}));var v=0;ve(e.offsetY)||(v=Object(ee.g)(-e.offsetY||0)+Gt)>255&&(v=255);a._dynamicPropertyMap.set("_offsetY",(function(t,r,n){if(ve(e.offsetY)){var i=Object(ee.g)(-e.offsetY(t,r,n))+Gt;return i>255&&(i=255),i}return v}));var d=0;ve(e.angle)||(d=Object(at.c)(e.angle)||0);return a._dynamicPropertyMap.set("_angle",(function(t,r,n){return ve(e.angle)?Object(at.c)(e.angle(t,r,n)):d})),a._effects=e.effects,a._cimFillLayer=e,a._fillMaterialKey=se.a.load(e.materialKey),Object(it.a)(a)}return Object(c.a)(r,[{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)}));var a=this._fillMaterialKey,s=this._materialCache,o=this._cimFillLayer;this.aux3=Object(ae.b)(0,0,this._angle,o.colorLocked?1:0);var c=(0,o.materialHash)(i,t,r),u=s.get(c),l=null;if(u&&Kt(u.spriteMosaicItem)&&(l=u.spriteMosaicItem),l){var h=l,f=h.rect,v=h.width,d=h.height,y=f.x+R.l,p=f.y+R.l,m=y+v,_=p+d,b=Object($.p)(Object(ee.g)(this._height));b>255?b=255:b<=0&&(b=Object($.p)(_-p));var g=Object($.p)(Object(ee.g)(this._height/d*v||0));g>255?g=255:g<=0&&(g=Object($.p)(m-y));var x=this._scaleX;this.tl=Object(ae.a)(y,p),this.br=Object(ae.a)(m,_),this.aux1=Object(ae.b)(g,b,this._offsetX,this._offsetY),this.aux2=Object(ae.a)(Gt*x,128),a.sdf=l.sdf,a.pattern=!0,a.textureBinding=l.textureBinding}else this.tl=0,this.br=0,this.aux1=0,this.aux2=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data}}],[{key:"fromCIMFill",value:function(e,t){var n=ye(e.scaleInfo,t),i=Object(Q.a)(n,2);return new r(e,i[0],i[1])}}]),r}(Ft(Dt)),Zt=r(961),Ut=31,Xt=function(e){return function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(){var e;Object(o.a)(this,r);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(e=t.call.apply(t,[this].concat(i))).tessellationProperties={},e._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0},e.geometryType=A.c.LINE,e}return Object(c.a)(r,[{key:"_initializeTessellator",value:function(e){var t=se.c.load(this._materialKey),r=this._tessellationOptions,n=t.vvSizeFieldStops||t.vvSizeMinMaxValue||t.vvSizeScaleStops||t.vvSizeUnitValue,i=this.tessellationProperties._halfWidth<R.u;this.tessellationProperties.minMaxZoom=this._minMaxZoom;var a=i&&!e&&!n;r.wrapDistance=65535,r.textured=this._isDashed||this._hasPattern,r.offset=this.tessellationProperties.offset,r.halfWidth=this.tessellationProperties._halfWidth;var s=a?0:1;this._lineTessellator=new Zt.a(qt(this.tessellationProperties,s,s),Yt(this.tessellationProperties),a)}},{key:"_write",value:function(e,t,r){var n="esriGeometryPoint"===t.geometryType;e.recordStart(t.getDisplayId(),this._materialKey,this.geometryType,!1,n),this._writeGeometry(e,t,r,n),e.recordEnd()}},{key:"_writeGeometry",value:function(e,t,r,n){var i=null!=r?r:t.readLegacyGeometryForDisplay(),a=this._getLines(i,n);Object(y.j)(a)||this._writeVertices(e,t,a)}},{key:"_getLines",value:function(e,t){if(Object(y.j)(e))return null;var r=e.paths||e.rings;return Object(y.j)(r)?null:function(e,t){Et.setPixelMargin(t);for(var r=Et,i=-t,a=R.v+t,s=[],o=!1,c=0;c<e.length;){var u=[],l=e[c];if(!l)return null;r.reset(2);var h=Object(Q.a)(l[0],2),f=h[0],v=h[1];if(o)r.moveTo(f,v);else{if(f<i||f>a||v<i||v>a){o=!0;continue}u.push({x:f,y:v})}for(var d=!1,y=l.length,p=1;p<y;++p)if(f+=l[p][0],v+=l[p][1],o)r.lineTo(f,v);else{if(f<i||f>a||v<i||v>a){d=!0;break}u.push({x:f,y:v})}if(d)o=!0;else{if(o){var m=r.resultWithStarts();if(m){var _,b=Object(n.a)(m);try{for(b.s();!(_=b.n()).done;){var g=_.value;s.push(g)}}catch(x){b.e(x)}finally{b.f()}}}else s.push({line:u,start:0});c++,o=!1}}return s=s.filter((function(e){return e.line.length>1})),0===s.length?null:s}(r,t?256:16)}},{key:"_writeVertices",value:function(e,t,r){var i=t.getDisplayId(),a=e.vertexCount(),s=this.tessellationProperties,o=this._tessellationOptions;s.out=e,s.id=i,s.indexCount=0,s.vertexCount=0,s.offset=a,o.capType=this._capType,o.joinType=this._joinType;var c,u=Object(n.a)(r);try{for(u.s();!(c=u.n()).done;){var l=c.value,h=l.line,f=l.start;o.initialDistance=f%65535,this._lineTessellator.tessellate(h,o)}}catch(v){u.e(v)}finally{u.f()}}}]),r}(e)},qt=function(e,t,r){return function(n,i,a,s,o,c,u,l,h,f,v){var d=Object(ae.a)(v,Math.ceil(1024*e._halfWidth)),y=Object(ae.b)(Math.round(Ut*u),Math.round(Ut*l),Math.round(Ut*h),Math.round(Ut*f)),p=Object(ae.b)(Ut*o,Ut*c,0,e._bitset),m=e.out;return m.vertexBounds(n,i,t,r),m.vertexWrite(Object(ae.a)(8*n,8*i)),m.vertexWrite(e.id),m.vertexWrite(e._fillColor),m.vertexWrite(y),m.vertexWrite(d),m.vertexWrite(e._tl),m.vertexWrite(e._br),m.vertexWrite(p),m.vertexWrite(Object(ae.a)(Math.ceil(1024*e._halfReferenceWidth),0)),m.vertexWrite(e.minMaxZoom),m.vertexEnd(),e.offset+e.vertexCount++}},Yt=function(e){return function(t,r,n){var i=e.out;i.indexWrite(t),i.indexWrite(r),i.indexWrite(n),e.indexCount+=3}},Ht=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e,n,i){var a;Object(o.a)(this,r),(a=t.call(this,e))._minMaxZoom=Object(ae.a)(Math.round(n*R.h),Math.round(i*R.h)),a._cimLineLayer=e;var s=0;ve(e.width)||(s=.5*Object(ee.g)(e.width));if(a._dynamicPropertyMap.set("_halfWidth",(function(t,r,n){return ve(e.width)?.5*Object(ee.g)(e.width(t,r,n)):s})),ve(e.cap)?a._dynamicPropertyMap.set("_capType",e.cap):a._capType=e.cap,ve(e.join)?a._dynamicPropertyMap.set("_joinType",e.join):a._joinType=e.join,ve(e.color)){a._dynamicPropertyMap.set("_fillColor",(function(t,r,n){var i=e.color(t,r,n);return i&&Object(ie.c)(i)||0}))}else{var c=e.color;a._fillColor=c&&Object(ie.c)(c)||0}if(ve(e.miterLimit)){a._dynamicPropertyMap.set("_miterLimitCosine",(function(t,r,n){return de(e.miterLimit(t,r,n))}))}else a._miterLimitCosine=de(e.miterLimit);return a._scaleFactor=e.scaleFactor||1,a._isDashed=e.isDashed,a._effects=e.effects,a.tessellationProperties._bitset=e.colorLocked?1:0,a._materialKey=e.materialKey,a._initializeTessellator(!0),a}return Object(c.a)(r,[{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)})),this._halfWidth*=this._scaleFactor;var a=this._materialCache,s=(0,this._cimLineLayer.materialHash)(i,t,r),o=a.get(s),c=null;if(o&&Kt(o.spriteMosaicItem)&&(c=o.spriteMosaicItem),c){this._hasPattern=!0;var u=c,l=u.rect,h=u.width,f=u.height,v=l.x+R.l,d=l.y+R.l,y=v+h,p=d+f;this.tessellationProperties._tl=Object(ae.a)(v,d),this.tessellationProperties._br=Object(ae.a)(y,p)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties.offset=0,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;var m=se.c.load(this._materialKey);c&&(m.sdf=c.sdf,m.pattern=!0,m.textureBinding=c.textureBinding),this._materialKey=m.data}}],[{key:"fromCIMLine",value:function(e,t){var n=ye(e.scaleInfo,t),i=Object(Q.a)(n,2);return new r(e,i[0],i[1])}}]),r}(Xt(Dt)),Jt=Object(Ie.a)(),Qt=Object(Te.a)(),$t=d.a.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate"),er=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e,n,i){var a;if(Object(o.a)(this,r),(a=t.call(this,e))._cimMarkerLayer=e,a._minMaxZoom=Object(ae.a)(Math.round(n*R.h),Math.round(i*R.h)),ve(e.color)){a._dynamicPropertyMap.set("_fillColor",(function(t,r,n){return Object(ie.c)(e.color(t,r,n))}))}else a._fillColor=Object(ie.c)(e.color);if(ve(e.outlineColor)){a._dynamicPropertyMap.set("_outlineColor",(function(t,r,n){return Object(ie.c)(e.outlineColor(t,r,n))}))}else a._outlineColor=Object(ie.c)(e.outlineColor);if(ve(e.size)){a._dynamicPropertyMap.set("_size",(function(t,r,n){return Object(ee.g)(e.size(t,r,n))}))}else a._size=Object(ee.g)(e.size)||0;if(ve(e.scaleX)?a._dynamicPropertyMap.set("_scaleX",e.scaleX):a._scaleX=e.scaleX||1,ve(e.offsetX)){a._dynamicPropertyMap.set("xOffset",(function(t,r,n){return Object(ee.g)(e.offsetX(t,r,n))}))}else a.xOffset=Object(ee.g)(e.offsetX)||0;if(ve(e.offsetY)){a._dynamicPropertyMap.set("yOffset",(function(t,r,n){return Object(ee.g)(e.offsetY(t,r,n))}))}else a.yOffset=Object(ee.g)(e.offsetY)||0;if(ve(e.outlineWidth)){a._dynamicPropertyMap.set("_outlineWidth",(function(t,r,n){return Object(ee.g)(e.outlineWidth(t,r,n))}))}else a._outlineWidth=Object(ee.g)(e.outlineWidth)||0;return ve(e.rotation)?a._dynamicPropertyMap.set("_angle",e.rotation):a._angle=e.rotation||0,a._scaleFactor=Object(y.u)(e.scaleFactor,1),a._markerPlacement=e.markerPlacement,a._effects=e.effects,a._bitSet=(1===e.alignment?1:0)|(e.colorLocked?1:0)<<1|(e.scaleSymbolsProportionally?1:0)<<3,a._materialKey=e.materialKey,Object(it.a)(a)}return Object(c.a)(r,[{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)}));var a=this._cimMarkerLayer.materialHash,s="function"==typeof a?a(i,t,r):a,o=this._materialCache.get(s);if(o&&Kt(o.spriteMosaicItem)&&o.spriteMosaicItem){var c=o.spriteMosaicItem,u=this._cimMarkerLayer.sizeRatio,l=c.width/c.height*this._scaleX,h=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle,v=this._size,d=v*l,y=this.xOffset,p=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;var m=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/Object(ee.g)(this._cimMarkerLayer.frameHeight):1,_=this._outlineWidth*m,b=Object(ee.g)(this._cimMarkerLayer.referenceSize),g=0,x=0,O=this._cimMarkerLayer.anchorPoint;O&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(g=-O.x/(this._size*l),x=O.y/this._size):(g=O.x,x=O.y)),this._sizeOutlineWidth=Object(ae.b)(Math.round(Math.min(Math.sqrt(128*d),255)),Math.round(Math.min(Math.sqrt(128*v),255)),Math.round(Math.min(Math.sqrt(128*_),255)),Math.round(Math.min(Math.sqrt(128*b),255))),this.angle=h;var j=Math.round(64*u);this._bitestAndDistRatio=Object(ae.a)(this._bitSet,j);var k=c.rect.x+R.l,w=c.rect.y+R.l,M=k+c.width,S=w+c.height;this._texUpperLeft=Object(ae.a)(k,w),this._texUpperRight=Object(ae.a)(M,w),this._texBottomLeft=Object(ae.a)(k,S),this._texBottomRight=Object(ae.a)(M,S);var T=se.d.load(this._materialKey);T.sdf=c.sdf,T.pattern=!0,T.textureBinding=c.textureBinding,this._materialKey=T.data,this._anchorX=.5-(.5+g)*c.width/c.width,this._anchorY=.5-(.5+x)*c.height/c.height,d*=u,v*=u,d*=this._scaleFactor,v*=this._scaleFactor,d*=c.rect.width/c.width,v*=c.rect.height/c.height,this._computedWidth=d,this._computedHeight=v,this._applyTransformation(Qt,Jt),this.xOffset=y,this.yOffset=p}else $t.error(new f.a("mapview-cim","Encountered an error when binding feature"))}}],[{key:"fromCIMMarker",value:function(e,t){var n=ye(e.scaleInfo,t),i=Object(Q.a)(n,2);return new r(e,i[0],i[1])}}]),r}(et(Dt));function tr(e){for(var t=new Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function rr(e,t,r,n){return"string"==typeof e.text?e.text:"function"==typeof e.text?e.text(t,r,n):""}var nr=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e,n,i){var a;Object(o.a)(this,r),(a=t.call(this,e))._horizontalAlignment="center",a._verticalAlignment="middle",a._textToGlyphs=new Map,a._minMaxZoom=Object(ae.a)(Math.round(n*R.h),Math.round(i*R.h));var s,c=e.scaleFactor||1;if(a._cimTextLayer=e,ve(e.color)){a._dynamicPropertyMap.set("_color",(function(t,r,n){return Object(ie.c)(e.color(t,r,n))}))}else a._color=Object(ie.c)(e.color);if(ve(e.color)){a._dynamicPropertyMap.set("_haloColor",(function(t,r,n){return Object(ie.c)(e.outlineColor(t,r,n))}))}else a._haloColor=Object(ie.c)(e.outlineColor);ve(e.size)||(s=Math.min(Math.round(Object(ee.g)(e.size*e.sizeRatio)),127));var u;if(a._dynamicPropertyMap.set("_size",(function(t,r,n){return ve(e.size)?Math.min(Math.round(Object(ee.g)(e.size(t,r,n)*e.sizeRatio)),127):s})),ve(e.outlineSize)){a._dynamicPropertyMap.set("_haloSize",(function(t,r,n){return Math.min(Math.floor(5*Object(ee.g)(e.outlineSize(t,r,n)*e.sizeRatio)),127)}))}else a._haloSize=Math.min(Math.floor(5*Object(ee.g)(e.outlineSize*e.sizeRatio)),127);ve(e.offsetX)||(u=Math.round(Object(ee.g)(e.offsetX*e.sizeRatio)));var l;a._dynamicPropertyMap.set("_xOffset",(function(t,r,n){return ve(e.offsetX)?Math.round(Object(ee.g)(e.offsetX(t,r,n)*e.sizeRatio)):u})),ve(e.offsetY)||(l=Math.round(Object(ee.g)(e.offsetY*e.sizeRatio)));a._dynamicPropertyMap.set("_yOffset",(function(t,r,n){return ve(e.offsetY)?Math.round(Object(ee.g)(e.offsetY(t,r,n)*e.sizeRatio)):l})),ve(e.angle)?a._dynamicPropertyMap.set("_angle",e.angle):a._angle=e.angle,ve(e.horizontalAlignment)?a._dynamicPropertyMap.set("_horizontalAlignment",e.horizontalAlignment):a._horizontalAlignment=e.horizontalAlignment,ve(e.verticalAlignment)?a._dynamicPropertyMap.set("_verticalAlignment",e.verticalAlignment):a._verticalAlignment=e.verticalAlignment,a._scaleFactor=c,ve(e.text)?a._dynamicPropertyMap.set("_text",e.text):a._text=e.text;var h=Math.min(Math.round(Object(ee.g)(e.referenceSize*e.sizeRatio)),127);a._referenceSize=Math.round(Math.sqrt(256*h)),a._materialKey=e.materialKey;var f=se.f.load(a._materialKey);return f.sdf=!0,a._bitset=(1===e.alignment?1:0)|(e.colorLocked?1:0)<<1,a._materialKey=f.data,a._decoration="none",a._lineHeight=1,a._lineWidth=512,a._textPlacement=e.markerPlacement,a._effects=e.effects,a._isCIM=!0,a}return Object(c.a)(r,[{key:"analyze",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n,i){var s,o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=r.readLegacyFeature(),o=rr(this._cimTextLayer,s,n,i),e.next=4,t.getMosaicItem(this._cimTextLayer.cim,tr(o));case 4:return c=e.sent,e.abrupt("return",(this._textToGlyphs.set(o,c.glyphMosaicItems),c));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"bindFeature",value:function(e,t,r){var n=this,i=e.readLegacyFeature();if(this._dynamicPropertyMap.forEach((function(e,a){n[a]=e(i,t,r)})),this._text&&0!==this._text.length){this._size*=this._scaleFactor,this._scale=this._size/24,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=te(this._horizontalAlignment||"center"),this._yAlignD=re(this._verticalAlignment||"baseline");var a=this._textToGlyphs.get(this._text);this.bindTextInfo(a,!1)}else this._shapingInfo=null}}],[{key:"fromCIMText",value:function(e,t){var n=ye(e.scaleInfo,t),i=Object(Q.a)(n,2);return new r(e,i[0],i[1])}}]),r}(Be(Dt)),ir=128,ar=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e,n,i,a,s,c,u,l,h,f,v){var d;Object(o.a)(this,r),(d=t.call(this))._effects=h;var y=se.a.load(e);return n&&(y.sdf=n.sdf,y.pattern=!0,y.textureBinding=n.textureBinding),d.fillColor=i,d.tl=a,d.br=s,d.aux1=c,d.aux2=u,d.aux3=l,d._minMaxZoom=Object(ae.a)(Math.round(f*R.h),Math.round(v*R.h)),d._materialKey=y.data,d}return Object(c.a)(r,null,[{key:"fromCIMFill",value:function(e,t,n){var i=e.color,a=i&&Object(ie.c)(i)||0,s=e.materialKey,o=ye(e.scaleInfo,n),c=Object(Q.a)(o,2),u=c[0],l=c[1];if(!t)return new r(s,null,a,0,0,0,0,Object(ae.b)(0,0,0,e.colorLocked?1:0),e.effects,u,l);var h=t.rect,f=t.width,v=t.height,d=h.x+R.l,y=h.y+R.l,p=d+f,m=y+v,_=Object($.p)(v);_>255?_=255:_<=0&&(_=Object($.p)(m-y));var b=Object($.p)(f||0);b>255?b=255:b<=0&&(b=Object($.p)(p-d));var g=Object(ee.g)(e.offsetX||0)+ir;g>255&&(g=255);var x=Object(ee.g)(-e.offsetY||0)+ir;x>255&&(x=255);var O=e.scaleX||1;return new r(s,t,a,Object(ae.a)(d,y),Object(ae.a)(p,m),Object(ae.b)(b,_,g,x),Object(ae.a)(ir*O,128),Object(ae.b)(0,0,Object(at.b)(e.angle),e.colorLocked?1:0),e.effects,u,l)}},{key:"fromSimpleFill",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.color,a=i&&"esriSFSNull"!==e.style&&Object(ie.d)(i)||0,s=Object(ae.b)(0,0,0,n?255:0),o=e.materialKey;if(!t)return new r(o,null,a,0,0,0,0,s,null,0,ce);var c=t.rect,u=t.width,l=t.height,h=c.x+R.l,f=c.y+R.l,v=h+u,d=f+l,y=Object(ae.a)(h,f),p=Object(ae.a)(v,d),m=Object(ae.b)(Object($.p)(v-h),Object($.p)(d-f),0,0),_=Object(ae.a)(ir,ir);return new r(o,t,a,y,p,m,_,s,null,0,ce)}},{key:"fromPictureFill",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=R.k,a=t.rect,s=t.width,o=t.height,c=a.x+R.l,u=a.y+R.l,l=c+s,h=u+o,f=Object(ae.a)(c,u),v=Object(ae.a)(l,h),d=Object($.p)(Object(ee.g)(e.width));d>255&&(d=255);var y=Object($.p)(Object(ee.g)(e.height));y>255&&(y=255);var p=Object(ee.g)(e.xoffset)+ir;p>255&&(p=255);var m=Object(ee.g)(-e.yoffset)+ir;m>255&&(m=255);var _=Object(ae.b)(d,y,p,m),b=Object(ae.a)(ir*e.xscale,ir*e.yscale),g=Object(ae.b)(0,0,0,n?255:0),x=e.materialKey;return new r(x,t,i,f,v,_,b,g,null,0,ce)}}]),r}(Ft(Ge)),sr=d.a.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate"),or=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e,n,i,a,s,c,u,l,h,f,v,d,y,p,m,_,b){var g;Object(o.a)(this,r),g=t.call(this);var x=se.c.load(e);return n&&(x.sdf=n.sdf,x.pattern=!0,x.textureBinding=n.textureBinding),g._capType=a,g._joinType=s,g._miterLimitCosine=de(c),g.tessellationProperties._fillColor=u,g.tessellationProperties._tl=l,g.tessellationProperties._br=h,g._hasPattern=f,g._isDashed=v,g._isColorLocked=d,g._zOrder=p,g._effects=m,g._minMaxZoom=Object(ae.a)(Math.round(_*R.h),Math.round(b*R.h)),g._materialKey=x.data,g.tessellationProperties._bitset=d?1:0,g.tessellationProperties._halfWidth=.5*i,g.tessellationProperties._halfReferenceWidth=.5*y,g.tessellationProperties.offset=0,g._initializeTessellator(!1),g}return Object(c.a)(r,null,[{key:"fromCIMLine",value:function(e,t,n){var i=e.color,a=e.scaleFactor||1,s=e.isDashed,o=e.cap;s&&1===o&&(o=2);var c=e.join,u=Object(ee.g)(e.width)*a,l=Object(ee.g)(e.referenceWidth),h=Object(ee.g)(e.miterLimit),f=i&&Object(ie.c)(i)||0,v=ye(e.scaleInfo,n),d=Object(Q.a)(v,2),y=d[0],p=d[1];if(!t)return new r(e.materialKey,t,u,o,c,h,f,0,0,!1,s,e.colorLocked,l,e.zOrder,e.effects,y,p);var m=t.rect,_=t.width,b=t.height,g=m.x+R.l,x=m.y+R.l,O=g+_,j=x+b,k=Object(ae.a)(g,x),w=Object(ae.a)(O,j);return new r(e.materialKey,t,u,o,c,h,f,k,w,!0,s,e.colorLocked,l,e.zOrder,e.effects,y,p)}},{key:"fromSimpleLine",value:function(e,t){var n=e.color,i="esriSLSSolid"!==e.style&&"esriSLSNull"!==e.style,a=Object(F.b)(e.cap||"round"),s=Object(F.c)(e.join||"round"),o=n&&"esriSLSNull"!==e.style&&Object(ie.d)(n)||0;"esriSLSNull"===e.style&&(o=0);var c=Object(ee.g)(e.width),u=e.miterLimit;if(!t)return new r(e.materialKey,t,c,a,s,u,o,0,0,!1,i,!1,c,0,null,0,ce);var l=t.rect,h=t.width,f=t.height,v=l.x+R.l,d=l.y+R.l,y=v+h,p=d+f,m=Object(ae.a)(v,d),_=Object(ae.a)(y,p);return new r(e.materialKey,t,c,a,s,u,o,m,_,!0,i,!1,c,0,null,0,ce)}},{key:"fromPictureLineSymbol",value:function(e,t,r,n){return sr.error("PictureLineSymbol support does not exist!"),null}}]),r}(Xt(Ge)),cr=function(){function e(){Object(o.a)(this,e),this._resolver=null}return Object(c.a)(e,[{key:"isHeld",value:function(){return!!this._resolver}},{key:"acquire",value:function(){var e=Object(s.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._resolver){e.next=2;break}return e.abrupt("return",(this._resolver=Object(p.h)(),Promise.resolve()));case 2:return e.next=4,this._resolver.promise;case 4:return e.next=6,this.acquire();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"release",value:function(){var e=this._resolver;this._resolver=null,e.resolve()}}]),e}();function ur(){return ur=Object(s.a)(a.a.mark((function e(t,r,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.acquire();case 3:return e.next=5,r(n);case 5:t.release(),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(0),t.release(),e.t0;case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),ur.apply(this,arguments)}r(44),r(455),r(549),r(550),r(551),r(194),r(421),r(419),r(459);var lr=r(25),hr=r(189),fr=r(956);r(845);var vr=r(860);r(461),r(102),r(457),r(183),r(56),Math.PI,Object(Te.a)(),Object(Ie.a)();Object(Ie.a)(),Object(Ie.a)(),Object(Ie.a)(),Object(Ie.a)(),Object(Ie.a)(),Object(Ie.a)(),Object(Ie.a)();function dr(e){if(!("visualVariables"in e))return 0;if(!e.hasVisualVariables("size"))return 0;var t=e.getVisualVariablesForType("size");if(!t[0])return 0;var r=t[0];if("outline"===r.target)return 0;if("stops"===r.transformationType)return r.stops.map((function(e){return e.size})).reduce(yr,0);if("clamped-linear"===r.transformationType){var n,i;return n="number"==typeof r.maxSize?r.maxSize:r.maxSize.stops.map((function(e){return e.size})).reduce(yr,0),i="number"==typeof r.minSize?r.minSize:r.minSize.stops.map((function(e){return e.size})).reduce(yr,0),Math.max(n,i)}return"real-world-size"===r.transformationType?30:void 0}R.c.metrics,new vr.a(0,0,24,24);function yr(e,t){return Math.max(e,t)}r(649),r(648),r(388),r(650);d.a.getLogger("esri.renderers.visualVariables.support.utils");r(869);var pr,mr=r(468),_r=(r(664),r(45)),br=r(220),gr=pr=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(){return Object(o.a)(this,r),t.apply(this,arguments)}return Object(c.a)(r,[{key:"writeLevels",value:function(e,t,r){for(var n in e){var i=this.levels[n];return void(t.stops=i)}}},{key:"clone",value:function(){return new pr({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Object(br.c)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Object(br.c)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map((function(e){return e.clone()})),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:Object(lr.a)(this.levels)})}}]),r}(mr.a);Object(h.a)([Object(m.b)()],gr.prototype,"levels",void 0),Object(h.a)([Object(_r.a)("levels")],gr.prototype,"writeLevels",null),gr=pr=Object(h.a)([Object(_.a)("esri.views.2d.engine.LevelDependentSizeVariable")],gr);d.a.getLogger("esri.views.2d.layers.support.clusterUtils");v.a.add("esri-cluster-arcade-enabled",!0);Object(v.a)("esri-cluster-arcade-enabled");new(r(59).a)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});d.a.getLogger("esri.views.2d.layers.features.schemaUtils");function xr(e){return Object(se.h)(e)}function Or(e){var t;return"line-marker"===e.type?{type:"line-marker",color:null==(t=e.color)?void 0:t.toJSON(),placement:e.placement,style:e.style}:Object(hr.a)(e.toJSON()).toJSON()}function jr(e,t,r){if(!e)return null;var i=0,a=!1,s=0;switch(Object(y.k)(t)&&(s=dr(t),"visualVariables"in t&&(i=function(e){if(!e)return A.d.NONE;var t,r=0,i=Object(n.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if("size"===a.type){var s=Object(fr.a)(a);r|=s,"outline"===a.target&&(r|=s<<4)}else"color"===a.type?r|=A.d.COLOR:"opacity"===a.type?r|=A.d.OPACITY:"rotation"===a.type&&(r|=A.d.ROTATION)}}catch(o){i.e(o)}finally{i.f()}return r}(t.visualVariables||[]),a="dot-density"===t.type)),e.type){case"simple-fill":case"picture-fill":return function(e,t,r,n){var i=Object(se.g)(A.c.FILL,t,!1,r),a=n?xr(i):i,s=e.clone(),o=s.outline;s.outline=null;var c=[],u=Object(rt.a)({materialKey:a,hash:s.hash()},Or(s));if(c.push(u),o){var l=Object(se.g)(A.c.LINE,t,!0,!1),h=Object(rt.a)({materialKey:n?xr(l):l,hash:o.hash()},Or(o));c.push(h)}return{type:"composite-symbol",layers:c,hash:c.reduce((function(e,t){return t.hash+e}),"")}}(e,i,a,r);case"simple-marker":case"picture-marker":return function(e,t,r,n){var i=Object(se.g)(A.c.MARKER,t,!1,!1),a=n?xr(i):i,s=Or(e);return Object(rt.a)(Object(rt.a)({materialKey:a,hash:e.hash()},s),{},{angle:e.angle,maxVVSize:r})}(e,i,s,r);case"simple-line":return function(e,t,r){var n=Object(se.g)(A.c.LINE,t,!1,!1),i=r?xr(n):n,a=e.clone(),s=a.marker;a.marker=null;var o=[];if(o.push(Object(rt.a)({materialKey:i,hash:a.hash()},Or(a))),s){var c,u=Object(se.g)(A.c.MARKER,t,!1,!1),l=r?xr(u):u;s.color=null!=(c=s.color)?c:a.color,o.push(Object(rt.a)({materialKey:l,hash:s.hash(),lineWidth:a.width},Or(s)))}return{type:"composite-symbol",layers:o,hash:o.reduce((function(e,t){return t.hash+e}),"")}}(e,i,r);case"text":return function(e,t,r,n){var i=Object(se.g)(A.c.TEXT,t,!1,!1),a=n?xr(i):i,s=Or(e);return Object(rt.a)(Object(rt.a)({materialKey:a,hash:e.hash()},s),{},{angle:e.angle,maxVVSize:r})}(e,i,s,r);case"label":return function(e,t,r){var n=e.toJSON(),i=Object(se.g)(A.c.LABEL,t,!1,!1,n.labelPlacement);return Object(rt.a)(Object(rt.a)({materialKey:r?xr(i):i,hash:e.hash()},n),{},{labelPlacement:n.labelPlacement})}(e,i,r);case"cim":return{type:"cim",rendererKey:i,data:e.data,maxVVSize:s};case"web-style":return Object(rt.a)(Object(rt.a)({},Or(e)),{},{type:"web-style",hash:e.hash(),rendererKey:i,maxVVSize:s});default:throw new Error("symbol not supported ".concat(e.type))}}var kr=d.a.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),wr=new Array;function Mr(e,t){var r=e.length;return e.push(null),t.then((function(t){return e[r]=t})),e}function Sr(e){return!!(1&e)}var Tr=function(){function e(t,r){Object(o.a)(this,e),this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new cr,this._fetchResource=t,this._tileInfo=r}return Object(c.a)(e,[{key:"_markerError",get:function(){return this._errorTemplates.marker[0]}},{key:"_fillError",get:function(){return this._errorTemplates.fill[0]}},{key:"_lineError",get:function(){return this._errorTemplates.line[0]}},{key:"_textError",get:function(){return this._errorTemplates.line[0]}},{key:"createTemplateGroup",value:function(e,t){this._initErrorTemplates();var r=e.hash;if(this._symbolToTemplate.has(r))return this._symbolToTemplate.get(r);var n=new Array;t&&this._createMeshTemplates(n,t,!0),this._createMeshTemplates(n,e,!1);var i=this._createGroupId("expanded-cim"===e.type);return this._idToTemplateGroup.set(i,n),this._symbolToTemplate.set(r,i),i}},{key:"getTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?this._idToTemplateGroup.get(e):wr}},{key:"getDynamicTemplateGroup",value:function(e){return this._idToTemplateGroup.has(e)?(Sr(e)||kr.error("mapview-template-store","Id ".concat(e," does not refer to a dynamic template")),this._idToTemplateGroup.get(e)):wr}},{key:"getMosaicItem",value:function(e,t){var r=this,n=this._createTemplateId(),i=new Promise((function(e){return r._idToResolver.set(n,e)}));return this._fetchQueue.push({symbol:e,id:n,glyphIds:t}),i}},{key:"finalize",value:function(e){return this._fetchQueue.length||this._lock.isHeld()?function(e,t,r){return ur.apply(this,arguments)}(this._lock,this._fetchAllQueuedResources.bind(this),e):Promise.resolve()}},{key:"_initErrorTemplates",value:function(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],jr(nt.f),!1),marker:this._createMeshTemplates([],jr(nt.e),!1),line:this._createMeshTemplates([],jr(nt.g),!1)})}},{key:"_fetchAllQueuedResources",value:function(e){var t=this;if(!this._fetchQueue.length)return Promise.resolve();var r=this._fetchQueue,i=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],Promise.all(i).then((function(){return t._fetchResource(r,e).then((function(e){var r,i=Object(n.a)(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,s=a.id,o=a.mosaicItem;t._idToResolver.get(s)(o),t._idToResolver.delete(s)}}catch(c){i.e(c)}finally{i.f()}}))})).catch((function(e){Object(p.n)(e)?t._fetchQueue=t._fetchQueue.concat(r):function(e){return"worker:port-closed"===e.name}(e)||kr.error(new f.a("mapview-template-store","Unable to fetch requested texture resources",e))}))}},{key:"_createGroupId",value:function(e){return this._idCounter++<<1|(e?1:0)}},{key:"_createTemplateId",value:function(){return this._templateIdCounter++}},{key:"_createSMS",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",Kt(n,kr)?tt.fromSimpleMarker(t,n):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createPMS",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",Kt(n,kr)?tt.fromPictureMarker(t,n):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createSFS",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return n=e.sent,i=n.spriteMosaicItem,e.abrupt("return",Kt(i,kr)?ar.fromSimpleFill(t,i,r):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createPFS",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return n=e.sent,i=n.spriteMosaicItem,e.abrupt("return",Kt(i,kr)?ar.fromPictureFill(t,i,r):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createSLS",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return n=e.sent,i=n.spriteMosaicItem,e.abrupt("return",Kt(i,kr)?or.fromSimpleLine(t,i):this._lineError);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_createLMS",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",Kt(n,kr)?tt.fromLineSymbolMarker(t,n):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createTS",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t);case 2:return r=e.sent,n=r.glyphMosaicItems,e.abrupt("return",Ue.fromText(t,n));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMText",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t.cim,tr(t.text));case 2:return r=e.sent,n=r.glyphMosaicItems,e.abrupt("return",Kt(n,kr)?Ue.fromCIMText(t,n,this._tileInfo):this._textError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMFill",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t.cim);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",Kt(n,kr)?ar.fromCIMFill(t,n,this._tileInfo):this._fillError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMLine",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t.cim);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",Kt(n,kr)?or.fromCIMLine(t,n,this._tileInfo):this._lineError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIMMarker",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMosaicItem(t.cim);case 2:return r=e.sent,n=r.spriteMosaicItem,e.abrupt("return",Kt(n,kr)?tt.fromCIMMarker(t,n,this._tileInfo):this._markerError);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createCIM",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n,i,s=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.templateHash,!this._cimTemplateCache.has(r)){e.next=3;break}return e.abrupt("return",this._cimTemplateCache.get(r));case 3:n=Object(rt.a)(Object(rt.a)({},t),{},{cim:Object(rt.a)(Object(rt.a)({},t.cim),{},{mosaicHash:t.materialHash})}),e.t0=n.type,e.next="marker"===e.t0?7:"line"===e.t0?9:"fill"===e.t0?11:"text"===e.t0?13:14;break;case 7:return i=this._createCIMMarker(n),e.abrupt("break",14);case 9:return i=this._createCIMLine(n),e.abrupt("break",14);case 11:return i=this._createCIMFill(n),e.abrupt("break",14);case 13:i=this._createCIMText(n);case 14:return e.abrupt("return",(i.then((function(e){return s._cimTemplateCache.set(r,e)})),i));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createDynamicCIM",value:function(e){var t,r=e.templateHash;if(this._cimTemplateCache.has(r))return this._cimTemplateCache.get(r);switch(e.type){case"marker":t=er.fromCIMMarker(e,this._tileInfo);break;case"line":t=Ht.fromCIMLine(e,this._tileInfo);break;case"fill":t=Nt.fromCIMFill(e,this._tileInfo);break;case"text":t=nr.fromCIMText(e,this._tileInfo)}return this._cimTemplateCache.set(r,t),t}},{key:"_createPrimitiveMeshTemplates",value:function(e,t,r){switch(t.type){case"esriSMS":return Mr(e,this._createSMS(t));case"esriPMS":return Mr(e,this._createPMS(t));case"esriSFS":return Mr(e,this._createSFS(t,r));case"line-marker":return Mr(e,this._createLMS(t));case"esriPFS":return Mr(e,this._createPFS(t,r));case"esriSLS":return Mr(e,this._createSLS(t,!1));case"esriTS":return Mr(e,this._createTS(t));default:return kr.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),e}}},{key:"_createMeshTemplates",value:function(e,t,r){if(-1!==t.type.indexOf("3d"))return kr.error("3D symbols are not supported with MapView"),e;if("expanded-cim"===t.type){var i,a=Object(n.a)(t.layers);try{for(a.s();!(i=a.n()).done;){var s=i.value;"function"==typeof s.materialHash?e.push(this._createDynamicCIM(s)):Mr(e,this._createCIM(s))}}catch(l){a.e(l)}finally{a.f()}return e}if("composite-symbol"===t.type){var o,c=Object(n.a)(t.layers);try{for(c.s();!(o=c.n()).done;){var u=o.value;this._createPrimitiveMeshTemplates(e,u,r)}}catch(l){c.e(l)}finally{c.f()}return e}return"cim"===t.type||"label"===t.type||"web-style"===t.type?e:this._createPrimitiveMeshTemplates(e,t,r)}}]),e}(),Ir=function(){function e(t,r,n){Object(o.a)(this,e),this._loadPromise=Object(J.a)(),this._geometryType=t,this._idField=r,this._templateStore=n}return Object(c.a)(e,[{key:"update",value:function(e,t){Object(y.k)(e.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(e.mesh.labels,t)),this._schema=e}},{key:"_createLabelTemplates",value:function(e,t){var r=new Map;if("simple"===e.type){var i,a=Object(n.a)(e.classes);try{for(a.s();!(i=a.n()).done;){var s=i.value,o=Qe.fromLabelClass(s,t);r.set(s.index,o)}}catch(d){a.e(d)}finally{a.f()}return r}for(var c in e.classes){var u,l=e.classes[c],h=Object(n.a)(l);try{for(h.s();!(u=h.n()).done;){var f=u.value,v=Qe.fromLabelClass(f,t);r.set(f.index,v)}}catch(d){h.e(d)}finally{h.f()}}return r}},{key:"templates",get:function(){return this._templateStore}},{key:"analyze",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,i,s,o,c){var u,l,h,f,v,d,m;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(p.o)(c)){e.next=2;break}return e.abrupt("return");case 2:if(e.t0="dictionary"===r.type,!e.t0){e.next=7;break}return e.next=6,r.analyze(this._idField,t.copy(),s,o,c);case 6:u=e.sent;case 7:for(l=0;t.next();)if(void 0,h=u?u[l++]:Object(y.k)(i)&&Object(K.c)(t.getDisplayId())&&1!==t.readAttribute("cluster_count")?i.match(this._idField,t,this._geometryType,s,o):r.match(this._idField,t,this._geometryType,s,o),t.setGroupId(h),Sr(h)){f=this._templateStore.getDynamicTemplateGroup(h),v=Object(n.a)(f);try{for(v.s();!(d=v.n()).done;)(m=d.value)&&m.analyze&&m.analyze(this._templateStore,t,s,o)}catch(a){v.e(a)}finally{v.f()}}return e.next=11,this._loadPromise;case 11:return e.abrupt("return",this._templateStore.finalize(c));case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a,s){return e.apply(this,arguments)}}()},{key:"analyzeGraphics",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,i,s,o){var c,u,l,h,f,v;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(p.o)(o)){e.next=2;break}return e.abrupt("return");case 2:if(c=t.getCursor(),e.t0=r,!e.t0){e.next=7;break}return e.next=7,r.analyze(this._idField,c.copy(),i,s,o);case 7:if(!c.next()){e.next=13;break}if(null!=(u=c.getGroupId())&&-1!==u||(u=r.match(this._idField,c,c.geometryType,i,s),c.setGroupId(u)),Sr(u)){l=this._templateStore.getDynamicTemplateGroup(u),h=Object(n.a)(l);try{for(h.s();!(f=h.n()).done;)(v=f.value)&&v.analyze&&v.analyze(this._templateStore,c,i,s)}catch(a){h.e(a)}finally{h.f()}}c.setGroupId(u);case 11:e.next=7;break;case 13:return e.next=15,this._loadPromise;case 15:return e.abrupt("return",this._templateStore.finalize(o));case 16:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"writeGraphic",value:function(e,t,r){var i=t.getGroupId(),a=t.getDisplayId(),s=this._templateStore.getTemplateGroup(i);if(e.featureStart(t.insertAfter,0),null!=a){if(Sr(i)){var o,c=Object(n.a)(s);try{for(c.s();!(o=c.n()).done;){o.value.bindFeature(t,null,null)}}catch(f){c.e(f)}finally{c.f()}}if(s){var u,l=Object(n.a)(s);try{for(l.s();!(u=l.n()).done;){var h=u.value;h&&h.write(e,t,r)}}catch(f){l.e(f)}finally{l.f()}e.featureEnd()}}}},{key:"writeCursor",value:function(e,t,r,i,a,s){var o=t.getGroupId(),c=t.getDisplayId(),u=this._templateStore.getTemplateGroup(o),l=this._schema.mesh.sortKey,h=0;if(Object(y.k)(l)&&(h=null!=l.fieldIndex?t.getComputedNumericAtIndex(l.fieldIndex):null!=l.field?t.readAttribute(l.field):t.readAttribute(this._idField),h*="asc"===l.order?1:-1),e.featureStart(0,null==h||isNaN(h)?0:h),null!=c&&u){if(Sr(o)){var f,v=Object(n.a)(u);try{for(v.s();!(f=v.n()).done;){f.value.bindFeature(t,r,i)}}catch(_){v.e(_)}finally{v.f()}}var d,p=Object(n.a)(u);try{for(p.s();!(d=p.n()).done;){d.value.write(e,t,a)}}catch(_){p.e(_)}finally{p.f()}if(Object(y.k)(s)&&e.hasRecords){var m=s&&this._findLabelRef(u);this._writeLabels(e,t,s,m,a)}e.featureEnd()}}},{key:"_findLabelRef",value:function(e){var t,r=Object(n.a)(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i instanceof tt)return i}}catch(a){r.e(a)}finally{r.f()}return null}},{key:"_writeLabels",value:function(e,t,r,i,a){var s,o=Object(n.a)(r);try{for(o.s();!(s=o.n()).done;){var c=s.value;if(Object(y.k)(c)&&c){var u=c.glyphs,l=c.rtl,h=c.index,f=this._labelTemplates.get(h);f.setZoomLevel(a),f.bindReferenceTemplate(i),f.bindTextInfo(u,l),f.write(e,t,null)}}}catch(v){o.e(v)}finally{o.f()}}}]),e}(),Lr=r(28),zr=r(27),Cr=r(594),Pr=r(156),Vr=(r(99),{marker:A.c.MARKER,fill:A.c.FILL,line:A.c.LINE,text:A.c.TEXT}),Er=function(){function e(t,r,i,a){Object(o.a)(this,e);var s={minScale:null==r?void 0:r.minScale,maxScale:null==r?void 0:r.maxScale},c=function(e){return e.minScale||e.maxScale?e.minScale+"-"+e.maxScale:""}(s);this.layers=t,this.data=r,this.hash=this._createHash()+c,this.rendererKey=i;var u,l=Object(n.a)(t);try{for(l.s();!(u=l.n()).done;){var h=u.value,f=Vr[h.type];h.materialKey=Object(se.g)(f,this.rendererKey,!1,!1),h.maxVVSize=a,h.scaleInfo=s,h.templateHash+=c}}catch(v){l.e(v)}finally{l.f()}}return Object(c.a)(e,[{key:"type",get:function(){return"expanded-cim"}},{key:"_createHash",value:function(){var e,t="",r=Object(n.a)(this.layers);try{for(r.s();!(e=r.n()).done;){t+=e.value.templateHash}}catch(i){r.e(i)}finally{r.f()}return t}}]),e}();var Rr=r(230),Ar=function(){var e=Object(s.a)(a.a.mark((function e(t,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=Er,e.next=3,Object(Wt.b)(t.data,r);case 3:return e.t1=e.sent,e.t2=t.data,e.t3=t.rendererKey,e.t4=t.maxVVSize,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3,e.t4));case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),Fr=function(){var e=Object(s.a)(a.a.mark((function e(t,r,n){var i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:if("cim"!==t.type){e.next=4;break}return e.abrupt("return",Ar(t,r));case 4:if("web-style"!==t.type){e.next=13;break}return i=Rr.a.fromJSON(t),e.next=8,i.fetchCIMSymbol(n);case 8:return e.t0=e.sent.data,e.t1=t.rendererKey,e.t2=t.maxVVSize,s={type:"cim",data:e.t0,rendererKey:e.t1,maxVVSize:e.t2},e.abrupt("return",Ar(s,r));case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),Wr=r(180),Br=r(630),Dr=d.a.getLogger("esri/views/2d/engine/webgl/util/Matcher");function Kr(e,t,r){return Gr.apply(this,arguments)}function Gr(){return Gr=Object(s.a)(a.a.mark((function e(t,r,n){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="simple"===e.t0?3:"map"===e.t0?4:"interval"===e.t0?5:"dictionary"===e.t0?6:"subtype"===e.t0?7:8;break;case 3:return e.abrupt("return",Nr.fromBasicRenderer(t,r,n));case 4:return e.abrupt("return",Xr.fromUVRenderer(t,r,n));case 5:return e.abrupt("return",Ur.fromCBRenderer(t,r,n));case 6:return e.abrupt("return",Hr.fromDictionaryRenderer(t,r,n));case 7:return e.abrupt("return",Zr.fromSubtypes(t,r,n));case 8:case"end":return e.stop()}}),e)}))),Gr.apply(this,arguments)}var Nr=function(){function e(){Object(o.a)(this,e),this.type="feature",this._defaultResult=null}return Object(c.a)(e,[{key:"size",value:function(){return 1}},{key:"getDefault",value:function(){return this._defaultResult}},{key:"setDefault",value:function(e){this._defaultResult=e}},{key:"match",value:function(e,t,r,n,i){return this.getDefault()}},{key:"analyze",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n,i,s){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}}),e)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()}],[{key:"fromBasicRenderer",value:function(){var t=Object(s.a)(a.a.mark((function t(r,n,i){var s,o,c;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=new e,!r.symbol){t.next=7;break}return t.next=4,Fr(r.symbol,i);case 4:o=t.sent,c=n.createTemplateGroup(o,null),s.setDefault(c);case 7:return t.abrupt("return",s);case 8:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}()}]),e}(),Zr=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e,n){var i;return Object(o.a)(this,r),(i=t.call(this))._subMatchers=e,i._subtypeField=n,i}return Object(c.a)(r,[{key:"match",value:function(e,t,r,n,i){var a=t.readAttribute(this._subtypeField),s=this._subMatchers.get(a);return s?s.match(e,t,r,n,i):null}}],[{key:"fromSubtypes",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n,i){var s,o,c,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(u in s=new Map,o=[],c=function(e){var r=parseInt(e,10),a=Kr(t.renderers[e],n,i).then((function(e){return s.set(r,e)}));o.push(a)},t.renderers)c(u);return e.next=5,Promise.all(o);case 5:return e.abrupt("return",new r(s,t.subtypeField));case 6:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),r}(Nr),Ur=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e,n,i,a){var s;return Object(o.a)(this,r),(s=t.call(this)).type="interval",s._intervals=[],s._isMaxInclusive=n,s._fieldIndex=a,s._field=e,s._normalizationInfo=i,s}return Object(c.a)(r,[{key:"add",value:function(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort((function(e,t){return e.interval.min-t.interval.min}))}},{key:"size",value:function(){return Object(Lr.a)(Object(zr.a)(r.prototype),"size",this).call(this)+this._intervals.length}},{key:"match",value:function(e,t,r,n,i){if(null==this._fieldIndex&&!this._field)return this.getDefault();var a=null!=this._fieldIndex?t.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(t);if(!a&&(null==a||isNaN(a)))return this.getDefault();for(var s=0;s<this._intervals.length;s++){var o=this._intervals[s],c=o.interval,u=o.result,l=a>=c.min,h=this._isMaxInclusive?a<=c.max:a<c.max;if(l&&h)return u}return this.getDefault()}},{key:"_needsNormalization",value:function(){var e=this._normalizationInfo;return e&&(e.normalizationField||e.normalizationTotal||e.normalizationType)}},{key:"_getValueFromField",value:function(e){var t=e.readAttribute(this._field);if(!this._needsNormalization()||null==t)return t;var r=this._normalizationInfo,n=r.normalizationField,i=r.normalizationTotal,a=r.normalizationType,s=!!n&&e.readAttribute(n);if(a)switch(a){case"esriNormalizeByField":return s?t/s:void 0;case"esriNormalizeByLog":return Math.log(t)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return t/i*100;default:return void Dr.error("Found unknown normalization type: ".concat(a))}else Dr.error("Normalization is required, but no type was set!")}}],[{key:"fromCBRenderer",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n,i){var o,c,u,l,h,f,v,d,y;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.isMaxInclusive,c=t.normalizationField,u=t.normalizationTotal,l=t.normalizationType,h=t.field,f=new r(h,o,{normalizationField:c,normalizationTotal:u,normalizationType:l},t.fieldIndex),e.next=8,Fr(t.backgroundFillSymbol,i);case 8:return v=e.sent,e.next=11,Promise.all(t.intervals.map(function(){var e=Object(s.a)(a.a.mark((function e(t){var r,s,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fr(t.symbol,i);case 2:return r=e.sent,e.next=5,n.createTemplateGroup(r,v);case 5:s=e.sent,o={min:t.min,max:t.max},f.add(o,s);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:return e.next=13,Fr(t.defaultSymbol,i);case 13:if(!(d=e.sent)){e.next=19;break}return e.next=17,n.createTemplateGroup(d,v);case 17:y=e.sent,f.setDefault(y);case 19:return e.abrupt("return",f);case 20:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),r}(Nr),Xr=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(e,n,i){var a;return Object(o.a)(this,r),(a=t.call(this)).type="map",a._nullResult=null,a._resultsMap=new Map,a._fieldsIndex=i,a._fields=e,a._seperator=n||"",a}return Object(c.a)(r,[{key:"setNullResult",value:function(e){this._nullResult=e}},{key:"add",value:function(e,t){this._resultsMap.set(e.toString(),t)}},{key:"size",value:function(){return Object(Lr.a)(Object(zr.a)(r.prototype),"size",this).call(this)+this._resultsMap.size}},{key:"match",value:function(e,t,r,n,i){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();var a=null!=this._fieldsIndex?t.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(t);if(null!==this._nullResult&&(null==a||""===a||"<Null>"===a))return this._nullResult;if(!a&&null==a)return this.getDefault();var s=a.toString();return this._resultsMap.has(s)?this._resultsMap.get(s):this.getDefault()}},{key:"_getValueFromFields",value:function(e){var t,r=[],i=Object(n.a)(this._fields);try{for(i.s();!(t=i.n()).done;){var a=t.value,s=e.readAttribute(a);null==s||""===s?r.push("<Null>"):r.push(s)}}catch(o){i.e(o)}finally{i.f()}return r.join(this._seperator)}}],[{key:"fromUVRenderer",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n,i){var o,c,u,l,h,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.fieldDelimiter,c=[t.field],t.field2&&c.push(t.field2),t.field3&&c.push(t.field3),e.next=4,Fr(t.backgroundFillSymbol,i);case 4:return u=e.sent,l=new r(c,o,t.fieldIndex),e.next=8,Promise.all(t.map.map(function(){var e=Object(s.a)(a.a.mark((function e(t){var r,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Fr(t.symbol,i);case 2:return r=e.sent,e.next=5,n.createTemplateGroup(r,u);case 5:s=e.sent,"<Null>"===t.value?l.setNullResult(s):l.add(t.value,s);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return e.next=10,Fr(t.defaultSymbol,i);case 10:if(!(h=e.sent)){e.next=16;break}return e.next=14,n.createTemplateGroup(h,u);case 14:f=e.sent,l.setDefault(f);case 16:return e.abrupt("return",l);case 17:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),r}(Nr);function qr(e,t){return Yr.apply(this,arguments)}function Yr(){return Yr=Object(s.a)(a.a.mark((function e(t,r){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("number"!=typeof(n=t||1)){e.next=3;break}return e.abrupt("return",(function(e,t,r){return n}));case 3:return e.next=5,Object(Pr.d)(n,r.spatialReference,r.fields);case 5:return i=e.sent,e.abrupt("return",(function(e,t,n){return Object(Br.a)(i,e,{$view:n},r.geometryType,t)||1}));case 7:case"end":return e.stop()}}),e)}))),Yr.apply(this,arguments)}var Hr=function(e){Object(u.a)(i,e);var t=Object(l.a)(i);function i(e,r,n,a){var s;return Object(o.a)(this,i),(s=t.call(this)).type="dictionary",s._groupIdCache=new Cr.a(100),s._renderer=e,s._fieldMap=e.fieldMap,s._symbolFields=e.getSymbolFields(),s._templates=r,s._info=n,s._scaleFn=a,s}return Object(c.a)(i,[{key:"_analyzeFeature",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,i,s){var o,c,u,l,h,v,d,y,p=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.readLegacyFeature(),c=this._scaleFn(o,r,i),u=this._attributeHash(o)+"-"+c,!(l=this._groupIdCache.get(u))){e.next=3;break}return e.abrupt("return",l);case 3:return h=Object(rt.a)(Object(rt.a)({},i),{},{spatialReference:this._info.spatialReference,abortOptions:s,fields:this._info.fields}),e.next=6,this._renderer.getSymbolAsync(o,h);case 6:return v=e.sent,d=jr(v,this._renderer),y=Fr(d,this._info,s).then((function(e){if("expanded-cim"!==e.type)return Dr.error(new f.a("mapview-bad-type","Found unexpected type ".concat(e.type," in dictionary response"))),null;e.hash+="-"+c;var t,r=Object(n.a)(e.layers);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.scaleFactor=c,i.templateHash+="-"+c,"text"===i.type&&"string"==typeof i.text&&i.text.indexOf("[")>-1&&(i.text=Object(Wr.c)(p._fieldMap,i.text,i.cim.textCase))}}catch(a){r.e(a)}finally{r.f()}return p._templates.createTemplateGroup(e,null)})),e.abrupt("return",(this._groupIdCache.put(u,y,1),y));case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"analyze",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n,i,s){var o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=r.getCursor(),c=[];o.next();)c.push(this._analyzeFeature(o,n,i,s));return e.abrupt("return",Promise.all(c));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"match",value:function(e,t,r,n,i){return null}},{key:"_attributeHash",value:function(e){var t,r="",i=Object(n.a)(this._symbolFields);try{for(i.s();!(t=i.n()).done;){var a=t.value,s=this._fieldMap[a];s&&(r+=e.attributes[s]+"-")}}catch(o){i.e(o)}finally{i.f()}return r}}],[{key:"fromDictionaryRenderer",value:function(){var e=Object(s.a)(a.a.mark((function e(t,n,s){var o,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(r.bind(null,549));case 2:return o=e.sent.default.fromJSON(t.renderer),e.next=5,o.fetchResources({spatialReference:s.spatialReference,fields:s.fields});case 5:return e.next=7,qr(o.scaleExpression,s);case 7:return c=e.sent,e.abrupt("return",new i(o,n,s,c));case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),i}(Nr),Jr=r(934);function Qr(e,t){return(!e.minScale||e.minScale>=t)&&(!e.maxScale||e.maxScale<=t)}function $r(e){var t=e.message,r={message:{data:{},tileKey:t.tileKey,tileKeyOrigin:t.tileKeyOrigin},transferList:new Array};for(var n in t.data){var i=t.data[n];if(r.message.data[n]=null,Object(y.k)(i)){var a=i.stride,s=i.indices.slice(0),o=i.vertices.slice(0),c=i.records.slice(0),u={stride:a,indices:s,vertices:o,records:c,metrics:Object(y.b)(i.metrics,(function(e){return e.slice(0)}))};r.transferList.push(s,o,c),r.message.data[n]=u}}return r}d.a.getLogger("esri.views.2d.layers.features.processors.SymbolProcessor");var en=function(e){Object(u.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(o.a)(this,r),(e=t.apply(this,arguments)).type="symbol",e._matchers={feature:null,aggregate:null},e._bufferData=new Map,e._bufferIds=new Map,e}return Object(c.a)(r,[{key:"initialize",value:function(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}},{key:"destroy",value:function(){}},{key:"supportsTileUpdates",get:function(){return!0}},{key:"forEachBufferId",value:function(e){this._bufferIds.forEach((function(t){t.forEach(e)}))}},{key:"update",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r){var n,i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("symbol"===(n=r.schema.processors[0]).type){e.next=3;break}return e.abrupt("return");case 3:i=Object(b.a)(this._schema,n),Object(b.b)(i,"mesh")&&(Object(v.a)("esri-2d-update-debug")&&console.debug("Applying Update - Processor:",i),t.mesh=!0,t.why.mesh.push("Symbology changed"),this._schema=n,this._factory=this._createFactory(n),this._factory.update(n,this.tileStore.tileScheme.tileInfo));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"onTileMessage",value:function(e,t,r,n){return Object(p.x)(n),this._onTileData(e,t,r,n)}},{key:"onTileClear",value:function(e){return this._bufferData.delete(e.key.id),this._bufferIds.delete(e.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:e.id,data:{clear:!0}})}},{key:"onTileError",value:function(e,t,r){var n=r.signal,i={tileKey:e.id,error:t};return this.remoteClient.invoke("tileRenderer.onTileError",i,{signal:n})}},{key:"onTileUpdate",value:function(e){var t,r=this,i=Object(n.a)(e.removed);try{for(i.s();!(t=i.n()).done;){var a=t.value;this._bufferData.has(a.key.id)&&this._bufferData.delete(a.key.id),this._bufferIds.has(a.key.id)&&this._bufferIds.delete(a.key.id)}}catch(u){i.e(u)}finally{i.f()}var s,o=Object(n.a)(e.added);try{var c=function(){var e=s.value;r._bufferData.forEach((function(t){var i,a=Object(n.a)(t);try{for(a.s();!(i=a.n()).done;){var s=i.value;s.message.tileKey===e.id&&r._updateTileMesh("append",e,$r(s),[],!1,!1,null)}}catch(u){a.e(u)}finally{a.f()}}))};for(o.s();!(s=o.n()).done;)c()}catch(u){o.e(u)}finally{o.f()}}},{key:"_addBufferData",value:function(e,t){this._bufferData.has(e)||this._bufferData.set(e,[]),this._bufferData.get(e).push($r(t))}},{key:"_createFactory",value:function(e){var t=this,r=this.service,n=r.geometryType,i=r.objectIdField,a={geometryType:n,fields:r.fields,spatialReference:g.a.fromJSON(this.spatialReference)},s=new Tr((function(e,r){return t.remoteClient.invoke("tileRenderer.getMaterialItems",e,r)}),this.tileStore.tileScheme.tileInfo),o=e.mesh,c=o.matcher,u=o.aggregateMatcher;return this._store=s,this._matchers.feature=Kr(c,s,a),this._matchers.aggregate=Object(y.b)(u,(function(e){return Kr(e,s,a)})),new Ir(n,i,s)}},{key:"_onTileData",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,i,s){var o,c,u,l,h,f,v,d,m,_,b,g,x,O,j,k,w,M,S,T,I,L,z=this;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Object(p.x)(s),o=r.type,c=r.addOrUpdate,u=r.remove,l=r.end,h=!!this._schema.mesh.sortKey,c){e.next=5;break}return f={type:o,addOrUpdate:null,remove:u,clear:!1,end:l,sort:h},e.abrupt("return",this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:f},s));case 5:return v=this._processFeatures(t,c,i,s),e.prev=6,e.next=9,v;case 9:if(d=e.sent,!Object(y.j)(d)){e.next=13;break}return m={type:o,addOrUpdate:null,remove:u,clear:!1,end:l,sort:h},e.abrupt("return",this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:t.id,data:m},s));case 13:_=[],b=Object(n.a)(d),e.prev=15,b.s();case 17:if((g=b.n()).done){e.next=40;break}if(x=g.value,O=!1,j=x.message.bufferIds,k=t.key.id,w=x.message.tileKey,k===w||!Object(y.k)(j)){e.next=37;break}if(this.tileStore.get(w)){e.next=24;break}return e.abrupt("continue",38);case 24:(M=this._bufferIds.get(w))||(M=new Set,this._bufferIds.set(w,M)),S=Array.from(j),T=0,I=S;case 28:if(!(T<I.length)){e.next=37;break}if(L=I[T],!M.has(L)){e.next=33;break}return O=!0,e.abrupt("break",37);case 33:M.add(L);case 34:T++,e.next=28;break;case 37:O||(this._addBufferData(k,x),_.push(x));case 38:e.next=17;break;case 40:e.next=45;break;case 42:e.prev=42,e.t0=e.catch(15),b.e(e.t0);case 45:return e.prev=45,b.f(),e.finish(45);case 48:return e.next=50,Object(p.b)(_.map((function(e){var n=t.key.id===e.message.tileKey,i=n?r.remove:[],a=n&&r.end;return z._updateTileMesh(o,t,e,i,a,r.clear,s.signal)})));case 50:e.next=55;break;case 52:e.prev=52,e.t1=e.catch(6),this._handleError(t,e.t1,s);case 55:case"end":return e.stop()}}),e,this,[[6,52],[15,42,45,48]])})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_updateTileMesh",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n,i,s,o,c){var u,l,h,f,v,d,m;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t,l=n.message.tileKey,h=!!this._schema.mesh.sortKey,l!==r.key.id&&(s=!1),f=Object(y.b)(n,(function(e){return e.message})),v=Object(y.b)(n,(function(e){return e.transferList}))||[],d={type:u,addOrUpdate:f,remove:i,clear:!1,end:s,sort:h},m={transferList:Object(y.t)(v)||[],signal:c},e.abrupt("return",(Object(p.x)(m),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:l,data:d},m)));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a,s,o){return e.apply(this,arguments)}}()},{key:"_processFeatures",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n,i){var s,o,c,u,l,h;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(y.j)(r)&&r.hasFeatures){e.next=2;break}return e.abrupt("return",null);case 2:return s={transform:t.transform,hasZ:!1,hasM:!1},o=this._factory,c={viewingMode:"",scale:t.scale},e.next=7,this._matchers.feature;case 7:return u=e.sent,e.next=10,this._matchers.aggregate;case 10:return l=e.sent,Object(p.x)(i),h=this._getLabelInfos(t,r),e.next=15,o.analyze(r.getCursor(),u,l,s,c);case 15:return Object(p.x)(i),e.abrupt("return",this._writeFeatureSet(t,r,s,h,o,n));case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_writeFeatureSet",value:function(e,t,r,n,i,a){for(var s=t.getSize(),o="simple"===this._schema.mesh.matcher.type&&this._schema.mesh.matcher.isDotDensity,c=new H(e.key.id,{features:s,records:s,metrics:0},o,a,!0),u={viewingMode:"",scale:e.scale},l=t.getCursor();l.next();)try{var h=l.getDisplayId(),f=Object(y.k)(n)?n.get(h):null;i.writeCursor(c,l,r,u,e.level,f)}catch(d){}var v=e.tileInfoView.tileInfo.isWrappable;return c.serialize(v)}},{key:"_handleError",value:function(e,t,r){if(!Object(p.n)(t)){var n={tileKey:e.id,error:t.message};return this.remoteClient.invoke("tileRenderer.onTileError",n,{signal:r.signal})}}},{key:"_getLabelingSchemaForScale",value:function(e){var t=this._schema.mesh.labels;if(Object(y.j)(t))return null;if("subtype"===t.type){var r={type:"subtype",classes:{}},n=!1;for(var i in t.classes){var a=t.classes[i].filter((function(t){return Qr(t,e.scale)}));n=n||!!a.length,r.classes[i]=a}return n?r:null}var s=t.classes.filter((function(t){return Qr(t,e.scale)}));return s.length?{type:"simple",classes:s}:null}},{key:"_getLabels",value:function(e,t){if("subtype"===t.type){var r,n=this.service.subtypeField,i=Object(y.v)(n,"Expected to find subtype Field"),a=e.readAttribute(i);return null==a?[]:null!=(r=t.classes[a])?r:[]}return t.classes}},{key:"_getLabelInfos",value:function(e,t){var r=this,i=this._getLabelingSchemaForScale(e);if(Object(y.j)(i))return null;for(var a=new Map,s=t.getCursor(),o=function(){var e,t=s.getDisplayId(),o=[],c=Object(K.c)(t),u=c&&1!==s.readAttribute("cluster_count")?"aggregate":"feature",l=r._getLabels(s,i),h=Object(n.a)(l);try{var f=function(){var n=e.value;if(n.target!==u)return"continue";var i=s.getStorage(),a=c&&"feature"===u?i.getComputedStringAtIndex(s.readAttribute("referenceId"),n.fieldIndex):i.getComputedStringAtIndex(t,n.fieldIndex);if(!a)return"continue";var l=Ze(a.toString()),h=l[0],f=l[1];r._store.getMosaicItem(n.symbol,tr(h)).then((function(e){o[n.index]={glyphs:e.glyphMosaicItems,rtl:f,index:n.index}}))};for(h.s();!(e=h.n()).done;)f()}catch(v){h.e(v)}finally{h.f()}a.set(t,o)};s.next();)o();return a}}]),r}(Jr.a),tn=en=Object(h.a)([Object(_.a)("esri.views.2d.layers.features.processors.SymbolProcessor")],en)},745:function(e,t,r){"use strict";r.d(t,"a",(function(){return x})),r.d(t,"b",(function(){return w})),r.d(t,"c",(function(){return j})),r.d(t,"d",(function(){return O})),r.d(t,"e",(function(){return p})),r.d(t,"f",(function(){return k})),r.d(t,"g",(function(){return d})),r.d(t,"h",(function(){return y}));var n=r(14),i=r(28),a=r(27),s=r(6),o=r(7),c=r(2),u=r(4),l=r(22),h=r(741),f=r(862);function v(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=h.d.SIZE_FIELD_STOPS|h.d.SIZE_MINMAX_VALUE|h.d.SIZE_SCALE_STOPS|h.d.SIZE_UNIT_VALUE,n=(e&(h.e.FIELD_TARGETS_OUTLINE|h.e.MINMAX_TARGETS_OUTLINE|h.e.SCALE_TARGETS_OUTLINE|h.e.UNIT_TARGETS_OUTLINE))>>>4;return t?r&n:r&~n}function d(e,t,r,n,i){switch(e){case h.c.FILL:return x.from(t,n);case h.c.LINE:return j.from(t,r);case h.c.MARKER:return O.from(t);case h.c.TEXT:return k.from(t);case h.c.LABEL:return w.from(t,i);default:throw new Error("Unable to createMaterialKey for unknown geometryType ".concat(e))}}function y(e){switch(p.load(e).geometryType){case h.c.MARKER:return new O(e);case h.c.FILL:return new x(e);case h.c.LINE:return new j(e);case h.c.TEXT:return new k(e);case h.c.LABEL:return new w(e)}}var p=function(){function e(t){Object(c.a)(this,e),this._data=0,this._data=t}return Object(u.a)(e,[{key:"data",get:function(){return this._data},set:function(e){this._data=e}},{key:"geometryType",get:function(){return this.bits(8,11)},set:function(e){this.setBits(e,8,11)}},{key:"mapAligned",get:function(){return!!this.bit(20)},set:function(e){this.setBit(20,e)}},{key:"sdf",get:function(){return!!this.bit(11)},set:function(e){this.setBit(11,e)}},{key:"pattern",get:function(){return!!this.bit(12)},set:function(e){this.setBit(12,e)}},{key:"textureBinding",get:function(){return this.bits(0,8)},set:function(e){this.setBits(e,0,8)}},{key:"geometryTypeString",get:function(){switch(this.geometryType){case h.c.FILL:return"fill";case h.c.MARKER:return"marker";case h.c.LINE:return"line";case h.c.TEXT:return"text";case h.c.LABEL:return"label";default:throw new l.a("Unable to handle unknown geometryType: ".concat(this.geometryType))}}},{key:"setBit",value:function(e,t){var r=1<<e;t?this._data|=r:this._data&=~r}},{key:"bit",value:function(e){return(this._data&1<<e)>>e}},{key:"setBits",value:function(e,t,r){for(var n=t,i=0;n<r;n++,i++)this.setBit(n,0!=(e&1<<i))}},{key:"bits",value:function(e,t){for(var r=0,n=e,i=0;n<t;n++,i++)r|=this.bit(n)<<i;return r}},{key:"hasVV",value:function(){return!1}},{key:"setVV",value:function(e,t){}},{key:"getVariation",value:function(){return{mapAligned:this.mapAligned,pattern:this.pattern,sdf:this.sdf}}},{key:"getVariationHash",value:function(){return this._data&~(7&this.textureBinding)}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}}]),e}();p.shared=new p(0);var m=function(e){return function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"vvSizeMinMaxValue",get:function(){return 0!==this.bit(16)},set:function(e){this.setBit(16,e)}},{key:"vvSizeScaleStops",get:function(){return 0!==this.bit(17)},set:function(e){this.setBit(17,e)}},{key:"vvSizeFieldStops",get:function(){return 0!==this.bit(18)},set:function(e){this.setBit(18,e)}},{key:"vvSizeUnitValue",get:function(){return 0!==this.bit(19)},set:function(e){this.setBit(19,e)}},{key:"hasVV",value:function(){return Object(i.a)(Object(a.a)(r.prototype),"hasVV",this).call(this)||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue}},{key:"setVV",value:function(e,t){Object(i.a)(Object(a.a)(r.prototype),"setVV",this).call(this,e,t);var n=v(e,t)&e;this.vvSizeMinMaxValue=!!(n&h.d.SIZE_MINMAX_VALUE),this.vvSizeFieldStops=!!(n&h.d.SIZE_FIELD_STOPS),this.vvSizeUnitValue=!!(n&h.d.SIZE_UNIT_VALUE),this.vvSizeScaleStops=!!(n&h.d.SIZE_SCALE_STOPS)}}]),r}(e)},_=function(e){return function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"vvRotation",get:function(){return 0!==this.bit(15)},set:function(e){this.setBit(15,e)}},{key:"hasVV",value:function(){return Object(i.a)(Object(a.a)(r.prototype),"hasVV",this).call(this)||this.vvRotation}},{key:"setVV",value:function(e,t){Object(i.a)(Object(a.a)(r.prototype),"setVV",this).call(this,e,t),this.vvRotation=!t&&!!(e&h.d.ROTATION)}}]),r}(e)},b=function(e){return function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"vvColor",get:function(){return 0!==this.bit(13)},set:function(e){this.setBit(13,e)}},{key:"hasVV",value:function(){return Object(i.a)(Object(a.a)(r.prototype),"hasVV",this).call(this)||this.vvColor}},{key:"setVV",value:function(e,t){Object(i.a)(Object(a.a)(r.prototype),"setVV",this).call(this,e,t),this.vvColor=!t&&!!(e&h.d.COLOR)}}]),r}(e)},g=function(e){return function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"vvOpacity",get:function(){return 0!==this.bit(14)},set:function(e){this.setBit(14,e)}},{key:"hasVV",value:function(){return Object(i.a)(Object(a.a)(r.prototype),"hasVV",this).call(this)||this.vvOpacity}},{key:"setVV",value:function(e,t){Object(i.a)(Object(a.a)(r.prototype),"setVV",this).call(this,e,t),this.vvOpacity=!t&&!!(e&h.d.OPACITY)}}]),r}(e)},x=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"getVariation",value:function(){return Object(n.a)(Object(n.a)({},Object(i.a)(Object(a.a)(r.prototype),"getVariation",this).call(this)),{},{dotDensity:this.dotDensity,vvColor:this.vvColor,vvOpacity:this.vvOpacity})}},{key:"dotDensity",get:function(){return!!this.bit(15)},set:function(e){this.setBit(15,e)}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e,t){var r=this.load(0);return r.geometryType=h.c.FILL,t?r.dotDensity=!0:r.setVV(e,!1),r.data}}]),r}(b(g(p)));x.shared=new x(0);var O=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"getVariation",value:function(){return Object(n.a)(Object(n.a)({},Object(i.a)(Object(a.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvRotation:this.vvRotation,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(0);return t.geometryType=h.c.MARKER,t.setVV(e,!1),t.data}}]),r}(b(g(_(m(p)))));O.shared=new O(0);var j=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"getVariation",value:function(){return Object(n.a)(Object(n.a)({},Object(i.a)(Object(a.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e,t){var r=this.load(0);return r.geometryType=h.c.LINE,r.setVV(e,t),r.data}}]),r}(b(g(m(p))));j.shared=new j(0);var k=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"getVariation",value:function(){return Object(n.a)(Object(n.a)({},Object(i.a)(Object(a.a)(r.prototype),"getVariation",this).call(this)),{},{vvColor:this.vvColor,vvOpacity:this.vvOpacity,vvRotation:this.vvRotation,vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e){var t=this.load(e);return t.geometryType=h.c.TEXT,t.setVV(e,!1),t.data}}]),r}(b(g(_(m(p)))));k.shared=new k(0);var w=function(e){Object(s.a)(r,e);var t=Object(o.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"getVariation",value:function(){return Object(n.a)(Object(n.a)({},Object(i.a)(Object(a.a)(r.prototype),"getVariation",this).call(this)),{},{vvSizeFieldStops:this.vvSizeFieldStops,vvSizeMinMaxValue:this.vvSizeMinMaxValue,vvSizeScaleStops:this.vvSizeScaleStops,vvSizeUnitValue:this.vvSizeUnitValue})}}],[{key:"load",value:function(e){var t=this.shared;return t.data=e,t}},{key:"from",value:function(e,t){var r=this.load(0);return r.geometryType=h.c.LABEL,r.setVV(e,!1),r.mapAligned=Object(f.a)(t),r.data}}]),r}(m(p));w.shared=new w(0)},862:function(e,t,r){"use strict";function n(e){switch(e){case"above-along":case"below-along":case"center-along":case"esriServerLinePlacementAboveAlong":case"esriServerLinePlacementBelowAlong":case"esriServerLinePlacementCenterAlong":return!0;default:return!1}}r.d(t,"a",(function(){return n}))},869:function(e,t,r){"use strict";r.d(t,"a",(function(){return y})),r.d(t,"b",(function(){return n}));var n={Base64:0,Hex:1,String:2,Raw:3};function i(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function a(e){for(var t=[],r=0,n=8*e.length;r<n;r+=8)t[r>>5]|=(255&e.charCodeAt(r/8))<<r%32;return t}function s(e){for(var t=[],r=0,n=32*e.length;r<n;r+=8)t.push(String.fromCharCode(e[r>>5]>>>r%32&255));return t.join("")}function o(e){for(var t="0123456789abcdef",r=[],n=0,i=4*e.length;n<i;n++)r.push(t.charAt(e[n>>2]>>n%4*8+4&15)+t.charAt(e[n>>2]>>n%4*8&15));return r.join("")}function c(e){for(var t=[],r=0,n=4*e.length;r<n;r+=3)for(var i=(e[r>>2]>>r%4*8&255)<<16|(e[r+1>>2]>>(r+1)%4*8&255)<<8|e[r+2>>2]>>(r+2)%4*8&255,a=0;a<4;a++)8*r+6*a>32*e.length?t.push("="):t.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(i>>6*(3-a)&63));return t.join("")}function u(e,t,r,n,a,s){return i(function(e,t){return e<<t|e>>>32-t}(i(i(t,e),i(n,s)),a),r)}function l(e,t,r,n,i,a,s){return u(t&r|~t&n,e,t,i,a,s)}function h(e,t,r,n,i,a,s){return u(t&n|r&~n,e,t,i,a,s)}function f(e,t,r,n,i,a,s){return u(t^r^n,e,t,i,a,s)}function v(e,t,r,n,i,a,s){return u(r^(t|~n),e,t,i,a,s)}function d(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var r=1732584193,n=-271733879,a=-1732584194,s=271733878,o=0;o<e.length;o+=16){var c=r,u=n,d=a,y=s;r=l(r,n,a,s,e[o+0],7,-680876936),s=l(s,r,n,a,e[o+1],12,-389564586),a=l(a,s,r,n,e[o+2],17,606105819),n=l(n,a,s,r,e[o+3],22,-1044525330),r=l(r,n,a,s,e[o+4],7,-176418897),s=l(s,r,n,a,e[o+5],12,1200080426),a=l(a,s,r,n,e[o+6],17,-1473231341),n=l(n,a,s,r,e[o+7],22,-45705983),r=l(r,n,a,s,e[o+8],7,1770035416),s=l(s,r,n,a,e[o+9],12,-1958414417),a=l(a,s,r,n,e[o+10],17,-42063),n=l(n,a,s,r,e[o+11],22,-1990404162),r=l(r,n,a,s,e[o+12],7,1804603682),s=l(s,r,n,a,e[o+13],12,-40341101),a=l(a,s,r,n,e[o+14],17,-1502002290),r=h(r,n=l(n,a,s,r,e[o+15],22,1236535329),a,s,e[o+1],5,-165796510),s=h(s,r,n,a,e[o+6],9,-1069501632),a=h(a,s,r,n,e[o+11],14,643717713),n=h(n,a,s,r,e[o+0],20,-373897302),r=h(r,n,a,s,e[o+5],5,-701558691),s=h(s,r,n,a,e[o+10],9,38016083),a=h(a,s,r,n,e[o+15],14,-660478335),n=h(n,a,s,r,e[o+4],20,-405537848),r=h(r,n,a,s,e[o+9],5,568446438),s=h(s,r,n,a,e[o+14],9,-1019803690),a=h(a,s,r,n,e[o+3],14,-187363961),n=h(n,a,s,r,e[o+8],20,1163531501),r=h(r,n,a,s,e[o+13],5,-1444681467),s=h(s,r,n,a,e[o+2],9,-51403784),a=h(a,s,r,n,e[o+7],14,1735328473),r=f(r,n=h(n,a,s,r,e[o+12],20,-1926607734),a,s,e[o+5],4,-378558),s=f(s,r,n,a,e[o+8],11,-2022574463),a=f(a,s,r,n,e[o+11],16,1839030562),n=f(n,a,s,r,e[o+14],23,-35309556),r=f(r,n,a,s,e[o+1],4,-1530992060),s=f(s,r,n,a,e[o+4],11,1272893353),a=f(a,s,r,n,e[o+7],16,-155497632),n=f(n,a,s,r,e[o+10],23,-1094730640),r=f(r,n,a,s,e[o+13],4,681279174),s=f(s,r,n,a,e[o+0],11,-358537222),a=f(a,s,r,n,e[o+3],16,-722521979),n=f(n,a,s,r,e[o+6],23,76029189),r=f(r,n,a,s,e[o+9],4,-640364487),s=f(s,r,n,a,e[o+12],11,-421815835),a=f(a,s,r,n,e[o+15],16,530742520),r=v(r,n=f(n,a,s,r,e[o+2],23,-995338651),a,s,e[o+0],6,-198630844),s=v(s,r,n,a,e[o+7],10,1126891415),a=v(a,s,r,n,e[o+14],15,-1416354905),n=v(n,a,s,r,e[o+5],21,-57434055),r=v(r,n,a,s,e[o+12],6,1700485571),s=v(s,r,n,a,e[o+3],10,-1894986606),a=v(a,s,r,n,e[o+10],15,-1051523),n=v(n,a,s,r,e[o+1],21,-2054922799),r=v(r,n,a,s,e[o+8],6,1873313359),s=v(s,r,n,a,e[o+15],10,-30611744),a=v(a,s,r,n,e[o+6],15,-1560198380),n=v(n,a,s,r,e[o+13],21,1309151649),r=v(r,n,a,s,e[o+4],6,-145523070),s=v(s,r,n,a,e[o+11],10,-1120210379),a=v(a,s,r,n,e[o+2],15,718787259),n=v(n,a,s,r,e[o+9],21,-343485551),r=i(r,c),n=i(n,u),a=i(a,d),s=i(s,y)}return[r,n,a,s]}function y(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Hex,r=t||n.Base64,i=d(a(e),8*e.length);switch(r){case n.Raw:return i;case n.Hex:return o(i);case n.String:return s(i);case n.Base64:return c(i)}}},934:function(e,t,r){"use strict";r.d(t,"a",(function(){return f}));var n=r(2),i=r(4),a=r(6),s=r(7),o=r(0),c=r(193),u=r(1),l=(r(17),r(18),r(15),r(11)),h=function(e){Object(a.a)(r,e);var t=Object(s.a)(r);function r(){return Object(n.a)(this,r),t.apply(this,arguments)}return Object(i.a)(r,[{key:"initialize",value:function(){}},{key:"destroy",value:function(){}},{key:"supportsTileUpdates",get:function(){return!1}},{key:"spatialReference",get:function(){var e=this.get("tileStore.tileScheme.spatialReference");return e&&e.toJSON()||null}}]),r}(c.a);Object(o.a)([Object(u.b)({readOnly:!0})],h.prototype,"supportsTileUpdates",null),Object(o.a)([Object(u.b)({constructOnly:!0})],h.prototype,"remoteClient",void 0),Object(o.a)([Object(u.b)({constructOnly:!0})],h.prototype,"service",void 0),Object(o.a)([Object(u.b)()],h.prototype,"spatialReference",null),Object(o.a)([Object(u.b)({constructOnly:!0})],h.prototype,"tileInfo",void 0),Object(o.a)([Object(u.b)({constructOnly:!0})],h.prototype,"tileStore",void 0);var f=h=Object(o.a)([Object(l.a)("esri.views.2d.layers.features.processors.BaseProcessor")],h)},935:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r(894);function n(e,t,r,n){var i=e.clone(),a=1<<i.level,s=i.col+t,o=i.row+r;return n&&s<0?(i.col=s+a,i.world-=1):s>=a?(i.col=s-a,i.world+=1):i.col=s,i.row=o,i}}}]);
//# sourceMappingURL=66.25b159d7.chunk.js.map