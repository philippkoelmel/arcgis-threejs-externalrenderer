(this.webpackJsonpexample=this.webpackJsonpexample||[]).push([[2],{817:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var a=i(6),r=i(7),n=i(11),s=i(2),o=i(3),l=i(115),c=i(4),h=i(73),u=i(825),d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9,i=arguments.length>1?arguments[1]:void 0;Object(s.a)(this,e),this.compareMinX=f,this.compareMinY=g,this.toBBox=function(e){return e},this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),i&&("function"==typeof i?this.toBBox=i:this._initFormat(i)),this.clear()}return Object(o.a)(e,[{key:"destroy",value:function(){this.clear(),k.prune(),w.prune(),G.prune(),_.prune()}},{key:"all",value:function(e){this._all(this.data,e)}},{key:"search",value:function(e,t){var i=this.data,a=this.toBBox;if(x(e,i))for(k.clear();i;){for(var r=0,n=i.children.length;r<n;r++){var s=i.children[r],o=i.leaf?a(s):s;x(e,o)&&(i.leaf?t(s):S(e,o)?this._all(s,t):k.push(s))}i=k.pop()}}},{key:"collides",value:function(e){var t=this.data,i=this.toBBox;if(!x(e,t))return!1;for(k.clear();t;){for(var a=0,r=t.children.length;a<r;a++){var n=t.children[a],s=t.leaf?i(n):n;if(x(e,s)){if(t.leaf||S(e,s))return!0;k.push(n)}}t=k.pop()}return!1}},{key:"load",value:function(e){if(!e.length)return this;if(e.length<this._minEntries){for(var t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}var a=this._build(e.slice(0,e.length),0,e.length-1,0);if(this.data.children.length)if(this.data.height===a.height)this._splitRoot(this.data,a);else{if(this.data.height<a.height){var r=this.data;this.data=a,a=r}this._insert(a,this.data.height-a.height-1,!0)}else this.data=a;return this}},{key:"insert",value:function(e){return e&&this._insert(e,this.data.height-1),this}},{key:"clear",value:function(){return this.data=new I([]),this}},{key:"remove",value:function(e){if(!e)return this;var t,i=this.data,a=null,r=0,n=!1,s=this.toBBox(e);for(G.clear(),_.clear();i||G.length>0;){var o;if(i||(i=Object(c.d)(G.pop()),a=G.data[G.length-1],r=null!=(o=_.pop())?o:0,n=!0),i.leaf&&-1!==(t=Object(l.g)(i.children,e,i.children.length,i.indexHint)))return i.children.splice(t,1),G.push(i),this._condense(G),this;n||i.leaf||!S(i,s)?a?(r++,i=a.children[r],n=!1):i=null:(G.push(i),_.push(r),r=0,a=i,i=i.children[0])}return this}},{key:"toJSON",value:function(){return this.data}},{key:"fromJSON",value:function(e){return this.data=e,this}},{key:"_all",value:function(e,t){var i=e;for(w.clear();i;){var a;if(!0===i.leaf){var r,s=Object(n.a)(i.children);try{for(s.s();!(r=s.n()).done;){t(r.value)}}catch(o){s.e(o)}finally{s.f()}}else w.pushArray(i.children);i=null!=(a=w.pop())?a:null}}},{key:"_build",value:function(e,t,i,a){var r=i-t+1,n=this._maxEntries;if(r<=n){var s=new I(e.slice(t,i+1));return p(s,this.toBBox),s}a||(a=Math.ceil(Math.log(r)/Math.log(n)),n=Math.ceil(r/Math.pow(n,a-1)));var o=new E([]);o.height=a;var l=Math.ceil(r/n),c=l*Math.ceil(Math.sqrt(n));C(e,t,i,c,this.compareMinX);for(var h=t;h<=i;h+=c){var u=Math.min(h+c-1,i);C(e,h,u,l,this.compareMinY);for(var d=h;d<=u;d+=l){var y=Math.min(d+l-1,u);o.children.push(this._build(e,d,y,a-1))}}return p(o,this.toBBox),o}},{key:"_chooseSubtree",value:function(e,t,i,a){for(;a.push(t),!0!==t.leaf&&a.length-1!==i;){for(var r=void 0,n=1/0,s=1/0,o=0,l=t.children.length;o<l;o++){var c=t.children[o],h=m(c),u=O(e,c)-h;u<s?(s=u,n=h<n?h:n,r=c):u===s&&h<n&&(n=h,r=c)}t=r||t.children[0]}return t}},{key:"_insert",value:function(e,t,i){var a=this.toBBox,r=i?e:a(e);G.clear();var n=this._chooseSubtree(r,this.data,t,G);for(n.children.push(e),b(n,r);t>=0&&G.data[t].children.length>this._maxEntries;)this._split(G,t),t--;this._adjustParentBBoxes(r,G,t)}},{key:"_split",value:function(e,t){var i=e.data[t],a=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,a);var n=this._chooseSplitIndex(i,r,a);if(n){var s=i.children.splice(n,i.children.length-n),o=i.leaf?new I(s):new E(s);o.height=i.height,p(i,this.toBBox),p(o,this.toBBox),t?e.data[t-1].children.push(o):this._splitRoot(i,o)}else console.log("  Error: assertion failed at PooledRBush._split: no valid split index")}},{key:"_splitRoot",value:function(e,t){this.data=new E([e,t]),this.data.height=e.height+1,p(this.data,this.toBBox)}},{key:"_chooseSplitIndex",value:function(e,t,i){var a,r,n;a=r=1/0;for(var s=t;s<=i-t;s++){var o=y(e,0,s,this.toBBox),l=y(e,s,i,this.toBBox),c=j(o,l),h=m(o)+m(l);c<a?(a=c,n=s,r=h<r?h:r):c===a&&h<r&&(r=h,n=s)}return n}},{key:"_chooseSplitAxis",value:function(e,t,i){var a=e.leaf?this.compareMinX:f,r=e.leaf?this.compareMinY:g;this._allDistMargin(e,t,i,a)<this._allDistMargin(e,t,i,r)&&e.children.sort(a)}},{key:"_allDistMargin",value:function(e,t,i,a){e.children.sort(a);for(var r=this.toBBox,n=y(e,0,t,r),s=y(e,i-t,i,r),o=v(n)+v(s),l=t;l<i-t;l++){var c=e.children[l];b(n,e.leaf?r(c):c),o+=v(n)}for(var h=i-t-1;h>=t;h--){var u=e.children[h];b(s,e.leaf?r(u):u),o+=v(s)}return o}},{key:"_adjustParentBBoxes",value:function(e,t,i){for(var a=i;a>=0;a--)b(t.data[a],e)}},{key:"_condense",value:function(e){for(var t=e.length-1;t>=0;t--){var i=e.data[t];if(0===i.children.length)if(t>0){var a=e.data[t-1],r=a.children;r.splice(Object(l.g)(r,i,r.length,a.indexHint),1)}else this.clear();else p(i,this.toBBox)}}},{key:"_initFormat",value:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}]),e}();function p(e,t){y(e,0,e.children.length,t,e)}function y(e,t,i,a,r){r||(r=new I([])),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var n,s=t;s<i;s++)n=e.children[s],b(r,e.leaf?a(n):n);return r}function b(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function f(e,t){return e.minX-t.minX}function g(e,t){return e.minY-t.minY}function m(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function v(e){return e.maxX-e.minX+(e.maxY-e.minY)}function O(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function j(e,t){var i=Math.max(e.minX,t.minX),a=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),n=Math.min(e.maxY,t.maxY);return Math.max(0,r-i)*Math.max(0,n-a)}function S(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function x(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function C(e,t,i,a,r){for(var n=[t,i];n.length;){var s=Object(c.d)(n.pop()),o=Object(c.d)(n.pop());if(!(s-o<=a)){var l=o+Math.ceil((s-o)/a/2)*a;Object(u.a)(e,l,o,s,r),n.push(o,l,l,s)}}}var k=new h.a,w=new h.a,G=new h.a,_=new h.a({deallocator:void 0}),R=function(e){Object(a.a)(i,e);var t=Object(r.a)(i);function i(){var e;return Object(s.a)(this,i),(e=t.apply(this,arguments)).height=1,e.indexHint=new l.a,e}return i}((function e(){Object(s.a)(this,e),this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0})),I=function(e){Object(a.a)(i,e);var t=Object(r.a)(i);function i(e){var a;return Object(s.a)(this,i),(a=t.call(this)).children=e,a.leaf=!0,a}return i}(R),E=function(e){Object(a.a)(i,e);var t=Object(r.a)(i);function i(e){var a;return Object(s.a)(this,i),(a=t.call(this)).children=e,a.leaf=!1,a}return i}(R)},824:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var a=i(815),r=i(306),n=i(244),s={getObjectId:function(e){return e.objectId},getAttributes:function(e){return e.attributes},getAttribute:function(e,t){return e.attributes[t]},cloneWithGeometry:function(e,t){return new r.b(t,e.attributes,null,e.objectId)},getGeometry:function(e){return e.geometry},getCentroid:function(e,t){return e.centroid||(e.centroid=Object(a.a)(new n.a,e.geometry,t.hasZ,t.hasM)),e.centroid}}},881:function(e,t,i){"use strict";i.d(t,"a",(function(){return m}));var a=i(2),r=i(3),n=i(6),s=i(7),o=i(0),l=i(34),c=i(61),h=i(4),u=i(1),d=(i(17),i(18),i(16),i(12)),p=i(504),y=i(103),b=function(e){Object(n.a)(i,e);var t=Object(s.a)(i);function i(){var e;return Object(a.a)(this,i),(e=t.apply(this,arguments))._scaleRangeActive=!1,e.layerScaleRangeVisibilityQuery=!1,e.handles=new c.a,e.layerView=null,e.layer=null,e.queryGraphicUIDsInExtent=null,e.extent=null,e.graphicsCore=null,e.basemapTerrain=null,e.layerScaleEnabled=!0,e.suspended=!1,e.updating=!0,e}return Object(r.a)(i,[{key:"setup",value:function(e,t,i,a,r){this.layerView=e,this.layer=t,this.queryGraphicUIDsInExtent=i,this.graphicsCore=a,this.basemapTerrain=r,this.updateScaleRangeActive();var n=this.layerView.view.resourceController.scheduler;this.handles.add(n.registerTask(y.b.SCALE_VISIBILITY,this))}},{key:"destroy",value:function(){this.handles.destroy(),this.handles=null,this.layerView=null,this.extent=null,this.queryGraphicUIDsInExtent=null,this.graphicsCore=null}},{key:"_setDirty",value:function(){this.updating||this._set("updating",!0)}},{key:"setExtent",value:function(e){this.extent=e,this._setDirty()}},{key:"scaleRangeActive",value:function(){return this._scaleRangeActive}},{key:"updateScaleRangeActive",value:function(){var e=this,t=this.layer,i=this.layerScaleEnabled&&f(t.minScale,t.maxScale);t.labelingInfo&&!i&&(i=t.labelingInfo.some((function(e){return e&&f(e.minScale,e.maxScale)})));var a=this._scaleRangeActive!==i;return this._scaleRangeActive=i,i&&!this.handles.has(g)&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",(function(t){return e.scaleUpdateHandler(t)})),g),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",(function(){return e._setDirty()})),g)):!i&&this.handles.has(g)&&this.handles.remove(g),a}},{key:"running",get:function(){return!(!this.layerView.view.basemapTerrain||!this.updating)}},{key:"runTask",value:function(){var e=this,t=this.layerView.view.basemapTerrain;this.extent&&t&&t.ready&&this._scaleRangeActive&&this.layerScaleEnabled?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,t.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,(function(t){return e.finishUpdate(t)}))):this.finishUpdate(!0)}},{key:"finishUpdate",value:function(e){this.layerScaleRangeVisibilityQuery=!1,this._set("suspended",!e),this._set("updating",!1)}},{key:"visibleAtLayerScale",value:function(e){return!this.layerScaleEnabled||Object(p.d)(e,this.layer.minScale||0,this.layer.maxScale||0)}},{key:"visibleAtLabelScale",value:function(e,t){return Object(p.d)(e,t.minScale||0,t.maxScale||0)}},{key:"graphicScale",value:function(e){var t;return Object(h.k)(e.centroid)?t=e.centroid:Object(h.k)(e.graphic.geometry)&&"point"===e.graphic.geometry.type&&(t=e.graphic.geometry),t?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(t):1:null}},{key:"graphicVisible",value:function(e){if(!this.layerScaleEnabled)return!0;var t=this.graphicScale(e);return this.visibleAtLayerScale(t)}},{key:"updateVisibility",value:function(e){if(this._scaleRangeActive){var t=this.graphicVisible(e);return e.setVisibilityFlag(1,t,0)}return!1}},{key:"updateGraphicLabelScaleVisibility",value:function(e){if(!this._scaleRangeActive)return!1;if(!e.labelGraphics||0===e.labelGraphics.length)return!1;var t=this.graphicScale(e),i=this.updateLabelScaleVisibility(e,t);return i&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty()),i}},{key:"updateLabelScaleVisibility",value:function(e,t){if(!e.labelGraphics||0===e.labelGraphics.length)return!1;var i=e.labelGraphics[0]._labelClass;if(i&&null!=i.minScale&&null!=i.maxScale){var a=this.visibleAtLabelScale(t,i);if(e.setVisibilityFlag(1,a,1))return!0}return!1}},{key:"scaleUpdateHandler",value:function(e){var t=this;if(this._setDirty(),!this.layerView.suspended){var i=e.extent,a=e.scale,r=this.visibleAtLayerScale(a),n=!1;this.queryGraphicUIDsInExtent(i,e.spatialReference,(function(e){var s=t.graphicsCore.getGraphics3DGraphicById(e);if(!Object(h.j)(s)){var o=s.centroid;Object(h.k)(o)&&(i[0]>o.x||i[1]>o.y||i[2]<o.x||i[3]<o.y)||(s.setVisibilityFlag(1,r,0)&&(n=!0),t.updateLabelScaleVisibility(s,a)&&(n=!0))}})),n&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}}},{key:"layerMinMaxScaleChangeHandler",value:function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities((function(e){return e.clearVisibilityFlag(1)})):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility(),this._setDirty()}}]),i}(l.a);function f(e,t){return e>0||t>0}Object(o.a)([Object(u.b)({constructOnly:!0})],b.prototype,"layerScaleEnabled",void 0),Object(o.a)([Object(u.b)({readOnly:!0})],b.prototype,"suspended",void 0),Object(o.a)([Object(u.b)({readOnly:!0})],b.prototype,"updating",void 0),b=Object(o.a)([Object(d.a)("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],b);var g="terrain-events",m=b},904:function(e,t,i){"use strict";i.d(t,"a",(function(){return Ke}));var a=i(42),r=i(29),n=i(8),s=i.n(n),o=i(15),l=i(11),c=i(2),h=i(3),u=i(19),d=i(6),p=i(7),y=i(0),b=(i(140),i(493),i(599),i(600),i(601),i(214),i(459),i(457)),f=(i(497),i(105),i(34)),g=i(17),m=i(24),v=i(61),O=i(16),j=i(127),S=i(21),x=i(4),C=i(73),k=i(25),w=i(154),G=i(36),_=i(1),R=(i(18),i(12)),I=i(636),E=i(5),P=i(10),D=i(49),L=i(37),V=i(43),A=i(409),U=i(204),M=i(381),B=i(665);function F(e){return Object(x.j)(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type}function T(e){if(Object(x.j)(e))return null;if(!F(e))return new m.a("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '".concat(e.type||e.declaredClass,"'"),{renderer:e});switch(e.type){case"simple":return z(t=e,Object(B.a)(t.symbol).error);case"unique-value":return function(e){var t=e.uniqueValueInfos.map((function(e){return Object(B.a)(e.symbol).error})).filter((function(e){return!!e})),i=Object(B.a)(e.defaultSymbol);return i.error&&t.unshift(i.error),z(e,t)}(e);case"class-breaks":return function(e){var t=e.classBreakInfos.map((function(e){return Object(B.a)(e.symbol).error})).filter((function(e){return!!e})),i=Object(B.a)(e.defaultSymbol);return i.error&&t.unshift(i.error),z(e,t)}(e);case"dictionary":return null}var t;return null}function z(e,t){if(!t)return null;var i;if((i=Array.isArray(t)?t:[t]).length>0){var a=i.map((function(e){return e.details.symbol.type||e.details.symbol.declaredClass})).filter((function(e){return!!e}));a.sort();var r=[];return a.forEach((function(e,t){0!==t&&e===a[t-1]||r.push(e)})),new m.a("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols (".concat(r.join(", "),") which are not supported in 3D"),{renderer:e,symbolErrors:i})}return null}var W=i(172),Y=i(272),X=i(335),q=i(392),H=i(227),N=i(259),Z=i(666),Q=i(351),J=H.a.fromSimpleMarkerSymbol(Z.a),K=X.a.fromSimpleLineSymbol(Z.c),$=N.a.fromSimpleFillSymbol(Z.b),ee=new q.a({symbolLayers:[new Y.a({material:{color:Q.a},edges:{type:"solid",size:"1px",color:Q.b}})]});function te(e){if(Object(x.j)(e))return null;switch(e.type){case"mesh":return ee;case"point":case"multipoint":return J;case"polyline":return K;case"polygon":case"extent":return $}return null}var ie=i(728),ae=i(261),re=i(94),ne=i(306),se=i(244),oe=i(824),le=function(e){Object(d.a)(i,e);var t=Object(p.a)(i);function i(e){var a;return Object(c.a)(this,i),(a=t.call(this,e)).events=new re.a,a.hasZ=null,a.hasM=null,a.objectIdField=null,a.spatialReference=null,a.featureAdapter={getAttribute:function(e,t){return"graphic"in e?e.graphic.attributes[t]:oe.a.getAttribute(e,t)},getAttributes:function(e){return"graphic"in e?e.graphic.attributes:oe.a.getAttributes(e)},getObjectId:function(e){return"graphic"in e?Object(U.g)(e.graphic,a.objectIdField):oe.a.getObjectId(e)},getGeometry:function(e){return"graphic"in e?e.getAsOptimizedGeometry(a.hasZ,a.hasM):oe.a.getGeometry(e)},getCentroid:function(e,t){if("graphic"in e){var i=null;Object(x.k)(e.centroid)?i=e.centroid:"point"===e.graphic.geometry.type&&Object(D.t)(e.graphic.geometry,ce,a.spatialReference)&&(i=ce);var r=new Array(2+(t.hasZ?1:0)+(t.hasM?1:0));return Object(x.j)(i)?(r[0]=0,r[1]=0,r[2]=0,r[3]=0):(r[0]=i.x,r[1]=i.y,t.hasZ&&(r[2]=i.hasZ?i.z:0),t.hasM&&(r[t.hasZ?3:2]=i.hasM?i.m:0)),new se.a([],r)}return oe.a.getCentroid(e,t)},cloneWithGeometry:function(e,t){return"graphic"in e?new ne.b(t,a.featureAdapter.getAttributes(e),null,a.featureAdapter.getObjectId(e)):oe.a.cloneWithGeometry(e,t)}},a}return Object(h.a)(i,[{key:"forEach",value:function(e){this.forAllGraphics((function(t){e(t)}))}},{key:"forEachInBounds",value:function(e,t){this.getSpatialIndex().forEachInBounds(e,t)}},{key:"forEachBounds",value:function(e,t,i){var a,r=this.getSpatialIndex(),n=Object(l.a)(e);try{for(n.s();!(a=n.n()).done;){var s=a.value,o=this.featureAdapter.getObjectId(s);Object(x.k)(r.getBounds(o,i))&&t(i)}}catch(c){n.e(c)}finally{n.f()}}}]),i}(f.a);Object(y.a)([Object(_.b)({constructOnly:!0})],le.prototype,"getSpatialIndex",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],le.prototype,"forAllGraphics",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],le.prototype,"hasZ",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],le.prototype,"hasM",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],le.prototype,"objectIdField",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],le.prototype,"spatialReference",void 0),le=Object(y.a)([Object(R.a)("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],le);var ce={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null},he=le,ue=i(724),de=function e(t){Object(c.a)(this,e),this.schedule=t,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.layerView=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.isAsync=!1},pe=i(23),ye=i(22),be=i(142),fe=i(749),ge=i(701),me=function(e){Object(d.a)(i,e);var t=Object(p.a)(i);function i(e,a,r){var n;return Object(c.a)(this,i),(n=t.call(this,e,a,r)).calloutSymbolLayer=null,n.symbol.hasVisibleCallout()&&(n.calloutSymbolLayer=Object(fe.a)(n.symbol,a)),n}return Object(h.a)(i,[{key:"doLoad",value:function(){var e=Object(o.a)(s.a.mark((function e(t){var a,r,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.calloutSymbolLayer?Object(be.d)(this.calloutSymbolLayer.load()):null,e.prev=1,e.next=4,Object(pe.a)(Object(ye.a)(i.prototype),"doLoad",this).call(this,t);case 4:e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),null==(r=this.calloutSymbolLayer)||r.abortLoad(),e.t0;case 9:if(!Object(k.o)(t)){e.next=11;break}throw null==(n=this.calloutSymbolLayer)||n.abortLoad(),Object(k.f)();case 11:if(e.t1=a,!e.t1){e.next=15;break}return e.next=15,a;case 15:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"destroy",value:function(){Object(pe.a)(Object(ye.a)(i.prototype),"destroy",this).call(this),this.calloutSymbolLayer&&this.calloutSymbolLayer.destroy()}},{key:"createGraphics3DGraphic",value:function(e,t){var a=Object(pe.a)(Object(ye.a)(i.prototype),"createGraphics3DGraphic",this).call(this,e,t);if(this.calloutSymbolLayer){var r=this.createCalloutGraphic(e);r&&a.addAuxiliaryGraphic(r)}return a}},{key:"globalPropertyChanged",value:function(e,t){var a=this;return!!Object(pe.a)(Object(ye.a)(i.prototype),"globalPropertyChanged",this).call(this,e,t)&&(!this.calloutSymbolLayer||this.calloutSymbolLayer.globalPropertyChanged(e,t,(function(e){return a._getCalloutGraphicLayer(e)})))}},{key:"updateGeometry",value:function(e,t){var a=Object(pe.a)(Object(ye.a)(i.prototype),"updateGeometry",this).call(this,e,t);if(a&&this.calloutSymbolLayer){var r=this._getCalloutGraphicLayer(e);if(r)return this.calloutSymbolLayer.updateGeometry(r,t)}return a}},{key:"createCalloutGraphic",value:function(e){var t=e.renderingInfo,i={renderer:t.renderer,symbol:t.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return e.renderingInfo=i,this.calloutSymbolLayer.createGraphics3DGraphic(e)}},{key:"_getCalloutGraphicLayer",value:function(e){var t,i=Object(l.a)(e._auxiliaryGraphics);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.graphics3DSymbolLayer===this.calloutSymbolLayer)return a}}catch(r){i.e(r)}finally{i.f()}}}]),i}(ge.a);var ve=i(727),Oe=i(115),je=function(){function e(t){var i=this;Object(c.a)(this,e),this.graphicsCore=t,this.idToState=new Map,this.states=new Set;var a=t.owner.layer&&t.owner.layer.objectIdField;a?(this.getGraphicId=function(e){return Object(U.g)(e,a)},this.getGraphics3DGraphicById=function(e){return i.graphicsCore.getGraphics3DGraphicByObjectId(e)}):(this.getGraphicId=function(e){return e.uid},this.getGraphics3DGraphicById=function(e){return i.graphicsCore.getGraphics3DGraphicById(e)})}return Object(h.a)(e,[{key:"destroy",value:function(){var e=this;this.idToState.clear(),this.states.forEach((function(t,i){return e.remove(i)}))}},{key:"add",value:function(e){var t=this,i={remove:function(){return t.remove(e)}};if(this.states.has(e))return i;var a=this.getGraphicId(e.graphic),r=this.getGraphics3DGraphicById(a);return this.states.has(e)||this.states.add(e),this.ensureStateList(a).push(e),e.displaying=!!Object(x.k)(r)&&r.isVisible(),e.isDraped=!!Object(x.k)(r)&&r.isDraped,e.tracking=!0,Object(x.k)(r)&&e.emit("changed",{}),i}},{key:"remove",value:function(e){if(this.states.has(e)){if(this.idToState.size){var t=this.getGraphicId(e.graphic),i=this.idToState.get(t);i&&(Object(Oe.j)(i,e),0===i.length&&this.idToState.delete(t))}this.states.delete(e),e.tracking=!1,e.displaying=!1}}},{key:"addGraphic",value:function(e){this.forEachState(e,(function(t){t.displaying=e.isVisible(),t.isDraped=e.isDraped,t.emit("changed",{})}))}},{key:"removeGraphic",value:function(e){this.forEachState(e,(function(e){e.displaying=!1,e.isDraped=!1}))}},{key:"updateGraphicGeometry",value:function(e){this.forEachState(e,(function(e){e.emit("changed",{})}))}},{key:"updateGraphicVisibility",value:function(e){this.forEachState(e,(function(t){t.displaying=e.isVisible()}))}},{key:"allGraphicsDeleted",value:function(){this.states.forEach((function(e){e.displaying=!1}))}},{key:"ensureStateList",value:function(e){var t=this.idToState.get(e);if(t)return t;var i=new Array;return this.idToState.set(e,i),i}},{key:"forEachState",value:function(e,t){if(0!==this.states.size&&0!==this.idToState.size){var i=this.getGraphicId(e.graphic),a=this.idToState.get(i);null!=a&&a.forEach(t)}}}]),e}(),Se=i(114),xe=i(817),Ce=function(e){Object(d.a)(i,e);var t=Object(p.a)(i);function i(e){var a;return Object(c.a)(this,i),(a=t.call(this,e))._index=new xe.a(9,Object(g.a)("csp-restrictions")?function(e){return{minX:e.extent[0],minY:e.extent[1],maxX:e.extent[2],maxY:e.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),a._missing=new Set,a._boundsByFeature=new Map,a.spatialReference=null,a.hasZ=null,a.hasM=null,a.objectIdField=null,a.updating=!1,a}return Object(h.a)(i,[{key:"setup",value:function(e){this._addMany(e)}},{key:"destroy",value:function(){this._missing.clear(),this._index.destroy(),this._index=null,this._boundsByFeature.clear(),this._boundsByFeature=null}},{key:"update",value:function(){this._missing.size>0&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())}},{key:"updatingRemaining",get:function(){return this._missing.size}},{key:"queryGraphicUIDsInExtent",value:function(e,t,i){t.equals(this.spatialReference)&&(ke.minX=e[0],ke.minY=e[1],ke.maxX=e[2],ke.maxY=e[3],this.update(),this._index.search(ke,(function(e){return i(e.graphic.uid)})))}},{key:"add",value:function(e){this._missing.add(e),this.updating=!0}},{key:"remove",value:function(e){if(this._missing.delete(e))this.updating=this._missing.size>0;else{this._index.remove(e);var t=Object(U.g)(e.graphic,this._get("objectIdField"));null!=t&&this._boundsByFeature.delete(t)}}},{key:"_addMany",value:function(e){if(0!==e.length){var t,i=this._get("objectIdField"),a=Object(l.a)(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;r.computeExtent(this.spatialReference);var n=Object(U.g)(r.graphic,i);null!=n&&this._boundsByFeature.set(n,r.extent)}}catch(s){a.e(s)}finally{a.f()}this._index.load(e)}}},{key:"clear",value:function(){this._index.clear(),this._missing.clear(),this._boundsByFeature.clear(),this.updating=!1}},{key:"forEachInBounds",value:function(e,t){ke.minX=e[0],ke.minY=e[1],ke.maxX=e[2],ke.maxY=e[3],this.update(),this._index.search(ke,(function(e){t(e)}))}},{key:"getBounds",value:function(e,t){this.update();var i=this._boundsByFeature.get(e);return i?Object(L.s)(t,i):null}}]),i}(f.a);Object(y.a)([Object(_.b)({constructOnly:!0})],Ce.prototype,"spatialReference",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],Ce.prototype,"hasZ",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],Ce.prototype,"hasM",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],Ce.prototype,"objectIdField",void 0),Object(y.a)([Object(_.b)()],Ce.prototype,"updating",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Ce.prototype,"updatingRemaining",null),Ce=Object(y.a)([Object(R.a)("esri.views.3d.layers.graphics.SpatialIndex2D")],Ce);var ke={minX:0,minY:0,maxX:0,maxY:0},we=i(316),Ge=i(78),_e=i(463),Re=i(161),Ie=O.a.getLogger("esri.views.3d.layers.support.StageLayerElevationProvider"),Ee=function(e){Object(d.a)(i,e);var t=Object(p.a)(i);function i(e){var a;return Object(c.a)(this,i),(a=t.call(this,e)).elevationOffset=0,a._layerHandes=new v.a,a}return Object(h.a)(i,[{key:"initialize",value:function(){var e=this;this.renderCoordsHelper=this.view.renderCoordsHelper,this.intersectLayers=[this.stageLayer],this.intersector=new Re.a(this.view.state.viewingMode),this.intersector.options.store=0;var t=this.computeLayerExtent(this.stageLayer);this.zmin=t[2],this.zmax=t[5];var i=this.stageLayer.events;this._layerHandes.add([i.on("layerObjectAdded",(function(t){return e.objectChanged(t.object)})),i.on("layerObjectRemoved",(function(t){return e.objectChanged(t.object)})),i.on("objectGeometryAdded",(function(t){return e.objectChanged(t.object)})),i.on("objectGeometryRemoved",(function(t){return e.objectChanged(t.object)})),i.on("vertexAttrsUpdated",(function(t){return e.objectChanged(t.object)})),i.on("objectTransformation",(function(t){return e.objectChanged(t)}))])}},{key:"dispose",value:function(){this._layerHandes.destroy()}},{key:"elevationInfoChanged",value:function(){var e=null!=this.layer?this.layer.elevationInfo:null;if(null!=e&&"on-the-ground"!==e.mode){var t=Object(Ge.g)(this.layer.spatialReference),i=Object(_e.a)(e.unit);this.elevationOffset=Object(x.u)(e.offset,0)*i/t}else this.elevationOffset=0}},{key:"getElevation",value:function(e,t,i,a){if(Ae[0]=e,Ae[1]=t,Ae[2]=i,!this.renderCoordsHelper.toRenderCoords(Ae,a,Ae))return Ie.error("could not project point for elevation alignment"),null;var r=this.elevationOffset,n=this.zmin+r,s=this.zmax+r;this.renderCoordsHelper.setAltitude(Ue,s,Ae),this.renderCoordsHelper.setAltitude(Me,n,Ae);return this.intersector.reset(Ue,Me),this.intersector.intersect(this.intersectLayers,null,null,1,null,(function(e){return e.metadata&&e.metadata.isElevationSource})),this.intersector.results.min.getIntersectionPoint(Ae)?this.renderCoordsHelper.getAltitude(Ae):null}},{key:"objectChanged",value:function(e){var t;if(null!=(t=e.metadata)&&t.isElevationSource&&this.spatialReference){Object(L.k)(De),e.metadata.lastValidElevationBB.isEmpty()||this.expandExtent(e.metadata.lastValidElevationBB.min,e.metadata.lastValidElevationBB.max,De);var i=e.boundingVolumeWorldSpace.min,a=e.boundingVolumeWorldSpace.max;this.expandExtent(i,a,De),Object(L.F)(De,Le),this.zmin=Math.min(this.zmin,De[2]),this.zmax=Math.max(this.zmax,De[5]),Ve.extent=Le,Ve.spatialReference=this.spatialReference,this.emit("elevation-change",Ve),Object(E.m)(e.metadata.lastValidElevationBB.min,i),Object(E.m)(e.metadata.lastValidElevationBB.max,a)}}},{key:"computeLayerExtent",value:function(e){var t=this;return Object(L.k)(De),e.objects.forAll((function(e){return t.expandExtent(e.boundingVolumeWorldSpace.min,e.boundingVolumeWorldSpace.max,De)})),De}},{key:"expandExtent",value:function(e,t,i){for(var a=0;a<8;++a)Ae[0]=1&a?e[0]:t[0],Ae[1]=2&a?e[1]:t[1],Ae[2]=4&a?e[2]:t[2],this.renderCoordsHelper.fromRenderCoords(Ae,Ae,this.spatialReference),Object(L.r)(i,Ae);return i}}]),i}(re.a.EventedMixin(f.a));Object(y.a)([Object(_.b)({constructOnly:!0})],Ee.prototype,"layer",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],Ee.prototype,"stageLayer",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],Ee.prototype,"view",void 0),Object(y.a)([Object(_.b)({readOnly:!0,aliasOf:"view.spatialReference"})],Ee.prototype,"spatialReference",void 0),Ee=Object(y.a)([Object(R.a)("esri.views.3d.layers.support.StageLayerElevationProvider")],Ee);var Pe,De=Object(L.k)(),Le=Object(V.n)(),Ve={spatialReference:null,extent:Le,context:"scene"},Ae=Object(P.e)(),Ue=Object(P.e)(),Me=Object(P.e)(),Be=i(498),Fe=i(237),Te=i(537),ze=i(311),We=i(103),Ye=i(72),Xe=i(57),qe=i(334),He=i(287),Ne=i(251),Ze=Object(P.e)(),Qe=Object(L.h)(),Je=O.a.getLogger("esri.views.3d.layers.graphics.Graphics3DCore"),Ke=Pe=function(e){Object(d.a)(i,e);var t=Object(p.a)(i);function i(e){var a;return Object(c.a)(this,i),(a=t.call(this,e)).propertiesPool=new Fe.a({computedExtent:Ye.a},Object(u.a)(a)),a.computedExtent=null,a.currentRenderer=null,a.rendererHasGeometryOperations=!1,a.graphicStateTracking=null,a.symbolCreationContext=new de((function(e,t){return a._frameTask.schedule(e,t)})),a.graphics3DGraphics=new Map,a.stageLayer=null,a.stage=null,a.graphicsDrapedUids=new Set,a.graphicsBySymbol=new Map,a.symbolConversionCache=new Map,a.symbols=new Map,a.graphicsWithoutSymbol=new Map,a.graphicsWaitingForSymbol=new Set,a._handles=new v.a,a._frameTask=We.a,a.suspendSymbolCleanup=!1,a._spatialReference=null,a.arcadeOnDemand=null,a.rendererChangeAbortController=null,a.elevationInfoChangeAbortController=null,a.setupAbortController=null,a.elevationAlignment=null,a.scaleVisibility=null,a.filterVisibility=null,a._spatialIndex=null,a.extentPadding=0,a._updatingPendingLoadedGraphicsChange=null,a.featureStore=null,a.deconflictor=null,a.labeler=null,a.objectStates=null,a.viewElevationProvider=null,a.stageLayerElevationProvider=null,a.sharedSymbolResourcesOwnerHandle=null,a.whenGraphics3DGraphicRequests={},a.pendingUpdates=new Map,a.numberOfGraphics=0,a.numberOfGraphicsProvidingElevation=0,a.pendingAdds=0,a.pendingRemoves=0,a.pendingUpdatesPool=new C.a({allocator:function(e){return e||new $e},deallocator:function(e){return e.clear(),e}}),a.symbolWarningLogged=!1,a.geometryWarningLogged=!1,a.objectIdInvisibleSet=new Set,a._whenSymbolRemoved=new C.a,a.preferredUpdatePolicy=1,a.forcedUpdatePolicy=null,a.elevationFeatureExpressionEnabled=!0,a.owner=null,a.layer=null,a.graphicSymbolSupported=!0,a.getRenderingInfoWithoutRenderer=!1,a.hasZ=null,a.hasM=null,a._usedMemory=0,a._visible=void 0,a._startCreateGraphics=!1,a}return Object(h.a)(i,[{key:"spatialIndex",get:function(){return this._spatialIndex||(this._spatialIndex=new Ce({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values()))),this._spatialIndex.update(),this._spatialIndex}},{key:"effectiveUpdatePolicy",get:function(){return Object(x.k)(this.currentRenderer)&&"dictionary"===this.currentRenderer.type?0:Object(x.u)(this.forcedUpdatePolicy,this.preferredUpdatePolicy)}},{key:"updating",get:function(){var e,t;return!!(this.graphicsWaitingForSymbol.size>0||this.running||null!=(e=this.elevationAlignment)&&e.updating||Object(x.k)(this.scaleVisibility)&&this.scaleVisibility.updating||null!=(t=this.filterVisibility)&&t.updating||this.rendererChangeAbortController||this.elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating)}},{key:"running",get:function(){var e;return this.pendingUpdates.size>0||!(null==(e=this._spatialIndex)||!e.updating)}},{key:"suspendedOrOutsideOfView",get:function(){var e;return this.owner.suspended||(null==(e=this.owner.suspendInfo)?void 0:e.outsideOfView)}},{key:"updatingRemaining",get:function(){var e,t;return this.updating?this.pendingUpdates.size+.1*((null==(e=this._spatialIndex)?void 0:e.updatingRemaining)||0)+.1*((null==(t=this.elevationAlignment)?void 0:t.updatingRemaining)||0):0}},{key:"displayFeatureLimit",get:function(){var e=this.owner&&this.owner.view&&this.owner.view.qualitySettings,t=e?e.graphics3D.minTotalNumberOfFeatures:0,i=e?e.graphics3D.maxTotalNumberOfFeatures:0,a=e?e.graphics3D.maxTotalNumberOfPrimitives:0,r=this.averageSymbolComplexity,n=Math.max(1,Object(x.k)(r)?r.primitivesPerFeature:1),s=Object(x.k)(r)&&r.drawCallsPerFeature>0?i/r.drawCallsPerFeature*.3:i,o=Math.ceil(a/n),l=Math.max(t,Math.min(i,o,s)),c=this._get("displayFeatureLimit");return c&&c.minimumTotalNumberOfFeatures===t&&c.maximumTotalNumberOfFeatures===i&&c.maximumTotalNumberOfPrimitives===a&&c.averageSymbolComplexity===r&&c.maximumNumberOfFeatures===l?c:{minimumTotalNumberOfFeatures:t,maximumTotalNumberOfFeatures:i,maximumTotalNumberOfPrimitives:a,averageSymbolComplexity:r,maximumNumberOfFeatures:l}}},{key:"averageSymbolComplexity",get:function(){var e=Object(we.a)(this.symbolComplexities),t=this._get("averageSymbolComplexity");return 0===e.numComplexities||Object(x.k)(t)&&(e.estimated&&(t.primitivesPerFeature>=e.primitivesPerFeature||t.primitivesPerCoordinate>=e.primitivesPerCoordinate||t.drawCallsPerFeature>=e.drawCallsPerFeature)||t.primitivesPerFeature===e.primitivesPerFeature&&t.primitivesPerCoordinate===e.primitivesPerCoordinate&&t.drawCallsPerFeature===e.drawCallsPerFeature)?t:e}},{key:"spatialReference",get:function(){return this._spatialReference}},{key:"usedMemory",get:function(){var e=Object(x.k)(this.averageSymbolComplexity)&&this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this.numberOfGraphics:0;return this._usedMemory+e}},{key:"usedMemoryPerGraphic",get:function(){if(this._usedMemory&&this.numberOfGraphics)return Math.abs(this.pendingAdds-this.pendingRemoves)/this.numberOfGraphics>30?0:this._usedMemory/this.numberOfGraphics;if(Object(x.k)(this.averageSymbolComplexity)){var e=this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0;return this.averageSymbolComplexity.memory.bytesPerFeature+e}return 0}},{key:"unprocessedMemoryEstimate",get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)}},{key:"symbolComplexities",get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()}},{key:"getConvertedSymbol",value:function(e){if("web-style"===e.type)return e.clone();var t=this.symbolConversionCache.get(e.id);if(void 0!==t)return t;var i=Object(B.a)(e,!0,!1,this.hasLabelingContext(e)),a=i.symbol||null;return a||i.error&&Je.error(i.error.message),this.symbolConversionCache.set(e.id,a),a}},{key:"getSymbolComplexitiesUsedOrRenderer",value:function(e){if(Object(x.j)(e))return[];var t=e.getSymbols(),i="backgroundFillSymbol"in e&&e.backgroundFillSymbol;if(!(i||t&&t.length))return[];var a=[],r=this.getSymbolComplexityUsedOrRenderer(i);Object(x.k)(r)&&a.push(r);var n,s=Object(l.a)(t);try{for(s.s();!(n=s.n()).done;){var o=n.value,c=this.getSymbolComplexityUsedOrRenderer(o);Object(x.k)(c)&&a.push(c)}}catch(h){s.e(h)}finally{s.f()}return a}},{key:"getSymbolComplexityUsedOrRenderer",value:function(e){if(Object(x.j)(e))return null;var t=this.symbols.get(e.id);if(Object(x.k)(t))return t.complexity;var i=this.getConvertedSymbol(e);return i?Object(we.b)(i):null}},{key:"getSymbolComplexitiesUsed",value:function(){var e=[];return this.symbols.forEach((function(t){Object(x.k)(t)&&e.push(t.complexity)})),e}},{key:"initialize",value:function(){var e=this;this._spatialReference=this.owner.view.spatialReference,this._set("featureStore",new he({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:function(){return e.spatialIndex},forAllGraphics:function(t){return e.graphics3DGraphics.forEach(t)}}))}},{key:"setup",value:function(){var e=Object(o.a)(s.a.mark((function e(t){var i,a,r,n,o=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setupAbortController=Object(k.e)(),i=this.setupAbortController.signal,this._set("elevationAlignment",t.elevationAlignment),this._set("scaleVisibility",t.scaleVisibility),this._set("filterVisibility",t.filterVisibility),this._set("deconflictor",t.deconflictor),this._set("labeler",t.labeler),this._set("objectStates",t.objectStates),a=this.owner.view,this.viewElevationProvider=new ie.b(this._spatialReference,a),this.initializeStage(a,this.layer.uid),this.symbolCreationContext.sharedResources=a.sharedSymbolResources,this.sharedSymbolResourcesOwnerHandle=a.sharedSymbolResources.addGraphicsOwner(this.owner),Object(x.k)(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer),this.symbolCreationContext.stage=this.stage,this.symbolCreationContext.streamDataRequester=a.sharedSymbolResources.streamDataRequester,this.symbolCreationContext.renderCoordsHelper=a.renderCoordsHelper,this.symbolCreationContext.layer=this.layer,this.symbolCreationContext.layerView=this.owner,this.symbolCreationContext.localOriginFactory=new Te.a(a.renderSpatialReference),this.symbolCreationContext.elevationProvider=a.elevationProvider,this.symbolCreationContext.notifyGraphicGeometryChanged=function(e){return o.notifyGraphicGeometryChanged(e)},this.symbolCreationContext.notifyGraphicVisibilityChanged=function(e){return o.notifyGraphicVisibilityChanged(e)},r=Object(ae.f)(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),e.next=8,Object(ae.b)(r,this._spatialReference,Je);case 8:return this.symbolCreationContext.featureExpressionInfoContext=e.sent,Object(k.x)(i),this.symbolCreationContext.screenSizePerspectiveEnabled=a.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled,n="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled",this._handles.add([this.watch("suspendedOrOutsideOfView",(function(){return o._frameTask.reschedule((function(){return o.updateLayerVisibility()}))})),this.owner.watch(n,(function(){var e,t=a.screenSizePerspectiveEnabled&&o.layer.screenSizePerspectiveEnabled;t!==o.symbolCreationContext.screenSizePerspectiveEnabled&&(o.symbolCreationContext.screenSizePerspectiveEnabled=t,null==(e=o.labeler)||e.reset(),o.recreateAllGraphics())})),this.owner.watch("slicePlaneEnabled",(function(e){return o.slicePlaneEnabledChange(!!e)})),this.owner.view.watch("pixelRatio",(function(){return o.pixelRatioChange()})),this.owner.view.watch("qualitySettings.physicallyBasedRenderingEnabled",(function(e){return o.physicalBasedRenderingChange(e)})),Object(G.f)(a.basemapTerrain,"tilingScheme",(function(e){e.spatialReference.equals(o.symbolCreationContext.overlaySR)||(o.symbolCreationContext.overlaySR=a.basemapTerrain.spatialReference),o._handles.has("loaded-graphics")?o.recreateAllGraphics():o._handles.add([Object(G.b)(o.owner,"loadedGraphics","change",(function(e){return o.graphicsCollectionChanged(e)}),(function(){return o.recreateAllGraphics()})),Object(G.b)(o.owner,"loadedGraphics","after-changes",(function(){return o._signalUpdatingDuringAsyncLoadedGraphicsChange()}),(function(){return o._signalUpdatingDuringAsyncLoadedGraphicsChange()}))],"loaded-graphics")})),Object(G.g)(this,"asyncUpdates",(function(){return o.runTask(We.d)}),!0),Object(G.a)(this,"effectiveUpdatePolicy",(function(e){Object(x.k)(o.stageLayer)&&(o.stageLayer.updatePolicy=e),o.symbolCreationContext.isAsync=0===o.effectiveUpdatePolicy,1===e&&o.runTask(We.d)}),!0)]),this._frameTask=a.resourceController.scheduler.registerTask(We.b.GRAPHICS_CORE,this),this.owner.layer&&"featureReduction"in this.owner.layer&&this._handles.add(this.owner.watch("layer.featureReduction",(function(){return o.deconflictor.featureReductionChange()}))),this.notifyChange("averageSymbolComplexity"),e.prev=15,e.next=18,this.rendererChange(this.layer.renderer);case 18:e.next=22;break;case 20:e.prev=20,e.t0=e.catch(15);case 22:Object(k.x)(i),this.setupAbortController=null;case 23:case"end":return e.stop()}}),e,this,[[15,20]])})));return function(t){return e.apply(this,arguments)}}()},{key:"abortSetup",value:function(){this.setupAbortController&&(this.setupAbortController.abort(),this.setupAbortController=null)}},{key:"destroy",value:function(){for(var e in this.abortSetup(),this.abortRendererChange(),this.abortElevationInfoChange(),this.owner.view.deconflictor.removeGraphicsOwner(this),this.owner.view.labeler.removeGraphicsOwner(this),this._updatingPendingLoadedGraphicsChange&&(this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=null),this.clear(),Object(x.k)(this.graphicStateTracking)&&(this.graphicStateTracking.destroy(),this.graphicStateTracking=null),this.stage&&(this.stage.remove(this.stageLayer),this.stageLayer=null,this.stage=null),this._handles=Object(x.e)(this._handles),this._frameTask.remove(),this._frameTask=We.a,this._spatialReference=null,this._set("owner",null),this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[e].reject(new m.a("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null,this.sharedSymbolResourcesOwnerHandle=Object(x.s)(this.sharedSymbolResourcesOwnerHandle),this.propertiesPool=Object(x.e)(this.propertiesPool),this.pendingUpdatesPool=null,this.symbolConversionCache.clear(),this.objectIdInvisibleSet.clear(),this._spatialIndex=Object(x.e)(this._spatialIndex),this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",null))}},{key:"clear",value:function(){var e;this.objectStates&&this.objectStates.allGraphicsDeleted(),Object(x.k)(this.graphicStateTracking)&&this.graphicStateTracking.allGraphicsDeleted(),this.graphics3DGraphics.forEach((function(e){return e.destroy()})),null==(e=this._spatialIndex)||e.clear(),this.graphics3DGraphics.clear(),this.numberOfGraphics=0,this._usedMemory=0,this.updateLayerVisibility(),this.symbols.forEach((function(e){Object(x.k)(e)&&e.destroy()})),this.symbols.clear(),this.graphicsBySymbol.clear(),this.graphicsWithoutSymbol.clear(),this.graphicsWaitingForSymbol.clear(),this.pendingUpdates.clear(),this.pendingUpdatesPool.clear(),this.pendingAdds=0,this.pendingRemoves=0,this.notifyChange("updating"),this.notifyChange("running"),this.notifyChange("updatingRemaining"),this.featureStore.events.emit("changed")}},{key:"initializeStage",value:function(e,t){var i=this;this.stage=e._stage,this.stageLayer=new ze.a({isPickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},t),this.stage.add(this.stageLayer);var a=this.stageLayer.events;a.on("objectTransformation",(function(e){return i.notifyGraphicGeometryChanged(e.metadata.graphicUid)})),a.on("visibilityChanged",(function(e){return i.notifyGraphicVisibilityChanged(e.metadata.graphicUid)})),a.on("objectGeometryAdded",(function(e){return i.notifyGraphicGeometryChanged(e.object.metadata.graphicUid)})),a.on("objectGeometryRemoved",(function(e){return i.notifyGraphicGeometryChanged(e.object.metadata.graphicUid)})),a.on("vertexAttrsUpdated",(function(e){return i.notifyGraphicGeometryChanged(e.object.metadata.graphicUid)}))}},{key:"notifyGraphicGeometryChanged",value:function(e){if(!Object(x.j)(this.graphicStateTracking)){var t=this.graphics3DGraphics.get(e);t&&this.graphicStateTracking.updateGraphicGeometry(t)}}},{key:"notifyGraphicVisibilityChanged",value:function(e){if(!Object(x.j)(this.graphicStateTracking)){var t=this.graphics3DGraphics.get(e);t&&this.graphicStateTracking.updateGraphicVisibility(t)}}},{key:"updateLayerVisibility",value:function(){var e=this.displayFeatureLimit.maximumNumberOfFeatures,t=this.numberOfGraphics>e*et,i=!this.suspendedOrOutsideOfView&&!t;i!==this._visible&&(this._visible=i,i?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())}},{key:"updateStageLayerVisibility",value:function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||this.layer.opacity>0)}},{key:"getGraphics3DGraphicById",value:function(e){return this.graphics3DGraphics.get(e)}},{key:"getGraphics3DGraphicByObjectId",value:function(e){var t;return null!=(t=this.owner.layer)&&t.objectIdField?this._findGraphics3DGraphicByObjectId(e):null}},{key:"_getGraphicObjectID",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.owner.layer&&this.owner.layer.objectIdField;return Object(U.g)(e,t)}},{key:"graphics3DGraphicsByObjectID",get:function(){var e=this,t=this.owner.layer&&this.owner.layer.objectIdField;if(!t)return null;var i=new Map;return this.graphics3DGraphics.forEach((function(a){if(a){var r=a.graphic,n=e._getGraphicObjectID(r,t);Object(x.k)(n)&&i.set(n,a)}})),i}},{key:"labelsEnabled",get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())}},{key:"updateLabelingInfo",value:function(){var e=Object(o.a)(s.a.mark((function e(t){var i,a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.deconflictor&&this.deconflictor.labelingInfoChange(t),a=this.labeler&&this.labeler.labelingInfoChange(t),e.next=3,Object(k.k)([i,a]);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateVisibilityInfo",value:function(){this.deconflictor&&this.deconflictor.labelingInfoChange(),this.labeler&&this.labeler.visibilityInfoChange()}},{key:"symbolUpdateType",get:function(){var e=this;if(this.pendingUpdates.size>0)return"unknown";var t=0,i=0;return Object(j.c)(this.symbols,(function(a,r){if(Object(x.k)(a)){var n=a.getFastUpdateStatus();if(n.loading>0)return!0;e.graphicsBySymbol.has(r)&&(i+=n.fast,t+=n.slow)}return!1}))?"unknown":i>=0&&0===t?"fast":t>=0&&0===i?"slow":"mixed"}},{key:"runTask",value:function(e){this._frameTask.processQueue(e),this._applyPendingUpdates(e),this.notifyChange("running"),this.running||this.notifyChange("updating"),this.notifyChange("updatingRemaining")}},{key:"setObjectIdVisibility",value:function(e,t){t?this.objectIdInvisibleSet.delete(e):this.objectIdInvisibleSet.add(e);var i=this._findGraphics3DGraphicByObjectId(e);Object(x.k)(i)&&this._updateUserVisibility(i)}},{key:"_findGraphics3DGraphicByObjectId",value:function(e){var t=this;return Object(j.a)(this.graphics3DGraphics,(function(i){return t._getGraphicObjectID(i.graphic)===e}))}},{key:"_updateUserVisibility",value:function(e){if(Object(x.j)(e))return!1;var t=e.graphic,i=this._getGraphicObjectID(t),a=t.visible&&!this.owner.suspended&&(Object(x.j)(i)||!this.objectIdInvisibleSet.has(i));return e.setVisibilityFlag(0,a,0)}},{key:"whenGraphics3DGraphic",value:function(e){var t=this.graphics3DGraphics.get(e.uid);if(t)return Promise.resolve(t);var i=this.whenGraphics3DGraphicRequests[e.uid];if(i)return i.promise;var a=Object(k.g)();return this.whenGraphics3DGraphicRequests[e.uid]=a,a.promise}},{key:"boundsForGraphics3DGraphic",value:function(){var e=Object(o.a)(s.a.mark((function e(t,i){var a,r,n,o,l,c,h,u,d,p;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this._spatialReference,r=this.owner.view.renderSpatialReference,n=this.owner.view.basemapTerrain.spatialReference,o=function(e,t,i){return Object(D.q)(e,r,t,e,a,t,i)},l=function(e,t,i){return Object(D.q)(e,n,t,e,a,t,i)},c=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:Object(x.k)(i)&&i.useViewElevation,minDemResolution:Object(x.k)(i)&&i.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null,e.next=8,t.getProjectedBoundingBox(o,l,c,Object(x.i)(i,"signal"));case 8:if(h=e.sent){e.next=11;break}return e.abrupt("return",null);case 11:return u=h.boundingBox,h.requiresDrapedElevation&&(d=this.symbolCreationContext.elevationProvider)&&(Object(L.e)(u,Ze),p=Object(x.u)(d.getElevation(Ze[0],Ze[1],0,a,"ground"),0),u[2]=Math.min(u[2],p),u[5]=Math.max(u[5],p)),e.abrupt("return",{boundingBox:u,screenSpaceObjects:h.screenSpaceObjects});case 14:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"whenGraphicBounds",value:function(e,t){var i=this;return Object(G.j)(this.owner,"loadedGraphics").then((function(){var t=i.owner.layer&&i.owner.layer.objectIdField,a=i.owner.loadedGraphics.find((function(i){return i===e||t&&i.attributes&&e.attributes&&i.attributes[t]===e.attributes[t]}));if(a)return i.whenGraphics3DGraphic(a);throw new m.a("internal:graphic-not-part-of-view","Graphic is not part of this view")})).then((function(e){return i.boundsForGraphics3DGraphic(e,t)}))}},{key:"computeAttachmentOrigin",value:function(e,t){var i=this.graphics3DGraphics.get(e.uid);if(!i)return null;var a=i.computeAttachmentOrigin();if(0===a.render.num&&0===a.draped.num)return null;Object(E.y)(tt,0,0,0);var n=0;if(a.render.num>0){if(!Object(D.z)(a.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,it,t))return null;Object(E.h)(tt,tt,it),n++}if(a.draped.num>0){var s=Object(r.a)(a.draped.origin,2),o=s[0],l=s[1],c=Object(x.u)(this.viewElevationProvider.getElevation(o,l,"ground"),0);if(Object(E.y)(it,o,l,c),!Object(D.z)(it,this.viewElevationProvider.spatialReference,it,t))return null;Object(E.h)(tt,tt,it),n++}return n>1&&Object(E.g)(tt,tt,1/n),new Xe.a({x:tt[0],y:tt[1],z:tt[2],spatialReference:t})}},{key:"getSymbolLayerSize",value:function(e,t){var i=this.symbols.get(e.id);if(Object(x.j)(i))throw new m.a("internal:symbol-not-part-of-view","Symbol is not part of this view");var a=e.symbolLayers.indexOf(t);if(-1===a)throw new m.a("internal:missing-symbol-layer","Symbol layer is not in symbol");var r=i.getSymbolLayerSize(a);if(null==r)throw new m.a("internal:missing-size","Symbol layer has no valid size");return r}},{key:"graphicsCollectionChanged",value:function(e){this._startCreateGraphics&&(this.add(e.added),this.remove(e.removed))}},{key:"graphicUpdateHandler",value:function(e){var t=e.graphic.uid,i=this.graphics3DGraphics.get(t),a=this.graphicsWithoutSymbol.get(t);if(i||a)switch(e.property){case"visible":this.graphicUpdateVisibleHandler(i);break;case"geometry":this.graphicUpdateGeometryHandler(i,e);break;case"symbol":this.graphicUpdateSymbolHandler(i,e)}}},{key:"graphicUpdateGeometryHandler",value:function(e,t){var i=t.graphic.geometry;if(Object(x.j)(i))this.recreateGraphic(t.graphic);else if(Object(x.j)(e)){var a=t.graphic.symbol&&t.graphic.symbol.id;if(a){var r=this.symbols.get(a);if(Object(x.k)(r)&&0===r.loadStatus)return}this.recreateGraphic(t.graphic)}else{var n=e.graphics3DSymbol;!Object(x.j)(t.newValue)&&n.updateGeometry(e,t.newValue)||this.recreateGraphic(e.graphic),this.expandComputedExtent(i)}}},{key:"graphicUpdateSymbolHandler",value:function(e,t){var i=t.graphic,a=Object(x.k)(e)?e.graphics3DSymbol:Object(x.k)(t.oldValue)?this.symbols.get(t.oldValue.id):null;if(Object(x.j)(a)||Object(x.j)(t.newValue))this.recreateGraphic(i);else{var r=a.symbol,n=this.getConvertedSymbol(t.newValue);if(n.type===r.type&&"web-style"!==n.type&&"web-style"!==r.type){var s=this.graphicsBySymbol.get(r.id);if(s&&1!==s.size)this.recreateGraphic(i);else{var o=Object(I.a)(r,n);if(Object(x.j)(o))this.updateSymbolMapping(r.id,n);else{var c={diff:o,graphics3DGraphicPatches:[],symbolStatePatches:[]};if(a.prepareSymbolPatch(c),Object(I.d)(c.diff)){var h=this._getRenderingInfo(i);if(Object(x.j)(h))this.recreateGraphic(i);else{var u,d=a.extentPadding,p=Object(l.a)(c.symbolStatePatches);try{for(p.s();!(u=p.n()).done;){(0,u.value)()}}catch(f){p.e(f)}finally{p.f()}if(d!==a.extentPadding&&this.recomputeExtentPadding(),Object(x.k)(e)){var y,b=Object(l.a)(c.graphics3DGraphicPatches);try{for(b.s();!(y=b.n()).done;){(0,y.value)(e,h)}}catch(f){b.e(f)}finally{b.f()}}this.updateSymbolMapping(r.id,n)}}else this.recreateGraphic(i)}}}else this.recreateGraphic(i)}}},{key:"graphicUpdateVisibleHandler",value:function(e){this._updateUserVisibility(e)&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())}},{key:"recreateGraphics",value:function(e){this.suspendSymbolCleanup=!0,this.remove(e),this.add(e),this.suspendSymbolCleanup=!1,1===this.effectiveUpdatePolicy&&this._cleanupSymbols()}},{key:"recreateGraphic",value:function(e){this.recreateGraphics([e])}},{key:"_beginGraphicUpdate",value:function(e){this.graphicsWaitingForSymbol.add(e.uid),1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating")}},{key:"_endGraphicUpdate",value:function(e){e&&(this.graphicsWaitingForSymbol.delete(e.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))}},{key:"recomputeExtentPadding",value:function(){var e=0;this.symbols.forEach((function(t){Object(x.k)(t)&&(e=Math.max(e,t.extentPadding))})),this._set("extentPadding",e)}},{key:"expandComputedExtent",value:function(e){var t=Qe,i=e.spatialReference;Object(U.c)(e,t);var a=this._spatialReference,r=Pe.tmpVec;if(i.equals(a)||Object(D.C)(t[0],t[1],0,i,r,a)&&(t[0]=r[0],t[1]=r[1],Object(D.C)(t[3],t[4],0,i,r,a),t[3]=r[0],t[4]=r[1]),Object(S.k)(t[0])&&Object(S.k)(t[3])&&Object(S.k)(t[1])&&Object(S.k)(t[4])){var n=this.computedExtent,s=null,o=Object(S.k)(t[2])&&Object(S.k)(t[5]),l=o&&(!n||null==n.zmin||t[2]<n.zmin),c=o&&(!n||null==n.zmax||t[5]>n.zmax);n?(t[0]<n.xmin||t[1]<n.ymin||t[3]>n.xmax||t[4]>n.ymax||l||c)&&((s=this.propertiesPool.get("computedExtent")).xmin=Math.min(t[0],n.xmin),s.ymin=Math.min(t[1],n.ymin),s.xmax=Math.max(t[3],n.xmax),s.ymax=Math.max(t[4],n.ymax),s.spatialReference=a):((s=this.propertiesPool.get("computedExtent")).xmin=t[0],s.ymin=t[1],s.xmax=t[3],s.ymax=t[4],s.spatialReference=a),s&&(l&&(s.zmin=t[2]),c&&(s.zmax=t[5]),this._set("computedExtent",s))}}},{key:"abortElevationInfoChange",value:function(){this.elevationInfoChangeAbortController&&(this.elevationInfoChangeAbortController.abort(),this.elevationInfoChangeAbortController=null)}},{key:"elevationInfoChange",value:function(){var e=Object(o.a)(s.a.mark((function e(){var t,i,a=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.abortElevationInfoChange(),t=Object(k.e)(),this.elevationInfoChangeAbortController=t,i=Object(ae.f)(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled),e.next=6,Object(ae.b)(i,this._spatialReference,Je);case 6:this.symbolCreationContext.featureExpressionInfoContext=e.sent,Object(k.x)(t),this.elevationInfoChangeAbortController=null,this.labeler&&this.labeler.elevationInfoChange(),this.forEachGraphics3DSymbol((function(e,t,i){e.globalPropertyChanged("elevationInfo",t)?t.forEach((function(e){var t,i=e.graphic,a=e.labelGraphics,r=Object(l.a)(a);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.graphics3DSymbolLayer.updateGraphicElevationContext(i,n)}}catch(s){r.e(s)}finally{r.f()}})):a._recreateSymbol(i)})),this.updateStageLayerElevationProvider(),this.elevationAlignment&&this.elevationAlignment.elevationInfoChange();case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateStageLayerElevationProvider",value:function(){this.stageLayerElevationProvider?(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null):(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&this.numberOfGraphicsProvidingElevation>0&&(this.stageLayerElevationProvider=new Ee({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))}},{key:"clearSymbolsAndGraphics",value:function(){var e,t,i,a,r;this.clear(),null==(e=this.filterVisibility)||e.clear(),null==(t=this.labeler)||t.reset(),null==(i=this.deconflictor)||i.clear(),null==(a=this.elevationAlignment)||a.clear(),null==(r=this.stageLayer)||r.invalidateSpatialQueryAccelerator(),this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)}},{key:"startCreateGraphics",value:function(){this._startCreateGraphics=!0,this.recreateAllGraphics()}},{key:"recreateAllGraphics",value:function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))}},{key:"_recreateSymbol",value:function(e){var t=this,i=this.graphicsBySymbol.get(e),a=[];i&&(i.forEach((function(e,i){var r,n=e.usedMemory;t._conditionalRemove(e,i),null==(r=t._spatialIndex)||r.remove(e),a.push(e.graphic),e.destroy(),t.removeGraphics3DGraphic(i,n),t.updateLayerVisibility(),t.featureStore.events.emit("changed")})),this.graphicsBySymbol.set(e,new Map));var r=this.symbols.get(e);Object(x.k)(r)&&r.destroy(),this.symbols.delete(e),this.add(a)}},{key:"_conditionalRemove",value:function(e,t){e.isDraped&&this.graphicsDrapedUids.delete(t),this.objectStates&&this.objectStates.removeGraphic(e),this.labeler&&this.labeler.removeGraphic(e),this.deconflictor&&this.deconflictor.removeGraphic(e),Object(x.k)(this.graphicStateTracking)&&this.graphicStateTracking.removeGraphic(e)}},{key:"add",value:function(e){e&&0!==e.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(0===this._updatePolicyForGraphics(e)?this._addDelayed(e):this._addImmediate(e),this.notifyChange("updating")):Je.error("#add()","Cannot add graphics before terrain surface has been initialized"))}},{key:"_updatePolicyForGraphics",value:function(e){if(1===this.effectiveUpdatePolicy&&("mesh"===this.layer.geometryType||null==this.layer.geometryType)){var t,i=Object(l.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(Object(x.k)(a.geometry)&&"mesh"===a.geometry.type&&!a.geometry.loaded)return 0}}catch(r){i.e(r)}finally{i.f()}}return this.effectiveUpdatePolicy}},{key:"_addImmediate",value:function(e){this.geometryWarningLogged=!1,this.symbolWarningLogged=!1;var t,i=Object(l.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;this._addGraphic(a,this._getRenderingInfo(a,Je),1)}}catch(r){i.e(r)}finally{i.f()}this._cleanupSymbols(),this.labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols()),this.owner.view.deconflictor.setDirty()}},{key:"_addDelayed",value:function(e){var t,i=Object(l.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,r=a.uid,n=this.pendingUpdates.get(r);n?n.add?0!==n.state&&n.abortController.abort():this.pendingAdds++:(n=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,this.pendingUpdates.set(r,n)),n.add=a}}catch(s){i.e(s)}finally{i.f()}this.notifyChange("running"),this.notifyChange("updatingRemaining")}},{key:"remove",value:function(e){0===this.effectiveUpdatePolicy?this._removeDelayed(e):this._removeImmediate(e),this.notifyChange("updating")}},{key:"_removeImmediate",value:function(e){var t,i=Object(l.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;this._removeGraphic(a)}}catch(r){i.e(r)}finally{i.f()}this._cleanupSymbols(),this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty()}},{key:"_removeDelayed",value:function(e){var t,i=Object(l.a)(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,r=a.uid,n=this.pendingUpdates.get(r);if(n)n.add&&(n.remove?n.add=null:this.pendingUpdates.delete(r),1===n.state&&n.abortController.abort(),this.pendingAdds--);else{var s=this.pendingUpdatesPool.pushNew();s.remove=a,this.pendingUpdates.set(r,s),this.pendingRemoves++}}}catch(o){i.e(o)}finally{i.f()}0===this.pendingUpdates.size&&this._finishPendingUpdates(),this.notifyChange("running"),this.notifyChange("updatingRemaining")}},{key:"_finishPendingUpdates",value:function(){this.pendingUpdatesPool.clear(),this._cleanupSymbols(),(this.pendingAdds||this.pendingRemoves)&&Je.warn("pendingAdds/Removes in inconsistent state!"),this.pendingAdds=0,this.pendingRemoves=0}},{key:"_applyPendingUpdates",value:function(e){var t;if(this.geometryWarningLogged=!1,this.symbolWarningLogged=!1,0===this.pendingUpdates.size&&null!=(t=this._spatialIndex)&&t.updating)this._spatialIndex.update();else{var i,a=Object(l.a)(this.pendingUpdates);try{for(a.s();!(i=a.n()).done;){var n=Object(r.a)(i.value,2),s=n[0],o=n[1];if(e.done)break;o.add&&0===o.state&&this._processPendingUpdateNew(o);var c=this.effectiveUpdatePolicy;if(!o.remove||o.add&&2!==o.state||(this.pendingRemoves--,e.madeProgress(),this._removeGraphic(o.remove),o.remove=null,c=1),o.add)switch(o.state){case 2:this._addGraphic(o.add,o.renderingInfo,c),o.add=null,this.pendingAdds--,e.madeProgress();break;case 3:o.add=null,this.pendingAdds--}null==o.remove&&null==o.add&&this.pendingUpdates.delete(s)}}catch(h){a.e(h)}finally{a.f()}0===this.pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"))}}},{key:"_processPendingUpdateNew",value:function(e){if(e.add){var t=e.add.geometry;Object(x.k)(t)&&"mesh"===t.type&&!t.loaded?this._processPendingUpdateNewMesh(e,t):this._processPendingUpdateNewRenderingInfo(e)}else e.state=2}},{key:"_processPendingUpdateNewMesh",value:function(e,t){var i=this;e.state=1,e.abortController=Object(k.e)();var a=e.abortController.signal;t.load({signal:a}).then((function(){e.abortController=null,i._processPendingUpdateNewRenderingInfo(e)}),(function(t){return i._processPendingUpdateNewError(e,t)}))}},{key:"_processPendingUpdateNewError",value:function(e,t){e.abortController=null,Object(k.n)(t)?e.state=0:e.state=3}},{key:"_processPendingUpdateNewRenderingInfo",value:function(e){var t=this;if(Object(x.j)(this.layer.renderer)||"dictionary"!==this.layer.renderer.type)return e.renderingInfo=this._getRenderingInfo(e.add,Je),void(e.state=2);e.state=1,e.abortController=Object(k.e)(),this._getRenderingInfoAsync(e.add,{signal:e.abortController.signal}).then((function(i){Object(x.j)(i)||Object(x.j)(i.symbol)?(Je&&!t.symbolWarningLogged&&(t.symbolWarningLogged=!0,Je.warn("Graphic in layer ".concat(t.layer.id," has no symbol and will not render"))),e.renderingInfo=null):e.renderingInfo=i,e.state=2}),(function(t){e.abortController=null,Object(k.n)(t)?e.state=0:e.state=3}))}},{key:"_addGraphic",value:function(e,t,i){var a=this;if(this.graphicsWithoutSymbol.set(e.uid,e),!Object(x.j)(t)&&!Object(x.j)(t.symbol)&&Object(U.h)(e)){var r=t.symbol,n=this.getOrCreateGraphics3DSymbol(r,t.renderer);if(!Object(x.j)(n)){this.expandComputedExtent(e.geometry),this._beginGraphicUpdate(e);var s=new ue.a(e,t,this.layer),o=!1,l=function(e){e===n.symbol.id&&(o=!0)};this._whenSymbolRemoved.push(l);var c=function(){if(!a.destroyed){if(a._whenSymbolRemoved.removeUnordered(l),!(o||n.destroyed||a.graphicSymbolSupported&&e.symbol&&e.symbol.id!==n.symbol.id)){if(a.graphicsWaitingForSymbol.has(e.uid)){var t=a._createGraphics3DGraphic(n,s);a._spatialIndex&&Object(x.k)(t)&&a._spatialIndex.add(t)}a._endGraphicUpdate(e)}--n.referenced,a.featureStore.events.emit("changed"),a.labeler&&a.owner.view.labeler.setDirty()}},h=function(t){a.destroyed||(a._whenSymbolRemoved.removeUnordered(l),o||(Object(k.n)(t)?a.add([e]):n.destroyed||a._endGraphicUpdate(e)))};0===i?n.load((function(){return a._frameTask.schedule(c)}),(function(e){return a._frameTask.schedule((function(){return h(e)}))})):n.load(c,h)}}}},{key:"_removeGraphic",value:function(e){var t=e.uid,i=this.graphics3DGraphics.get(t);if(i){var a;i.graphics3DSymbol.onRemoveGraphic(i);var r=i.usedMemory,n=i.isElevationSource;this._conditionalRemove(i,t),null==(a=this._spatialIndex)||a.remove(i);var s=i.graphics3DSymbol.symbol.id;this.graphicsBySymbol.get(s).delete(t),this.graphicsWithoutSymbol.delete(t),this.removeGraphics3DGraphic(t,r,n),i.destroy(),this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(t),this.graphicsWaitingForSymbol.delete(t),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"))}},{key:"hasLabelingContext",value:function(e){if(e instanceof qe.a||e instanceof He.a){var t=this.symbolCreationContext.layer;return!!t.labelingInfo&&t.labelingInfo.some((function(t){return t.symbol===e}))}return!1}},{key:"hasValidSymbolCreationContext",value:function(e){return!(e instanceof qe.a&&!this.hasLabelingContext(e))||(Je.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1)}},{key:"_getRenderingInfo",value:function(e,t){var i=e.geometry;if(Object(x.j)(i))return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn("Graphic in layer ".concat(this.layer.id," has no geometry and will not render"))),null;if(!Object(D.b)(i.spatialReference,this._spatialReference))return t&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,t.warn("Graphic in layer ".concat(this.layer.id," has incompatible spatial reference and will not render"))),null;if(!this.graphicSymbolSupported&&Object(x.k)(e.symbol))return t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer ".concat(this.layer.id," is not allowed to have a symbol, use a renderer instead"))),null;var a,r=this.rendererHasGeometryOperations?Object(M.c)(e,this.layer):e;return a=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||Object(x.k)(this.currentRenderer))?this.owner.getRenderingInfo(r,this.currentRenderer,Object(x.t)(this.arcadeOnDemand)):{symbol:r.symbol||te(r.geometry)},Object(x.j)(a)||Object(x.j)(a.symbol)?(t&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,t.warn("Graphic in layer ".concat(this.layer.id," has no symbol and will not render"))),null):a}},{key:"_getRenderingInfoAsync",value:function(e,t){var i=e.geometry;if(Object(x.j)(i))return Je&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,Je.warn("Graphic in layer ".concat(this.layer.id," has no geometry and will not render"))),null;if(!this.graphicSymbolSupported&&Object(x.k)(e.symbol))return Je&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Je.warn("Graphic in layer ".concat(this.layer.id," is not allowed to have a symbol, use a renderer instead"))),null;var a=this.rendererHasGeometryOperations?Object(M.c)(e,this.layer):e;return this.owner.getRenderingInfoAsync(a,Object(x.t)(this.currentRenderer),Object(x.t)(this.arcadeOnDemand),t)}},{key:"createGraphics3DSymbol",value:function(e,t){var i=this;if(!this.hasValidSymbolCreationContext(e))return null;var a,r=this.getConvertedSymbol(e);if(!r)return null;if(Object(x.k)(t)&&"backgroundFillSymbol"in t&&t.backgroundFillSymbol){var n=Object(B.a)(t.backgroundFillSymbol,!1,!0);n.symbol&&"web-style"!==n.symbol.type&&(a=n.symbol.symbolLayers)}var s=function(e,t,i){return new("point-3d"===e.type?me:ge.a)(e,t,i)}(r,this.symbolCreationContext,a);return s.load((function(){var e=s.extentPadding;e>i.extentPadding&&i._set("extentPadding",e),i.notifyChange("averageSymbolComplexity")}),(function(){})),s}},{key:"getOrCreateGraphics3DSymbol",value:function(e,t){var i=this,a=this.symbols.get(e.id);return void 0===a&&(a=e instanceof Ne.a?new ve.a(e,(function(e){return i._frameTask.schedule(e)}),(function(e){return i.createGraphics3DSymbol(e,t)})):this.createGraphics3DSymbol(e,t),this.symbols.set(e.id,a)),Object(x.k)(a)&&++a.referenced,a}},{key:"trackGraphicState",value:function(e){return Object(x.j)(this.graphicStateTracking)&&(this.graphicStateTracking=new je(this)),this.graphicStateTracking.add(e)}},{key:"addGraphics3DGraphic",value:function(e){this._usedMemory+=e.usedMemory,this.graphics3DGraphics.set(e.graphic.uid,e),this.numberOfGraphics++,e.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider()),this.updateLayerVisibility()}},{key:"removeGraphics3DGraphic",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._usedMemory-=t,this.graphics3DGraphics.delete(e),this.numberOfGraphics--,i&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider()),this.updateLayerVisibility()}},{key:"_createGraphics3DGraphic",value:function(e,t){var i,a,r,n,s=t.graphic;if(this.graphicsWithoutSymbol.delete(s.uid),!this.symbols.has(e.symbol.id))return this.add([s]),null;if(this.graphics3DGraphics.has(s.uid))return null;var o=e.createGraphics3DGraphic(t);if(Object(x.j)(o))return null;this.addGraphics3DGraphic(o);var l=e.symbol.id;this.graphicsBySymbol.has(l)||this.graphicsBySymbol.set(l,new Map),this.graphicsBySymbol.get(l).set(s.uid,o),o.isDraped&&this.graphicsDrapedUids.add(s.uid),o.centroid=null,Object(x.k)(s.geometry)&&"point"!==s.geometry.type&&(o.centroid=Object(Se.a)(s.geometry,this._spatialReference)),this._updateUserVisibility(o),Object(x.k)(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(o),null==(i=this.filterVisibility)||i.updateVisibility(o),null==(a=this.deconflictor)||a.addGraphic(o),null==(r=this.labeler)||r.addGraphic(o),null==(n=this.objectStates)||n.addGraphic(o),this.deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,o),o.initialize(this.stage,this.stageLayer,this.owner),Object(x.k)(this.graphicStateTracking)&&this.graphicStateTracking.addGraphic(o);var c=this.whenGraphics3DGraphicRequests[s.uid];return c&&(delete this.whenGraphics3DGraphicRequests[s.uid],c.resolve(o)),o}},{key:"abortRendererChange",value:function(){this.rendererChangeAbortController&&(this.rendererChangeAbortController.abort(),this.rendererChangeAbortController=null)}},{key:"rendererChange",value:function(){var e=Object(o.a)(s.a.mark((function e(t){var i,a,r,n,o=this;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.abortRendererChange(),t===this.currentRenderer){e.next=36;break}if(this.validateRenderer(t),Object(x.j)(t)&&this.currentRendererChange(null,!1),!F(t)){e.next=35;break}if(!Object(x.k)(t)||!t.arcadeRequired){e.next=24;break}return i=Object(k.e)(),this.rendererChangeAbortController=i,e.next=7,this.ensureArcade();case 7:if(a=e.sent,r=a.arcadeUtils,Object(k.x)(i),e.t0=r.hasGeometryOperations(t),!e.t0){e.next=15;break}return e.next=14,r.enableGeometryOperations();case 14:Object(k.x)(i);case 15:if(0!==this.effectiveUpdatePolicy){e.next=20;break}return e.next=18,this._frameTask.schedule((function(){return o.currentRendererChange(t,!0)}),i.signal);case 18:e.next=21;break;case 20:this.currentRendererChange(t,!0);case 21:this.rendererChangeAbortController=null,e.next=33;break;case 24:if(0!==this.effectiveUpdatePolicy){e.next=32;break}return n=Object(k.e)(),this.rendererChangeAbortController=n,e.next=29,this._frameTask.schedule((function(){return o.currentRendererChange(t,!1)}),n.signal);case 29:this.rendererChangeAbortController=null,e.next=33;break;case 32:this.currentRendererChange(t,!1);case 33:e.next=36;break;case 35:this.currentRendererChange(t,!1);case 36:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"ensureArcade",value:function(){var e=Object(o.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Object(x.j)(this.arcadeOnDemand)){e.next=7;break}return e.next=3,Object(W.e)();case 3:this.arcadeOnDemand=e.sent,e.t0=this.arcadeOnDemand,e.next=8;break;case 7:e.t0=this.arcadeOnDemand;case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"currentRendererChange",value:function(e,t){this.currentRenderer=e,this.rendererHasGeometryOperations=t,this.symbolCreationContext.arcade=Object(x.t)(this.arcadeOnDemand);var i=this.symbolCreationContext.renderer;if(e!==i){if(this.symbolConversionCache.clear(),Object(x.j)(e))return this.symbolCreationContext.renderer=null,void this.recreateAllGraphics();var a=Object(I.a)(i,e);this.updateUnchangedSymbolMappings(a,e,i),this.symbolCreationContext.renderer=e,Object(x.j)(a)||("complete"===a.type?this.recreateAllGraphics():"partial"===a.type&&(this.applyRendererDiff(a,e,i)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("averageSymbolComplexity"))}}},{key:"diffHasSymbolChange",value:function(e){for(var t in e.diff)switch(t){case"visualVariables":case"defaultSymbol":case"uniqueValueInfos":break;case"authoringInfo":case"fieldDelimiter":delete e.diff[t];break;default:return!0}return!1}},{key:"applySymbolSetDiff",value:function(e,t,i){var a=this;e=e||[],t=t||[];var r,n=[],s=Object(l.a)(t);try{var o=function(){var t=r.value,s=a.graphicsBySymbol.get(t.id);s&&s.forEach((function(r,o){var l=r.graphic,c=a.layer instanceof A.a?a.layer:null,h=Object(x.t)(a.arcadeOnDemand);if(t!==i.defaultSymbol||i.getSymbol(Object(M.c)(l,c),{arcade:h})!==i.defaultSymbol){var u=r.usedMemory;e.length||i.defaultSymbol?n.push(l):a.graphicsWithoutSymbol.set(o,l);var d=a.graphics3DGraphics.get(o);a._conditionalRemove(d,o),r.destroy(),s.delete(o),a.removeGraphics3DGraphic(o,u),a.updateLayerVisibility()}})),a._whenSymbolRemoved.forAll((function(e){return e(t.id)}))};for(s.s();!(r=s.n()).done;)o()}catch(c){s.e(c)}finally{s.f()}(e.length||n.length)&&(this.graphicsWithoutSymbol.forEach((function(e){return n.push(e)})),this.graphicsWithoutSymbol.clear(),this.add(n)),this._cleanupSymbols(),this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty()}},{key:"applyUniqueValueRendererDiff",value:function(e,t,i){var a=e.diff.defaultSymbol,r=e.diff.uniqueValueInfos;if(a||r){var n=r?r.added.map((function(e){return e.symbol})):[],s=r?r.removed.map((function(e){return e.symbol})):[];if(r)for(var o=0;o<r.changed.length;o++)n.push(r.changed[o].newValue.symbol),s.push(r.changed[o].oldValue.symbol);return a?(i.defaultSymbol&&s.push(i.defaultSymbol),t.defaultSymbol&&n.push(t.defaultSymbol)):i.defaultSymbol&&n.length&&s.push(t.defaultSymbol),this.applySymbolSetDiff(n,s,t),delete e.diff.defaultSymbol,delete e.diff.uniqueValueInfos,!0}return!1}},{key:"calculateUnchangedSymbolMapping",value:function(e,t,i){var a=function(e){return Object(x.k)(e)?e.id:null};if(t instanceof b.a&&i instanceof b.a&&(Object(x.j)(e)||"partial"===e.type)){var r,n=e&&e.diff,s=n&&n.defaultSymbol,o=n&&n.uniqueValueInfos;return r=o?o.unchanged.map((function(e){return{oldId:a(e.oldValue.symbol),newId:a(e.newValue.symbol)}})):i.uniqueValueInfos.map((function(e,i){return{oldId:a(e.symbol),newId:a(t.uniqueValueInfos[i].symbol)}})),!s&&i.defaultSymbol&&r.push({oldId:a(i.defaultSymbol),newId:a(t.defaultSymbol)}),r}return[]}},{key:"updateSymbolMapping",value:function(e,t){var i=t?"string"==typeof t?t:t.id:null,a="string"==typeof t?null:t;if(e&&e!==i){var r=this.graphicsBySymbol.get(e);this.graphicsBySymbol.delete(e),void 0!==r&&this.graphicsBySymbol.set(i,r);var n=this.symbols.get(e);void 0!==n&&(this.symbols.delete(e),this.symbols.set(i,n),Object(x.k)(n)&&(Object(x.k)(a)?n.symbol=a:n.symbol.id=i))}}},{key:"updateUnchangedSymbolMappings",value:function(e,t,i){var a,r=this.calculateUnchangedSymbolMapping(e,t,i),n=Object(l.a)(r);try{for(n.s();!(a=n.n()).done;){var s=a.value,o=s.oldId,c=s.newId;this.updateSymbolMapping(o,c)}}catch(h){n.e(h)}finally{n.f()}}},{key:"applyRendererDiff",value:function(e,t,i){if(this.diffHasSymbolChange(e))return!1;if(t instanceof b.a&&i instanceof b.a&&this.applyUniqueValueRendererDiff(e,t,i)&&0===Object.keys(e.diff).length)return!0;var a,n=Object(l.a)(this.graphicsBySymbol);try{for(n.s();!(a=n.n()).done;){var s=Object(r.a)(a.value,1)[0],o=this.symbols.get(s);if(Object(x.k)(o)&&!o.applyRendererDiff(e,t))return!1}}catch(c){n.e(c)}finally{n.f()}return!0}},{key:"opacityChange",value:function(){this.forEachGraphics3DSymbol((function(e,t){return e.globalPropertyChanged("opacity",t)})),this.updateStageLayerVisibility()}},{key:"slicePlaneEnabledChange",value:function(e){e!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=e,this.stageLayer.isSliceable=e,this.forEachGraphics3DSymbol((function(e,t){return e.globalPropertyChanged("slicePlaneEnabled",t)})),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())}},{key:"physicalBasedRenderingChange",value:function(e){var t=this;e!==this.symbolCreationContext.physicalBasedRenderingEnabled&&(this.symbolCreationContext.physicalBasedRenderingEnabled=e,this.forEachGraphics3DSymbol((function(e,i,a){e.globalPropertyChanged("physicalBasedRenderingEnabled",i)||t._recreateSymbol(a)})))}},{key:"pixelRatioChange",value:function(){var e=this;this.forEachGraphics3DSymbol((function(t,i,a){t.globalPropertyChanged("pixelRatio",i)||e._recreateSymbol(a)}))}},{key:"_signalUpdatingDuringAsyncLoadedGraphicsChange",value:function(){var e=this;this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=Object(w.b)((function(){e._updatingPendingLoadedGraphicsChange=null}))}},{key:"setClippingExtent",value:function(e,t){var i=this.symbolCreationContext.clippingExtent,a=Object(V.l)();return Object(Be.b)(e,a,t)?this.symbolCreationContext.clippingExtent=Object(L.s)(Object(L.h)(),a):this.symbolCreationContext.clippingExtent=null,!Object(L.l)(this.symbolCreationContext.clippingExtent,i)}},{key:"modifyGraphics3DGraphicVisibilities",value:function(e){var t=!1;this.graphics3DGraphics.forEach((function(i){e(i)&&(t=!0)})),t&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())}},{key:"forEachGraphics3DSymbol",value:function(e){var t,i=Object(l.a)(this.symbols);try{for(i.s();!(t=i.n()).done;){var a=Object(r.a)(t.value,2),n=a[0],s=a[1];if(Object(x.j)(s))return;e(s,this.graphicsBySymbol.get(n)||at,n)}}catch(o){i.e(o)}finally{i.f()}}},{key:"updateAllGraphicsVisibility",value:function(){var e=this;this.filterVisibility&&(this.filterVisibility.dirty=!0),this.modifyGraphics3DGraphicVisibilities((function(t){var i=e._updateUserVisibility(t),a=Object(x.k)(e.scaleVisibility)&&e.scaleVisibility.updateVisibility(t);return i||a}))}},{key:"hideAllGraphics",value:function(){this.modifyGraphics3DGraphicVisibilities((function(e){return e.setVisibilityFlag(0,!1,0)}))}},{key:"validateRenderer",value:function(e){var t=T(e);if(t){var i="Renderer for layer '".concat(this.layer.title?"".concat(this.layer.title,", "):"",", id:").concat(this.layer.id,"' is not supported in a SceneView");Je.warn(i,t.message)}}},{key:"volatileGraphicsUpdated",value:function(){this.labeler&&this.labeler.reset(),this.stageLayer.shaderTransformationChanged(),this.notifyChange("updating")}},{key:"_cleanupSymbols",value:function(){var e=this;if(!(this.graphicsWaitingForSymbol.size>0||this.suspendSymbolCleanup)){var t=!1;this.symbols.forEach((function(i,a){if(!(Object(x.j)(i)||i.referenced>0)){var r=e.graphicsBySymbol.get(a);r&&0!==r.size||(e.graphicsBySymbol.delete(a),e.symbols.delete(a),i&&i.destroy(),t=!0)}})),t&&(this.recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}}},{key:"snapshotInternals",value:function(){var e=this;return{graphics:Object(a.a)(this.graphics3DGraphics.keys()).sort(),symbols:Object(a.a)(this.symbols.keys()).sort(),graphicsBySymbol:Object(a.a)(this.graphicsBySymbol.keys()).sort().map((function(t){return{symbolId:t,graphics:Object(a.a)(e.graphicsBySymbol.get(t).keys()).sort()}})),graphicsWithoutSymbol:Object(a.a)(this.graphicsWithoutSymbol.keys()).sort(),graphicsDrapedUids:Object(a.a)(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}}},{key:"test",get:function(){var e=this;return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size,forceUpdatePolicy:function(t){e.forcedUpdatePolicy=t}}}},{key:"performanceInfo",get:function(){return{visible:this.graphics3DGraphics.size,missing:this.graphicsWithoutSymbol.size,pending:this.pendingUpdates.size}}}]),i}(f.a);Ke.tmpVec=Object(P.e)(),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"computedExtent",void 0),Object(y.a)([Object(_.b)()],Ke.prototype,"currentRenderer",void 0),Object(y.a)([Object(_.b)()],Ke.prototype,"rendererHasGeometryOperations",void 0),Object(y.a)([Object(_.b)()],Ke.prototype,"_frameTask",void 0),Object(y.a)([Object(_.b)()],Ke.prototype,"rendererChangeAbortController",void 0),Object(y.a)([Object(_.b)()],Ke.prototype,"elevationInfoChangeAbortController",void 0),Object(y.a)([Object(_.b)()],Ke.prototype,"setupAbortController",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"elevationAlignment",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"scaleVisibility",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"filterVisibility",void 0),Object(y.a)([Object(_.b)()],Ke.prototype,"_spatialIndex",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"extentPadding",void 0),Object(y.a)([Object(_.b)()],Ke.prototype,"_updatingPendingLoadedGraphicsChange",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"featureStore",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"deconflictor",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"labeler",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"objectStates",void 0),Object(y.a)([Object(_.b)()],Ke.prototype,"preferredUpdatePolicy",void 0),Object(y.a)([Object(_.b)()],Ke.prototype,"forcedUpdatePolicy",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"effectiveUpdatePolicy",null),Object(y.a)([Object(_.b)({constructOnly:!0})],Ke.prototype,"elevationFeatureExpressionEnabled",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],Ke.prototype,"owner",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],Ke.prototype,"layer",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],Ke.prototype,"graphicSymbolSupported",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],Ke.prototype,"getRenderingInfoWithoutRenderer",void 0),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"updating",null),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"running",null),Object(y.a)([Object(_.b)({readOnly:!0})],Ke.prototype,"suspendedOrOutsideOfView",null),Object(y.a)([Object(_.b)({readOnly:!0,dependsOn:[]})],Ke.prototype,"updatingRemaining",null),Object(y.a)([Object(_.b)({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","averageSymbolComplexity"]})],Ke.prototype,"displayFeatureLimit",null),Object(y.a)([Object(_.b)({readOnly:!0,dependsOn:[]})],Ke.prototype,"averageSymbolComplexity",null),Object(y.a)([Object(_.b)({constructOnly:!0})],Ke.prototype,"hasZ",void 0),Object(y.a)([Object(_.b)({constructOnly:!0})],Ke.prototype,"hasM",void 0),Ke=Pe=Object(y.a)([Object(R.a)("esri.views.3d.layers.graphics.Graphics3DCore")],Ke);var $e=function(){function e(){Object(c.a)(this,e),this.add=null,this.renderingInfo=null,this.state=0,this.remove=null}return Object(h.a)(e,[{key:"clear",value:function(){this.add=null,this.renderingInfo=null,this.state=0,this.abortController=null,this.remove=null}}]),e}(),et=10,tt=Object(P.e)(),it=Object(P.e)(),at=new Map}}]);
//# sourceMappingURL=2.cbbf52cc.chunk.js.map